import{_ as Lt}from"./VPagination.vuevuetypescriptsetuptruelang-DzqpJyre.js";import{m as We,c as p,o as a,a as n,i as _e,a_ as Rt,a$ as Mt,s as me,g as Xe,u as Je,a2 as w,aE as Ye,D as ve,r as U,b0 as Bt,e as Vt,f as zt,G as Ut,af as Ge,aC as Nt,H as Ht,I as Qt,aD as Gt,aF as Kt,ag as Ot,J as jt,aH as Wt,aI as Xt,K as Jt,L as Yt,k as l,l as e,j as Y,t as y,Q as L,p as r,M as Zt,O as u,a3 as d,y as i,aJ as ce,aK as re,ai as xt,aL as es,P as Ke,R as ue,S as ts,aM as ss,b1 as os,a6 as as,aP as ns,ah as ls,aQ as is,N as ds,an as cs,U as rs,aX as us,ay as ps,n as _s,a8 as ms,aS as vs,W as gs,ao as ks,aG as Oe,b2 as ys,X as hs,Y as fs,Z as $s,d as bs,z as Cs,$ as Ts,a0 as Is,aT as je,a1 as ws,b3 as Es,F as Ds}from"./index-BOocQAqZ.js";import{_ as As,a as qs}from"./SearchInput-CGRIMF-l.js";import{_ as Ss}from"./sort-rounded-B3sZF1TK.js";import{_ as Fs}from"./upload-rounded-DgeoBiTy.js";import{u as Ps}from"./search-DtIxMFMN.js";import{u as Ls,a as Rs}from"./key-events-j-7DpEu_.js";import{a as Ms}from"./tags-x5k-cbnO.js";import"./search-rounded-CyzWHMe0.js";import"./vee-validate-CU2Cxe7k.js";const Bs={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Vs(E,k){return a(),p("svg",Bs,k[0]||(k[0]=[n("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V9q0-.425-.288-.712T10 8t-.712.288T9 9v6q0 .425.288.713T10 16m4 0q.425 0 .713-.288T15 15V9q0-.425-.288-.712T14 8t-.712.288T13 9v6q0 .425.288.713T14 16m-2 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const zs=We({name:"material-symbols-pause-circle-outline-rounded",render:Vs}),Us={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ns(E,k){return a(),p("svg",Us,k[0]||(k[0]=[n("path",{fill:"currentColor",d:"M3 16v-2h7v2zm0-4v-2h11v2zm0-4V6h11v2zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4z"},null,-1)]))}const Hs=We({name:"material-symbols-playlist-add",render:Ns});function pe(E,k,D=500){const v=E.cloneNode(!0),h=E.getBoundingClientRect(),R=k.getBoundingClientRect();v.style.position="absolute",v.style.top=h.top+"px",v.style.left=h.left+"px",v.style.opacity=1,document.body.appendChild(v);let f=0;function A(V){f||(f=V);const N=V-f,P=Math.min(N/D,1);v.style.top=h.top+(R.top-h.top)*P+"px",v.style.left=h.left+(R.left-h.left)*P+"px",P<1?requestAnimationFrame(A):document.body.removeChild(v)}requestAnimationFrame(A)}const Qs=(E,k)=>{const{mutate:D,loading:v,onDone:h}=_e({document:Rt}),{mutate:R,loading:f,onDone:A}=_e({document:Mt}),{app:V}=me(Xe()),{t:N}=Je();h(()=>{w.emit("refetch_app"),k()}),A(()=>{w.emit("refetch_app")});const P=Ye(()=>{var $;return(($=V.value)==null?void 0:$.audios)??[]}),j=$=>P.value.some(b=>b.path===$.path);return{loading:v,removeLoading:f,isInPlaylist:j,addItemsToPlaylist:($,b,M,H)=>{let Q=H;if(!M){if(b.length===0){ve(N("select_first"),"error");return}Q=`ids:${b.join(",")}`}const G=$.target,B=document.getElementById("quick-audio");pe(G,B),D({query:Q})},removeItemsFromPlaylist:($,b,M,H)=>{if(M)E.value.filter(B=>j(B)).forEach(B=>{R({path:B.path})});else{if(b.length===0){ve(N("select_first"),"error");return}E.value.filter(z=>b.includes(z.id)&&j(z)).forEach(z=>{R({path:z.path})})}const Q=$.target,G=document.getElementById("quick-audio");pe(Q,G)},addToPlaylist:($,b)=>{const M=$.target,H=document.getElementById("quick-audio");pe(M,H),D({query:`ids:${b.id}`})},removeFromPlaylist:($,b)=>{R({path:b.path})}}},Gs=()=>{const E=U(""),{mutate:k,loading:D,onDone:v}=_e({document:Bt});return v(()=>{w.emit("play_audio")}),{loading:D,playPath:E,play:h=>{E.value=h.path,k({path:h.path})},pause:()=>{w.emit("pause_audio")}}},Ks={class:"top-app-bar"},Os=["checked","indeterminate"],js={class:"title"},Ws={key:0},Xs={key:1},Js={class:"actions"},Ys=["onClick"],Zs={slot:"headline"},xs=["onClick"],eo={slot:"headline"},to={class:"menu-items"},so=["selected","onClick"],oo={slot:"headline"},ao=["onClick","onMouseover"],no={class:"start"},lo=["checked","onClick"],io=["checked","onClick"],co={class:"number"},ro={class:"image"},uo=["src"],po=["src","onError"],_o={class:"title"},mo={class:"subtitle"},vo={class:"duration"},go=["onClick"],ko={class:"actions"},yo={key:2,indeterminate:"",class:"spinner-sm"},ho={class:"artist"},fo={class:"time"},$o={class:"start"},bo={class:"number"},Co={key:0,class:"no-data-placeholder"},O=50,To=Vt({__name:"AudiosView",setup(E){var Be;const k=zt(),{audioSortBy:D}=me(k),v=U([]),{t:h}=Je(),{parseQ:R}=Ps(),f=Ut({tagIds:[],bucketId:void 0}),{app:A,urlTokenKey:V,audioPlaying:N,uploads:P}=me(Xe()),j=t=>{var o;return N.value&&((o=A.value)==null?void 0:o.audioCurrent)===t.path},{input:$,upload:b,uploadChanged:M}=Ge(P),{input:H,upload:Q,uploadChanged:G}=Ge(P),{dropping:B,fileDragEnter:z,fileDragLeave:ge,dropFiles:Ze}=Nt(P),te=U(!1),g=Ht.AUDIO,ke=Qt(),ye=ke.query,se=U(parseInt(((Be=ye.page)==null?void 0:Be.toString())??"1")),{tags:Z,buckets:x,fetch:xe}=Gt(g),et=Ye(()=>{const t={};return x.value.forEach(o=>{t[o.id]=o}),t}),q=U(""),{addToTags:tt}=Ms(g,Z),{deleteItems:oe,deleteItem:he}=Kt(),{view:st}=vs(g),{selectedIds:T,allChecked:fe,realAllChecked:S,selectRealAll:ot,allCheckedAlertVisible:at,clearSelection:K,toggleAllChecked:$e,toggleSelect:be,total:F,checked:ae,shiftEffectingIds:Ce,handleItemClick:nt,handleMouseOver:lt,selectAll:it,shouldSelect:dt}=Ls(v),{downloadItems:Te}=Ot(V,g,K,"audios.zip"),{downloadFile:Ie}=ks(V),we=t=>{const o=ke.query.q;Cs(k,o?`/audios?page=${t}&q=${o}`:`/audios?page=${t}`)},{keyDown:Ee,keyUp:De}=Rs(F,O,se,it,K,we,()=>{ce(re.MEDIA_TRASH,A.value.osVersion)?le(g,J()):oe(g,T.value,S.value,F.value,q.value)}),{addItemsToPlaylist:ct,addToPlaylist:rt,removeFromPlaylist:ut,isInPlaylist:pt}=Qs(v,K),_t=cs(),Ae=U([]),W=U([]),{play:mt,playPath:vt,loading:gt,pause:kt}=Gs(),yt=t=>{Ae.value.push(t)},{loading:ne,fetch:X}=jt({handle:(t,o)=>{te.value=!1,o?ve(h(o),"error"):t&&(v.value=t.items,F.value=t.total)},document:os,variables:()=>({offset:(se.value-1)*O,limit:O,query:q.value,sortBy:D.value})}),{trashLoading:qe,trash:le}=Wt(),{restoreLoading:Se,restore:Fe}=Xt();function ht(t){return t?`/audios?q=${t}`:"/audios"}function ft(t,o){if(D.value===o){t.close();return}te.value=!0,D.value=o,t.close()}function ie(){const t=x.value.find(o=>o.id===f.bucketId);return t?je(t.topItems[0]):`${A.value.internalStoragePath}/Music`}function $t(t){b(ie()),t.close()}function bt(t){Q(ie()),t.close()}function Ct(t){Ze(t,ie(),"audio")}const J=()=>{let t=q.value;return S.value||(t=`ids:${T.value.join(",")}`),t},Pe=t=>{t.type===g&&(K(),X())},Le=t=>{t.type===g&&X()},Re=t=>{t.type===g&&(K(),X())},Me=t=>{t.status==="done"&&Es(t.fileName)&&(!f.bucketId||x.value.some(C=>C.id===f.bucketId&&C.topItems.some(c=>t.dir.startsWith(je(c)))))&&setTimeout(()=>{X()},1e3)};function Tt(t){const o=t.tags.map(C=>C.id);Ts(Is,{type:g,tags:Z.value,item:{key:t.id,title:t.title,size:t.size},selected:Z.value.filter(C=>o.includes(C.id))})}function It(t,o){W.value.push(o.id),setTimeout(()=>{ut(t,o),setTimeout(()=>{W.value=W.value.filter(C=>C!==o.id)},300)},150)}return Jt(()=>{var t;q.value=ws(((t=ye.q)==null?void 0:t.toString())??""),R(f,q.value),xe(),X(),w.on("item_tags_updated",Le),w.on("items_tags_updated",Pe),w.on("media_items_actioned",Re),w.on("upload_task_done",Me),window.addEventListener("keydown",Ee),window.addEventListener("keyup",De)}),Yt(()=>{w.off("item_tags_updated",Le),w.off("items_tags_updated",Pe),w.off("media_items_actioned",Re),w.off("upload_task_done",Me),window.removeEventListener("keydown",Ee),window.removeEventListener("keyup",De)}),(t,o)=>{const C=as,c=ss,Ve=ns,ee=ls,ze=is,Ue=Hs,Ne=ds,wt=As,Et=Fs,He=xt,Dt=Ss,At=qs,qt=rs,St=gs,Qe=ys,Ft=zs,Pt=Lt,_=Zt("tooltip");return a(),p(L,null,[n("div",Ks,[n("md-checkbox",{"touch-target":"wrapper",checked:e(fe),indeterminate:!e(fe)&&e(ae),onChange:o[0]||(o[0]=(...s)=>e($e)&&e($e)(...s))},null,40,Os),n("div",js,[e(T).length?(a(),p("span",Ws,y(t.$t("x_selected",{count:e(S)?e(F).toLocaleString():e(T).length.toLocaleString()})),1)):(a(),p("span",Xs,y(t.$t("page_title.audios"))+" ("+y(e(F).toLocaleString())+")",1)),e(ae)?(a(),p(L,{key:2},[f.trash?(a(),p(L,{key:0},[r((a(),u(c,{onClick:o[1]||(o[1]=i(s=>e(oe)(e(g),e(T),e(S),e(F),q.value),["stop"]))},{icon:d(()=>[l(C)]),_:1})),[[_,t.$t("delete")]]),r((a(),u(c,{loading:e(Se)(J()),onClick:o[2]||(o[2]=i(s=>e(Fe)(e(g),J()),["stop"]))},{icon:d(()=>[l(Ve)]),_:1},8,["loading"])),[[_,t.$t("restore")]]),r((a(),u(c,{onClick:o[3]||(o[3]=i(s=>e(Te)(e(S),e(T),q.value),["stop"]))},{icon:d(()=>[l(ee)]),_:1})),[[_,t.$t("download")]])],64)):(a(),p(L,{key:1},[e(ce)(e(re).MEDIA_TRASH,e(A).osVersion)?r((a(),u(c,{key:0,loading:e(qe)(J()),onClick:o[4]||(o[4]=i(s=>e(le)(e(g),J()),["stop"]))},{icon:d(()=>[l(ze)]),_:1},8,["loading"])),[[_,t.$t("move_to_trash")]]):r((a(),u(c,{key:1,onClick:o[5]||(o[5]=i(s=>e(oe)(e(g),e(T),e(S),e(F),q.value),["stop"]))},{icon:d(()=>[l(C)]),_:1})),[[_,t.$t("delete")]]),r((a(),u(c,{onClick:o[6]||(o[6]=i(s=>e(Te)(e(S),e(T),q.value),["stop"]))},{icon:d(()=>[l(ee)]),_:1})),[[_,t.$t("download")]]),r((a(),u(c,{onClick:o[7]||(o[7]=i(s=>e(ct)(s,e(T),e(S),q.value),["stop"]))},{icon:d(()=>[l(Ue)]),_:1})),[[_,t.$t("add_to_playlist")]]),r((a(),u(c,{onClick:o[8]||(o[8]=i(s=>e(tt)(e(T),e(S),q.value),["stop"]))},{icon:d(()=>[l(Ne)]),_:1})),[[_,t.$t("add_to_tags")]])],64))],64)):Y("",!0)]),n("div",Js,[l(wt,{filter:f,tags:e(Z),buckets:e(x),"get-url":ht},null,8,["filter","tags","buckets"]),l(He,null,{content:d(s=>[n("md-menu-item",{onClick:i(I=>$t(s),["stop"])},[n("div",Zs,y(t.$t("upload_files")),1)],8,Ys),n("md-menu-item",{onClick:i(I=>bt(s),["stop"])},[n("div",eo,y(t.$t("upload_folder")),1)],8,xs)]),default:d(()=>[r((a(),u(c,null,{icon:d(()=>[l(Et)]),_:1})),[[_,t.$t("upload")]])]),_:1}),l(He,null,{content:d(s=>[n("div",to,[(a(!0),p(L,null,ue(e(_t),I=>(a(),p("md-menu-item",{key:I.value,selected:I.value===e(D),onClick:de=>ft(s,I.value)},[n("div",oo,y(t.$t(I.label)),1)],8,so))),128))])]),default:d(()=>[r((a(),u(c,{loading:te.value},{icon:d(()=>[l(Dt)]),_:1},8,["loading"])),[[_,t.$t("sort")]])]),_:1})])]),l(At,{limit:O,total:e(F),"all-checked-alert-visible":e(at),"real-all-checked":e(S),"select-real-all":e(ot),"clear-selection":e(K)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),n("div",{class:"scroll-content",onDragover:o[13]||(o[13]=i((...s)=>e(z)&&e(z)(...s),["stop","prevent"]))},[r(n("div",{class:"drag-mask",onDrop:i(Ct,["stop","prevent"]),onDragleave:o[9]||(o[9]=i((...s)=>e(ge)&&e(ge)(...s),["stop","prevent"]))},y(t.$t("release_to_send_files")),545),[[es,e(B)]]),n("div",{class:Ke(["audio-list",{"select-mode":e(ae)}])},[(a(!0),p(L,null,ue(v.value,(s,I)=>{var de;return a(),p("section",{key:s.id,class:Ke(["media-item selectable-card",{selected:e(T).includes(s.id),selecting:e(Ce).includes(s.id)}]),onClick:i(m=>e(nt)(m,s,I,()=>{e(mt)(s)}),["stop"]),onMouseover:m=>e(lt)(m,I)},[n("div",no,[e(Ce).includes(s.id)?(a(),p("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:e(dt),onClick:i(m=>e(be)(m,s,I),["stop"])},null,8,lo)):(a(),p("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:e(T).includes(s.id),onClick:i(m=>e(be)(m,s,I),["stop"])},null,8,io)),n("span",co,[l(qt,{id:I+1,raw:s},null,8,["id","raw"])])]),n("div",ro,[Ae.value.includes(s.id)?(a(),p("img",{key:0,src:`/ficons/${e(us)(s.path)}.svg`,class:"svg"},null,8,uo)):(a(),p("img",{key:1,class:"image-thumb",src:e(ps)(s.albumFileId,"&w=200&h=200"),onError:m=>yt(s.id)},null,40,po))]),n("div",_o,y(s.title),1),n("div",mo,[n("span",null,y(e(_s)(s.size)),1),n("span",vo,y(e(ms)(s.duration)),1),n("a",{onClick:i(m=>e(st)(e(k),s.bucketId),["stop","prevent"])},y((de=et.value[s.bucketId])==null?void 0:de.name),9,go),l(St,{tags:s.tags,type:e(g),"only-links":!0},null,8,["tags","type"])]),n("div",ko,[f.trash?(a(),p(L,{key:0},[r((a(),u(c,{class:"sm",onClick:i(m=>e(he)(e(g),s),["stop"])},{icon:d(()=>[l(C)]),_:2},1032,["onClick"])),[[_,t.$t("delete")]]),r((a(),u(c,{class:"sm",loading:e(Se)(`ids:${s.id}`),onClick:i(m=>e(Fe)(e(g),`ids:${s.id}`),["stop"])},{icon:d(()=>[l(Ve)]),_:2},1032,["loading","onClick"])),[[_,t.$t("restore")]]),r((a(),u(c,{class:"sm",onClick:i(m=>e(Ie)(s.path,e(Oe)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(ee)]),_:2},1032,["onClick"])),[[_,t.$t("download")]])],64)):(a(),p(L,{key:1},[e(ce)(e(re).MEDIA_TRASH,e(A).osVersion)?r((a(),u(c,{key:0,class:"sm",loading:e(qe)(`ids:${s.id}`),onClick:i(m=>e(le)(e(g),`ids:${s.id}`),["stop"])},{icon:d(()=>[l(ze)]),_:2},1032,["loading","onClick"])),[[_,t.$t("move_to_trash")]]):r((a(),u(c,{key:1,class:"sm",onClick:i(m=>e(he)(e(g),s),["stop"])},{icon:d(()=>[l(C)]),_:2},1032,["onClick"])),[[_,t.$t("delete")]]),r((a(),u(c,{class:"sm",onClick:i(m=>e(Ie)(s.path,e(Oe)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(ee)]),_:2},1032,["onClick"])),[[_,t.$t("download")]]),e(pt)(s)&&!W.value.includes(s.id)?r((a(),u(c,{key:2,class:"sm",onClick:i(m=>It(m,s),["stop","prevent"])},{icon:d(()=>[l(Qe,{class:"playlist-remove-icon"})]),_:2},1032,["onClick"])),[[_,t.$t("remove_from_playlist")]]):W.value.includes(s.id)?(a(),u(c,{key:3,class:"sm",disabled:!0},{icon:d(()=>[l(Qe,{class:"playlist-remove-icon rotating"})]),_:1})):r((a(),u(c,{key:4,class:"sm",onClick:i(m=>e(rt)(m,s),["stop","prevent"])},{icon:d(()=>[l(Ue)]),_:2},1032,["onClick"])),[[_,t.$t("add_to_playlist")]]),r((a(),u(c,{class:"sm",onClick:i(m=>Tt(s),["stop"])},{icon:d(()=>[l(Ne)]),_:2},1032,["onClick"])),[[_,t.$t("add_to_tags")]])],64)),e(gt)&&s.path===e(vt)?(a(),p("md-circular-progress",yo)):j(s)?r((a(),u(c,{key:3,class:"sm",onClick:o[10]||(o[10]=i(m=>e(kt)(),["stop"]))},{icon:d(()=>[l(Ft)]),_:1})),[[_,t.$t("pause")]]):Y("",!0)]),n("div",ho,y(s.artist),1),n("div",fo,[r((a(),p("span",null,[fs(y(e($s)(s.createdAt)),1)])),[[_,e(hs)(s.createdAt)]])])],42,ao)}),128)),e(ne)&&v.value.length===0?(a(),p(L,{key:0},ue(20,s=>n("section",{key:s,class:"media-item selectable-card-skeleton"},[n("div",$o,[o[14]||(o[14]=n("div",{class:"checkbox"},[n("div",{class:"skeleton-checkbox"})],-1)),n("span",bo,y(s),1)]),o[15]||(o[15]=bs('<div class="image" data-v-d8431b55><div class="skeleton-image" data-v-d8431b55></div></div><div class="title" data-v-d8431b55><div class="skeleton-text skeleton-title" data-v-d8431b55></div></div><div class="subtitle" data-v-d8431b55><div class="skeleton-text skeleton-subtitle" data-v-d8431b55></div></div><div class="actions" data-v-d8431b55><div class="skeleton-text skeleton-actions" data-v-d8431b55></div></div><div class="artist" data-v-d8431b55><div class="skeleton-text skeleton-artist" data-v-d8431b55></div></div><div class="time" data-v-d8431b55><div class="skeleton-text skeleton-time" data-v-d8431b55></div></div>',6))])),64)):Y("",!0)],2),!e(ne)&&v.value.length===0?(a(),p("div",Co,y(t.$t(e(ts)(e(ne),e(A).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):Y("",!0),e(F)>O?(a(),u(Pt,{key:1,page:se.value,go:we,total:e(F),limit:O},null,8,["page","total"])):Y("",!0),n("input",{ref_key:"fileInput",ref:$,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",onChange:o[11]||(o[11]=(...s)=>e(M)&&e(M)(...s))},null,544),n("input",{ref_key:"dirFileInput",ref:H,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:o[12]||(o[12]=(...s)=>e(G)&&e(G)(...s))},null,544)],32)],64)}}}),Ro=Ds(To,[["__scopeId","data-v-d8431b55"]]);export{Ro as default};
