import{_ as Me}from"./LeftSidebar.vuevuetypescriptsetuptruelang-DEmfzh0O.js";import{a as xe,_ as Se,b as Te}from"./TagFilter-CV0FK2WV.js";import{_ as Ie}from"./more-vert-CdXXCe8G.js";import{e as O,aw as ne,r,i as N,c5 as qe,ax as ae,ay as se,ad as le,aA as ce,az as A,R as Q,o as _,p as u,k as p,F as g,t as s,as as de,j as D,l as o,Y as ue,z as ie,a as c,q as re,v as _e,x as pe,aB as me,c6 as Re,u as Ae,f as De,s as Qe,g as Be,I as Ge,L as Ne,w as Ue,h as Ke,bl as ze,E as X,a4 as B,ae as Oe,a5 as Z,a3 as Pe,c7 as je,c8 as He,c9 as Ye,ca as Je,c as $,y as G,S as K,U as ee,O as te,P as We,T as oe,a1 as z,ab as Xe,cb as Ze,A as et}from"./index-Bm4LvS3o.js";import{_ as fe}from"./VCheckbox-BGOsDzY1.js";import{u as tt}from"./feeds-e_PfmHAA.js";import{u as ot}from"./search-KPji0eDE.js";import"./VIconButton.vuevuetypescriptsetuptruelang-BiHMDYOC.js";const nt={class:"form-row"},at={class:"form-row"},st={class:"form-check-label"},lt=O({__name:"AddFeedModal",props:{done:{type:Function,required:!0}},setup(I){const{handleSubmit:F}=ne(),b=r(),d=r(!1);function q(e){d.value=e.target.checked}const f=I,{mutate:L,loading:w,onDone:k}=N({document:qe}),{value:l,resetField:m,errorMessage:v}=ae("inputValue",se().required());m();function h(){A()}le(async()=>{await ce(),requestAnimationFrame(()=>{setTimeout(()=>{var e;try{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),(e=b.value)==null||e.focus()}catch(i){console.debug("Focus blocked:",i)}},100)})});const y=F(()=>{L({url:l.value??"",fetchContent:d.value})});return k(()=>{var e;(e=f.done)==null||e.call(this),A()}),(e,i)=>{const E=pe,M=fe,x=de,R=ue,S=ie,T=me;return _(),Q(T,{onClose:h},{headline:u(()=>[g(s(e.$t("add_subscription")),1)]),content:u(()=>[c("div",nt,[p(E,{ref_key:"inputRef",ref:b,modelValue:o(l),"onUpdate:modelValue":i[0]||(i[0]=V=>_e(l)?l.value=V:null),label:e.$t("rss_url"),error:!!o(v),"error-text":o(v)?e.$t(o(v)):"",onKeyup:re(o(y),["enter"])},null,8,["modelValue","label","error","error-text","onKeyup"])]),c("div",at,[c("label",st,[p(M,{"touch-target":"wrapper",checked:d.value,onChange:q},null,8,["checked"]),g(" "+s(e.$t("fetch_content_automatically")),1)])])]),actions:u(()=>[p(x,{value:"cancel",onClick:h},{default:u(()=>[g(s(e.$t("cancel")),1)]),_:1}),p(S,{value:"save",disabled:o(w),onClick:o(y)},{default:u(()=>[o(w)?(_(),Q(R,{key:0,slot:"icon",indeterminate:""})):D("",!0),g(" "+s(e.$t("save")),1)]),_:1},8,["disabled","onClick"])]),_:1})}}}),ct={class:"form-label"},dt={class:"form-row"},ut={class:"form-row"},it={class:"form-check-label"},rt=O({__name:"FeedModal",props:{data:{type:Object,required:!0}},setup(I){var h,y;const{handleSubmit:F}=ne(),b=r(),d=r(!1);function q(e){d.value=e.target.checked}const f=I,{mutate:L,loading:w,onDone:k}=N({document:Re}),{value:l,errorMessage:m}=ae("inputValue",se().required());l.value=((h=f.data)==null?void 0:h.name)??"",d.value=((y=f.data)==null?void 0:y.fetchContent)??!1,(async()=>(await ce(),requestAnimationFrame(()=>{setTimeout(()=>{var e;try{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),(e=b.value)==null||e.focus()}catch(i){console.debug("Focus blocked:",i)}},100)})))();const v=F(()=>{var e;L({id:(e=f.data)==null?void 0:e.id,name:l.value,fetchContent:d.value})});return k(()=>{A()}),(e,i)=>{const E=pe,M=fe,x=de,R=ue,S=ie,T=me;return _(),Q(T,{onClose:o(A)},{headline:u(()=>[g(s(e.$t("update_subscription")),1)]),content:u(()=>{var V;return[c("div",ct,s((V=I.data)==null?void 0:V.url),1),c("div",dt,[p(E,{ref_key:"inputRef",ref:b,modelValue:o(l),"onUpdate:modelValue":i[0]||(i[0]=U=>_e(l)?l.value=U:null),class:"form-control",label:e.$t("name"),error:!!o(m),"error-text":o(m)?e.$t(o(m)):"",onKeyup:re(o(v),["enter"])},null,8,["modelValue","label","error","error-text","onKeyup"])]),c("div",ut,[c("label",it,[p(M,{"touch-target":"wrapper",checked:d.value,onChange:q},null,8,["checked"]),g(" "+s(e.$t("fetch_content_automatically")),1)])])]}),actions:u(()=>[p(x,{value:"cancel",onClick:o(A)},{default:u(()=>[g(s(e.$t("cancel")),1)]),_:1},8,["onClick"]),p(S,{value:"save",disabled:o(w),onClick:o(v)},{default:u(()=>[o(w)?(_(),Q(R,{key:0,slot:"icon",indeterminate:""})):D("",!0),g(" "+s(e.$t("save")),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["onClose"])}}}),_t={class:"nav"},pt={class:"title"},mt={key:0,class:"count"},ft={class:"title"},vt={key:0,class:"count"},ht=["onClick"],gt={class:"title"},bt=["id","onClick"],kt={key:0,class:"count"},yt=["onClick"],xt=O({__name:"FeedsSidebar",setup(I){const{t:F}=Ae(),b=De(),{counter:d}=Qe(Be()),{parseQ:q}=ot(),f=Ge({tagIds:[]}),L=r([]),w=[{text:"add_subscription",click:ve},{text:"import_opml_file",click:ye},{text:"export_opml_file",click:Ce}],k=r(!1),l=r(""),m=r(""),v=r(!1),h=r(),y=r(new Map),e=r(!1),i=r(),{fetch:E}=Ne({handle:t=>{t&&(d.value.feedEntries=t.total,d.value.feedEntriesToday=t.today,t.feedsCount.forEach(n=>{y.value.set(n.id,n.count)}))},document:je,variables:()=>({})});function M(t){return y.value.get(t)??-1}function x(){var C;const t=Z.currentRoute.value,n=Pe(((C=t.query.q)==null?void 0:C.toString())??"");q(f,n),l.value=f.tagIds.length===1?f.tagIds[0]:"",m.value=f.feedId??"",v.value=f.today??!1,v.value?(l.value="",m.value=""):l.value&&m.value&&(l.value=""),E()}x(),Ue(()=>Z.currentRoute.value,()=>{x()});const{viewFeed:R,viewAll:S,viewToday:T}=tt(b),{refetch:V}=Ke({handle:(t,n)=>{n?X(F(n),"error"):t&&(L.value=t.feeds)},document:He});function U(t){const n=t.target.files;if(!n)return;const C=new FileReader;C.addEventListener("load",()=>{be({content:C.result})},!1),C.readAsText(n[0])}function ve(){z(lt,{done:()=>{V()}})}const{mutate:he,onDone:ge}=N({document:Ye});ge(t=>{ze(t.data.exportFeeds,"application/xml","feeds.xml")});const{mutate:be,onDone:ke}=N({document:Je});ke(()=>{X(F("imported")),V()});function ye(){h.value.value="",h.value.click()}function Ce(){he()}function $e(t){i.value=t;const n=document.getElementById("feed-"+t.id);document.dispatchEvent(new CustomEvent("dropdown-toggle",{detail:{exclude:n}})),e.value=!0}function Fe(t){z(rt,{data:t})}function we(t){z(Xe,{id:t.id,name:t.name,gql:Ze,typeName:"Feed",done:()=>{et(b,"/feeds")}})}const P=()=>{E()},j=()=>{E()};return le(()=>{B.on("feed_entries_deleted",P),B.on("feeds_fetched",j)}),Oe(()=>{B.off("feed_entries_deleted",P),B.off("feeds_fetched",j)}),(t,n)=>{const C=Te,Ee=Ie,H=xe,Ve=Se,Le=Me,Y=We("tooltip");return _(),Q(Le,null,{title:u(()=>[g(s(t.$t("page_title.feeds")),1)]),actions:u(()=>[te((_(),$("button",{id:"add-feed-ref",class:"btn-icon",onClick:n[0]||(n[0]=()=>k.value=!0)},[p(C)])),[[Y,o(F)("add_subscription")]])]),body:u(()=>{var J;return[c("ul",_t,[c("li",{class:K({active:!v.value&&!l.value&&!m.value}),onClick:n[1]||(n[1]=G((...a)=>o(S)&&o(S)(...a),["prevent"]))},[c("span",pt,s(t.$t("all")),1),o(d).feedEntries>=0?(_(),$("span",mt,s(o(d).feedEntries.toLocaleString()),1)):D("",!0)],2),c("li",{class:K({active:v.value}),onClick:n[2]||(n[2]=G((...a)=>o(T)&&o(T)(...a),["prevent"]))},[c("span",ft,s(t.$t("today")),1),o(d).feedEntriesToday>=0?(_(),$("span",vt,s(o(d).feedEntriesToday.toLocaleString()),1)):D("",!0)],2),(_(!0),$(oe,null,ee(L.value,a=>(_(),$("li",{key:a.id,class:K({active:m.value&&a.id===m.value}),onClick:G(W=>o(R)(a),["stop","prevent"])},[c("span",gt,s(a.name),1),te((_(),$("button",{id:"feed-"+a.id,class:"btn-icon sm",onClick:G(W=>$e(a),["prevent","stop"])},[p(Ee)],8,bt)),[[Y,t.$t("actions")]]),M(a.id)>=0?(_(),$("span",kt,s(M(a.id).toLocaleString()),1)):D("",!0)],10,ht))),128))]),p(H,{modelValue:k.value,"onUpdate:modelValue":n[3]||(n[3]=a=>k.value=a),anchor:"add-feed-ref"},{default:u(()=>[(_(),$(oe,null,ee(w,a=>c("div",{key:a.text,class:"dropdown-item",onClick:W=>{a.click(),k.value=!1}},s(t.$t(a.text)),9,yt)),64))]),_:1},8,["modelValue"]),p(H,{modelValue:e.value,"onUpdate:modelValue":n[6]||(n[6]=a=>e.value=a),anchor:"feed-"+((J=i.value)==null?void 0:J.id)},{default:u(()=>[c("div",{class:"dropdown-item",onClick:n[4]||(n[4]=a=>{Fe(i.value),e.value=!1})},s(t.$t("edit")),1),c("div",{class:"dropdown-item",onClick:n[5]||(n[5]=a=>{we(i.value),e.value=!1})},s(t.$t("delete")),1)]),_:1},8,["modelValue","anchor"]),p(Ve,{type:"FEED_ENTRY",selected:l.value},null,8,["selected"]),c("input",{ref_key:"fileInput",ref:h,style:{display:"none"},accept:".xml",type:"file",onChange:U},null,544)]}),_:1})}}});export{xt as default};
