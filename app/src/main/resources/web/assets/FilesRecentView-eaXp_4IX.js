import{e as re,u as ue,r as f,g as _e,s as pe,i as ve,at as he,L as ke,M as me,N as fe,c as a,o,a as n,j as g,R as S,k as _,O as y,l as s,t as i,P as ge,y as p,aj as ye,T as K,U as be,p as T,bm as we,V as Ee,bF as Ce,bR as Ie,E as Se,bE as Te,d as De,S as Le,bH as G,aG as Ve,n as $e,$ as Fe,F as Ae,a0 as Ne,bI as Re,bS as xe,bM as Me,ao as Ue,bN as Be,bO as Oe,bJ as ze,a4 as v,bQ as Ke}from"./index-CextXMl7.js";import{_ as Ge}from"./FieldId.vuevuetypescriptsetuptruelang-B-w7x5OO.js";import{_ as He}from"./VCheckbox-DS09yxvJ.js";import{u as Qe,c as je}from"./key-events-CRk-BMl_.js";const Je={class:"top-app-bar"},Pe={key:0},We={key:1},Xe={key:0,class:"scroller"},qe={class:"start"},Ye={class:"number"},Ze=["onClick","onMouseover"],es={class:"start"},ss={class:"number"},ts=["onClick"],os={key:0,class:"svg",src:G},ns=["src","onError"],as=["src","onError"],ls={key:3,class:"svg",src:G},cs={class:"title"},is={class:"subtitle"},ds={class:"actions"},rs=["onClick"],us={class:"btn-icon sm"},_s={class:"card card-info"},ps={class:"key-value vertical"},vs={class:"key"},hs={class:"value"},ks={key:2,class:"no-data-placeholder"},ws=re({__name:"FilesRecentView",setup(ms){const{t:H}=ue(),Q=f([]),D=_e(),{app:j,urlTokenKey:b}=pe(D),r=f([]),{selectedIds:h,allChecked:L,realAllChecked:J,clearSelection:w,toggleAllChecked:P,toggleSelect:V,total:E,checked:$,shiftEffectingIds:F,handleItemClick:W,handleMouseOver:X,selectAll:q,shouldSelect:Y}=Qe(r),{downloadFile:A,downloadFiles:Z}=he(b),{view:ee}=Oe(Q,(e,l)=>{D.lightbox={sources:e,index:l,visible:!0}}),{keyDown:N,keyUp:R}=je(q,w,()=>{}),x=f([]),M=f([]),se=e=>{x.value.push(e)},te=e=>{M.value.push(e)},{mutate:oe,onDone:ne}=ve({document:Ce});ne(e=>{Z(e.data.setTempValue.key),w()});const U=e=>{Me(e.name)?window.open(Ue(b.value,e.path),"_blank"):Be(e.name)?ee(r.value,e):A(e.path)},{loading:C,fetch:I}=ke({handle:async(e,l)=>{if(l)Se(H(l),"error");else{const d=[];for(const k of e.recentFiles)d.push(Te(k,b.value));r.value=d,E.value=d.length}},document:Ie}),ae=()=>{oe({key:ze(),value:JSON.stringify(h.value.map(e=>({path:e})))})},B=e=>{e.status==="done"&&setTimeout(()=>{I()},1e3)},le=e=>{e.forEach(l=>{Ke(r.value,d=>d.id===l.id)}),w()},O=e=>{le([e.item])},z=e=>{I()};return me(()=>{I(),v.on("upload_task_done",B),v.on("file_deleted",O),v.on("file_renamed",z),window.addEventListener("keydown",N),window.addEventListener("keyup",R)}),fe(()=>{v.off("upload_task_done",B),v.off("file_deleted",O),v.off("file_renamed",z),window.removeEventListener("keydown",N),window.removeEventListener("keyup",R)}),(e,l)=>{const d=He,k=ye,ce=Ge,ie=Re,de=xe,m=ge("tooltip");return o(),a(K,null,[n("div",Je,[_(d,{"touch-target":"wrapper",checked:s(L),indeterminate:!s(L)&&s($),onChange:s(P)},null,8,["checked","indeterminate","onChange"]),s(h).length?(o(),a("span",Pe,i(e.$t("x_selected",{count:s(J)?s(E).toLocaleString():s(h).length.toLocaleString()})),1)):(o(),a("span",We,i(e.$t("recent_files"))+" ("+i(s(E).toLocaleString())+")",1)),s($)?y((o(),a("button",{key:2,class:"btn-icon",onClick:p(ae,["stop"])},[_(k)])),[[m,e.$t("download")]]):g("",!0)]),s(C)&&r.value.length===0?(o(),a("div",Xe,[(o(),a(K,null,be(20,u=>n("section",{key:u,class:"file-item selectable-card-skeleton"},[n("div",qe,[l[0]||(l[0]=n("div",{class:"checkbox"},[n("div",{class:"skeleton-checkbox"})],-1)),n("span",Ye,i(u),1)]),l[1]||(l[1]=De('<div class="image"><div class="skeleton-image"></div></div><div class="title"><div class="skeleton-text skeleton-title"></div></div><div class="subtitle"><div class="skeleton-text skeleton-subtitle"></div></div><div class="actions"><div class="skeleton-text skeleton-actions"></div></div>',4))])),64))])):g("",!0),r.value.length>0?(o(),S(s(we),{key:1,class:"scroller","data-key":"id","data-sources":r.value,"estimate-size":80},{item:T(({index:u,item:t})=>[(o(),a("section",{key:t.id,class:Le(["file-item selectable-card",{selected:s(h).includes(t.id),selecting:s(F).includes(t.id)}]),onClick:p(c=>s(W)(c,t,u,()=>{U(t)}),["stop"]),onMouseover:c=>s(X)(c,u)},[n("div",es,[s(F).includes(t.id)?(o(),S(d,{key:0,class:"checkbox","touch-target":"wrapper",checked:s(Y),onClick:p(c=>s(V)(c,t,u),["stop"])},null,8,["checked","onClick"])):(o(),S(d,{key:1,class:"checkbox","touch-target":"wrapper",checked:s(h).includes(t.id),onClick:p(c=>s(V)(c,t,u),["stop"])},null,8,["checked","onClick"])),n("span",ss,[_(ce,{id:u+1,raw:t},null,8,["id","raw"])])]),n("div",{class:"image",onClick:p(c=>U(t),["stop"])},[M.value.includes(t.id)?(o(),a("img",os)):!x.value.includes(t.id)&&t.fileId?(o(),a("img",{key:1,class:"image-thumb",src:s(Ve)(t.fileId,"&w=50&h=50"),onError:c=>se(t.id)},null,40,ns)):t.extension?(o(),a("img",{key:2,src:`/ficons/${t.extension}.svg`,class:"svg",onError:c=>te(t.id)},null,40,as)):(o(),a("img",ls))],8,ts),n("div",cs,i(t.name),1),n("div",is,[n("span",null,i(s($e)(t.size)),1),y((o(),a("span",null,[Ae(i(s(Ne)(t.updatedAt)),1)])),[[m,s(Fe)(t.updatedAt)]])]),n("div",ds,[y((o(),a("button",{class:"btn-icon sm",onClick:p(c=>s(A)(t.path),["stop"])},[_(k)],8,rs)),[[m,e.$t("download")]]),_(de,null,{content:T(()=>[n("section",_s,[n("div",ps,[n("div",vs,i(e.$t("path")),1),n("div",hs,i(t.path),1)])])]),default:T(()=>[y((o(),a("button",us,[_(ie)])),[[m,e.$t("info")]])]),_:2},1024)])],42,Ze))]),_:1},8,["data-sources"])):g("",!0),!s(C)&&r.value.length===0?(o(),a("div",ks,i(e.$t(s(Ee)(s(C),s(j).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):g("",!0)],64)}}});export{ws as default};
