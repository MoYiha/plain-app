import{_ as Je}from"./VPagination.vuevuetypescriptsetuptruelang-B4JWBRU5.js";import{a4 as H,e as Ye,r as b,s as ue,g as We,ag as Xe,ah as Ze,f as et,u as tt,I as at,K as st,ai as nt,J as ot,i as re,L as _e,M as lt,N as it,c as l,o,a as n,k as p,l as t,O as v,j as E,t as i,P as dt,y as u,aj as ct,p as G,ak as pt,R as L,al as ut,S as R,T as U,U as j,V as rt,am as _t,an as vt,E as F,ao as kt,ap as mt,aq as gt,ar as ft,Y as ht,n as yt,F as M,as as bt,a7 as wt,at as $t,au as ve,$ as ke,d as Ct,A as St,a3 as Dt,H as At}from"./index-CextXMl7.js";import{_ as It}from"./FieldId.vuevuetypescriptsetuptruelang-B-w7x5OO.js";import{_ as Lt,a as Ut}from"./SearchInput-CrMMFD7Q.js";import{_ as Pt,a as Vt}from"./upload-rounded-Dxk1aS2W.js";import{_ as Nt}from"./VCheckbox-DS09yxvJ.js";import{u as qt,a as Et}from"./key-events-CRk-BMl_.js";import{u as Ft}from"./search-CYaYXsFn.js";import"./VInputChip-CfY98YKA.js";const w=C=>{H.emit("tap_phone",C)};function Mt(C,c){const S=C.findIndex(D=>D.id===c);S!==-1&&C.splice(S,1)}const Tt={class:"top-app-bar"},Bt={class:"title"},Kt={key:0},xt={key:1},Qt={class:"actions"},zt=["disabled"],Gt={class:"menu-items"},Rt=["onClick"],jt=["onClick","onMouseover"],Ht={class:"start"},Ot={class:"number"},Jt=["src"],Yt={class:"title"},Wt={class:"subtitle"},Xt={class:"actions"},Zt=["onClick"],ea=["onClick"],ta={class:"time"},aa={class:"start"},sa={class:"number"},na={key:0,class:"no-data-placeholder"},$=50,oa=Ye({__name:"AppsView",setup(C){var ce;const c=b([]),{app:S,urlTokenKey:D,uploads:O}=ue(We()),{input:me,upload:ge,uploadChanged:J}=Xe(O),{dropping:fe,fileDragEnter:Y,fileDragLeave:W,dropFiles:he}=Ze(O),X=et(),k=b([]),{t:g}=tt(),{appSortBy:P}=ue(X),{parseQ:ye}=Ft(),Z=at({tagIds:[]}),be=ft(),V=b(!1),ee=st(),te=ee.query,T=b(parseInt(((ce=te.page)==null?void 0:ce.toString())??"1")),N=b(""),{selectedIds:A,allChecked:ae,realAllChecked:B,selectRealAll:we,allCheckedAlertVisible:$e,clearSelection:K,toggleAllChecked:Ce,toggleSelect:se,total:f,checked:x,shiftEffectingIds:ne,handleItemClick:Se,handleMouseOver:De,selectAll:Ae,shouldSelect:Ie}=qt(k),{downloadItems:Le}=nt(D,ot.PACKAGE,K,"apps.zip"),{downloadFile:Ue}=$t(D),Q=e=>{const s=ee.query.q;St(X,s?`/apps?page=${e}&q=${s}`:`/apps?page=${e}`)},{keyDown:oe,keyUp:le}=Et(f,$,T,Ae,K,Q,()=>{}),Pe=()=>{ge(S.value.downloadsDir)},{mutate:Ve}=re({document:_t}),Ne=["user","system"].map(e=>({id:e,name:g("app_type."+e)})),qe=e=>{e.isUninstalling=!1},{loading:z,fetch:ie}=_e({handle:(e,s)=>{V.value=!1,s?F(g(s),"error"):e&&(k.value=e.packages.map(d=>({...d,isUninstalling:!1,icon:kt(D.value,"pkgicon://"+d.id)})),f.value=e.packageCount)},document:vt,variables:()=>({offset:(T.value-1)*$,limit:$,query:N.value,sortBy:P.value})});function Ee(e){return e?`/apps?q=${e}`:"/apps"}const q=b(!1);function Fe(e){if(P.value===e){q.value=!1;return}V.value=!0,P.value=e,Q(1),q.value=!1}const{mutate:Me}=re({document:mt});function Te(e){e.isUninstalling=!0,w(g("confirm_uninstallation_on_phone")),Me({id:e.id})}const{loading:Be,fetch:Ke}=_e({handle:e=>{if(e)for(const s of e.packageStatuses){const d=c.value.find(_=>_.id===s.id);if(d){const _=d.isNew&&s.exist,I=!d.isNew&&s.exist&&d.updatedAt<s.updatedAt;(_||I)&&(c.value=c.value.filter(h=>h.id!==s.id),w(""),_?F(g("app_installation_completed"),"success"):F(g("app_upgrade_completed"),"success"),ie())}else s.exist||(Mt(k.value,s.id),w(""))}},document:gt,variables:()=>({ids:[...k.value.filter(e=>e.isUninstalling).map(e=>e.id),...c.value.map(e=>e.id)]})}),de=e=>{e.status==="done"&&Ve({path:e.dir+"/"+e.fileName}).then(s=>{if(w(g("confirm_installation_on_phone")),s&&s.data&&s.data.installPackage){const{packageName:d,updatedAt:_,isNew:I}=s.data.installPackage;d&&(c.value.push({id:d,updatedAt:_,isNew:I}),setTimeout(()=>{c.value.some(h=>h.id===d)&&(c.value=c.value.filter(h=>h.id!==d),w(""))},12e4))}}).catch(s=>{w(""),F(g("app_installation_failed")+": "+s.message,"error")})};function xe(e){he(e,S.value.downloadsDir,"application")}return lt(()=>{var e;setInterval(()=>{(k.value.some(s=>s.isUninstalling)||c.value.length>0)&&!Be.value&&Ke()},1e3),N.value=Dt(((e=te.q)==null?void 0:e.toString())??""),ye(Z,N.value),ie(),H.on("upload_task_done",de),window.addEventListener("keydown",oe),window.addEventListener("keyup",le)}),it(()=>{H.off("upload_task_done",de),window.removeEventListener("keydown",oe),window.removeEventListener("keyup",le)}),(e,s)=>{const d=Nt,_=ct,I=Lt,h=Pt,pe=ht,Qe=Vt,ze=pt,Ge=Ut,Re=It,je=bt,He=wt,Oe=Je,m=dt("tooltip");return o(),l(U,null,[n("div",Tt,[p(d,{"touch-target":"wrapper",checked:t(ae),indeterminate:!t(ae)&&t(x),onChange:t(Ce)},null,8,["checked","indeterminate","onChange"]),n("div",Bt,[t(A).length?(o(),l("span",Kt,i(e.$t("x_selected",{count:t(B)?t(f).toLocaleString():t(A).length.toLocaleString()})),1)):(o(),l("span",xt,i(e.$t("page_title.apps"))+" ("+i(t(f).toLocaleString())+")",1)),t(x)?v((o(),l("button",{key:2,class:"btn-icon",onClick:s[0]||(s[0]=u(a=>t(Le)(t(B),t(A),N.value),["stop"]))},[p(_)])),[[m,e.$t("download")]]):E("",!0)]),n("div",Qt,[p(I,{filter:Z,types:t(Ne),"get-url":Ee},null,8,["filter","types"]),v((o(),l("button",{class:"btn-icon",onClick:u(Pe,["stop"])},[p(h)])),[[m,e.$t("install_app")]]),p(ze,{modelValue:q.value,"onUpdate:modelValue":s[1]||(s[1]=a=>q.value=a)},{trigger:G(()=>[v((o(),l("button",{class:"btn-icon btn-sort",disabled:V.value},[V.value?(o(),L(pe,{key:0,indeterminate:""})):(o(),L(Qe,{key:1}))],8,zt)),[[m,e.$t("sort")]])]),default:G(()=>[n("div",Gt,[(o(!0),l(U,null,j(t(be),a=>(o(),l("div",{key:a.value,class:R(["dropdown-item",{selected:a.value===t(P)}]),onClick:y=>Fe(a.value)},i(e.$t(a.label)),11,Rt))),128))])]),_:1},8,["modelValue"])])]),p(Ge,{limit:$,total:t(f),"all-checked-alert-visible":t($e),"real-all-checked":t(B),"select-real-all":t(we),"clear-selection":t(K)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),n("div",{class:"scroll-content",onDragover:s[4]||(s[4]=u((...a)=>t(Y)&&t(Y)(...a),["stop","prevent"]))},[v(n("div",{class:"drag-mask",onDrop:u(xe,["stop","prevent"]),onDragleave:s[2]||(s[2]=u((...a)=>t(W)&&t(W)(...a),["stop","prevent"]))},i(e.$t("release_to_send_files")),545),[[ut,t(fe)]]),n("div",{class:R(["app-list",{"select-mode":t(x)}])},[(o(!0),l(U,null,j(k.value,(a,y)=>(o(),l("section",{key:a.id,class:R(["app-item selectable-card",{selected:t(A).includes(a.id),selecting:t(ne).includes(a.id)}]),onClick:u(r=>t(Se)(r,a,y,()=>{}),["stop"]),onMouseover:r=>t(De)(r,y)},[n("div",Ht,[t(ne).includes(a.id)?(o(),L(d,{key:0,class:"checkbox","touch-target":"wrapper",checked:t(Ie),onClick:u(r=>t(se)(r,a,y),["stop"])},null,8,["checked","onClick"])):(o(),L(d,{key:1,class:"checkbox","touch-target":"wrapper",checked:t(A).includes(a.id),onClick:u(r=>t(se)(r,a,y),["stop"])},null,8,["checked","onClick"])),n("span",Ot,[p(Re,{id:y+1,raw:a},null,8,["id","raw"])])]),n("img",{class:"image",width:"50",height:"50",src:a.icon},null,8,Jt),n("div",Yt,i(a.name)+" ("+i(a.version)+")",1),n("div",Wt,[n("span",null,i(a.id),1),n("span",null,i(t(yt)(a.size)),1),n("span",null,i(e.$t("app_type."+a.type)),1)]),n("div",Xt,[a.isUninstalling?(o(),l(U,{key:0},[v(p(pe,{indeterminate:"",class:"sm"},null,512),[[m,e.$t("uninstalling")]]),s[5]||(s[5]=M(" Â ")),p(je,{class:"btn-sm",onClick:u(r=>qe(a),["stop"])},{default:G(()=>[M(i(e.$t("cancel")),1)]),_:2},1032,["onClick"])],64)):v((o(),l("button",{key:1,class:"btn-icon sm",onClick:u(r=>Te(a),["stop"])},[p(He)],8,Zt)),[[m,e.$t("uninstall")]]),v((o(),l("button",{class:"btn-icon sm",onClick:u(r=>t(Ue)(a.path,`${a.name.replace(" ","")}-${a.id}.apk`),["stop"])},[p(_)],8,ea)),[[m,e.$t("download")]])]),n("div",ta,[v((o(),l("span",null,[M(i(e.$t("installed_at"))+": "+i(t(ke)(a.installedAt)),1)])),[[m,t(ve)(a.installedAt)]]),v((o(),l("span",null,[M(i(e.$t("updated_at"))+": "+i(t(ke)(a.updatedAt)),1)])),[[m,t(ve)(a.updatedAt)]])])],42,jt))),128)),t(z)&&k.value.length===0?(o(),l(U,{key:0},j(20,a=>n("section",{key:a,class:"app-item selectable-card-skeleton"},[n("div",aa,[s[6]||(s[6]=n("div",{class:"checkbox"},[n("div",{class:"skeleton-checkbox"})],-1)),n("span",sa,i(a),1)]),s[7]||(s[7]=Ct('<div class="image" data-v-f096d6da><div class="skeleton-image" data-v-f096d6da></div></div><div class="title" data-v-f096d6da><div class="skeleton-text skeleton-title" data-v-f096d6da></div></div><div class="subtitle" data-v-f096d6da><div class="skeleton-text skeleton-subtitle" data-v-f096d6da></div></div><div class="actions" data-v-f096d6da><div class="skeleton-text skeleton-actions" data-v-f096d6da></div></div><div class="time" data-v-f096d6da><div class="skeleton-text skeleton-time" data-v-f096d6da></div><div class="skeleton-text skeleton-time" data-v-f096d6da></div></div>',5))])),64)):E("",!0)],2),!t(z)&&k.value.length===0?(o(),l("div",na,i(e.$t(t(rt)(t(z)))),1)):E("",!0),t(f)>$?(o(),L(Oe,{key:1,page:T.value,go:Q,total:t(f),limit:$},null,8,["page","total"])):E("",!0),n("input",{ref_key:"fileInput",ref:me,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:s[3]||(s[3]=(...a)=>t(J)&&t(J)(...a))},null,544)],32)],64)}}}),ka=At(oa,[["__scopeId","data-v-f096d6da"]]);export{ka as default};
