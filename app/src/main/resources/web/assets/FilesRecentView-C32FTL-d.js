import{e as ce,u as de,r as m,g as re,s as ue,i as _e,ao as pe,J as ve,K as ke,L as he,c as l,o as a,a as o,j as f,O as me,p as g,l as s,t as d,M as fe,y as _,k,ah as ge,Q as O,R as ye,a3 as I,bj as be,S as we,bA as Ce,bK as Ee,D as De,bz as Ie,d as Se,P as Te,U as Le,aA as Ve,n as $e,X as Fe,Y as Ae,Z as xe,bC as Ke,ai as Ne,bF as Re,ak as Ue,bG as ze,bH as Be,bD as Me,a2 as p,bJ as Oe}from"./index-BjwOe50_.js";import{_ as G}from"./default-BQXvEOng.js";import{u as Ge,c as He}from"./key-events-C_0dFOja.js";const Qe={class:"top-app-bar"},Je=["checked","indeterminate"],Pe={key:0},je={key:1},Xe={key:0,class:"scroller"},We={class:"start"},Ye={class:"number"},Ze=["onClick","onMouseover"],qe={class:"start"},es=["checked","onClick"],ss=["checked","onClick"],ts={class:"number"},os=["onClick"],ns={key:0,class:"svg",src:G},as=["src","onError"],ls=["src","onError"],is={key:3,class:"svg",src:G},cs={class:"title"},ds={class:"subtitle"},rs={class:"actions"},us=["onClick"],_s={class:"btn-icon sm"},ps={class:"card card-info"},vs={class:"key-value vertical"},ks={class:"key"},hs={class:"value"},ms={key:2,class:"no-data-placeholder"},ws=ce({__name:"FilesRecentView",setup(fs){const{t:H}=de(),Q=m([]),S=re(),{app:J,urlTokenKey:y}=ue(S),r=m([]),{selectedIds:v,allChecked:T,realAllChecked:P,clearSelection:b,toggleAllChecked:L,toggleSelect:V,total:w,checked:$,shiftEffectingIds:F,handleItemClick:j,handleMouseOver:X,selectAll:W,shouldSelect:Y}=Ge(r),{downloadFile:A,downloadFiles:Z}=pe(y),{view:q}=Be(Q,(e,n)=>{S.lightbox={sources:e,index:n,visible:!0}}),{keyDown:x,keyUp:K}=He(W,b,()=>{}),N=m([]),R=m([]),ee=e=>{N.value.push(e)},se=e=>{R.value.push(e)},{mutate:te,onDone:oe}=_e({document:Ce});oe(e=>{Z(e.data.setTempValue.key),b()});const U=e=>{Re(e.name)?window.open(Ue(y.value,e.path),"_blank"):ze(e.name)?q(r.value,e):A(e.path)},{loading:C,fetch:E}=ve({handle:async(e,n)=>{if(n)De(H(n),"error");else{const u=[];for(const D of e.recentFiles)u.push(Ie(D,y.value));r.value=u,w.value=u.length}},document:Ee}),ne=()=>{te({key:Me(),value:JSON.stringify(v.value.map(e=>({path:e})))})},z=e=>{e.status==="done"&&setTimeout(()=>{E()},1e3)},ae=e=>{e.forEach(n=>{Oe(r.value,u=>u.id===n.id)}),b()},B=e=>{ae([e.item])},M=e=>{E()};return ke(()=>{E(),p.on("upload_task_done",z),p.on("file_deleted",B),p.on("file_renamed",M),window.addEventListener("keydown",x),window.addEventListener("keyup",K)}),he(()=>{p.off("upload_task_done",z),p.off("file_deleted",B),p.off("file_renamed",M),window.removeEventListener("keydown",x),window.removeEventListener("keyup",K)}),(e,n)=>{const u=ge,D=Le,le=Ke,ie=Ne,h=fe("tooltip");return a(),l(O,null,[o("div",Qe,[o("md-checkbox",{"touch-target":"wrapper",checked:s(T),indeterminate:!s(T)&&s($),onChange:n[0]||(n[0]=(...c)=>s(L)&&s(L)(...c))},null,40,Je),s(v).length?(a(),l("span",Pe,d(e.$t("x_selected",{count:s(P)?s(w).toLocaleString():s(v).length.toLocaleString()})),1)):(a(),l("span",je,d(e.$t("recent_files"))+" ("+d(s(w).toLocaleString())+")",1)),s($)?g((a(),l("button",{key:2,class:"btn-icon",onClick:_(ne,["stop"])},[n[1]||(n[1]=o("md-ripple",null,null,-1)),k(u)])),[[h,e.$t("download")]]):f("",!0)]),s(C)&&r.value.length===0?(a(),l("div",Xe,[(a(),l(O,null,ye(20,c=>o("section",{key:c,class:"file-item selectable-card-skeleton"},[o("div",We,[n[2]||(n[2]=o("div",{class:"checkbox"},[o("div",{class:"skeleton-checkbox"})],-1)),o("span",Ye,d(c),1)]),n[3]||(n[3]=Se('<div class="image"><div class="skeleton-image"></div></div><div class="title"><div class="skeleton-text skeleton-title"></div></div><div class="subtitle"><div class="skeleton-text skeleton-subtitle"></div></div><div class="actions"><div class="skeleton-text skeleton-actions"></div></div>',4))])),64))])):f("",!0),r.value.length>0?(a(),me(s(be),{key:1,class:"scroller","data-key":"id","data-sources":r.value,"estimate-size":80},{item:I(({index:c,item:t})=>[(a(),l("section",{key:t.id,class:Te(["file-item selectable-card",{selected:s(v).includes(t.id),selecting:s(F).includes(t.id)}]),onClick:_(i=>s(j)(i,t,c,()=>{U(t)}),["stop"]),onMouseover:i=>s(X)(i,c)},[o("div",qe,[s(F).includes(t.id)?(a(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:s(Y),onClick:_(i=>s(V)(i,t,c),["stop"])},null,8,es)):(a(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:s(v).includes(t.id),onClick:_(i=>s(V)(i,t,c),["stop"])},null,8,ss)),o("span",ts,[k(D,{id:c+1,raw:t},null,8,["id","raw"])])]),o("div",{class:"image",onClick:_(i=>U(t),["stop"])},[R.value.includes(t.id)?(a(),l("img",ns)):!N.value.includes(t.id)&&t.fileId?(a(),l("img",{key:1,class:"image-thumb",src:s(Ve)(t.fileId,"&w=50&h=50"),onError:i=>ee(t.id)},null,40,as)):t.extension?(a(),l("img",{key:2,src:`/ficons/${t.extension}.svg`,class:"svg",onError:i=>se(t.id)},null,40,ls)):(a(),l("img",is))],8,os),o("div",cs,d(t.name),1),o("div",ds,[o("span",null,d(s($e)(t.size)),1),g((a(),l("span",null,[Ae(d(s(xe)(t.updatedAt)),1)])),[[h,s(Fe)(t.updatedAt)]])]),o("div",rs,[g((a(),l("button",{class:"btn-icon sm",onClick:_(i=>s(A)(t.path),["stop"])},[n[4]||(n[4]=o("md-ripple",null,null,-1)),k(u)],8,us)),[[h,e.$t("download")]]),k(ie,null,{content:I(i=>[o("section",ps,[o("div",vs,[o("div",ks,d(e.$t("path")),1),o("div",hs,d(t.path),1)])])]),default:I(()=>[g((a(),l("button",_s,[n[5]||(n[5]=o("md-ripple",null,null,-1)),k(le)])),[[h,e.$t("info")]])]),_:2},1024)])],42,Ze))]),_:1},8,["data-sources"])):f("",!0),!s(C)&&r.value.length===0?(a(),l("div",ms,d(e.$t(s(we)(s(C),s(J).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):f("",!0)],64)}}});export{ws as default};
