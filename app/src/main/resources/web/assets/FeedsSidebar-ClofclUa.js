import{_ as ge}from"./LeftSidebar.vuevuetypescriptsetuptruelang-CqwsEhTG.js";import{_ as be,a as Ce}from"./TagFilter.vuevuetypescriptsetuptruelang-DGglOglD.js";import{_ as Fe}from"./more-vert-CR2s4R8E.js";import{e as N,ar as X,r as c,i as D,b_ as we,as as Z,at as ee,av as te,au as L,c as m,o as f,a as e,t as l,p as Q,v as oe,l as o,q as ne,x as se,Y as I,j as S,F as Me,b$ as Ee,u as xe,f as Le,s as Se,g as Ie,G as Te,J as Ve,w as De,h as Qe,bi as Re,D as H,ac as qe,a2 as T,ad as Ge,O as Ae,a3 as R,a4 as Y,a1 as Ne,c0 as Be,c1 as Oe,c2 as Pe,c3 as ze,k as q,y as V,P as G,R as J,M as Ke,Q as W,$ as A,aa as Ue,c4 as je,z as He}from"./index-BaB8vEEK.js";import{u as Ye}from"./feeds-TyJ2rTp-.js";import{u as Je}from"./search-C-4y2IPr.js";const We={slot:"headline"},Xe={slot:"content"},Ze={class:"form-row"},et=["label","error","error-text"],tt={class:"form-row"},ot={class:"form-check-label"},nt=["checked"],st={slot:"actions"},at=["disabled"],lt={key:0,slot:"icon",indeterminate:""},dt=N({__name:"AddFeedModal",props:{done:{type:Function}},setup(E){const{handleSubmit:b}=X(),k=c(),i=c(!1);function x(t){i.value=t.target.checked}const _=E,{mutate:w,loading:C,onDone:F}=D({document:we}),{value:d,resetField:p,errorMessage:u}=Z("inputValue",ee().required());p();function y(){L()}(async()=>{var t;await te(),(t=k.value)==null||t.focus()})();const h=b(()=>{w({url:d.value??"",fetchContent:i.value})});return F(()=>{var t;(t=_.done)==null||t.call(this),L()}),(t,a)=>(f(),m("md-dialog",null,[e("div",We,l(t.$t("add_subscription")),1),e("div",Xe,[e("div",Ze,[Q(e("md-outlined-text-field",{ref_key:"inputRef",ref:k,"onUpdate:modelValue":a[0]||(a[0]=v=>se(d)?d.value=v:null),label:t.$t("rss_url"),error:o(u),"error-text":o(u)?t.$t(o(u)):"",onKeyup:a[1]||(a[1]=ne((...v)=>o(h)&&o(h)(...v),["enter"]))},null,40,et),[[oe,o(d)]])]),e("div",tt,[e("label",ot,[e("md-checkbox",{"touch-target":"wrapper",checked:i.value,onChange:x},null,40,nt),I(" "+l(t.$t("fetch_content_automatically")),1)])])]),e("div",st,[e("md-outlined-button",{value:"cancel",onClick:y},l(t.$t("cancel")),1),e("md-filled-button",{value:"save",disabled:o(C),autofocus:"",onClick:a[2]||(a[2]=(...v)=>o(h)&&o(h)(...v))},[o(C)?(f(),m("md-circular-progress",lt)):S("",!0),I(" "+l(t.$t("save")),1)],8,at)])]))}}),it=Me(dt,[["__scopeId","data-v-cf73b901"]]),rt={slot:"headline"},ut={slot:"content"},ct={class:"form-label"},ft={class:"form-row"},pt=["label","error","error-text"],vt={class:"form-row"},mt={class:"form-check-label"},_t=["checked"],ht={slot:"actions"},$t=["disabled"],kt={key:0,slot:"icon",indeterminate:""},yt=N({__name:"FeedModal",props:{data:{type:Object}},setup(E){var y,h;const{handleSubmit:b}=X(),k=c(),i=c(!1);function x(t){i.value=t.target.checked}const _=E,{mutate:w,loading:C,onDone:F}=D({document:Ee}),{value:d,errorMessage:p}=Z("inputValue",ee().required());d.value=((y=_.data)==null?void 0:y.name)??"",i.value=((h=_.data)==null?void 0:h.fetchContent)??!1,(async()=>{var t;await te(),(t=k.value)==null||t.focus()})();const u=b(()=>{var t;w({id:(t=_.data)==null?void 0:t.id,name:d.value,fetchContent:i.value})});return F(()=>{L()}),(t,a)=>{var v;return f(),m("md-dialog",null,[e("div",rt,l(t.$t("update_subscription")),1),e("div",ut,[e("div",ct,l((v=E.data)==null?void 0:v.url),1),e("div",ft,[Q(e("md-outlined-text-field",{ref_key:"inputRef",ref:k,"onUpdate:modelValue":a[0]||(a[0]=$=>se(d)?d.value=$:null),class:"form-control",label:t.$t("name"),error:o(p),"error-text":o(p)?t.$t(o(p)):"",onKeyup:a[1]||(a[1]=ne((...$)=>o(u)&&o(u)(...$),["enter"]))},null,40,pt),[[oe,o(d)]])]),e("div",vt,[e("label",mt,[e("md-checkbox",{"touch-target":"wrapper",checked:i.value,onChange:x},null,40,_t),I(" "+l(t.$t("fetch_content_automatically")),1)])])]),e("div",ht,[e("md-outlined-button",{value:"cancel",onClick:a[2]||(a[2]=(...$)=>o(L)&&o(L)(...$))},l(t.$t("cancel")),1),e("md-filled-button",{value:"save",disabled:o(C),autofocus:"",onClick:a[3]||(a[3]=(...$)=>o(u)&&o(u)(...$))},[o(C)?(f(),m("md-circular-progress",kt)):S("",!0),I(" "+l(t.$t("save")),1)],8,$t)])])}}}),gt=["open"],bt=["onClick"],Ct={slot:"headline"},Ft={class:"nav"},wt={class:"title"},Mt={key:0,class:"count"},Et={class:"title"},xt={key:0,class:"count"},Lt=["onClick"],St={class:"title"},It=["id","onClick"],Tt={key:0,class:"count"},Vt=["anchor","open"],Dt={slot:"headline"},Qt={slot:"headline"},Ot=N({__name:"FeedsSidebar",setup(E){const{t:b}=xe(),k=Le(),{counter:i}=Se(Ie()),{parseQ:x}=Je(),_=Te({tagIds:[]}),w=c([]),C=[{text:"add_subscription",click:de},{text:"import_opml_file",click:fe},{text:"export_opml_file",click:pe}],F=c(!1),d=c(""),p=c(""),u=c(!1),y=c(),h=c(new Map),t=c(!1),a=c(),{fetch:v}=Ve({handle:n=>{n&&(i.value.feedEntries=n.total,i.value.feedEntriesToday=n.today,n.feedsCount.forEach(s=>{h.value.set(s.id,s.count)}))},document:Be,variables:()=>({})});function $(n){return h.value.get(n)??-1}function B(){var g;const n=Y.currentRoute.value,s=Ne(((g=n.query.q)==null?void 0:g.toString())??"");x(_,s),d.value=_.tagIds.length===1?_.tagIds[0]:"",p.value=_.feedId??"",u.value=_.today??!1,u.value?(d.value="",p.value=""):d.value&&p.value&&(d.value=""),v()}B(),De(()=>Y.currentRoute.value,()=>{B()});const{viewFeed:ae,viewAll:O,viewToday:P}=Ye(k),{refetch:z}=Qe({handle:(n,s)=>{s?H(b(s),"error"):n&&(w.value=n.feeds)},document:Oe});function le(n){const s=n.target.files;if(!s)return;const g=new FileReader;g.addEventListener("load",()=>{ue({content:g.result})},!1),g.readAsText(s[0])}function de(){A(it,{done:()=>{z()}})}const{mutate:ie,onDone:re}=D({document:Pe});re(n=>{Re(n.data.exportFeeds,"application/xml","feeds.xml")});const{mutate:ue,onDone:ce}=D({document:ze});ce(()=>{H(b("imported")),z()});function fe(){y.value.value="",y.value.click()}function pe(){ie()}function ve(n){a.value=n,t.value=!0}function me(n){A(yt,{data:n})}function _e(n){A(Ue,{id:n.id,name:n.name,gql:je,typeName:"Feed",done:()=>{He(k,"/feeds")}})}const K=()=>{v()},U=()=>{v()};return qe(()=>{T.on("feed_entries_deleted",K),T.on("feeds_fetched",U)}),Ge(()=>{T.off("feed_entries_deleted",K),T.off("feeds_fetched",U)}),(n,s)=>{const g=Ce,he=Fe,$e=be,ke=ge,j=Ke("tooltip");return f(),Ae(ke,null,{title:R(()=>[I(l(n.$t("page_title.feeds")),1)]),actions:R(()=>[Q((f(),m("button",{id:"add-feed-ref",class:"btn-icon",onClick:s[0]||(s[0]=()=>F.value=!0)},[s[7]||(s[7]=e("md-ripple",null,null,-1)),q(g)])),[[j,o(b)("add_subscription")]]),e("md-menu",{anchor:"add-feed-ref",positioning:"fixed","stay-open-on-focusout":"",quick:"",open:F.value,onClosed:s[1]||(s[1]=()=>F.value=!1)},[(f(),m(W,null,J(C,M=>e("md-menu-item",{key:M.text,onClick:M.click},[e("div",Ct,l(n.$t(M.text)),1)],8,bt)),64))],40,gt)]),body:R(()=>{var M;return[e("ul",Ft,[e("li",{class:G({active:!u.value&&!d.value&&!p.value}),onClick:s[2]||(s[2]=V((...r)=>o(O)&&o(O)(...r),["prevent"]))},[e("span",wt,l(n.$t("all")),1),o(i).feedEntries>=0?(f(),m("span",Mt,l(o(i).feedEntries.toLocaleString()),1)):S("",!0)],2),e("li",{class:G({active:u.value}),onClick:s[3]||(s[3]=V((...r)=>o(P)&&o(P)(...r),["prevent"]))},[e("span",Et,l(n.$t("today")),1),o(i).feedEntriesToday>=0?(f(),m("span",xt,l(o(i).feedEntriesToday.toLocaleString()),1)):S("",!0)],2),(f(!0),m(W,null,J(w.value,r=>(f(),m("li",{key:r.id,class:G({active:p.value&&r.id===p.value}),onClick:V(ye=>o(ae)(r),["stop","prevent"])},[e("span",St,l(r.name),1),Q((f(),m("button",{id:"feed-"+r.id,class:"btn-icon sm",onClick:V(ye=>ve(r),["prevent","stop"])},[s[8]||(s[8]=e("md-ripple",null,null,-1)),q(he)],8,It)),[[j,n.$t("actions")]]),$(r.id)>=0?(f(),m("span",Tt,l($(r.id).toLocaleString()),1)):S("",!0)],10,Lt))),128))]),e("md-menu",{positioning:"popover",anchor:"feed-"+((M=a.value)==null?void 0:M.id),"stay-open-on-focusout":"",quick:"",open:t.value,onClosed:s[6]||(s[6]=r=>t.value=!1)},[e("md-menu-item",{onClick:s[4]||(s[4]=r=>me(a.value))},[e("div",Dt,l(n.$t("edit")),1)]),e("md-menu-item",{onClick:s[5]||(s[5]=r=>_e(a.value))},[e("div",Qt,l(n.$t("delete")),1)])],40,Vt),q($e,{type:"FEED_ENTRY",selected:d.value},null,8,["selected"]),e("input",{ref_key:"fileInput",ref:y,style:{display:"none"},accept:".xml",type:"file",onChange:le},null,544)]}),_:1})}}});export{Ot as default};
