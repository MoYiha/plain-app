import{_ as J}from"./MonacoEditor.vuevuetypescriptsetuptruelang-BMlTdJ5J.js";import{_ as ee}from"./print-outline-rounded-Do3M-1Bq.js";import{aW as te,aX as F,aY as ne,o as g,c as k,a as d,d as ae,u as oe,g as se,h as y,s as ie,i as ue,l as le,K as re,j as ce,aZ as de,aU as _e,a0 as E,aV as me,x as I,w as U,p as S,V as G,t as pe,m as O,a_ as ve,v as fe,e as z,O as j,Q as ge,a$ as he,k as Te,C as K,b0 as be,b1 as ye,b2 as ke,U as we,a2 as $e,a3 as Se,S as Ce,F as xe,G as Le,a5 as Me,f as Ne,Y as Ee,Z as Ie,a1 as Ve,H as qe}from"./index-BxNI00MG.js";import{u as Ae}from"./markdown-CMfotNJO.js";var H=function(){return te.Date.now()},De="Expected a function",Re=Math.max,Ue=Math.min;function He(_,u,l){var m,a,o,i,s,r,v=0,x=!1,f=!1,h=!0;if(typeof _!="function")throw new TypeError(De);u=F(u)||0,ne(l)&&(x=!!l.leading,f="maxWait"in l,o=f?Re(F(l.maxWait)||0,u):o,h="trailing"in l?!!l.trailing:h);function w(n){var c=m,e=a;return m=a=void 0,v=n,i=_.apply(e,c),i}function L(n){return v=n,s=setTimeout(p,u),x?w(n):i}function V(n){var c=n-r,e=n-v,t=u-c;return f?Ue(t,o-e):t}function T(n){var c=n-r,e=n-v;return r===void 0||c>=u||c<0||f&&e>=o}function p(){var n=H();if(T(n))return M(n);s=setTimeout(p,V(n))}function M(n){return s=void 0,h&&m?w(n):(m=a=void 0,i)}function q(){s!==void 0&&clearTimeout(s),v=0,m=r=a=s=void 0}function A(){return s===void 0?i:M(H())}function $(){var n=H(),c=T(n);if(m=arguments,a=this,r=n,c){if(s===void 0)return L(r);if(f)return clearTimeout(s),s=setTimeout(p,u),w(r)}return s===void 0&&(s=setTimeout(p,u)),i}return $.cancel=q,$.flush=A,$}const Qe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},We=d("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1),Be=[We];function Fe(_,u){return g(),k("svg",Qe,[...Be])}const Ge={name:"material-symbols-arrow-back-rounded",render:Fe},Q=_=>(xe("data-v-977015b7"),_=_(),Le(),_),Oe={class:"top-app-bar"},ze=Q(()=>d("md-ripple",null,null,-1)),je={class:"title"},Ke={class:"state-point"},Pe={class:"actions"},Xe=Q(()=>d("md-ripple",null,null,-1)),Ye=Q(()=>d("md-ripple",null,null,-1)),Ze={class:"panel-container"},Je=["innerHTML"],C="NOTE",et=ae({__name:"NoteEditView",setup(_){const u=oe(),{t:l}=se(),m=ge(),a=y(""),o=y(),i=y(""),s=y(""),r=y(!1),{app:v,urlTokenKey:x}=ie(ue());function f(){const e=Me.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),Ne(u,t)}const{render:h}=Ae(v,x),w=He(()=>{r.value=!1,M({id:a.value,input:{content:i.value,title:he(i.value,{length:250,omission:""})}})},500),L=()=>{Te(i,async e=>{r.value=!0,s.value=await h(e),w()})},V=()=>{window.print()},T=y();le({handle:(e,t)=>{t?K(l(t),"error"):e&&(T.value=e.tags)},document:be,variables:{type:C},appApi:!0});const{fetch:p}=re({handle:async(e,t)=>{t?K(l(t),"error"):(o.value=e.note,i.value=e.note.content,s.value=await h(i.value),L())},document:ye,variables:()=>({id:a.value}),appApi:!0}),{mutate:M,onDone:q}=ce({document:ke,appApi:!0});q(e=>{var t,b;o.value=e.data.saveNote,!a.value&&((t=o.value)!=null&&t.id)&&(a.value=(b=o.value)==null?void 0:b.id,de(u,`/notes/${a.value}`))});function A(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${l("updated_at")}: ${we(e)})`:""}function $(){var e,t;Ee(Ie,{type:C,tags:T.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=T.value)==null?void 0:t.filter(b=>{var N;return(N=o.value)==null?void 0:N.tags.some(D=>D.id===b.id)})})}const n=e=>{e.type===C&&p()},c=e=>{e.type===C&&p()};return _e(()=>{a.value=m.params.id,a.value==="create"&&(a.value=""),a.value?p():L(),E.on("item_tags_updated",c),E.on("items_tags_updated",n)}),me(()=>{E.off("item_tags_updated",c),E.off("items_tags_updated",n)}),(e,t)=>{var W,B;const b=Ge,N=$e,D=Se,P=Ve,X=ee,Y=J,R=Ce("tooltip");return g(),k(j,null,[d("div",Oe,[I((g(),k("button",{class:"btn-icon",onClick:U(f,["prevent"])},[ze,S(b)])),[[R,e.$t("back")]]),d("div",je,[G(pe(a.value?O(l)("edit"):O(l)("create"))+" ",1),I(d("span",Ke,"*",512),[[ve,r.value]]),G(),(W=o.value)!=null&&W.updatedAt?(g(),fe(N,{key:0,class:"time",id:A(),raw:o.value},null,8,["id","raw"])):z("",!0)]),d("div",Pe,[S(D,{tags:(B=o.value)==null?void 0:B.tags,type:C,"only-links":!0},null,8,["tags"]),a.value?(g(),k(j,{key:0},[I((g(),k("button",{class:"btn-icon",onClick:U($,["prevent"])},[Xe,S(P)])),[[R,e.$t("add_to_tags")]]),I((g(),k("button",{class:"btn-icon",onClick:U(V,["prevent"])},[Ye,S(X)])),[[R,e.$t("print")]])],64)):z("",!0)])]),d("div",Ze,[S(Y,{language:"html",modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=Z=>i.value=Z)},null,8,["modelValue"]),d("div",{class:"md-container",innerHTML:s.value},null,8,Je)])],64)}}}),st=qe(et,[["__scopeId","data-v-977015b7"]]);export{st as default};
