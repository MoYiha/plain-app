import{_ as Ut}from"./VPagination.vuevuetypescriptsetuptruelang-DZpCvrfT.js";import{m as Xe,c as g,o as a,a as l,i as _e,b5 as Nt,b6 as zt,s as me,g as Ze,u as Je,a4 as b,aM as Ye,E as ve,r as L,b7 as Ht,e as Qt,f as Kt,I as Gt,ag as Oe,ah as Ot,J as jt,K as Wt,aL as Xt,aN as Zt,ai as Jt,L as Yt,aP as xt,aQ as eo,M as to,N as oo,k as n,l as e,j as J,t as h,T as V,O as c,P as so,R as d,p as r,y as i,aR as de,aS as re,ak as ao,al as no,S as ce,U as ue,V as lo,aT as io,av as ro,b8 as co,a7 as uo,aW as po,aj as _o,aX as mo,Q as vo,ar as go,b2 as ko,aH as yo,n as fo,a9 as ho,aZ as $o,Z as Co,at as bo,aO as je,b9 as To,Y as Io,$ as wo,F as Eo,a0 as Ao,d as Do,A as qo,a1 as So,a2 as Fo,a_ as We,a3 as Po,ba as Vo,H as Lo}from"./index-Eg2Dz6vI.js";import{_ as Mo}from"./FieldId.vuevuetypescriptsetuptruelang-lzcc_jvg.js";import{_ as Ro,a as Bo}from"./SearchInput-DFrEaFdp.js";import{_ as Uo,a as No}from"./upload-rounded-DxjQpv8E.js";import{_ as zo}from"./MediaKeyboardShortcuts.vuevuetypescriptsetuptruelang-y9_9FBhl.js";import{_ as Ho}from"./VCheckbox-BuMj4nO3.js";import{u as Qo}from"./search-BrbvAB1e.js";import{u as Ko,a as Go}from"./key-events-BNPqExTk.js";import{a as Oo}from"./tags-BO_i69Sy.js";import"./VInputChip-BoCl3y34.js";const jo={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Wo(w,f){return a(),g("svg",jo,f[0]||(f[0]=[l("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V9q0-.425-.288-.712T10 8t-.712.288T9 9v6q0 .425.288.713T10 16m4 0q.425 0 .713-.288T15 15V9q0-.425-.288-.712T14 8t-.712.288T13 9v6q0 .425.288.713T14 16m-2 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const Xo=Xe({name:"material-symbols-pause-circle-outline-rounded",render:Wo}),Zo={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Jo(w,f){return a(),g("svg",Zo,f[0]||(f[0]=[l("path",{fill:"currentColor",d:"M3 16v-2h7v2zm0-4v-2h11v2zm0-4V6h11v2zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4z"},null,-1)]))}const Yo=Xe({name:"material-symbols-playlist-add",render:Jo});function pe(w,f,E=500){const v=w.cloneNode(!0),$=w.getBoundingClientRect(),M=f.getBoundingClientRect();v.style.position="absolute",v.style.top=$.top+"px",v.style.left=$.left+"px",v.style.opacity=1,document.body.appendChild(v);let C=0;function A(B){C||(C=B);const U=B-C,F=Math.min(U/E,1);v.style.top=$.top+(M.top-$.top)*F+"px",v.style.left=$.left+(M.left-$.left)*F+"px",F<1?requestAnimationFrame(A):document.body.removeChild(v)}requestAnimationFrame(A)}const xo=(w,f)=>{const{mutate:E,loading:v,onDone:$}=_e({document:Nt}),{mutate:M,loading:C,onDone:A}=_e({document:zt}),{app:B}=me(Ze()),{t:U}=Je();$(()=>{b.emit("refetch_app"),f()}),A(()=>{b.emit("refetch_app")});const F=Ye(()=>{var k;return((k=B.value)==null?void 0:k.audios)??[]}),W=k=>F.value.some(y=>y.path===k.path);return{loading:v,removeLoading:C,isInPlaylist:W,addItemsToPlaylist:(k,y,P,N)=>{let z=N;if(!P){if(y.length===0){ve(U("select_first"),"error");return}z=`ids:${y.join(",")}`}const H=k.target,R=document.getElementById("quick-audio");pe(H,R),E({query:z})},removeItemsFromPlaylist:(k,y,P,N)=>{if(P)w.value.filter(R=>W(R)).forEach(R=>{M({path:R.path})});else{if(y.length===0){ve(U("select_first"),"error");return}w.value.filter(Q=>y.includes(Q.id)&&W(Q)).forEach(Q=>{M({path:Q.path})})}const z=k.target,H=document.getElementById("quick-audio");pe(z,H)},addToPlaylist:(k,y)=>{const P=k.target,N=document.getElementById("quick-audio");pe(P,N),E({query:`ids:${y.id}`})},removeFromPlaylist:(k,y)=>{M({path:y.path})}}},es=()=>{const w=L(""),{mutate:f,loading:E,onDone:v}=_e({document:Ht});return v(()=>{b.emit("play_audio")}),{loading:E,playPath:w,play:$=>{w.value=$.path,f({path:$.path})},pause:()=>{b.emit("pause_audio")}}},ts={class:"top-app-bar"},os={class:"title"},ss={key:0},as={key:1},ns={class:"actions"},ls=["onClick"],is=["onClick","onMouseover"],ds={class:"start"},rs={class:"number"},cs={class:"image"},us=["src"],ps=["src","onError"],_s={class:"title"},ms={class:"subtitle"},vs={class:"duration"},gs=["onClick"],ks={class:"actions"},ys={class:"artist"},fs={class:"time"},hs={class:"start"},$s={class:"number"},Cs={key:0,class:"no-data-placeholder"},j=50,bs=Qt({__name:"AudiosView",setup(w){var Be;const f=Kt(),{audioSortBy:E}=me(f),v=L([]),{t:$}=Je(),{parseQ:M}=Qo(),C=Gt({tagIds:[],bucketId:void 0}),{app:A,urlTokenKey:B,audioPlaying:U,uploads:F}=me(Ze()),W=t=>{var s;return U.value&&((s=A.value)==null?void 0:s.audioCurrent)===t.path},k=L([]),y=L(!1),P=L(!1),{input:N,upload:z,uploadChanged:H}=Oe(F),{input:R,upload:Q,uploadChanged:ge}=Oe(F),{dropping:xe,fileDragEnter:ke,fileDragLeave:ye,dropFiles:et}=Ot(F),te=L(!1),m=jt.AUDIO,fe=Wt(),he=fe.query,oe=L(parseInt(((Be=he.page)==null?void 0:Be.toString())??"1")),{tags:Y,buckets:x,fetch:tt}=Xt(m),ot=Ye(()=>{const t={};return x.value.forEach(s=>{t[s.id]=s}),t}),D=L(""),{addToTags:st}=Oo(m,Y),{deleteItems:se,deleteItem:$e}=Zt(),{view:at}=$o(m),{selectedIds:T,allChecked:Ce,realAllChecked:q,selectRealAll:nt,allCheckedAlertVisible:lt,clearSelection:K,toggleAllChecked:it,toggleSelect:be,total:S,checked:ae,shiftEffectingIds:Te,handleItemClick:dt,handleMouseOver:rt,selectAll:ct,shouldSelect:ut}=Ko(v),{downloadItems:Ie}=Jt(B,m,K,()=>ro("audios")),{downloadFile:we}=bo(B),Ee=t=>{const s=fe.query.q;qo(f,s?`/audios?page=${t}&q=${s}`:`/audios?page=${t}`)},{keyDown:Ae,keyUp:De}=Go(S,j,oe,ct,K,Ee,()=>{de(re.MEDIA_TRASH,A.value.osVersion)?le(m,Z()):se(m,T.value,q.value,S.value,D.value)}),{addItemsToPlaylist:pt,addToPlaylist:_t,removeFromPlaylist:mt,isInPlaylist:vt}=xo(v,K),gt=go(),qe=L([]),{play:kt,playPath:yt,loading:ft,pause:ht}=es(),$t=t=>{qe.value.push(t)},{loading:ne,fetch:X}=Yt({handle:(t,s)=>{te.value=!1,s?ve($(s),"error"):t&&(v.value=t.items,S.value=t.total)},document:co,variables:()=>({offset:(oe.value-1)*j,limit:j,query:D.value,sortBy:E.value})}),{trashLoading:Se,trash:le}=xt(),{restoreLoading:Fe,restore:Pe}=eo();function Ct(t){return t?`/audios?q=${t}`:"/audios"}function bt(t){E.value!==t&&(te.value=!0,E.value=t)}function ie(){const t=x.value.find(s=>s.id===C.bucketId);return t?We(t.topItems[0]):`${A.value.internalStoragePath}/Music`}function Tt(){z(ie())}function It(){Q(ie())}function wt(t){et(t,ie(),"audio")}const Z=()=>{let t=D.value;return q.value||(t=`ids:${T.value.join(",")}`),t},Ve=t=>{t.type===m&&(K(),X())},Le=t=>{t.type===m&&X()},Me=t=>{t.type===m&&(K(),X())},Re=t=>{t.status==="done"&&Vo(t.fileName)&&((!C.bucketId||x.value.some(I=>I.id===C.bucketId&&I.topItems.some(G=>t.dir.startsWith(We(G)))))&&setTimeout(()=>{X()},1e3),b.emit("media_items_actioned",{type:m,action:"upload",query:""}))};function Et(t){const s=t.tags.map(I=>I.id);So(Fo,{type:m,tags:Y.value,item:{key:t.id,title:t.title,size:t.size},selected:Y.value.filter(I=>s.includes(I.id))})}function At(t,s){k.value.push(s.id),setTimeout(()=>{mt(t,s),setTimeout(()=>{k.value=k.value.filter(I=>I!==s.id)},300)},150)}return to(()=>{var t;D.value=Po(((t=he.q)==null?void 0:t.toString())??""),M(C,D.value),tt(),X(),b.on("item_tags_updated",Le),b.on("items_tags_updated",Ve),b.on("media_items_actioned",Me),b.on("upload_task_done",Re),window.addEventListener("keydown",Ae),window.addEventListener("keyup",De)}),oo(()=>{b.off("item_tags_updated",Le),b.off("items_tags_updated",Ve),b.off("media_items_actioned",Me),b.off("upload_task_done",Re),window.removeEventListener("keydown",Ae),window.removeEventListener("keyup",De)}),(t,s)=>{const I=Ho,G=uo,u=io,Ue=po,ee=_o,Ne=mo,ze=Yo,He=vo,Dt=Ro,qt=zo,St=Uo,Qe=ao,Ft=No,Pt=Bo,Vt=Mo,Lt=Co,Ke=To,Mt=Io,Rt=Xo,Bt=Ut,p=so("tooltip");return a(),g(V,null,[l("div",ts,[n(I,{"touch-target":"wrapper",checked:e(Ce),indeterminate:!e(Ce)&&e(ae),onChange:e(it)},null,8,["checked","indeterminate","onChange"]),l("div",os,[e(T).length?(a(),g("span",ss,h(t.$t("x_selected",{count:e(q)?e(S).toLocaleString():e(T).length.toLocaleString()})),1)):(a(),g("span",as,h(t.$t("page_title.audios"))+" ("+h(e(S).toLocaleString())+")",1)),e(ae)?(a(),g(V,{key:2},[C.trash?(a(),g(V,{key:0},[c((a(),d(u,{onClick:s[0]||(s[0]=i(o=>e(se)(e(m),e(T),e(q),e(S),D.value),["stop"]))},{icon:r(()=>[n(G)]),_:1})),[[p,t.$t("delete")]]),c((a(),d(u,{loading:e(Fe)(Z()),onClick:s[1]||(s[1]=i(o=>e(Pe)(e(m),Z()),["stop"]))},{icon:r(()=>[n(Ue)]),_:1},8,["loading"])),[[p,t.$t("restore")]]),c((a(),d(u,{onClick:s[2]||(s[2]=i(o=>e(Ie)(e(q),e(T),D.value),["stop"]))},{icon:r(()=>[n(ee)]),_:1})),[[p,t.$t("download")]])],64)):(a(),g(V,{key:1},[e(de)(e(re).MEDIA_TRASH,e(A).osVersion)?c((a(),d(u,{key:0,loading:e(Se)(Z()),onClick:s[3]||(s[3]=i(o=>e(le)(e(m),Z()),["stop"]))},{icon:r(()=>[n(Ne)]),_:1},8,["loading"])),[[p,t.$t("move_to_trash")]]):c((a(),d(u,{key:1,onClick:s[4]||(s[4]=i(o=>e(se)(e(m),e(T),e(q),e(S),D.value),["stop"]))},{icon:r(()=>[n(G)]),_:1})),[[p,t.$t("delete")]]),c((a(),d(u,{onClick:s[5]||(s[5]=i(o=>e(Ie)(e(q),e(T),D.value),["stop"]))},{icon:r(()=>[n(ee)]),_:1})),[[p,t.$t("download")]]),c((a(),d(u,{onClick:s[6]||(s[6]=i(o=>e(pt)(o,e(T),e(q),D.value),["stop"]))},{icon:r(()=>[n(ze)]),_:1})),[[p,t.$t("add_to_playlist")]]),c((a(),d(u,{onClick:s[7]||(s[7]=i(o=>e(st)(e(T),e(q),D.value),["stop"]))},{icon:r(()=>[n(He)]),_:1})),[[p,t.$t("add_to_tags")]])],64))],64)):J("",!0)]),l("div",ns,[n(Dt,{filter:C,tags:e(Y),buckets:e(x),"get-url":Ct},null,8,["filter","tags","buckets"]),n(qt),n(Qe,{modelValue:y.value,"onUpdate:modelValue":s[10]||(s[10]=o=>y.value=o)},{trigger:r(()=>[c((a(),d(u,null,{icon:r(()=>[n(St)]),_:1})),[[p,t.$t("upload")]])]),default:r(()=>[l("div",{class:"dropdown-item",onClick:s[8]||(s[8]=i(o=>{Tt(),y.value=!1},["stop"]))},h(t.$t("upload_files")),1),l("div",{class:"dropdown-item",onClick:s[9]||(s[9]=i(o=>{It(),y.value=!1},["stop"]))},h(t.$t("upload_folder")),1)]),_:1},8,["modelValue"]),n(Qe,{modelValue:P.value,"onUpdate:modelValue":s[11]||(s[11]=o=>P.value=o)},{trigger:r(()=>[c((a(),d(u,{loading:te.value},{icon:r(()=>[n(Ft)]),_:1},8,["loading"])),[[p,t.$t("sort")]])]),default:r(()=>[(a(!0),g(V,null,ue(e(gt),o=>(a(),g("div",{key:o.value,class:ce(["dropdown-item",{selected:o.value===e(E)}]),onClick:O=>{bt(o.value),P.value=!1}},h(t.$t(o.label)),11,ls))),128))]),_:1},8,["modelValue"])])]),n(Pt,{limit:j,total:e(S),"all-checked-alert-visible":e(lt),"real-all-checked":e(q),"select-real-all":e(nt),"clear-selection":e(K)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),l("div",{class:"scroll-content",onDragover:s[16]||(s[16]=i((...o)=>e(ke)&&e(ke)(...o),["stop","prevent"]))},[c(l("div",{class:"drag-mask",onDrop:i(wt,["stop","prevent"]),onDragleave:s[12]||(s[12]=i((...o)=>e(ye)&&e(ye)(...o),["stop","prevent"]))},h(t.$t("release_to_send_files")),545),[[no,e(xe)]]),l("div",{class:ce(["audio-list",{"select-mode":e(ae)}])},[(a(!0),g(V,null,ue(v.value,(o,O)=>{var Ge;return a(),g("section",{key:o.id,class:ce(["media-item selectable-card",{selected:e(T).includes(o.id),selecting:e(Te).includes(o.id)}]),onClick:i(_=>e(dt)(_,o,O,()=>{e(kt)(o)}),["stop"]),onMouseover:_=>e(rt)(_,O)},[l("div",ds,[e(Te).includes(o.id)?(a(),d(I,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(ut),onClick:i(_=>e(be)(_,o,O),["stop"])},null,8,["checked","onClick"])):(a(),d(I,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(T).includes(o.id),onClick:i(_=>e(be)(_,o,O),["stop"])},null,8,["checked","onClick"])),l("span",rs,[n(Vt,{id:O+1,raw:o},null,8,["id","raw"])])]),l("div",cs,[qe.value.includes(o.id)?(a(),g("img",{key:0,src:`/ficons/${e(ko)(o.path)}.svg`,class:"svg"},null,8,us)):(a(),g("img",{key:1,class:"image-thumb",src:e(yo)(o.albumFileId,"&w=200&h=200"),onError:_=>$t(o.id)},null,40,ps))]),l("div",_s,h(o.title),1),l("div",ms,[l("span",null,h(e(fo)(o.size)),1),l("span",vs,h(e(ho)(o.duration)),1),l("a",{onClick:i(_=>e(at)(e(f),o.bucketId),["stop","prevent"])},h((Ge=ot.value[o.bucketId])==null?void 0:Ge.name),9,gs),n(Lt,{tags:o.tags,type:e(m),"only-links":!0},null,8,["tags","type"])]),l("div",ks,[C.trash?(a(),g(V,{key:0},[c((a(),d(u,{class:"sm",onClick:i(_=>e($e)(e(m),o),["stop"])},{icon:r(()=>[n(G)]),_:2},1032,["onClick"])),[[p,t.$t("delete")]]),c((a(),d(u,{class:"sm",loading:e(Fe)(`ids:${o.id}`),onClick:i(_=>e(Pe)(e(m),`ids:${o.id}`),["stop"])},{icon:r(()=>[n(Ue)]),_:2},1032,["loading","onClick"])),[[p,t.$t("restore")]]),c((a(),d(u,{class:"sm",onClick:i(_=>e(we)(o.path,e(je)(o.path).replace(" ","-")),["stop"])},{icon:r(()=>[n(ee)]),_:2},1032,["onClick"])),[[p,t.$t("download")]])],64)):(a(),g(V,{key:1},[e(de)(e(re).MEDIA_TRASH,e(A).osVersion)?c((a(),d(u,{key:0,class:"sm",loading:e(Se)(`ids:${o.id}`),onClick:i(_=>e(le)(e(m),`ids:${o.id}`),["stop"])},{icon:r(()=>[n(Ne)]),_:2},1032,["loading","onClick"])),[[p,t.$t("move_to_trash")]]):c((a(),d(u,{key:1,class:"sm",onClick:i(_=>e($e)(e(m),o),["stop"])},{icon:r(()=>[n(G)]),_:2},1032,["onClick"])),[[p,t.$t("delete")]]),c((a(),d(u,{class:"sm",onClick:i(_=>e(we)(o.path,e(je)(o.path).replace(" ","-")),["stop"])},{icon:r(()=>[n(ee)]),_:2},1032,["onClick"])),[[p,t.$t("download")]]),e(vt)(o)&&!k.value.includes(o.id)?c((a(),d(u,{key:2,class:"sm",onClick:i(_=>At(_,o),["stop","prevent"])},{icon:r(()=>[n(Ke,{class:"playlist-remove-icon"})]),_:2},1032,["onClick"])),[[p,t.$t("remove_from_playlist")]]):k.value.includes(o.id)?(a(),d(u,{key:3,class:"sm",disabled:!0},{icon:r(()=>[n(Ke,{class:"playlist-remove-icon rotating"})]),_:1})):c((a(),d(u,{key:4,class:"sm",onClick:i(_=>e(_t)(_,o),["stop","prevent"])},{icon:r(()=>[n(ze)]),_:2},1032,["onClick"])),[[p,t.$t("add_to_playlist")]]),c((a(),d(u,{class:"sm",onClick:i(_=>Et(o),["stop"])},{icon:r(()=>[n(He)]),_:2},1032,["onClick"])),[[p,t.$t("add_to_tags")]])],64)),e(ft)&&o.path===e(yt)?(a(),d(Mt,{key:2,indeterminate:"",class:"sm"})):W(o)?c((a(),d(u,{key:3,class:"sm",onClick:s[13]||(s[13]=i(_=>e(ht)(),["stop"]))},{icon:r(()=>[n(Rt)]),_:1})),[[p,t.$t("pause")]]):J("",!0)]),l("div",ys,h(o.artist),1),l("div",fs,[c((a(),g("span",null,[Eo(h(e(Ao)(o.createdAt)),1)])),[[p,e(wo)(o.createdAt)]])])],42,is)}),128)),e(ne)&&v.value.length===0?(a(),g(V,{key:0},ue(20,o=>l("section",{key:o,class:"media-item selectable-card-skeleton"},[l("div",hs,[s[17]||(s[17]=l("div",{class:"checkbox"},[l("div",{class:"skeleton-checkbox"})],-1)),l("span",$s,h(o),1)]),s[18]||(s[18]=Do('<div class="image" data-v-23379591><div class="skeleton-image" data-v-23379591></div></div><div class="title" data-v-23379591><div class="skeleton-text skeleton-title" data-v-23379591></div></div><div class="subtitle" data-v-23379591><div class="skeleton-text skeleton-subtitle" data-v-23379591></div></div><div class="actions" data-v-23379591><div class="skeleton-text skeleton-actions" data-v-23379591></div></div><div class="artist" data-v-23379591><div class="skeleton-text skeleton-artist" data-v-23379591></div></div><div class="time" data-v-23379591><div class="skeleton-text skeleton-time" data-v-23379591></div></div>',6))])),64)):J("",!0)],2),!e(ne)&&v.value.length===0?(a(),g("div",Cs,h(t.$t(e(lo)(e(ne),e(A).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):J("",!0),e(S)>j?(a(),d(Bt,{key:1,page:oe.value,go:Ee,total:e(S),limit:j},null,8,["page","total"])):J("",!0),l("input",{ref_key:"fileInput",ref:N,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",onChange:s[14]||(s[14]=(...o)=>e(H)&&e(H)(...o))},null,544),l("input",{ref_key:"dirFileInput",ref:R,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:s[15]||(s[15]=(...o)=>e(ge)&&e(ge)(...o))},null,544)],32)],64)}}}),Ls=Lo(bs,[["__scopeId","data-v-23379591"]]);export{Ls as default};
