import{e as ve,c as i,J as y,o,a as n,t as b,u as he,r as T,N as ge,cr as Je,F as E,f as Ye,s as Ze,g as Xe,K as es,L as ss,M as ts,aU as de,a6 as ue,i as _e,O as os,P as ns,j as C,k as r,l as e,U as pe,Q as I,R as as,z as g,a8 as ls,S as is,p as cs,V as rs,q as me,br as ds,W as us,cq as _s,c3 as ps,cs as ms,ct as fs,cu as vs,Z as hs,T as gs,a0 as ks,G as ys,a1 as bs,$ as ws,ck as $s,aK as Ss,B as G,a4 as Cs,a5 as k,cv as Ts,I as Fs}from"./index-DRp6xo3j.js";import{_ as Ls}from"./FieldId.vuevuetypescriptsetuptruelang-slfJ4h1L.js";import{_ as qs,u as Is,b as Es,a as Ds}from"./key-events-cECSsEaK.js";import{_ as Ms,a as Ns,b as As}from"./SearchInput-BJwFSU_P.js";import{_ as Ps,a as Qs}from"./add-notes-outline-rounded-DfdtNEgc.js";import{_ as Us}from"./VCheckbox-COaKMA3E.js";import{u as Bs}from"./feeds-92enUHJ0.js";import{a as Rs}from"./tags-DBIbojtk.js";import{u as zs}from"./search-VN1T4MU3.js";import"./search-rounded-DveNm3Pb.js";const Vs={key:0,class:"feed-item selectable-card-skeleton"},Gs={class:"subtitle"},Ks={class:"number"},Ws=ve({__name:"FeedSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(D){return(d,l)=>{const m=qs;return d.isPhone?(o(),y(m,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":3})):(o(),i("section",Vs,[l[1]||(l[1]=n("div",{class:"title"},[n("div",{class:"skeleton-checkbox"}),n("div",{class:"skeleton-text lg",style:{width:"50%"}})],-1)),n("div",Gs,[n("span",Ks,b(d.index),1),l[0]||(l[0]=n("div",{class:"info"},[n("div",{class:"skeleton-text",style:{width:"30%"}})],-1))]),l[2]||(l[2]=n("div",{class:"image"},[n("div",{class:"skeleton-image lg"})],-1))]))}}}),js=(D,d,l)=>{const{t:m}=he(),u=T(1),_=100,M=T(!1),{loading:Q,fetch:f}=ge({handle:(v,N)=>{if(N)E(m(N),"error");else if(v){v.items.length<_&&(M.value=!0);const A=v.items;u.value===1?D.value=A:D.value=D.value.concat(A),l.value=v.total}},document:Je,variables:()=>({offset:(u.value-1)*_,limit:_,query:d.value})});return{page:u,noMore:M,loading:Q,fetch:f,loadMore:()=>{M.value||Q.value||u.value++}}},xs={class:"top-app-bar"},Hs={class:"title"},Os={key:0},Js={key:1},Ys={class:"actions"},Zs=["disabled"],Xs={key:1,class:"scroller"},et=["href"],st=["onClick","onMouseover"],tt={class:"title"},ot={class:"text"},nt={class:"subtitle"},at={class:"number"},lt={class:"info"},it=["onClick"],ct={class:"time"},rt={class:"btn-icon sm",style:{display:"none"}},dt=["src"],ut={key:3,class:"no-data-placeholder"},fe=100,_t=ve({__name:"FeedsSidebar2",setup(D){var ce;const d=cs("isPhone"),l=Ye(),{feedsSyncing:m}=Ze(Xe()),{t:u}=he(),_=es({tagIds:[]}),{parseQ:M,buildQ:Q}=zs(),f=ss.FEED_ENTRY,v=ts(),N=v.query,A=T(parseInt(((ce=N.page)==null?void 0:ce.toString())??"1")),U=T([]),B=T([]),K=de(()=>{const s={};return B.value.forEach(t=>{s[t.id]=t}),s}),w=T([]),$=T(""),{selectedIds:p,allChecked:W,realAllChecked:F,selectRealAll:ke,allCheckedAlertVisible:ye,clearSelection:R,toggleAllChecked:be,toggleSelect:j,total:S,checked:x,shiftEffectingIds:H,handleItemClick:we,handleMouseOver:$e,selectAll:Se,shouldSelect:Ce}=Is(w),Te=s=>{A.value=s;const t=v.query.q;G(l,t?`/feeds?page=${s}&q=${t}`:`/feeds?page=${s}`)},{keyDown:O,keyUp:J}=Ds(S,fe,A,Se,R,Te,()=>{X(p.value,F.value,S.value,$.value)}),{page:Y,loading:z,loadMore:Fe,fetch:Le,noMore:Z}=js(w,$,S),{addToTags:qe}=Rs(f,U),P=()=>{Y.value=1,Le()},{deleteItems:X}=Es(Ts,()=>{R(),P(),w.value.some(s=>s.tags.length)&&k.emit("refetch_tags",f),k.emit("feed_entries_deleted")}),ee=de(()=>ue.currentRoute.value.path!=="/feeds"),{resizeWidth:se}=_s(300,()=>l.sidebar2Width,s=>{l.sidebar2Width=s}),{mutate:te,loading:Ie,onDone:Ee}=_e({document:ms});function De(){if(F)te({query:$.value});else{if(p.value.length===0){E(u("select_first"),"error");return}te({query:`ids:${p.value.join(",")}`})}}Ee(()=>{E(u("saved"))});function oe(s){return s?`/feeds?q=${s}`:"/feeds"}const{fetch:Me}=ge({handle:async(s,t)=>{t?E(u(t),"error"):s&&(U.value=s.tags,B.value=s.feeds)},document:fs,variables:{type:f}});function ne(s){const t=ue.currentRoute.value.query.q;return t?`/feeds/${s.feedId}/entries/${s.id}?q=${t}`:`/feeds/${s.feedId}/entries/${s.id}`}function Ne(s){G(l,ne(s))}const{viewFeed:Ae}=Bs(l),{mutate:Pe}=_e({document:vs});function Qe(){m.value=!0,Pe({id:""})}const ae=s=>{m.value=!1,P(),s.error?E(s.error,"error"):E(u("feeds_synced"))},le=s=>{s.type===f&&(R(),P())},ie=s=>{s.type===f&&P()};function Ue(s){Object.assign(_,s),G(l,oe(Q(_)))}return os(()=>{var t,L;const s=(t=document.getElementsByClassName("scroller"))==null?void 0:t[0];s&&(s.scrollTop=0),$.value=Cs(((L=N.q)==null?void 0:L.toString())??""),M(_,$.value),Me(),P(),k.on("item_tags_updated",ie),k.on("items_tags_updated",le),k.on("feeds_fetched",ae),window.addEventListener("keydown",O),window.addEventListener("keyup",J)}),ns(()=>{Y.value=1,Z.value=!1,k.off("item_tags_updated",ie),k.off("items_tags_updated",le),k.off("feeds_fetched",ae),window.removeEventListener("keydown",O),window.removeEventListener("keyup",J)}),(s,t)=>{const L=Us,Be=ls,Re=is,V=hs,ze=Ps,Ve=Ms,Ge=Qs,Ke=As,We=Ns,je=Ws,xe=Ls,He=ws,Oe=$s,q=as("tooltip");return o(),i("aside",{class:"sidebar2",style:ps({width:e(v).params.id?e(l).sidebar2Width+"px":"auto"})},[n("div",xs,[r(L,{"touch-target":"wrapper",checked:e(W),indeterminate:!e(W)&&e(x),onChange:e(be)},null,8,["checked","indeterminate","onChange"]),n("div",Hs,[e(p).length?(o(),i("span",Os,b(s.$t("x_selected",{count:e(F)?e(S).toLocaleString():e(p).length.toLocaleString()})),1)):(o(),i("span",Js,b(s.$t("page_title.feeds"))+" ("+b(e(S).toLocaleString())+")",1)),e(x)?(o(),i(pe,{key:2},[I((o(),i("button",{class:"btn-icon",onClick:t[0]||(t[0]=g(c=>e(X)(e(p),e(F),e(S),$.value),["stop"]))},[r(Be)])),[[q,s.$t("delete")]]),I((o(),i("button",{class:"btn-icon",onClick:t[1]||(t[1]=g(c=>e(qe)(e(p),e(F),$.value),["stop"]))},[r(Re)])),[[q,s.$t("add_to_tags")]]),e(Ie)?(o(),y(V,{key:0,indeterminate:"",class:"sm"})):I((o(),i("button",{key:1,class:"btn-icon sm",onClick:g(De,["prevent"])},[r(ze)])),[[q,s.$t("save_to_notes")]])],64)):C("",!0)]),n("div",Ys,[r(Ve,{filter:_,tags:U.value,feeds:B.value,"show-chips":!ee.value&&!e(d),"get-url":oe,"show-today":!0,"is-phone":e(d)},null,8,["filter","tags","feeds","show-chips","is-phone"]),e(m)?(o(),y(V,{key:0,indeterminate:"",class:"sm"})):I((o(),i("button",{key:1,class:"btn-icon",disabled:e(m),onClick:g(Qe,["prevent"])},[r(Ge)],8,Zs)),[[q,s.$t("sync_feeds")]])])]),ee.value||e(d)?(o(),y(Ke,{key:0,class:"mobile-search-filters",filter:_,tags:U.value,feeds:B.value,buckets:[],types:[],onFilterChange:Ue},null,8,["filter","tags","feeds"])):C("",!0),r(We,{limit:fe,total:e(S),"all-checked-alert-visible":e(ye),"real-all-checked":e(F),"select-real-all":e(ke),"clear-selection":e(R)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(z)&&w.value.length===0?(o(),i("div",Xs,[(o(),i(pe,null,rs(20,c=>r(je,{key:c,index:c,"is-phone":e(d)},null,8,["index","is-phone"])),64))])):C("",!0),w.value.length>0?(o(),y(e(ds),{key:2,class:"scroller","data-key":"id","data-sources":w.value,"estimate-size":100,onTobottom:e(Fe)},{item:me(({index:c,item:a})=>{var re;return[n("a",{class:"item-link",href:ne(a)},[n("article",{class:gs(["feed-item selectable-card",{selected:e(p).includes(a.id)||a.id==s.$route.params.id,selecting:e(H).includes(a.id)}]),onClick:g(h=>e(we)(h,a,c,()=>{Ne(a)}),["stop","prevent"]),onMouseover:h=>e($e)(h,c)},[n("div",tt,[e(H).includes(a.id)?(o(),y(L,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(Ce),onClick:g(h=>e(j)(h,a,c),["stop"])},null,8,["checked","onClick"])):(o(),y(L,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(p).includes(a.id),onClick:g(h=>e(j)(h,a,c),["stop"])},null,8,["checked","onClick"])),n("div",ot,b(a.title||s.$t("no_content")),1)]),n("div",nt,[n("span",at,[r(xe,{id:c+1,raw:a},null,8,["id","raw"])]),n("div",lt,[n("a",{onClick:g(h=>e(Ae)(K.value[a.feedId]),["stop","prevent"])},b((re=K.value[a.feedId])==null?void 0:re.name),9,it),t[3]||(t[3]=n("span",null,"Â·",-1)),I((o(),i("span",ct,[ys(b(e(bs)(a.publishedAt)),1)])),[[q,e(ks)(a.publishedAt)]]),r(He,{tags:a.tags,type:e(f),"only-links":!0},null,8,["tags","type"])])]),I((o(),i("button",rt,[r(Oe)])),[[q,s.$t("actions")]]),a.image?(o(),i("img",{key:0,class:"image",src:e(Ss)(a.image,"&w=200&h=200")},null,8,dt)):C("",!0)],42,st)],8,et)]}),footer:me(()=>[e(Z)?C("",!0):(o(),y(V,{key:0,indeterminate:"",class:"sm"}))]),_:1},8,["data-sources","onTobottom"])):C("",!0),!e(z)&&w.value.length===0?(o(),i("div",ut,b(s.$t(e(us)(e(z)))),1)):C("",!0),n("div",{class:"sidebar-drag-indicator",onMousedown:t[2]||(t[2]=(...c)=>e(se)&&e(se)(...c))},null,32)],4)}}}),$t=Fs(_t,[["__scopeId","data-v-eab9ef26"]]);export{$t as default};
