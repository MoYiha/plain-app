import{_ as Be}from"./more-vert-DqCIvKEs.js";import{u as ue,r as b,J as _e,c8 as Ge,D,e as Ke,f as We,s as xe,g as He,G as Pe,H as je,I as Oe,aE as ne,a4 as ae,i as le,K as Ye,L as Je,c as l,o as n,a as o,k as r,j as F,O as Xe,l as e,t as p,Q as ie,p as q,M as Ze,y as f,a6 as es,N as ss,R as ts,a3 as de,bh as os,S as ns,c7 as as,bM as ls,c9 as is,ca as ds,cb as cs,d as rs,P as us,U as _s,X as ps,Y as fs,Z as vs,W as ms,ay as gs,z as ce,a1 as hs,a2 as v,cc as ks,F as ys}from"./index-BEu6YjWH.js";import{_ as bs,a as ws}from"./SearchInput-xdUPJv23.js";import{_ as $s,a as Cs}from"./add-notes-outline-rounded-DXtgt7v5.js";import{u as Ss}from"./feeds-CbEuEBPO.js";import{u as Ts,b as Ls,a as Es}from"./key-events-tmVSwCBq.js";import{a as Fs}from"./tags-DObxk3fj.js";import{u as qs}from"./search-Cl5-OtJh.js";import"./search-rounded-B6Fp8Tpm.js";import"./vee-validate-DE4bExDP.js";const Ds=(N,u,w)=>{const{t:$}=ue(),m=b(1),I=100,d=b(!1),{loading:C,fetch:A}=_e({handle:(g,S)=>{if(S)D($(S),"error");else if(g){g.items.length<I&&(d.value=!0);const T=g.items;m.value===1?N.value=T:N.value=N.value.concat(T),w.value=g.total}},document:Ge,variables:()=>({offset:(m.value-1)*I,limit:I,query:u.value})});return{page:m,noMore:d,loading:C,fetch:A,loadMore:()=>{d.value||C.value||m.value++}}},Is={class:"top-app-bar"},Ms=["checked","indeterminate"],Ns={class:"title"},As={key:0},Qs={key:1},Rs={key:0,indeterminate:"",class:"spinner-sm"},Us={class:"actions"},zs={key:0,indeterminate:"",class:"spinner-sm"},Vs=["disabled"],Bs={key:0,class:"scroller"},Gs={class:"subtitle"},Ks={class:"number"},Ws=["href"],xs=["onClick","onMouseover"],Hs={class:"title"},Ps=["checked","onClick"],js=["checked","onClick"],Os={class:"text"},Ys={class:"subtitle"},Js={class:"number"},Xs={class:"info"},Zs=["onClick"],et={class:"time"},st={class:"btn-icon sm",style:{display:"none"}},tt=["src"],ot={key:0,indeterminate:"",class:"spinner-sm"},nt={key:2,class:"no-data-placeholder"},re=100,at=Ke({__name:"FeedsSidebar2",setup(N){var te;const u=We(),{feedsSyncing:w}=xe(He()),{t:$}=ue(),m=Pe({tagIds:[]}),{parseQ:I}=qs(),d=je.FEED_ENTRY,C=Oe(),A=C.query,g=b(parseInt(((te=A.page)==null?void 0:te.toString())??"1")),S=b([]),T=b([]),z=ne(()=>{const s={};return T.value.forEach(t=>{s[t.id]=t}),s}),h=b([]),k=b(""),{selectedIds:c,allChecked:V,realAllChecked:L,selectRealAll:pe,allCheckedAlertVisible:fe,clearSelection:Q,toggleAllChecked:B,toggleSelect:G,total:y,checked:K,shiftEffectingIds:W,handleItemClick:ve,handleMouseOver:me,selectAll:ge,shouldSelect:he}=Ts(h),ke=s=>{g.value=s;const t=C.query.q;ce(u,t?`/feeds?page=${s}&q=${t}`:`/feeds?page=${s}`)},{keyDown:x,keyUp:H}=Es(y,re,g,ge,Q,ke,()=>{O(c.value,L.value,y.value,k.value)}),{page:P,loading:U,loadMore:ye,fetch:be,noMore:j}=Ds(h,k,y),{addToTags:we}=Fs(d,S),M=()=>{P.value=1,be()},{deleteItems:O}=Ls(ks,()=>{Q(),M(),h.value.some(s=>s.tags.length)&&v.emit("refetch_tags",d),v.emit("feed_entries_deleted")}),$e=ne(()=>ae.currentRoute.value.path!=="/feeds"),{resizeWidth:Y}=as(300,()=>u.sidebar2Width,s=>{u.sidebar2Width=s}),{mutate:J,loading:Ce,onDone:Se}=le({document:is});function Te(){if(L)J({query:k.value});else{if(c.value.length===0){D($("select_first"),"error");return}J({query:`ids:${c.value.join(",")}`})}}Se(()=>{D($("saved"))});function Le(s){return s?`/feeds?q=${s}`:"/feeds"}const{fetch:Ee}=_e({handle:async(s,t)=>{t?D($(t),"error"):s&&(S.value=s.tags,T.value=s.feeds)},document:ds,variables:{type:d}});function X(s){const t=ae.currentRoute.value.query.q;return t?`/feeds/${s.feedId}/entries/${s.id}?q=${t}`:`/feeds/${s.feedId}/entries/${s.id}`}function Fe(s){ce(u,X(s))}const{viewFeed:qe}=Ss(u),{mutate:De}=le({document:cs});function Ie(){w.value=!0,De({id:""})}const Z=s=>{w.value=!1,M(),s.error?D(s.error,"error"):D($("feeds_synced"))},ee=s=>{s.type===d&&(Q(),M())},se=s=>{s.type===d&&M()};return Ye(()=>{var t,R;const s=(t=document.getElementsByClassName("scroller"))==null?void 0:t[0];s&&(s.scrollTop=0),k.value=hs(((R=A.q)==null?void 0:R.toString())??""),I(m,k.value),Ee(),M(),v.on("item_tags_updated",se),v.on("items_tags_updated",ee),v.on("feeds_fetched",Z),window.addEventListener("keydown",x),window.addEventListener("keyup",H)}),Je(()=>{P.value=1,j.value=!1,v.off("item_tags_updated",se),v.off("items_tags_updated",ee),v.off("feeds_fetched",Z),window.removeEventListener("keydown",x),window.removeEventListener("keyup",H)}),(s,t)=>{const R=es,Me=ss,Ne=$s,Ae=bs,Qe=Cs,Re=ws,Ue=_s,ze=ms,Ve=Be,E=Ze("tooltip");return n(),l("aside",{class:"sidebar2",style:ls({width:e(C).params.id?e(u).sidebar2Width+"px":"auto"})},[o("div",Is,[o("md-checkbox",{"touch-target":"wrapper",checked:e(V),indeterminate:!e(V)&&e(K),onChange:t[0]||(t[0]=(...i)=>e(B)&&e(B)(...i))},null,40,Ms),o("div",Ns,[e(c).length?(n(),l("span",As,p(s.$t("x_selected",{count:e(L)?e(y).toLocaleString():e(c).length.toLocaleString()})),1)):(n(),l("span",Qs,p(s.$t("page_title.feeds"))+" ("+p(e(y).toLocaleString())+")",1)),e(K)?(n(),l(ie,{key:2},[q((n(),l("button",{class:"btn-icon",onClick:t[1]||(t[1]=f(i=>e(O)(e(c),e(L),e(y),k.value),["stop"]))},[t[4]||(t[4]=o("md-ripple",null,null,-1)),r(R)])),[[E,s.$t("delete")]]),q((n(),l("button",{class:"btn-icon",onClick:t[2]||(t[2]=f(i=>e(we)(e(c),e(L),k.value),["stop"]))},[t[5]||(t[5]=o("md-ripple",null,null,-1)),r(Me)])),[[E,s.$t("add_to_tags")]]),e(Ce)?(n(),l("md-circular-progress",Rs)):q((n(),l("button",{key:1,class:"btn-icon sm",onClick:f(Te,["prevent"])},[t[6]||(t[6]=o("md-ripple",null,null,-1)),r(Ne)])),[[E,s.$t("save_to_notes")]])],64)):F("",!0)]),o("div",Us,[r(Ae,{filter:m,tags:S.value,feeds:T.value,"show-chips":!$e.value,"get-url":Le,"show-today":!0},null,8,["filter","tags","feeds","show-chips"]),e(w)?(n(),l("md-circular-progress",zs)):q((n(),l("button",{key:1,class:"btn-icon",disabled:e(w),onClick:f(Ie,["prevent"])},[t[7]||(t[7]=o("md-ripple",null,null,-1)),r(Qe)],8,Vs)),[[E,s.$t("sync_feeds")]])])]),r(Re,{limit:re,total:e(y),"all-checked-alert-visible":e(fe),"real-all-checked":e(L),"select-real-all":e(pe),"clear-selection":e(Q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(U)&&h.value.length===0?(n(),l("div",Bs,[(n(),l(ie,null,ts(20,i=>o("section",{key:i,class:"feed-item selectable-card-skeleton"},[t[9]||(t[9]=rs('<div class="title" data-v-9fe1976f><div class="checkbox" data-v-9fe1976f><div class="skeleton-checkbox" data-v-9fe1976f></div></div><div class="text" data-v-9fe1976f><div class="skeleton-text skeleton-title" data-v-9fe1976f></div></div></div>',1)),o("div",Gs,[o("span",Ks,p(i),1),t[8]||(t[8]=o("div",{class:"info"},[o("div",{class:"skeleton-text skeleton-info"})],-1))]),t[10]||(t[10]=o("div",{class:"image"},[o("div",{class:"skeleton-image"})],-1))])),64))])):F("",!0),h.value.length>0?(n(),Xe(e(os),{key:1,class:"scroller","data-key":"id","data-sources":h.value,"estimate-size":100,onTobottom:e(ye)},{item:de(({index:i,item:a})=>{var oe;return[o("a",{class:"item-link",href:X(a)},[o("article",{class:us(["feed-item selectable-card",{selected:e(c).includes(a.id)||a.id==s.$route.params.id,selecting:e(W).includes(a.id)}]),onClick:f(_=>e(ve)(_,a,i,()=>{Fe(a)}),["stop","prevent"]),onMouseover:_=>e(me)(_,i)},[o("div",Hs,[e(W).includes(a.id)?(n(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:e(he),onClick:f(_=>e(G)(_,a,i),["stop"])},null,8,Ps)):(n(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:e(c).includes(a.id),onClick:f(_=>e(G)(_,a,i),["stop"])},null,8,js)),o("div",Os,p(a.title||s.$t("no_content")),1)]),o("div",Ys,[o("span",Js,[r(Ue,{id:i+1,raw:a},null,8,["id","raw"])]),o("div",Xs,[o("a",{onClick:f(_=>e(qe)(z.value[a.feedId]),["stop","prevent"])},p((oe=z.value[a.feedId])==null?void 0:oe.name),9,Zs),t[11]||(t[11]=o("span",null,"Â·",-1)),q((n(),l("span",et,[fs(p(e(vs)(a.publishedAt)),1)])),[[E,e(ps)(a.publishedAt)]]),r(ze,{tags:a.tags,type:e(d),"only-links":!0},null,8,["tags","type"])])]),q((n(),l("button",st,[t[12]||(t[12]=o("md-ripple",null,null,-1)),r(Ve)])),[[E,s.$t("actions")]]),a.image?(n(),l("img",{key:0,class:"image",src:e(gs)(a.image,"&w=200&h=200")},null,8,tt)):F("",!0)],42,xs)],8,Ws)]}),footer:de(()=>[e(j)?F("",!0):(n(),l("md-circular-progress",ot))]),_:1},8,["data-sources","onTobottom"])):F("",!0),!e(U)&&h.value.length===0?(n(),l("div",nt,p(s.$t(e(ns)(e(U)))),1)):F("",!0),o("div",{class:"sidebar-drag-indicator",onMousedown:t[3]||(t[3]=(...i)=>e(Y)&&e(Y)(...i))},null,32)],4)}}}),mt=ys(at,[["__scopeId","data-v-9fe1976f"]]);export{mt as default};
