import{_ as We}from"./more-vert-B9buNtZx.js";import{u as _e,r as b,L as pe,cm as He,E as N,e as Pe,f as je,s as xe,g as Oe,I as Je,J as Ye,K as Ze,aN as ne,a6 as le,i as ie,M as Xe,N as es,c as l,o,a,k as d,j as F,S as I,l as e,O as ss,t as p,U as ce,P as D,Q as ts,y as v,a8 as os,R as as,V as ns,p as de,bq as ls,W as is,cl as cs,b_ as ds,cn as rs,co as us,cp as _s,Z as ps,d as vs,T as fs,a0 as ms,F as gs,a1 as hs,$ as ks,aI as ys,A as re,a4 as bs,a5 as f,cq as ws,H as $s}from"./index-CuU5w3Fk.js";import{_ as Cs}from"./FieldId.vuevuetypescriptsetuptruelang-BAr-ccW2.js";import{_ as Ts,a as Ss}from"./SearchInput-Do4mYLNe.js";import{_ as Ls,a as qs}from"./add-notes-outline-rounded-DF30hd1s.js";import{u as Es}from"./feeds-lyrVZxPU.js";import{u as Fs,b as Is,a as Ds}from"./key-events-CMYOn2tc.js";import{a as Ns}from"./tags-C_c-1fHE.js";import{u as Ms}from"./search-cTEMyIe9.js";import"./VInputChip-Cze1-7DF.js";const As=(Q,u,w)=>{const{t:$}=_e(),m=b(1),M=100,c=b(!1),{loading:C,fetch:R}=pe({handle:(g,T)=>{if(T)N($(T),"error");else if(g){g.items.length<M&&(c.value=!0);const S=g.items;m.value===1?Q.value=S:Q.value=Q.value.concat(S),w.value=g.total}},document:He,variables:()=>({offset:(m.value-1)*M,limit:M,query:u.value})});return{page:m,noMore:c,loading:C,fetch:R,loadMore:()=>{c.value||C.value||m.value++}}},Qs={class:"top-app-bar"},Rs={class:"title"},Us={key:0},Vs={key:1},zs={class:"actions"},Bs=["disabled"],Gs={key:0,class:"scroller"},Ks={class:"subtitle"},Ws={class:"number"},Hs=["href"],Ps=["onClick","onMouseover"],js={class:"title"},xs={class:"text"},Os={class:"subtitle"},Js={class:"number"},Ys={class:"info"},Zs=["onClick"],Xs={class:"time"},et={class:"btn-icon sm",style:{display:"none"}},st=["src"],tt={key:2,class:"no-data-placeholder"},ue=100,ot=Pe({__name:"FeedsSidebar2",setup(Q){var oe;const u=je(),{feedsSyncing:w}=xe(Oe()),{t:$}=_e(),m=Je({tagIds:[]}),{parseQ:M}=Ms(),c=Ye.FEED_ENTRY,C=Ze(),R=C.query,g=b(parseInt(((oe=R.page)==null?void 0:oe.toString())??"1")),T=b([]),S=b([]),B=ne(()=>{const s={};return S.value.forEach(t=>{s[t.id]=t}),s}),h=b([]),k=b(""),{selectedIds:r,allChecked:G,realAllChecked:L,selectRealAll:ve,allCheckedAlertVisible:fe,clearSelection:U,toggleAllChecked:me,toggleSelect:K,total:y,checked:W,shiftEffectingIds:H,handleItemClick:ge,handleMouseOver:he,selectAll:ke,shouldSelect:ye}=Fs(h),be=s=>{g.value=s;const t=C.query.q;re(u,t?`/feeds?page=${s}&q=${t}`:`/feeds?page=${s}`)},{keyDown:P,keyUp:j}=Ds(y,ue,g,ke,U,be,()=>{J(r.value,L.value,y.value,k.value)}),{page:x,loading:V,loadMore:we,fetch:$e,noMore:O}=As(h,k,y),{addToTags:Ce}=Ns(c,T),A=()=>{x.value=1,$e()},{deleteItems:J}=Is(ws,()=>{U(),A(),h.value.some(s=>s.tags.length)&&f.emit("refetch_tags",c),f.emit("feed_entries_deleted")}),Te=ne(()=>le.currentRoute.value.path!=="/feeds"),{resizeWidth:Y}=cs(300,()=>u.sidebar2Width,s=>{u.sidebar2Width=s}),{mutate:Z,loading:Se,onDone:Le}=ie({document:rs});function qe(){if(L)Z({query:k.value});else{if(r.value.length===0){N($("select_first"),"error");return}Z({query:`ids:${r.value.join(",")}`})}}Le(()=>{N($("saved"))});function Ee(s){return s?`/feeds?q=${s}`:"/feeds"}const{fetch:Fe}=pe({handle:async(s,t)=>{t?N($(t),"error"):s&&(T.value=s.tags,S.value=s.feeds)},document:us,variables:{type:c}});function X(s){const t=le.currentRoute.value.query.q;return t?`/feeds/${s.feedId}/entries/${s.id}?q=${t}`:`/feeds/${s.feedId}/entries/${s.id}`}function Ie(s){re(u,X(s))}const{viewFeed:De}=Es(u),{mutate:Ne}=ie({document:_s});function Me(){w.value=!0,Ne({id:""})}const ee=s=>{w.value=!1,A(),s.error?N(s.error,"error"):N($("feeds_synced"))},se=s=>{s.type===c&&(U(),A())},te=s=>{s.type===c&&A()};return Xe(()=>{var t,q;const s=(t=document.getElementsByClassName("scroller"))==null?void 0:t[0];s&&(s.scrollTop=0),k.value=bs(((q=R.q)==null?void 0:q.toString())??""),M(m,k.value),Fe(),A(),f.on("item_tags_updated",te),f.on("items_tags_updated",se),f.on("feeds_fetched",ee),window.addEventListener("keydown",P),window.addEventListener("keyup",j)}),es(()=>{x.value=1,O.value=!1,f.off("item_tags_updated",te),f.off("items_tags_updated",se),f.off("feeds_fetched",ee),window.removeEventListener("keydown",P),window.removeEventListener("keyup",j)}),(s,t)=>{const q=ss,Ae=os,Qe=as,z=ps,Re=Ls,Ue=Ts,Ve=qs,ze=Ss,Be=Cs,Ge=ks,Ke=We,E=ts("tooltip");return o(),l("aside",{class:"sidebar2",style:ds({width:e(C).params.id?e(u).sidebar2Width+"px":"auto"})},[a("div",Qs,[d(q,{"touch-target":"wrapper",checked:e(G),indeterminate:!e(G)&&e(W),onChange:e(me)},null,8,["checked","indeterminate","onChange"]),a("div",Rs,[e(r).length?(o(),l("span",Us,p(s.$t("x_selected",{count:e(L)?e(y).toLocaleString():e(r).length.toLocaleString()})),1)):(o(),l("span",Vs,p(s.$t("page_title.feeds"))+" ("+p(e(y).toLocaleString())+")",1)),e(W)?(o(),l(ce,{key:2},[D((o(),l("button",{class:"btn-icon",onClick:t[0]||(t[0]=v(i=>e(J)(e(r),e(L),e(y),k.value),["stop"]))},[d(Ae)])),[[E,s.$t("delete")]]),D((o(),l("button",{class:"btn-icon",onClick:t[1]||(t[1]=v(i=>e(Ce)(e(r),e(L),k.value),["stop"]))},[d(Qe)])),[[E,s.$t("add_to_tags")]]),e(Se)?(o(),I(z,{key:0,indeterminate:"",class:"sm"})):D((o(),l("button",{key:1,class:"btn-icon sm",onClick:v(qe,["prevent"])},[d(Re)])),[[E,s.$t("save_to_notes")]])],64)):F("",!0)]),a("div",zs,[d(Ue,{filter:m,tags:T.value,feeds:S.value,"show-chips":!Te.value,"get-url":Ee,"show-today":!0},null,8,["filter","tags","feeds","show-chips"]),e(w)?(o(),I(z,{key:0,indeterminate:"",class:"sm"})):D((o(),l("button",{key:1,class:"btn-icon",disabled:e(w),onClick:v(Me,["prevent"])},[d(Ve)],8,Bs)),[[E,s.$t("sync_feeds")]])])]),d(ze,{limit:ue,total:e(y),"all-checked-alert-visible":e(fe),"real-all-checked":e(L),"select-real-all":e(ve),"clear-selection":e(U)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(V)&&h.value.length===0?(o(),l("div",Gs,[(o(),l(ce,null,ns(20,i=>a("section",{key:i,class:"feed-item selectable-card-skeleton"},[t[4]||(t[4]=vs('<div class="title" data-v-115aa717><div class="checkbox" data-v-115aa717><div class="skeleton-checkbox" data-v-115aa717></div></div><div class="text" data-v-115aa717><div class="skeleton-text skeleton-title" data-v-115aa717></div></div></div>',1)),a("div",Ks,[a("span",Ws,p(i),1),t[3]||(t[3]=a("div",{class:"info"},[a("div",{class:"skeleton-text skeleton-info"})],-1))]),t[5]||(t[5]=a("div",{class:"image"},[a("div",{class:"skeleton-image"})],-1))])),64))])):F("",!0),h.value.length>0?(o(),I(e(ls),{key:1,class:"scroller","data-key":"id","data-sources":h.value,"estimate-size":100,onTobottom:e(we)},{item:de(({index:i,item:n})=>{var ae;return[a("a",{class:"item-link",href:X(n)},[a("article",{class:fs(["feed-item selectable-card",{selected:e(r).includes(n.id)||n.id==s.$route.params.id,selecting:e(H).includes(n.id)}]),onClick:v(_=>e(ge)(_,n,i,()=>{Ie(n)}),["stop","prevent"]),onMouseover:_=>e(he)(_,i)},[a("div",js,[e(H).includes(n.id)?(o(),I(q,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(ye),onClick:v(_=>e(K)(_,n,i),["stop"])},null,8,["checked","onClick"])):(o(),I(q,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(r).includes(n.id),onClick:v(_=>e(K)(_,n,i),["stop"])},null,8,["checked","onClick"])),a("div",xs,p(n.title||s.$t("no_content")),1)]),a("div",Os,[a("span",Js,[d(Be,{id:i+1,raw:n},null,8,["id","raw"])]),a("div",Ys,[a("a",{onClick:v(_=>e(De)(B.value[n.feedId]),["stop","prevent"])},p((ae=B.value[n.feedId])==null?void 0:ae.name),9,Zs),t[6]||(t[6]=a("span",null,"Â·",-1)),D((o(),l("span",Xs,[gs(p(e(hs)(n.publishedAt)),1)])),[[E,e(ms)(n.publishedAt)]]),d(Ge,{tags:n.tags,type:e(c),"only-links":!0},null,8,["tags","type"])])]),D((o(),l("button",et,[d(Ke)])),[[E,s.$t("actions")]]),n.image?(o(),l("img",{key:0,class:"image",src:e(ys)(n.image,"&w=200&h=200")},null,8,st)):F("",!0)],42,Ps)],8,Hs)]}),footer:de(()=>[e(O)?F("",!0):(o(),I(z,{key:0,indeterminate:"",class:"sm"}))]),_:1},8,["data-sources","onTobottom"])):F("",!0),!e(V)&&h.value.length===0?(o(),l("div",tt,p(s.$t(e(is)(e(V)))),1)):F("",!0),a("div",{class:"sidebar-drag-indicator",onMousedown:t[2]||(t[2]=(...i)=>e(Y)&&e(Y)(...i))},null,32)],4)}}}),vt=$s(ot,[["__scopeId","data-v-115aa717"]]);export{vt as default};
