import{_ as $e}from"./VPagination.vuevuetypescriptsetuptruelang-BmXTgLz3.js";import{_ as we}from"./call-outline-rounded-B_RMlFtN.js";import{d as Te,e as Le,s as Se,f as qe,r as L,u as Ae,D as De,E as Ie,F as xe,G as Ee,i as Ve,H as Me,I as Ne,c as o,o as n,a,j as r,k as t,h as S,t as d,N as q,n as g,J as Be,x as p,a6 as Ge,K as Ue,L as Ke,M as W,O as J,P as Qe,a7 as Re,A as ze,B as He,R as Oe,a8 as Pe,T as je,U as Fe,V as We,W as Je,X as Xe,y as Ye,Y as X,Z as Ze,a9 as et,aa as tt,$ as st,a0 as _,ab as lt,C as at}from"./index-Dohfv8Fq.js";import{_ as nt,a as ot}from"./SearchInput-NYtHFioA.js";import{b as ct,u as it,a as dt}from"./key-events-COB8z-tk.js";import{u as rt}from"./search-BGPnRmZx.js";import{u as ut,a as pt}from"./tags-TPcx2lPg.js";import"./search-rounded-DoLKRhlL.js";import"./rss-feed-rounded-DCFCzJSD.js";import"./vee-validate-BgwL6Mce.js";const _t={class:"top-app-bar"},vt=["checked","indeterminate"],mt={class:"title"},kt={key:0},gt={key:1},ht={class:"actions"},yt={class:"scroll-content"},ft=["onClick","onMouseover"],bt={class:"start"},Ct=["checked","onClick"],$t=["checked","onClick"],wt={class:"number"},Tt={class:"title"},Lt={class:"subtitle"},St={class:"actions"},qt=["onClick"],At={key:0,indeterminate:"",class:"spinner-sm"},Dt=["onClick"],It=["onClick"],xt={class:"geo"},Et={class:"time"},Vt={class:"start"},Mt={class:"number"},Nt={key:0,class:"no-data-placeholder"},h=50,Bt=Te({__name:"CallsView",setup(Gt){var j;const Y=Le(),{app:Z}=Se(qe()),y=L([]),{t:A}=Ae(),{parseQ:ee}=rt(),E=De({tagIds:[]}),u=Ie.CALL,V=xe(),M=V.query,D=L(parseInt(((j=M.page)==null?void 0:j.toString())??"1")),m=L(""),{tags:C,fetch:te}=ut(u),{addToTags:se}=pt(u,C),{deleteItems:N}=ct(lt,()=>{$(),w(),_.emit("refetch_tags",u),_.emit("calls_deleted")}),{selectedIds:v,allChecked:B,realAllChecked:f,selectRealAll:le,allCheckedAlertVisible:ae,clearSelection:$,toggleAllChecked:G,toggleSelect:U,total:c,checked:I,shiftEffectingIds:K,handleItemClick:ne,handleMouseOver:oe,selectAll:ce,shouldSelect:ie}=it(y),Q=e=>{const s=V.query.q;Ye(Y,s?`/calls?page=${e}&q=${s}`:`/calls?page=${e}`)},{keyDown:R,keyUp:z}=dt(c,h,D,ce,$,Q,()=>{N(v.value,f.value,c.value,m.value)}),{loading:x,fetch:w}=Ee({handle:(e,s)=>{s?ze(A(s),"error"):e&&(y.value=e.calls,c.value=e.callCount)},document:Re,variables:()=>({offset:(D.value-1)*h,limit:h,query:m.value})}),de=["1","2","3"].map(e=>({id:e,name:A("call_type."+e)}));function re(e){X(Ze,{type:u,tags:C.value,item:{key:e.id,title:"",size:0},selected:C.value.filter(s=>e.tags.some(T=>T.id===s.id))})}function ue(e){return e?`/calls?q=${e}`:"/calls"}const H=e=>{e.type===u&&($(),w())},O=e=>{e.type===u&&w()};function pe(e){if(!e)return"";const s=[];return e.isp&&s.push(A("phone_isp_type."+e.isp)),e.city===e.province?s.push(e.city):s.push(`${e.province}${e.city}`),s.join(", ")}const P=L(""),{mutate:_e,loading:ve}=Ve({document:He});function me(e){P.value=e.id,_e({number:e.number})}function ke(e){X(tt,{id:e.id,name:e.number,gql:et`
      mutation DeleteCall($query: String!) {
        deleteCalls(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),typeName:"Call",done:()=>{c.value--,e.tags.length&&_.emit("refetch_tags",u),_.emit("calls_deleted")}})}return Me(()=>{var e;m.value=st(((e=M.q)==null?void 0:e.toString())??""),ee(E,m.value),te(),w(),_.on("item_tags_updated",O),_.on("items_tags_updated",H),window.addEventListener("keydown",R),window.addEventListener("keyup",z)}),Ne(()=>{_.off("item_tags_updated",O),_.off("items_tags_updated",H),window.removeEventListener("keydown",R),window.removeEventListener("keyup",z)}),(e,s)=>{const T=Ge,F=Ue,ge=nt,he=ot,ye=Oe,fe=je,be=we,Ce=$e,k=Be("tooltip");return n(),o(q,null,[a("div",_t,[a("md-checkbox",{"touch-target":"wrapper",checked:t(B),indeterminate:!t(B)&&t(I),onChange:s[0]||(s[0]=(...l)=>t(G)&&t(G)(...l))},null,40,vt),a("div",mt,[t(v).length?(n(),o("span",kt,d(e.$t("x_selected",{count:t(f)?t(c).toLocaleString():t(v).length.toLocaleString()})),1)):(n(),o("span",gt,d(e.$t("page_title.calls"))+" ("+d(t(c).toLocaleString())+")",1)),t(I)?(n(),o(q,{key:2},[g((n(),o("button",{class:"btn-icon",onClick:s[1]||(s[1]=p(l=>t(N)(t(v),t(f),t(c),m.value),["stop"]))},[s[3]||(s[3]=a("md-ripple",null,null,-1)),r(T)])),[[k,e.$t("delete")]]),g((n(),o("button",{class:"btn-icon",onClick:s[2]||(s[2]=p(l=>t(se)(t(v),t(f),m.value),["stop"]))},[s[4]||(s[4]=a("md-ripple",null,null,-1)),r(F)])),[[k,e.$t("add_to_tags")]])],64)):S("",!0)]),a("div",ht,[r(ge,{filter:E,tags:t(C),types:t(de),"get-url":ue},null,8,["filter","tags","types"])])]),r(he,{limit:h,total:t(c),"all-checked-alert-visible":t(ae),"real-all-checked":t(f),"select-real-all":t(le),"clear-selection":t($)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",yt,[a("div",{class:W(["call-list",{"select-mode":t(I)}])},[(n(!0),o(q,null,J(y.value,(l,b)=>(n(),o("section",{key:l.id,class:W(["call-item selectable-card",{selected:t(v).includes(l.id),selecting:t(K).includes(l.id)}]),onClick:p(i=>t(ne)(i,l,b,()=>{}),["stop"]),onMouseover:i=>t(oe)(i,b)},[a("div",bt,[t(K).includes(l.id)?(n(),o("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:t(ie),onClick:p(i=>t(U)(i,l,b),["stop"])},null,8,Ct)):(n(),o("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:t(v).includes(l.id),onClick:p(i=>t(U)(i,l,b),["stop"])},null,8,$t)),a("span",wt,[r(ye,{id:b+1,raw:l},null,8,["id","raw"])])]),a("div",Tt,d(l.name?l.name+" "+l.number:l.number),1),a("div",Lt,[a("span",null,d(t(Pe)(l.duration)),1),a("span",null,d(e.$t("call_type."+l.type)),1),r(fe,{tags:l.tags,type:t(u),"only-links":!0},null,8,["tags","type"])]),a("div",St,[g((n(),o("button",{class:"btn-icon sm",onClick:p(i=>ke(l),["stop"])},[s[5]||(s[5]=a("md-ripple",null,null,-1)),r(T)],8,qt)),[[k,e.$t("delete")]]),t(ve)&&P.value===l.id?(n(),o("md-circular-progress",At)):g((n(),o("button",{key:1,class:"btn-icon sm",onClick:p(i=>me(l),["stop"])},[s[6]||(s[6]=a("md-ripple",null,null,-1)),r(be)],8,Dt)),[[k,e.$t("make_a_phone_call")]]),g((n(),o("button",{class:"btn-icon sm",onClick:p(i=>re(l),["stop"])},[s[7]||(s[7]=a("md-ripple",null,null,-1)),r(F)],8,It)),[[k,e.$t("add_to_tags")]])]),a("div",xt,d(pe(l.geo)),1),a("div",Et,[g((n(),o("span",null,[We(d(t(Je)(l.startedAt)),1)])),[[k,t(Fe)(l.startedAt)]])])],42,ft))),128)),t(x)&&y.value.length===0?(n(),o(q,{key:0},J(20,l=>a("section",{key:l,class:"call-item selectable-card-skeleton"},[a("div",Vt,[s[8]||(s[8]=a("div",{class:"checkbox"},[a("div",{class:"skeleton-checkbox"})],-1)),a("span",Mt,d(l),1)]),s[9]||(s[9]=Xe('<div class="title" data-v-b01ce200><div class="skeleton-text skeleton-title" data-v-b01ce200></div></div><div class="subtitle" data-v-b01ce200><div class="skeleton-text skeleton-subtitle" data-v-b01ce200></div></div><div class="actions" data-v-b01ce200><div class="skeleton-text skeleton-actions" data-v-b01ce200></div></div><div class="geo" data-v-b01ce200><div class="skeleton-text skeleton-geo" data-v-b01ce200></div></div><div class="time" data-v-b01ce200><div class="skeleton-text skeleton-time" data-v-b01ce200></div></div>',5))])),64)):S("",!0)],2),!t(x)&&y.value.length===0?(n(),o("div",Nt,d(e.$t(t(Qe)(t(x),t(Z).permissions,"WRITE_CALL_LOG"))),1)):S("",!0),t(c)>h?(n(),Ke(Ce,{key:1,page:D.value,go:Q,total:t(c),limit:h},null,8,["page","total"])):S("",!0)])],64)}}}),Wt=at(Bt,[["__scopeId","data-v-b01ce200"]]);export{Wt as default};
