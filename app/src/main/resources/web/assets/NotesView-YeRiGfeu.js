import{_ as Re}from"./VPagination.vuevuetypescriptsetuptruelang-CEZVU5HQ.js";import{m as xe,c as r,o as s,a as l,i as x,bn as Be,I as B,a5 as b,J as G,bo as Ge,e as Ke,f as Oe,r as R,u as je,K as Fe,L as Pe,bp as Je,M as We,N as Xe,k as i,j as D,S as c,l as e,O as Ye,t as T,U as w,P as h,Q as Ze,p as _,y as d,V as et,T as de,bq as tt,W as st,aU as ot,at,br as nt,E as lt,bs as it,a8 as ct,aX as rt,aY as dt,R as ut,F as ue,d as _t,bt as pt,$ as vt,a0 as mt,a1 as gt,A as _e,a2 as pe,a3 as ht,ab as kt,bm as ft,ac as yt,a6 as ve,a4 as $t,bu as Tt,H as bt}from"./index-CuU5w3Fk.js";import{_ as qt}from"./FieldId.vuevuetypescriptsetuptruelang-BAr-ccW2.js";import{_ as Ct,a as wt}from"./SearchInput-Do4mYLNe.js";import{u as Nt,b as Lt,a as St}from"./key-events-CMYOn2tc.js";import{u as Dt,a as Vt}from"./tags-C_c-1fHE.js";import{u as Et}from"./search-cTEMyIe9.js";import"./VInputChip-Cze1-7DF.js";const Mt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function At(E,k){return s(),r("svg",Mt,k[0]||(k[0]=[l("path",{fill:"currentColor",d:"M19 17.7v1.8q0 .2.15.35t.35.15t.35-.15t.15-.35v-3q0-.2-.15-.35T19.5 16h-3q-.2 0-.35.15t-.15.35t.15.35t.35.15h1.8l-2.45 2.45q-.15.15-.15.35t.15.35t.35.15t.35-.15zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v5q0 .425-.288.713T20 11t-.712-.288T19 10V5H5v14h5q.425 0 .713.288T11 20t-.288.713T10 21zm0-3v1V5v6.075V11zm2-2q0 .425.288.713T8 17h2.075q.425 0 .713-.288t.287-.712t-.287-.712t-.713-.288H8q-.425 0-.712.288T7 16m0-4q0 .425.288.713T8 13h5q.425 0 .713-.288T14 12t-.288-.712T13 11H8q-.425 0-.712.288T7 12m0-4q0 .425.288.713T8 9h8q.425 0 .713-.288T17 8t-.288-.712T16 7H8q-.425 0-.712.288T7 8m11 15q-2.075 0-3.537-1.463T13 18t1.463-3.537T18 13t3.538 1.463T23 18t-1.463 3.538T18 23"},null,-1)]))}const It=xe({name:"material-symbols-export-notes-outline-rounded",render:At}),Qt=(E,k)=>{const{mutate:v,onDone:M}=x({document:Be}),f=B(new Map);return M(n=>{f.delete(n.data.trashNotes),E(),k(),b.emit("refetch_tags",G.NOTE),b.emit("notes_actioned",{action:"trash"})}),{trashLoading(n){return f.get(n)??!1},trash(n){f.set(n,!0),v({query:n})}}},Ut=(E,k)=>{const{mutate:v,onDone:M}=x({document:Ge}),f=B(new Map);return M(n=>{f.delete(n.data.restoreNotes),E(),k(),b.emit("refetch_tags",G.NOTE),b.emit("notes_actioned",{action:"restore"})}),{restoreLoading(n){return f.get(n)??!1},restore(n){f.set(n,!0),v({query:n})}}},zt={class:"top-app-bar"},Ht={class:"title"},Rt={key:0},xt={key:1},Bt={class:"actions"},Gt={key:0,class:"scroller"},Kt={class:"start"},Ot={class:"number"},jt=["href"],Ft=["onClick","onMouseover"],Pt={class:"start"},Jt={class:"number"},Wt={class:"title"},Xt={class:"subtitle"},Yt={class:"actions"},Zt={class:"time"},es={key:2,class:"no-data-placeholder"},V=50,ts=Ke({__name:"NotesView",setup(E){var ne;const k=Oe(),v=R([]),{t:M}=je(),{parseQ:f}=Et(),n=B({tagIds:[],trash:!1}),N=G.NOTE,K=Fe(),O=K.query,U=R(parseInt(((ne=O.page)==null?void 0:ne.toString())??"1")),q=R(""),{tags:I,fetch:me}=Dt(N),{selectedIds:$,allChecked:j,realAllChecked:L,selectRealAll:ge,allCheckedAlertVisible:he,clearSelection:C,toggleAllChecked:ke,toggleSelect:F,total:m,checked:z,shiftEffectingIds:P,handleItemClick:fe,handleMouseOver:ye,selectAll:$e,shouldSelect:Te}=Nt(v),{addToTags:be}=Vt(N,I),J=t=>{const o=K.query.q;_e(k,o?`/notes?page=${t}&q=${o}`:`/notes?page=${t}`)},{keyDown:W,keyUp:X}=St(m,V,U,$e,C,J,()=>{Y($.value,L.value,m.value,q.value)}),{loading:H,fetch:S}=Pe({handle:(t,o)=>{o?lt(M(o),"error"):t&&(v.value=t.notes,m.value=t.noteCount)},document:nt,variables:()=>({offset:(U.value-1)*V,limit:V,query:q.value})});function qe(t){pe(ht,{type:N,tags:I.value,item:{key:t.id,title:"",size:0},selected:I.value.filter(o=>t.tags.some(A=>A.id===o.id))})}function Ce(t){return t?`/notes?q=${t}`:"/notes"}const{mutate:we,onDone:Ne}=x({document:it}),Le=()=>{we({query:Q()})},Q=()=>{let t=q.value;return L.value||(t=`ids:${$.value.join(",")}`),t};Ne(t=>{Je(t.data.exportNotes,"application/json","notes.json")});const{deleteItems:Y}=Lt(Tt,()=>{C(),S()});function Se(t){pe(yt,{id:t.id,name:ft(t.title,{length:20}),gql:kt`
      mutation DeleteNote($query: String!) {
        deleteNotes(query: $query)
      }
    `,variables:()=>({query:`ids:${t.id}`}),done:()=>{C(),m.value--},typeName:"Note"})}const{trashLoading:De,trash:Z}=Qt(C,S),{restoreLoading:ee,restore:te}=Ut(C,S);function Ve(t){_e(k,se(t))}function se(t){const o=ve.currentRoute.value.query.q;return o?`/notes/${t.id}?q=${o}`:`/notes/${t.id}`}function Ee(){ve.push("/notes/create")}const oe=t=>{t.type===N&&(C(),S())},ae=t=>{t.type===N&&S()};return We(()=>{var t;q.value=$t(((t=O.q)==null?void 0:t.toString())??""),f(n,q.value),n.trash===void 0&&(n.trash=!1),me(),S(),b.on("item_tags_updated",ae),b.on("items_tags_updated",oe),window.addEventListener("keydown",W),window.addEventListener("keyup",X)}),Xe(()=>{b.off("item_tags_updated",ae),b.off("items_tags_updated",oe),window.removeEventListener("keydown",W),window.removeEventListener("keyup",X)}),(t,o)=>{const A=Ye,le=ct,y=ot,ie=rt,ce=dt,re=ut,Me=It,Ae=Ct,Ie=at,Qe=wt,Ue=qt,ze=vt,He=Re,g=Ze("tooltip");return s(),r(w,null,[l("div",zt,[i(A,{"touch-target":"wrapper",checked:e(j),indeterminate:!e(j)&&e(z),onChange:e(ke)},null,8,["checked","indeterminate","onChange"]),l("div",Ht,[e($).length?(s(),r("span",Rt,T(t.$t("x_selected",{count:e(L)?e(m).toLocaleString():e($).length.toLocaleString()})),1)):(s(),r("span",xt,T(t.$t("page_title.notes"))+" ("+T(e(m).toLocaleString())+")",1)),e(z)?(s(),r(w,{key:2},[n.trash?(s(),r(w,{key:0},[h((s(),c(y,{onClick:o[0]||(o[0]=d(u=>e(Y)(e($),e(L),e(m),q.value),["stop"]))},{default:_(()=>[i(le)]),_:1})),[[g,t.$t("delete")]]),h((s(),c(y,{loading:e(ee)(Q()),onClick:o[1]||(o[1]=d(u=>e(te)(Q()),["stop"]))},{default:_(()=>[i(ie)]),_:1},8,["loading"])),[[g,t.$t("restore")]])],64)):(s(),r(w,{key:1},[h((s(),c(y,{onClick:o[2]||(o[2]=d(u=>e(Z)(Q()),["stop"]))},{default:_(()=>[i(ce)]),_:1})),[[g,t.$t("move_to_trash")]]),h((s(),c(y,{onClick:o[3]||(o[3]=d(u=>e(be)(e($),e(L),q.value),["stop"]))},{default:_(()=>[i(re)]),_:1})),[[g,t.$t("add_to_tags")]]),h((s(),c(y,{onClick:d(Le,["stop"])},{default:_(()=>[i(Me)]),_:1})),[[g,t.$t("export_notes")]])],64))],64)):D("",!0)]),l("div",Bt,[i(Ae,{filter:n,tags:e(I),"get-url":Ce,"show-trash":!0},null,8,["filter","tags"]),n.trash?D("",!0):(s(),c(Ie,{key:0,class:"btn-sm",onClick:d(Ee,["prevent"])},{default:_(()=>[ue(T(t.$t("create")),1)]),_:1}))])]),i(Qe,{limit:V,total:e(m),"all-checked-alert-visible":e(he),"real-all-checked":e(L),"select-real-all":e(ge),"clear-selection":e(C)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(H)&&v.value.length===0?(s(),r("div",Gt,[(s(),r(w,null,et(20,u=>l("article",{key:u,class:"note-item selectable-card-skeleton"},[l("div",Kt,[o[4]||(o[4]=l("div",{class:"checkbox"},[l("div",{class:"skeleton-checkbox"})],-1)),l("span",Ot,T(u),1)]),o[5]||(o[5]=_t('<div class="title" data-v-c544c579><div class="skeleton-text skeleton-title" data-v-c544c579></div></div><div class="subtitle" data-v-c544c579><div class="skeleton-text skeleton-subtitle" data-v-c544c579></div></div><div class="actions" data-v-c544c579><div class="skeleton-text skeleton-actions" data-v-c544c579></div></div><div class="time" data-v-c544c579><div class="skeleton-text skeleton-time" data-v-c544c579></div></div>',4))])),64))])):D("",!0),v.value.length?(s(),c(e(tt),{key:1,class:de(["scroller",{"select-mode":e(z)}]),"data-key":"id","data-sources":v.value,"estimate-size":100},{item:_(({index:u,item:a})=>[(s(),r("a",{key:a.id,class:"item-link",href:se(a)},[l("article",{class:de(["note-item selectable-card",{selected:e($).includes(a.id)||a.id==t.$route.params.id,selecting:e(P).includes(a.id)}]),onClick:d(p=>e(fe)(p,a,u,()=>{Ve(a)}),["stop","prevent"]),onMouseover:p=>e(ye)(p,u)},[l("div",Pt,[e(P).includes(a.id)?(s(),c(A,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(Te),onClick:d(p=>e(F)(p,a,u),["stop"])},null,8,["checked","onClick"])):(s(),c(A,{key:1,class:"checkbox","touch-target":"wrapper",checked:e($).includes(a.id),onClick:d(p=>e(F)(p,a,u),["stop"])},null,8,["checked","onClick"])),l("span",Jt,[i(Ue,{id:u+1,raw:a},null,8,["id","raw"])])]),l("div",Wt,T(e(pt)(a.title.split(`
`)[0].trimStart())||t.$t("meta_no_title")),1),l("div",Xt,[i(ze,{tags:a.tags,type:e(N),"only-links":!0},null,8,["tags","type"])]),l("div",Yt,[n.trash?(s(),r(w,{key:0},[h((s(),c(y,{class:"sm",onClick:d(p=>Se(a),["stop","prevent"])},{default:_(()=>[i(le)]),_:2},1032,["onClick"])),[[g,t.$t("delete")]]),h((s(),c(y,{class:"sm",loading:e(ee)(`ids:${a.id}`),onClick:d(p=>e(te)(`ids:${a.id}`),["stop","prevent"])},{default:_(()=>[i(ie)]),_:2},1032,["loading","onClick"])),[[g,t.$t("restore")]])],64)):(s(),r(w,{key:1},[h((s(),c(y,{class:"sm",loading:e(De)(`ids:${a.id}`),onClick:d(p=>e(Z)(`ids:${a.id}`),["stop","prevent"])},{default:_(()=>[i(ce)]),_:2},1032,["loading","onClick"])),[[g,t.$t("move_to_trash")]]),h((s(),c(y,{class:"sm",onClick:d(p=>qe(a),["stop","prevent"])},{default:_(()=>[i(re)]),_:2},1032,["onClick"])),[[g,t.$t("add_to_tags")]])],64))]),l("div",Zt,[h((s(),r("span",null,[ue(T(e(gt)(a.updatedAt)),1)])),[[g,e(mt)(a.updatedAt)]])])],42,Ft)],8,jt))]),footer:_(()=>[e(m)>V?(s(),c(He,{key:0,page:U.value,go:J,total:e(m),limit:V},null,8,["page","total"])):D("",!0)]),_:1},8,["data-sources","class"])):D("",!0),!e(H)&&v.value.length===0?(s(),r("div",es,T(t.$t(e(st)(e(H)))),1)):D("",!0)],64)}}}),ds=bt(ts,[["__scopeId","data-v-c544c579"]]);export{ds as default};
