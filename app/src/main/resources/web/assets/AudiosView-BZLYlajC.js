import{_ as Bt}from"./VPagination.vuevuetypescriptsetuptruelang-C8EdHkPn.js";import{m as Xe,c as g,o as a,a as l,i as _e,b3 as Ut,b4 as zt,s as me,g as Ye,u as Je,a4 as b,aL as Ze,E as ve,r as L,b5 as Nt,e as Qt,f as Ht,I as Kt,ag as Oe,ah as Gt,J as Ot,K as jt,aK as Wt,aM as Xt,ai as Yt,L as Jt,aO as Zt,aP as xt,M as eo,N as to,k as n,l as e,j as J,t as h,T as V,O as r,P as oo,R as d,p as c,y as i,aQ as de,aR as ce,ak as so,al as ao,S as re,U as ue,V as no,b6 as lo,a7 as io,aU as co,aj as ro,aV as uo,Q as po,ar as _o,b0 as mo,aG as vo,n as go,a9 as ko,aX as yo,Z as fo,at as ho,aN as je,b7 as $o,Y as Co,$ as bo,F as To,a0 as Io,d as wo,A as Eo,a1 as Ao,a2 as Do,aY as We,a3 as qo,b8 as So,H as Fo}from"./index-Bm4LvS3o.js";import{_ as Po}from"./FieldId.vuevuetypescriptsetuptruelang-BrgUyHoS.js";import{_ as Vo,a as Lo}from"./SearchInput-DRzs7deS.js";import{_ as Mo,a as Ro}from"./upload-rounded-kDOL7bYn.js";import{_ as Bo}from"./VIconButton.vuevuetypescriptsetuptruelang-BiHMDYOC.js";import{_ as Uo}from"./VCheckbox-BGOsDzY1.js";import{u as zo}from"./search-KPji0eDE.js";import{u as No,a as Qo}from"./key-events-CTyRdg-2.js";import{a as Ho}from"./tags-Btr3rBM8.js";import"./VInputChip-Cxd-Tq_f.js";const Ko={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Go(w,f){return a(),g("svg",Ko,f[0]||(f[0]=[l("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V9q0-.425-.288-.712T10 8t-.712.288T9 9v6q0 .425.288.713T10 16m4 0q.425 0 .713-.288T15 15V9q0-.425-.288-.712T14 8t-.712.288T13 9v6q0 .425.288.713T14 16m-2 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const Oo=Xe({name:"material-symbols-pause-circle-outline-rounded",render:Go}),jo={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Wo(w,f){return a(),g("svg",jo,f[0]||(f[0]=[l("path",{fill:"currentColor",d:"M3 16v-2h7v2zm0-4v-2h11v2zm0-4V6h11v2zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4z"},null,-1)]))}const Xo=Xe({name:"material-symbols-playlist-add",render:Wo});function pe(w,f,E=500){const v=w.cloneNode(!0),$=w.getBoundingClientRect(),M=f.getBoundingClientRect();v.style.position="absolute",v.style.top=$.top+"px",v.style.left=$.left+"px",v.style.opacity=1,document.body.appendChild(v);let C=0;function A(B){C||(C=B);const U=B-C,F=Math.min(U/E,1);v.style.top=$.top+(M.top-$.top)*F+"px",v.style.left=$.left+(M.left-$.left)*F+"px",F<1?requestAnimationFrame(A):document.body.removeChild(v)}requestAnimationFrame(A)}const Yo=(w,f)=>{const{mutate:E,loading:v,onDone:$}=_e({document:Ut}),{mutate:M,loading:C,onDone:A}=_e({document:zt}),{app:B}=me(Ye()),{t:U}=Je();$(()=>{b.emit("refetch_app"),f()}),A(()=>{b.emit("refetch_app")});const F=Ze(()=>{var k;return((k=B.value)==null?void 0:k.audios)??[]}),W=k=>F.value.some(y=>y.path===k.path);return{loading:v,removeLoading:C,isInPlaylist:W,addItemsToPlaylist:(k,y,P,z)=>{let N=z;if(!P){if(y.length===0){ve(U("select_first"),"error");return}N=`ids:${y.join(",")}`}const Q=k.target,R=document.getElementById("quick-audio");pe(Q,R),E({query:N})},removeItemsFromPlaylist:(k,y,P,z)=>{if(P)w.value.filter(R=>W(R)).forEach(R=>{M({path:R.path})});else{if(y.length===0){ve(U("select_first"),"error");return}w.value.filter(H=>y.includes(H.id)&&W(H)).forEach(H=>{M({path:H.path})})}const N=k.target,Q=document.getElementById("quick-audio");pe(N,Q)},addToPlaylist:(k,y)=>{const P=k.target,z=document.getElementById("quick-audio");pe(P,z),E({query:`ids:${y.id}`})},removeFromPlaylist:(k,y)=>{M({path:y.path})}}},Jo=()=>{const w=L(""),{mutate:f,loading:E,onDone:v}=_e({document:Nt});return v(()=>{b.emit("play_audio")}),{loading:E,playPath:w,play:$=>{w.value=$.path,f({path:$.path})},pause:()=>{b.emit("pause_audio")}}},Zo={class:"top-app-bar"},xo={class:"title"},es={key:0},ts={key:1},os={class:"actions"},ss=["onClick"],as=["onClick","onMouseover"],ns={class:"start"},ls={class:"number"},is={class:"image"},ds=["src"],cs=["src","onError"],rs={class:"title"},us={class:"subtitle"},ps={class:"duration"},_s=["onClick"],ms={class:"actions"},vs={class:"artist"},gs={class:"time"},ks={class:"start"},ys={class:"number"},fs={key:0,class:"no-data-placeholder"},j=50,hs=Qt({__name:"AudiosView",setup(w){var Be;const f=Ht(),{audioSortBy:E}=me(f),v=L([]),{t:$}=Je(),{parseQ:M}=zo(),C=Kt({tagIds:[],bucketId:void 0}),{app:A,urlTokenKey:B,audioPlaying:U,uploads:F}=me(Ye()),W=t=>{var s;return U.value&&((s=A.value)==null?void 0:s.audioCurrent)===t.path},k=L([]),y=L(!1),P=L(!1),{input:z,upload:N,uploadChanged:Q}=Oe(F),{input:R,upload:H,uploadChanged:ge}=Oe(F),{dropping:xe,fileDragEnter:ke,fileDragLeave:ye,dropFiles:et}=Gt(F),te=L(!1),m=Ot.AUDIO,fe=jt(),he=fe.query,oe=L(parseInt(((Be=he.page)==null?void 0:Be.toString())??"1")),{tags:Z,buckets:x,fetch:tt}=Wt(m),ot=Ze(()=>{const t={};return x.value.forEach(s=>{t[s.id]=s}),t}),D=L(""),{addToTags:st}=Ho(m,Z),{deleteItems:se,deleteItem:$e}=Xt(),{view:at}=yo(m),{selectedIds:T,allChecked:Ce,realAllChecked:q,selectRealAll:nt,allCheckedAlertVisible:lt,clearSelection:K,toggleAllChecked:it,toggleSelect:be,total:S,checked:ae,shiftEffectingIds:Te,handleItemClick:dt,handleMouseOver:ct,selectAll:rt,shouldSelect:ut}=No(v),{downloadItems:Ie}=Yt(B,m,K,"audios.zip"),{downloadFile:we}=ho(B),Ee=t=>{const s=fe.query.q;Eo(f,s?`/audios?page=${t}&q=${s}`:`/audios?page=${t}`)},{keyDown:Ae,keyUp:De}=Qo(S,j,oe,rt,K,Ee,()=>{de(ce.MEDIA_TRASH,A.value.osVersion)?le(m,Y()):se(m,T.value,q.value,S.value,D.value)}),{addItemsToPlaylist:pt,addToPlaylist:_t,removeFromPlaylist:mt,isInPlaylist:vt}=Yo(v,K),gt=_o(),qe=L([]),{play:kt,playPath:yt,loading:ft,pause:ht}=Jo(),$t=t=>{qe.value.push(t)},{loading:ne,fetch:X}=Jt({handle:(t,s)=>{te.value=!1,s?ve($(s),"error"):t&&(v.value=t.items,S.value=t.total)},document:lo,variables:()=>({offset:(oe.value-1)*j,limit:j,query:D.value,sortBy:E.value})}),{trashLoading:Se,trash:le}=Zt(),{restoreLoading:Fe,restore:Pe}=xt();function Ct(t){return t?`/audios?q=${t}`:"/audios"}function bt(t){E.value!==t&&(te.value=!0,E.value=t)}function ie(){const t=x.value.find(s=>s.id===C.bucketId);return t?We(t.topItems[0]):`${A.value.internalStoragePath}/Music`}function Tt(){N(ie())}function It(){H(ie())}function wt(t){et(t,ie(),"audio")}const Y=()=>{let t=D.value;return q.value||(t=`ids:${T.value.join(",")}`),t},Ve=t=>{t.type===m&&(K(),X())},Le=t=>{t.type===m&&X()},Me=t=>{t.type===m&&(K(),X())},Re=t=>{t.status==="done"&&So(t.fileName)&&((!C.bucketId||x.value.some(I=>I.id===C.bucketId&&I.topItems.some(G=>t.dir.startsWith(We(G)))))&&setTimeout(()=>{X()},1e3),b.emit("media_items_actioned",{type:m,action:"upload",query:""}))};function Et(t){const s=t.tags.map(I=>I.id);Ao(Do,{type:m,tags:Z.value,item:{key:t.id,title:t.title,size:t.size},selected:Z.value.filter(I=>s.includes(I.id))})}function At(t,s){k.value.push(s.id),setTimeout(()=>{mt(t,s),setTimeout(()=>{k.value=k.value.filter(I=>I!==s.id)},300)},150)}return eo(()=>{var t;D.value=qo(((t=he.q)==null?void 0:t.toString())??""),M(C,D.value),tt(),X(),b.on("item_tags_updated",Le),b.on("items_tags_updated",Ve),b.on("media_items_actioned",Me),b.on("upload_task_done",Re),window.addEventListener("keydown",Ae),window.addEventListener("keyup",De)}),to(()=>{b.off("item_tags_updated",Le),b.off("items_tags_updated",Ve),b.off("media_items_actioned",Me),b.off("upload_task_done",Re),window.removeEventListener("keydown",Ae),window.removeEventListener("keyup",De)}),(t,s)=>{const I=Uo,G=io,u=Bo,Ue=co,ee=ro,ze=uo,Ne=Xo,Qe=po,Dt=Vo,qt=Mo,He=so,St=Ro,Ft=Lo,Pt=Po,Vt=fo,Ke=$o,Lt=Co,Mt=Oo,Rt=Bt,p=oo("tooltip");return a(),g(V,null,[l("div",Zo,[n(I,{"touch-target":"wrapper",checked:e(Ce),indeterminate:!e(Ce)&&e(ae),onChange:e(it)},null,8,["checked","indeterminate","onChange"]),l("div",xo,[e(T).length?(a(),g("span",es,h(t.$t("x_selected",{count:e(q)?e(S).toLocaleString():e(T).length.toLocaleString()})),1)):(a(),g("span",ts,h(t.$t("page_title.audios"))+" ("+h(e(S).toLocaleString())+")",1)),e(ae)?(a(),g(V,{key:2},[C.trash?(a(),g(V,{key:0},[r((a(),d(u,{onClick:s[0]||(s[0]=i(o=>e(se)(e(m),e(T),e(q),e(S),D.value),["stop"]))},{icon:c(()=>[n(G)]),_:1})),[[p,t.$t("delete")]]),r((a(),d(u,{loading:e(Fe)(Y()),onClick:s[1]||(s[1]=i(o=>e(Pe)(e(m),Y()),["stop"]))},{icon:c(()=>[n(Ue)]),_:1},8,["loading"])),[[p,t.$t("restore")]]),r((a(),d(u,{onClick:s[2]||(s[2]=i(o=>e(Ie)(e(q),e(T),D.value),["stop"]))},{icon:c(()=>[n(ee)]),_:1})),[[p,t.$t("download")]])],64)):(a(),g(V,{key:1},[e(de)(e(ce).MEDIA_TRASH,e(A).osVersion)?r((a(),d(u,{key:0,loading:e(Se)(Y()),onClick:s[3]||(s[3]=i(o=>e(le)(e(m),Y()),["stop"]))},{icon:c(()=>[n(ze)]),_:1},8,["loading"])),[[p,t.$t("move_to_trash")]]):r((a(),d(u,{key:1,onClick:s[4]||(s[4]=i(o=>e(se)(e(m),e(T),e(q),e(S),D.value),["stop"]))},{icon:c(()=>[n(G)]),_:1})),[[p,t.$t("delete")]]),r((a(),d(u,{onClick:s[5]||(s[5]=i(o=>e(Ie)(e(q),e(T),D.value),["stop"]))},{icon:c(()=>[n(ee)]),_:1})),[[p,t.$t("download")]]),r((a(),d(u,{onClick:s[6]||(s[6]=i(o=>e(pt)(o,e(T),e(q),D.value),["stop"]))},{icon:c(()=>[n(Ne)]),_:1})),[[p,t.$t("add_to_playlist")]]),r((a(),d(u,{onClick:s[7]||(s[7]=i(o=>e(st)(e(T),e(q),D.value),["stop"]))},{icon:c(()=>[n(Qe)]),_:1})),[[p,t.$t("add_to_tags")]])],64))],64)):J("",!0)]),l("div",os,[n(Dt,{filter:C,tags:e(Z),buckets:e(x),"get-url":Ct},null,8,["filter","tags","buckets"]),n(He,{modelValue:y.value,"onUpdate:modelValue":s[10]||(s[10]=o=>y.value=o)},{trigger:c(()=>[r((a(),d(u,null,{icon:c(()=>[n(qt)]),_:1})),[[p,t.$t("upload")]])]),default:c(()=>[l("div",{class:"dropdown-item",onClick:s[8]||(s[8]=i(o=>{Tt(),y.value=!1},["stop"]))},h(t.$t("upload_files")),1),l("div",{class:"dropdown-item",onClick:s[9]||(s[9]=i(o=>{It(),y.value=!1},["stop"]))},h(t.$t("upload_folder")),1)]),_:1},8,["modelValue"]),n(He,{modelValue:P.value,"onUpdate:modelValue":s[11]||(s[11]=o=>P.value=o)},{trigger:c(()=>[r((a(),d(u,{loading:te.value},{icon:c(()=>[n(St)]),_:1},8,["loading"])),[[p,t.$t("sort")]])]),default:c(()=>[(a(!0),g(V,null,ue(e(gt),o=>(a(),g("div",{key:o.value,class:re(["dropdown-item",{selected:o.value===e(E)}]),onClick:O=>{bt(o.value),P.value=!1}},h(t.$t(o.label)),11,ss))),128))]),_:1},8,["modelValue"])])]),n(Ft,{limit:j,total:e(S),"all-checked-alert-visible":e(lt),"real-all-checked":e(q),"select-real-all":e(nt),"clear-selection":e(K)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),l("div",{class:"scroll-content",onDragover:s[16]||(s[16]=i((...o)=>e(ke)&&e(ke)(...o),["stop","prevent"]))},[r(l("div",{class:"drag-mask",onDrop:i(wt,["stop","prevent"]),onDragleave:s[12]||(s[12]=i((...o)=>e(ye)&&e(ye)(...o),["stop","prevent"]))},h(t.$t("release_to_send_files")),545),[[ao,e(xe)]]),l("div",{class:re(["audio-list",{"select-mode":e(ae)}])},[(a(!0),g(V,null,ue(v.value,(o,O)=>{var Ge;return a(),g("section",{key:o.id,class:re(["media-item selectable-card",{selected:e(T).includes(o.id),selecting:e(Te).includes(o.id)}]),onClick:i(_=>e(dt)(_,o,O,()=>{e(kt)(o)}),["stop"]),onMouseover:_=>e(ct)(_,O)},[l("div",ns,[e(Te).includes(o.id)?(a(),d(I,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(ut),onClick:i(_=>e(be)(_,o,O),["stop"])},null,8,["checked","onClick"])):(a(),d(I,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(T).includes(o.id),onClick:i(_=>e(be)(_,o,O),["stop"])},null,8,["checked","onClick"])),l("span",ls,[n(Pt,{id:O+1,raw:o},null,8,["id","raw"])])]),l("div",is,[qe.value.includes(o.id)?(a(),g("img",{key:0,src:`/ficons/${e(mo)(o.path)}.svg`,class:"svg"},null,8,ds)):(a(),g("img",{key:1,class:"image-thumb",src:e(vo)(o.albumFileId,"&w=200&h=200"),onError:_=>$t(o.id)},null,40,cs))]),l("div",rs,h(o.title),1),l("div",us,[l("span",null,h(e(go)(o.size)),1),l("span",ps,h(e(ko)(o.duration)),1),l("a",{onClick:i(_=>e(at)(e(f),o.bucketId),["stop","prevent"])},h((Ge=ot.value[o.bucketId])==null?void 0:Ge.name),9,_s),n(Vt,{tags:o.tags,type:e(m),"only-links":!0},null,8,["tags","type"])]),l("div",ms,[C.trash?(a(),g(V,{key:0},[r((a(),d(u,{class:"sm",onClick:i(_=>e($e)(e(m),o),["stop"])},{icon:c(()=>[n(G)]),_:2},1032,["onClick"])),[[p,t.$t("delete")]]),r((a(),d(u,{class:"sm",loading:e(Fe)(`ids:${o.id}`),onClick:i(_=>e(Pe)(e(m),`ids:${o.id}`),["stop"])},{icon:c(()=>[n(Ue)]),_:2},1032,["loading","onClick"])),[[p,t.$t("restore")]]),r((a(),d(u,{class:"sm",onClick:i(_=>e(we)(o.path,e(je)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[n(ee)]),_:2},1032,["onClick"])),[[p,t.$t("download")]])],64)):(a(),g(V,{key:1},[e(de)(e(ce).MEDIA_TRASH,e(A).osVersion)?r((a(),d(u,{key:0,class:"sm",loading:e(Se)(`ids:${o.id}`),onClick:i(_=>e(le)(e(m),`ids:${o.id}`),["stop"])},{icon:c(()=>[n(ze)]),_:2},1032,["loading","onClick"])),[[p,t.$t("move_to_trash")]]):r((a(),d(u,{key:1,class:"sm",onClick:i(_=>e($e)(e(m),o),["stop"])},{icon:c(()=>[n(G)]),_:2},1032,["onClick"])),[[p,t.$t("delete")]]),r((a(),d(u,{class:"sm",onClick:i(_=>e(we)(o.path,e(je)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[n(ee)]),_:2},1032,["onClick"])),[[p,t.$t("download")]]),e(vt)(o)&&!k.value.includes(o.id)?r((a(),d(u,{key:2,class:"sm",onClick:i(_=>At(_,o),["stop","prevent"])},{icon:c(()=>[n(Ke,{class:"playlist-remove-icon"})]),_:2},1032,["onClick"])),[[p,t.$t("remove_from_playlist")]]):k.value.includes(o.id)?(a(),d(u,{key:3,class:"sm",disabled:!0},{icon:c(()=>[n(Ke,{class:"playlist-remove-icon rotating"})]),_:1})):r((a(),d(u,{key:4,class:"sm",onClick:i(_=>e(_t)(_,o),["stop","prevent"])},{icon:c(()=>[n(Ne)]),_:2},1032,["onClick"])),[[p,t.$t("add_to_playlist")]]),r((a(),d(u,{class:"sm",onClick:i(_=>Et(o),["stop"])},{icon:c(()=>[n(Qe)]),_:2},1032,["onClick"])),[[p,t.$t("add_to_tags")]])],64)),e(ft)&&o.path===e(yt)?(a(),d(Lt,{key:2,indeterminate:"",class:"sm"})):W(o)?r((a(),d(u,{key:3,class:"sm",onClick:s[13]||(s[13]=i(_=>e(ht)(),["stop"]))},{icon:c(()=>[n(Mt)]),_:1})),[[p,t.$t("pause")]]):J("",!0)]),l("div",vs,h(o.artist),1),l("div",gs,[r((a(),g("span",null,[To(h(e(Io)(o.createdAt)),1)])),[[p,e(bo)(o.createdAt)]])])],42,as)}),128)),e(ne)&&v.value.length===0?(a(),g(V,{key:0},ue(20,o=>l("section",{key:o,class:"media-item selectable-card-skeleton"},[l("div",ks,[s[17]||(s[17]=l("div",{class:"checkbox"},[l("div",{class:"skeleton-checkbox"})],-1)),l("span",ys,h(o),1)]),s[18]||(s[18]=wo('<div class="image" data-v-8c85488a><div class="skeleton-image" data-v-8c85488a></div></div><div class="title" data-v-8c85488a><div class="skeleton-text skeleton-title" data-v-8c85488a></div></div><div class="subtitle" data-v-8c85488a><div class="skeleton-text skeleton-subtitle" data-v-8c85488a></div></div><div class="actions" data-v-8c85488a><div class="skeleton-text skeleton-actions" data-v-8c85488a></div></div><div class="artist" data-v-8c85488a><div class="skeleton-text skeleton-artist" data-v-8c85488a></div></div><div class="time" data-v-8c85488a><div class="skeleton-text skeleton-time" data-v-8c85488a></div></div>',6))])),64)):J("",!0)],2),!e(ne)&&v.value.length===0?(a(),g("div",fs,h(t.$t(e(no)(e(ne),e(A).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):J("",!0),e(S)>j?(a(),d(Rt,{key:1,page:oe.value,go:Ee,total:e(S),limit:j},null,8,["page","total"])):J("",!0),l("input",{ref_key:"fileInput",ref:z,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",onChange:s[14]||(s[14]=(...o)=>e(Q)&&e(Q)(...o))},null,544),l("input",{ref_key:"dirFileInput",ref:R,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:s[15]||(s[15]=(...o)=>e(ge)&&e(ge)(...o))},null,544)],32)],64)}}}),Fs=Fo(hs,[["__scopeId","data-v-8c85488a"]]);export{Fs as default};
