import{_ as $e}from"./VPagination.vuevuetypescriptsetuptruelang-BzK-L-Ey.js";import{_ as we}from"./call-outline-rounded-BHND40zM.js";import{e as Le,f as Te,s as Se,g as qe,r as T,u as De,G as Ie,H as Ae,I as xe,J as Ee,i as Ve,K as Me,L as Ne,c as o,o as n,a,k as r,l as t,j as S,t as d,Q as q,p as g,M as Ge,y as p,a5 as Qe,N as Be,O as Ke,P as W,R as J,S as Re,a6 as Ue,D as ze,E as He,a7 as Oe,V as Pe,W as je,X as Fe,Y as We,d as Je,z as Xe,Z as X,$ as Ye,a8 as Ze,a9 as et,a0 as tt,a1 as _,aa as st,F as lt}from"./index-BaWXnnLZ.js";import{_ as at}from"./FieldId.vuevuetypescriptsetuptruelang-eOYRhci9.js";import{_ as nt,a as ot}from"./SearchInput-Cq5_Bnx2.js";import{b as ct,u as it,a as dt}from"./key-events-B0Jq4BkE.js";import{u as rt}from"./search-brnXFXDL.js";import{u as ut,a as pt}from"./tags-zkWLe_qU.js";import"./search-rounded-Dmop53vQ.js";const _t={class:"top-app-bar"},vt=["checked","indeterminate"],mt={class:"title"},kt={key:0},gt={key:1},ht={class:"actions"},ft={class:"scroll-content"},yt=["onClick","onMouseover"],bt={class:"start"},Ct=["checked","onClick"],$t=["checked","onClick"],wt={class:"number"},Lt={class:"title"},Tt={class:"subtitle"},St={class:"actions"},qt=["onClick"],Dt={key:0,indeterminate:"",class:"spinner-sm"},It=["onClick"],At=["onClick"],xt={class:"geo"},Et={class:"time"},Vt={class:"start"},Mt={class:"number"},Nt={key:0,class:"no-data-placeholder"},h=50,Gt=Le({__name:"CallsView",setup(Qt){var j;const Y=Te(),{app:Z}=Se(qe()),f=T([]),{t:D}=De(),{parseQ:ee}=rt(),E=Ie({tagIds:[]}),u=Ae.CALL,V=xe(),M=V.query,I=T(parseInt(((j=M.page)==null?void 0:j.toString())??"1")),m=T(""),{tags:C,fetch:te}=ut(u),{addToTags:se}=pt(u,C),{deleteItems:N}=ct(st,()=>{$(),w(),_.emit("refetch_tags",u),_.emit("calls_deleted")}),{selectedIds:v,allChecked:G,realAllChecked:y,selectRealAll:le,allCheckedAlertVisible:ae,clearSelection:$,toggleAllChecked:Q,toggleSelect:B,total:c,checked:A,shiftEffectingIds:K,handleItemClick:ne,handleMouseOver:oe,selectAll:ce,shouldSelect:ie}=it(f),R=e=>{const s=V.query.q;Xe(Y,s?`/calls?page=${e}&q=${s}`:`/calls?page=${e}`)},{keyDown:U,keyUp:z}=dt(c,h,I,ce,$,R,()=>{N(v.value,y.value,c.value,m.value)}),{loading:x,fetch:w}=Ee({handle:(e,s)=>{s?ze(D(s),"error"):e&&(f.value=e.calls,c.value=e.callCount)},document:Ue,variables:()=>({offset:(I.value-1)*h,limit:h,query:m.value})}),de=["1","2","3"].map(e=>({id:e,name:D("call_type."+e)}));function re(e){X(Ye,{type:u,tags:C.value,item:{key:e.id,title:"",size:0},selected:C.value.filter(s=>e.tags.some(L=>L.id===s.id))})}function ue(e){return e?`/calls?q=${e}`:"/calls"}const H=e=>{e.type===u&&($(),w())},O=e=>{e.type===u&&w()};function pe(e){if(!e)return"";const s=[];return e.isp&&s.push(D("phone_isp_type."+e.isp)),e.city===e.province?s.push(e.city):s.push(`${e.province}${e.city}`),s.join(", ")}const P=T(""),{mutate:_e,loading:ve}=Ve({document:He});function me(e){P.value=e.id,_e({number:e.number})}function ke(e){X(et,{id:e.id,name:e.number,gql:Ze`
      mutation DeleteCall($query: String!) {
        deleteCalls(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),typeName:"Call",done:()=>{c.value--,e.tags.length&&_.emit("refetch_tags",u),_.emit("calls_deleted")}})}return Me(()=>{var e;m.value=tt(((e=M.q)==null?void 0:e.toString())??""),ee(E,m.value),te(),w(),_.on("item_tags_updated",O),_.on("items_tags_updated",H),window.addEventListener("keydown",U),window.addEventListener("keyup",z)}),Ne(()=>{_.off("item_tags_updated",O),_.off("items_tags_updated",H),window.removeEventListener("keydown",U),window.removeEventListener("keyup",z)}),(e,s)=>{const L=Qe,F=Be,ge=nt,he=ot,fe=at,ye=Pe,be=we,Ce=$e,k=Ge("tooltip");return n(),o(q,null,[a("div",_t,[a("md-checkbox",{"touch-target":"wrapper",checked:t(G),indeterminate:!t(G)&&t(A),onChange:s[0]||(s[0]=(...l)=>t(Q)&&t(Q)(...l))},null,40,vt),a("div",mt,[t(v).length?(n(),o("span",kt,d(e.$t("x_selected",{count:t(y)?t(c).toLocaleString():t(v).length.toLocaleString()})),1)):(n(),o("span",gt,d(e.$t("page_title.calls"))+" ("+d(t(c).toLocaleString())+")",1)),t(A)?(n(),o(q,{key:2},[g((n(),o("button",{class:"btn-icon",onClick:s[1]||(s[1]=p(l=>t(N)(t(v),t(y),t(c),m.value),["stop"]))},[s[3]||(s[3]=a("md-ripple",null,null,-1)),r(L)])),[[k,e.$t("delete")]]),g((n(),o("button",{class:"btn-icon",onClick:s[2]||(s[2]=p(l=>t(se)(t(v),t(y),m.value),["stop"]))},[s[4]||(s[4]=a("md-ripple",null,null,-1)),r(F)])),[[k,e.$t("add_to_tags")]])],64)):S("",!0)]),a("div",ht,[r(ge,{filter:E,tags:t(C),types:t(de),"get-url":ue},null,8,["filter","tags","types"])])]),r(he,{limit:h,total:t(c),"all-checked-alert-visible":t(ae),"real-all-checked":t(y),"select-real-all":t(le),"clear-selection":t($)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",ft,[a("div",{class:W(["call-list",{"select-mode":t(A)}])},[(n(!0),o(q,null,J(f.value,(l,b)=>(n(),o("section",{key:l.id,class:W(["call-item selectable-card",{selected:t(v).includes(l.id),selecting:t(K).includes(l.id)}]),onClick:p(i=>t(ne)(i,l,b,()=>{}),["stop"]),onMouseover:i=>t(oe)(i,b)},[a("div",bt,[t(K).includes(l.id)?(n(),o("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:t(ie),onClick:p(i=>t(B)(i,l,b),["stop"])},null,8,Ct)):(n(),o("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:t(v).includes(l.id),onClick:p(i=>t(B)(i,l,b),["stop"])},null,8,$t)),a("span",wt,[r(fe,{id:b+1,raw:l},null,8,["id","raw"])])]),a("div",Lt,d(l.name?l.name+" "+l.number:l.number),1),a("div",Tt,[a("span",null,d(t(Oe)(l.duration)),1),a("span",null,d(e.$t("call_type."+l.type)),1),r(ye,{tags:l.tags,type:t(u),"only-links":!0},null,8,["tags","type"])]),a("div",St,[g((n(),o("button",{class:"btn-icon sm",onClick:p(i=>ke(l),["stop"])},[s[5]||(s[5]=a("md-ripple",null,null,-1)),r(L)],8,qt)),[[k,e.$t("delete")]]),t(ve)&&P.value===l.id?(n(),o("md-circular-progress",Dt)):g((n(),o("button",{key:1,class:"btn-icon sm",onClick:p(i=>me(l),["stop"])},[s[6]||(s[6]=a("md-ripple",null,null,-1)),r(be)],8,It)),[[k,e.$t("make_a_phone_call")]]),g((n(),o("button",{class:"btn-icon sm",onClick:p(i=>re(l),["stop"])},[s[7]||(s[7]=a("md-ripple",null,null,-1)),r(F)],8,At)),[[k,e.$t("add_to_tags")]])]),a("div",xt,d(pe(l.geo)),1),a("div",Et,[g((n(),o("span",null,[Fe(d(t(We)(l.startedAt)),1)])),[[k,t(je)(l.startedAt)]])])],42,yt))),128)),t(x)&&f.value.length===0?(n(),o(q,{key:0},J(20,l=>a("section",{key:l,class:"call-item selectable-card-skeleton"},[a("div",Vt,[s[8]||(s[8]=a("div",{class:"checkbox"},[a("div",{class:"skeleton-checkbox"})],-1)),a("span",Mt,d(l),1)]),s[9]||(s[9]=Je('<div class="title" data-v-b01ce200><div class="skeleton-text skeleton-title" data-v-b01ce200></div></div><div class="subtitle" data-v-b01ce200><div class="skeleton-text skeleton-subtitle" data-v-b01ce200></div></div><div class="actions" data-v-b01ce200><div class="skeleton-text skeleton-actions" data-v-b01ce200></div></div><div class="geo" data-v-b01ce200><div class="skeleton-text skeleton-geo" data-v-b01ce200></div></div><div class="time" data-v-b01ce200><div class="skeleton-text skeleton-time" data-v-b01ce200></div></div>',5))])),64)):S("",!0)],2),!t(x)&&f.value.length===0?(n(),o("div",Nt,d(e.$t(t(Re)(t(x),t(Z).permissions,"WRITE_CALL_LOG"))),1)):S("",!0),t(c)>h?(n(),Ke(Ce,{key:1,page:I.value,go:R,total:t(c),limit:h},null,8,["page","total"])):S("",!0)])],64)}}}),Ft=lt(Gt,[["__scopeId","data-v-b01ce200"]]);export{Ft as default};
