import{_ as Y}from"./MonacoEditor.vuevuetypescriptsetuptruelang-Dp3kEFBa.js";import{u as Z,_ as ee}from"./markdown-DGqQAVjS.js";import{b6 as te,b7 as W,b8 as ne,m as ae,c as h,o as p,a as c,d as oe,e as se,u as ie,r as y,s as le,f as ue,g as re,G as de,i as ce,b9 as me,ac as _e,F as fe,a0 as q,ad as ve,n as S,J as pe,x as A,j as L,V as F,L as ge,h as G,t as be,k as z,aL as Te,T as ye,N as O,K as he,w as ke,U as we,R as Le,ba as Ce,A as P,bb as Ne,bc as xe,a2 as Me,y as $e,Y as Ee,Z as qe,bd as Se,C as Ve}from"./index-Dohfv8Fq.js";var B=function(){return te.Date.now()},Re="Expected a function",Ie=Math.max,De=Math.min;function Ue(N,i,u){var m,a,o,l,s,r,f=0,x=!1,v=!1,g=!0;if(typeof N!="function")throw new TypeError(Re);i=W(i)||0,ne(u)&&(x=!!u.leading,v="maxWait"in u,o=v?Ie(W(u.maxWait)||0,i):o,g="trailing"in u?!!u.trailing:g);function k(n){var d=m,e=a;return m=a=void 0,f=n,l=N.apply(e,d),l}function M(n){return f=n,s=setTimeout(_,i),x?k(n):l}function V(n){var d=n-r,e=n-f,t=i-d;return v?De(t,o-e):t}function b(n){var d=n-r,e=n-f;return r===void 0||d>=i||d<0||v&&e>=o}function _(){var n=B();if(b(n))return $(n);s=setTimeout(_,V(n))}function $(n){return s=void 0,g&&m?k(n):(m=a=void 0,l)}function R(){s!==void 0&&clearTimeout(s),f=0,m=r=a=s=void 0}function I(){return s===void 0?l:$(B())}function w(){var n=B(),d=b(n);if(m=arguments,a=this,r=n,d){if(s===void 0)return M(r);if(v)return clearTimeout(s),s=setTimeout(_,i),k(r)}return s===void 0&&(s=setTimeout(_,i)),l}return w.cancel=R,w.flush=I,w}const Ae={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Be(N,i){return p(),h("svg",Ae,i[0]||(i[0]=[c("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1)]))}const He=ae({name:"material-symbols-arrow-back-rounded",render:Be}),Qe={class:"top-app-bar"},We={class:"title"},Fe={class:"state-point"},Ge={class:"actions"},ze={class:"panel-container"},Oe=["innerHTML"],C="NOTE",Pe=oe({__name:"NoteEditView",setup(N){const i=se(),{t:u}=ie(),m=fe(),a=y(""),o=y(),l=y(""),s=y(""),r=y(!1),{app:f,urlTokenKey:x}=le(ue());function v(){const e=Me.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),$e(i,t)}const{render:g}=Z(f,x),k=Ue(()=>{r.value=!1,$({id:a.value,input:{content:l.value,title:Se(l.value,{length:250,omission:""})}})},500),M=()=>{ke(l,async e=>{r.value=!0,s.value=await g(e),k()})},V=()=>{window.print()},b=y();re({handle:(e,t)=>{t?P(u(t),"error"):e&&(b.value=e.tags)},document:Ce,variables:{type:C}});const{fetch:_}=de({handle:async(e,t)=>{t?P(u(t),"error"):(o.value=e.note,l.value=e.note.content,s.value=await g(l.value),M())},document:Ne,variables:()=>({id:a.value}),options:{fetchPolicy:"no-cache"}}),{mutate:$,onDone:R}=ce({document:xe});R(e=>{var t,T;o.value=e.data.saveNote,!a.value&&((t=o.value)!=null&&t.id)&&(a.value=(T=o.value)==null?void 0:T.id,me(i,`/notes/${a.value}`))});function I(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${u("updated_at")}: ${we(e)})`:""}function w(){var e,t;Ee(qe,{type:C,tags:b.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=b.value)==null?void 0:t.filter(T=>{var E;return(E=o.value)==null?void 0:E.tags.some(D=>D.id===T.id)})})}const n=e=>{e.type===C&&_()},d=e=>{e.type===C&&_()};return _e(()=>{a.value=m.params.id,a.value==="create"&&(a.value=""),a.value?_():M(),q.on("item_tags_updated",d),q.on("items_tags_updated",n)}),ve(()=>{q.off("item_tags_updated",d),q.off("items_tags_updated",n)}),(e,t)=>{var H,Q;const T=He,E=Le,D=ye,j=he,K=ee,J=Y,U=pe("tooltip");return p(),h(O,null,[c("div",Qe,[S((p(),h("button",{class:"btn-icon",onClick:A(v,["prevent"])},[t[1]||(t[1]=c("md-ripple",null,null,-1)),L(T)])),[[U,e.$t("back")]]),c("div",We,[F(be(a.value?z(u)("edit"):z(u)("create"))+" ",1),S(c("span",Fe,"*",512),[[Te,r.value]]),t[2]||(t[2]=F()),(H=o.value)!=null&&H.updatedAt?(p(),ge(E,{key:0,id:I(),class:"time",raw:o.value},null,8,["id","raw"])):G("",!0)]),c("div",Ge,[L(D,{tags:(Q=o.value)==null?void 0:Q.tags,type:C,"only-links":!0},null,8,["tags"]),a.value?(p(),h(O,{key:0},[S((p(),h("button",{class:"btn-icon",onClick:A(w,["prevent"])},[t[3]||(t[3]=c("md-ripple",null,null,-1)),L(j)])),[[U,e.$t("add_to_tags")]]),S((p(),h("button",{class:"btn-icon",onClick:A(V,["prevent"])},[t[4]||(t[4]=c("md-ripple",null,null,-1)),L(K)])),[[U,e.$t("print")]])],64)):G("",!0)])]),c("div",ze,[L(J,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=X=>l.value=X),language:"html"},null,8,["modelValue"]),c("div",{class:"md-container",innerHTML:s.value},null,8,Oe)])],64)}}}),Xe=Ve(Pe,[["__scopeId","data-v-eb5effca"]]);export{Xe as default};
