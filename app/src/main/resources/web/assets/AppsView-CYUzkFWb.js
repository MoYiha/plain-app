import{_ as xe}from"./VPagination.vuevuetypescriptsetuptruelang-DJTUsUyq.js";import{a1 as T,d as Fe,s as Z,i as Me,ai as Te,u as Ke,h as S,g as Ne,I as Qe,aj as ze,J as Ge,K as ee,j as Re,L as je,M as He,c as l,a,m as t,t as i,x as k,w as u,p as h,e as I,V as A,q as te,N as se,O as w,P as M,v as ae,Q as Oe,f as Je,C as Xe,ak as Ye,al as We,am as Ze,an as et,ao as tt,S as st,o as n,E as at,ap as ne,U as oe,X as nt,F as ot,G as lt,Y as it,aq as ct,ar as dt,a0 as pt,as as rt,a3 as ut,ae as _t,H as vt}from"./index-BzaaAwnX.js";import{_ as kt,a as ht}from"./SearchInput-DTMVECJE.js";import{_ as mt}from"./sort-rounded-BiVhN4C5.js";import{u as ft,a as gt}from"./key-events-C5OjC_dP.js";import{u as yt}from"./search-DwB6FdxH.js";import"./search-rounded-Btuwf-IQ.js";import"./rss-feed-rounded-9FbiHzkN.js";const le=p=>{T.emit("tap_phone",p)};function bt(p,D){const m=p.findIndex(L=>L.id===D);m!==-1&&p.splice(m,1)}const g=p=>(ot("data-v-40570fe8"),p=p(),lt(),p),wt={class:"top-app-bar"},Ct=["checked","indeterminate"],$t={class:"title"},St={key:0},It={key:1},At=g(()=>a("md-ripple",null,null,-1)),Dt={class:"actions"},Lt=g(()=>a("md-ripple",null,null,-1)),Ut=["disabled"],qt=g(()=>a("md-ripple",null,null,-1)),Bt={key:0,indeterminate:""},Et={class:"menu-items"},Pt=["onClick","selected"],Vt={slot:"headline"},xt={class:"scroll-content"},Ft=["onClick","onMouseover"],Mt={class:"start"},Tt=["onClick","checked"],Kt=["onClick","checked"],Nt={class:"number"},Qt=["src"],zt={class:"title"},Gt={class:"subtitle"},Rt={class:"actions"},jt={indeterminate:"",class:"spinner-sm"},Ht=["onClick"],Ot=["onClick"],Jt=g(()=>a("md-ripple",null,null,-1)),Xt=["onClick"],Yt=g(()=>a("md-ripple",null,null,-1)),Wt={class:"time"},Zt={class:"start"},es=g(()=>a("div",{class:"checkbox"},[a("div",{class:"skeleton-checkbox"})],-1)),ts={class:"number"},ss=it('<div class="image" data-v-40570fe8><div class="skeleton-image" data-v-40570fe8></div></div><div class="title" data-v-40570fe8><div class="skeleton-text skeleton-title" data-v-40570fe8></div></div><div class="subtitle" data-v-40570fe8><div class="skeleton-text skeleton-subtitle" data-v-40570fe8></div></div><div class="actions" data-v-40570fe8><div class="skeleton-text skeleton-actions" data-v-40570fe8></div></div><div class="time" data-v-40570fe8><div class="skeleton-text skeleton-time" data-v-40570fe8></div><div class="skeleton-text skeleton-time" data-v-40570fe8></div></div>',5),as={key:0,class:"no-data-placeholder"},f=50,ns=Fe({__name:"AppsView",setup(p){var W;const{app:D,urlTokenKey:m,uploads:L}=Z(Me()),{input:ie,upload:ce,uploadChanged:K}=Te(L),N=Ke(),r=S([]),{t:U}=Ne(),{appSortBy:q}=Z(N),{parseQ:de}=yt(),Q=Qe({tagIds:[]}),pe=ct(),C=S(!1),z=Oe(),G=z.query,B=S(parseInt(((W=G.page)==null?void 0:W.toString())??"1")),$=S(""),{selectedIds:y,allChecked:R,realAllChecked:E,selectRealAll:re,allCheckedAlertVisible:ue,clearSelection:P,toggleAllChecked:j,toggleSelect:H,total:_,checked:V,shiftEffectingIds:O,handleItemClick:_e,handleMouseOver:ve,selectAll:ke,shouldSelect:he}=ft(r),{downloadItems:me}=ze(m,Ge.PACKAGE,P,"apps.zip"),{downloadFile:fe}=dt(m),x=e=>{const o=z.query.q;Je(N,o?`/apps?page=${e}&q=${o}`:`/apps?page=${e}`)},{keyDown:J,keyUp:X}=gt(_,f,B,ke,P,x,()=>{}),ge=()=>{ce(D.value.downloadsDir)},ye=["user","system"].map(e=>({id:e,name:U("app_type."+e)})),be=e=>{e.isUninstalling=!1},{loading:F,fetch:we}=ee({handle:(e,o)=>{C.value=!1,o?Xe(U(o),"error"):e&&(r.value=e.packages.map(b=>({...b,isUninstalling:!1,icon:Ye(m.value,"pkgicon://"+b.id)})),_.value=e.packageCount)},document:We,variables:()=>({offset:(B.value-1)*f,limit:f,query:$.value,sortBy:q.value}),appApi:!0});function Ce(e){return e?`/apps?q=${e}`:"/apps"}function $e(e,o){C.value=!0,q.value=o,x(1),e.close()}const{mutate:Se}=Re({document:Ze,appApi:!0});function Ie(e){e.isUninstalling=!0,le(U("confirm_uninstallation_on_phone")),Se({id:e.id})}const{loading:Ae,fetch:De}=ee({handle:e=>{if(e)for(const o of e.packageStatuses)o.exist||(bt(r.value,o.id),le(""))},document:et,variables:()=>({ids:r.value.filter(e=>e.isUninstalling).map(e=>e.id)}),appApi:!0}),Y=e=>{e.status};return je(()=>{var e;setInterval(()=>{r.value.some(o=>o.isUninstalling)&&!Ae.value&&De()},1e3),$.value=pt(((e=G.q)==null?void 0:e.toString())??""),de(Q,$.value),we(),T.on("upload_task_done",Y),window.addEventListener("keydown",J),window.addEventListener("keyup",X)}),He(()=>{T.off("upload_task_done",Y),window.removeEventListener("keydown",J),window.removeEventListener("keyup",X)}),(e,o)=>{const b=rt,Le=kt,Ue=mt,qe=tt,Be=ht,Ee=ut,Pe=_t,Ve=xe,v=st("tooltip");return n(),l(w,null,[a("div",wt,[a("md-checkbox",{"touch-target":"wrapper",onChange:o[0]||(o[0]=(...s)=>t(j)&&t(j)(...s)),checked:t(R),indeterminate:!t(R)&&t(V)},null,40,Ct),a("div",$t,[t(y).length?(n(),l("span",St,i(e.$t("x_selected",{count:t(E)?t(_).toLocaleString():t(y).length.toLocaleString()})),1)):(n(),l("span",It,i(e.$t("page_title.apps"))+" ("+i(t(_).toLocaleString())+")",1)),t(V)?k((n(),l("button",{key:2,class:"btn-icon",onClick:o[1]||(o[1]=u(s=>t(me)(t(E),t(y),$.value),["stop"]))},[At,h(b)])),[[v,e.$t("download")]]):I("",!0)]),a("div",Dt,[h(Le,{filter:Q,types:t(ye),"get-url":Ce},null,8,["filter","types"]),a("button",{class:"btn-icon",onClick:u(ge,["stop"]),style:{display:"none"}},[Lt,A(" "+i(e.$t("install")),1)]),h(qe,null,{content:te(s=>[a("div",Et,[(n(!0),l(w,null,M(t(pe),d=>(n(),l("md-menu-item",{onClick:c=>$e(s,d.value),key:d.value,selected:d.value===t(q)},[a("div",Vt,i(e.$t(d.label)),1)],8,Pt))),128))])]),default:te(()=>[k((n(),l("button",{class:"btn-icon btn-sort",disabled:C.value},[qt,C.value?(n(),l("md-circular-progress",Bt)):(n(),ae(Ue,{key:1}))],8,Ut)),[[v,e.$t("sort")]])]),_:1})])]),h(Be,{limit:f,total:t(_),"all-checked-alert-visible":t(ue),"real-all-checked":t(E),"select-real-all":t(re),"clear-selection":t(P)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",xt,[a("div",{class:se(["app-list",{"select-mode":t(V)}])},[(n(!0),l(w,null,M(r.value,(s,d)=>(n(),l("section",{class:se(["app-item selectable-card",{selected:t(y).includes(s.id),selecting:t(O).includes(s.id)}]),key:s.id,onClick:u(c=>t(_e)(c,s,d,()=>{}),["stop"]),onMouseover:c=>t(ve)(c,d)},[a("div",Mt,[t(O).includes(s.id)?(n(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:u(c=>t(H)(c,s,d),["stop"]),checked:t(he)},null,8,Tt)):(n(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:u(c=>t(H)(c,s,d),["stop"]),checked:t(y).includes(s.id)},null,8,Kt)),a("span",Nt,[h(Ee,{id:d+1,raw:s},null,8,["id","raw"])])]),a("img",{class:"image",width:"50",height:"50",src:s.icon},null,8,Qt),a("div",zt,i(s.name)+" ("+i(s.version)+")",1),a("div",Gt,[a("span",null,i(s.id),1),a("span",null,i(t(at)(s.size)),1),a("span",null,i(e.$t("app_type."+s.type)),1)]),a("div",Rt,[s.isUninstalling?(n(),l(w,{key:0},[k(a("md-circular-progress",jt,null,512),[[v,e.$t("uninstalling")]]),A(" Â "),a("md-outlined-button",{class:"btn-sm",onClick:u(c=>be(s),["stop"])},i(e.$t("cancel")),9,Ht)],64)):k((n(),l("button",{key:1,class:"btn-icon sm",onClick:u(c=>Ie(s),["stop"])},[Jt,h(Pe)],8,Ot)),[[v,e.$t("uninstall")]]),k((n(),l("button",{class:"btn-icon sm",onClick:u(c=>t(fe)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},[Yt,h(b)],8,Xt)),[[v,e.$t("download")]])]),a("div",Wt,[k((n(),l("span",null,[A(i(e.$t("installed_at"))+": "+i(t(oe)(s.installedAt)),1)])),[[v,t(ne)(s.installedAt)]]),k((n(),l("span",null,[A(i(e.$t("updated_at"))+": "+i(t(oe)(s.updatedAt)),1)])),[[v,t(ne)(s.updatedAt)]])])],42,Ft))),128)),t(F)&&r.value.length===0?(n(),l(w,{key:0},M(20,s=>a("section",{class:"app-item selectable-card-skeleton",key:s},[a("div",Zt,[es,a("span",ts,i(s),1)]),ss])),64)):I("",!0)],2),!t(F)&&r.value.length===0?(n(),l("div",as,i(e.$t(t(nt)(t(F)))),1)):I("",!0),t(_)>f?(n(),ae(Ve,{key:1,page:B.value,go:x,total:t(_),limit:f},null,8,["page","total"])):I("",!0),a("input",{ref_key:"fileInput",ref:ie,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:o[2]||(o[2]=(...s)=>t(K)&&t(K)(...s))},null,544)])],64)}}}),_s=vt(ns,[["__scopeId","data-v-40570fe8"]]);export{_s as default};
