import{_ as fe}from"./VPagination.vuevuetypescriptsetuptruelang-JQdiaM3z.js";import{e as he,f as ye,s as be,g as Ce,r as b,u as we,G as Te,H as Se,I as $e,J as Le,i as Me,K as xe,L as De,c as l,o as n,a as o,k as r,l as e,p as C,j as w,t as c,M as Ie,y as _,N as qe,O as Ae,P as O,Q as I,R as j,S as Ee,T as Ve,D as Ue,E as Ne,U as Re,V as Be,W as He,X as Ke,Y as Qe,Z as ze,d as Ge,z as Pe,$ as Fe,a0 as Oe,a1 as je,a2 as T,F as Je}from"./index-BjwOe50_.js";import{_ as We}from"./call-outline-rounded-CjYYQeWh.js";import{_ as Xe,a as Ye}from"./SearchInput-CiogdeIK.js";import{u as Ze,a as es}from"./tags-CUGCZoM5.js";import{u as ss,a as ts}from"./key-events-C_0dFOja.js";import{u as as}from"./search-Cp54c8dH.js";import"./search-rounded-DTTX8wGU.js";const os={class:"top-app-bar"},ns=["checked","indeterminate"],ls={class:"title"},is={key:0},cs={key:1},ds={class:"actions"},rs={class:"scroll-content"},us=["onClick","onMouseover"],_s={class:"start"},ps=["checked","onClick"],ms=["checked","onClick"],vs={class:"number"},gs={class:"title"},ks=["innerHTML"],fs={class:"actions"},hs=["onClick"],ys={key:0,indeterminate:"",class:"spinner-sm"},bs=["onClick"],Cs={class:"info"},ws={class:"time"},Ts={class:"start"},Ss={class:"number"},$s={key:0,class:"no-data-placeholder"},p=50,Ls=he({__name:"MessagesView",setup(Ms){var F;const J=ye(),{app:W}=be(Ce()),m=b([]),{t:q}=we(),{parseQ:X}=as(),A=Te({tagIds:[]}),u=Se.SMS,E=$e(),V=E.query,S=b(parseInt(((F=V.page)==null?void 0:F.toString())??"1")),k=b(""),{tags:f,fetch:Y}=Ze(u),{addToTags:Z}=es(u,f),{selectedIds:v,allChecked:U,realAllChecked:$,selectRealAll:ee,allCheckedAlertVisible:se,clearSelection:L,toggleAllChecked:N,toggleSelect:R,total:d,checked:M,shiftEffectingIds:B,handleItemClick:te,handleMouseOver:ae,selectAll:oe,shouldSelect:ne}=ss(m),H=s=>{const a=E.query.q;Pe(J,a?`/messages?page=${s}&q=${a}`:`/messages?page=${s}`)},{keyDown:K,keyUp:Q}=ts(d,p,S,oe,L,H,()=>{}),{loading:x,fetch:D}=Le({handle:(s,a)=>{a?Ue(q(a),"error"):s&&(m.value=s.messages,d.value=s.messageCount)},document:Ve,variables:()=>({offset:(S.value-1)*p,limit:p,query:k.value})}),le=["1","2","3"].map(s=>({id:s,name:q("message_type."+s)}));function ie(s){Fe(Oe,{type:u,tags:f.value,item:{key:s.id,title:"",size:0},selected:f.value.filter(a=>s.tags.some(h=>h.id===a.id))})}const z=b(""),{mutate:ce,loading:de}=Me({document:Ne});function re(s){z.value=s.id,ce({number:s.address})}function ue(s){return s?`/messages?q=${s}`:"/messages"}const G=s=>{s.type===u&&(L(),D())},P=s=>{s.type===u&&D()};return xe(()=>{var s;k.value=je(((s=V.q)==null?void 0:s.toString())??""),X(A,k.value),Y(),D(),T.on("item_tags_updated",P),T.on("items_tags_updated",G),window.addEventListener("keydown",K),window.addEventListener("keyup",Q)}),De(()=>{T.off("item_tags_updated",P),T.off("items_tags_updated",G),window.removeEventListener("keydown",K),window.removeEventListener("keyup",Q)}),(s,a)=>{const h=qe,_e=Xe,pe=Ye,me=Re,ve=We,ge=He,ke=fe,y=Ie("tooltip");return n(),l(I,null,[o("div",os,[o("md-checkbox",{"touch-target":"wrapper",checked:e(U),indeterminate:!e(U)&&e(M),onChange:a[0]||(a[0]=(...t)=>e(N)&&e(N)(...t))},null,40,ns),o("div",ls,[e(v).length?(n(),l("span",is,c(s.$t("x_selected",{count:e($)?e(d).toLocaleString():e(v).length.toLocaleString()})),1)):(n(),l("span",cs,c(s.$t("page_title.messages"))+" ("+c(e(d).toLocaleString())+")",1)),e(M)?C((n(),l("button",{key:2,class:"btn-icon",onClick:a[1]||(a[1]=_(t=>e(Z)(e(v),e($),k.value),["stop"]))},[a[2]||(a[2]=o("md-ripple",null,null,-1)),r(h)])),[[y,s.$t("add_to_tags")]]):w("",!0)]),o("div",ds,[r(_e,{filter:A,tags:e(f),types:e(le),"get-url":ue},null,8,["filter","tags","types"])])]),r(pe,{limit:p,total:e(d),"all-checked-alert-visible":e(se),"real-all-checked":e($),"select-real-all":e(ee),"clear-selection":e(L)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),o("div",rs,[o("div",{class:O(["sms-list",{"select-mode":e(M)}])},[(n(!0),l(I,null,j(m.value,(t,g)=>(n(),l("section",{key:t.id,class:O(["sms-item selectable-card",{selected:e(v).includes(t.id),selecting:e(B).includes(t.id)}]),onClick:_(i=>e(te)(i,t,g,()=>{}),["stop"]),onMouseover:i=>e(ae)(i,g)},[o("div",_s,[e(B).includes(t.id)?(n(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:e(ne),onClick:_(i=>e(R)(i,t,g),["stop"])},null,8,ps)):(n(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:e(v).includes(t.id),onClick:_(i=>e(R)(i,t,g),["stop"])},null,8,ms)),o("span",vs,[r(me,{id:g+1,raw:t},null,8,["id","raw"])])]),o("div",gs,c(t.address),1),o("div",{class:"subtitle",innerHTML:e(Be)(t.body)},null,8,ks),o("div",fs,[C((n(),l("button",{class:"btn-icon sm",onClick:_(i=>ie(t),["stop"])},[a[3]||(a[3]=o("md-ripple",null,null,-1)),r(h)],8,hs)),[[y,s.$t("add_to_tags")]]),e(de)&&z.value===t.id?(n(),l("md-circular-progress",ys)):C((n(),l("button",{key:1,class:"btn-icon sm",onClick:_(i=>re(t),["stop"])},[a[4]||(a[4]=o("md-ripple",null,null,-1)),r(ve)],8,bs)),[[y,s.$t("make_a_phone_call")]])]),o("div",Cs,[o("span",null,c(s.$t(`message_type.${t.type}`)),1),r(ge,{tags:t.tags,type:e(u),"only-links":!0},null,8,["tags","type"])]),o("div",ws,[C((n(),l("span",null,[Qe(c(e(ze)(t.date)),1)])),[[y,e(Ke)(t.date)]])])],42,us))),128)),e(x)&&m.value.length===0?(n(),l(I,{key:0},j(20,t=>o("section",{key:t,class:"sms-item selectable-card-skeleton"},[o("div",Ts,[a[5]||(a[5]=o("div",{class:"checkbox"},[o("div",{class:"skeleton-checkbox"})],-1)),o("span",Ss,c(t),1)]),a[6]||(a[6]=Ge('<div class="title" data-v-d5f0aaae><div class="skeleton-text skeleton-title" data-v-d5f0aaae></div></div><div class="subtitle" data-v-d5f0aaae><div class="skeleton-text skeleton-subtitle" data-v-d5f0aaae></div><div class="skeleton-text skeleton-subtitle" data-v-d5f0aaae></div></div><div class="actions" data-v-d5f0aaae><div class="skeleton-text skeleton-actions" data-v-d5f0aaae></div></div><div class="info" data-v-d5f0aaae><div class="skeleton-text skeleton-info" data-v-d5f0aaae></div></div><div class="time" data-v-d5f0aaae><div class="skeleton-text skeleton-time" data-v-d5f0aaae></div></div>',5))])),64)):w("",!0)],2),!e(x)&&m.value.length===0?(n(),l("div",$s,c(s.$t(e(Ee)(e(x),e(W).permissions,"READ_SMS"))),1)):w("",!0),e(d)>p?(n(),Ae(ke,{key:1,page:S.value,go:H,total:e(d),limit:p},null,8,["page","total"])):w("",!0)])],64)}}}),Ns=Je(Ls,[["__scopeId","data-v-d5f0aaae"]]);export{Ns as default};
