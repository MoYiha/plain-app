import{e as ie,u as ce,r as h,g as de,s as re,i as ue,ao as _e,J as pe,K as ve,L as ke,c as l,o as a,a as o,j as m,O as he,p as g,l as s,t as d,M as me,y as _,k as v,ah as ge,Q as z,R as fe,a3 as D,bh as ye,S as be,by as we,bH as Ee,D as Ce,bx as De,d as Ie,P as Se,U as Te,ay as Le,n as Ve,X as $e,Y as Fe,Z as xe,bA as Ae,ai as Be,bD as Ne,ak as Ue,bE as Ke,bF as Me,bB as Re,a2 as f,bG as ze}from"./index-BEu6YjWH.js";import{_ as O}from"./default-BQXvEOng.js";import{u as Oe,c as Ge}from"./key-events-tmVSwCBq.js";const Qe={class:"top-app-bar"},He=["checked","indeterminate"],Pe={key:0},Je={key:1},Xe={key:0,class:"scroller"},je={class:"start"},We={class:"number"},Ye=["onClick","onMouseover"],Ze={class:"start"},qe=["checked","onClick"],es=["checked","onClick"],ss={class:"number"},ts=["onClick"],os={key:0,class:"svg",src:O},ns=["src","onError"],as=["src","onError"],ls={key:3,class:"svg",src:O},is={class:"title"},cs={class:"subtitle"},ds={class:"actions"},rs=["onClick"],us={class:"btn-icon sm"},_s={class:"card card-info"},ps={class:"key-value vertical"},vs={class:"key"},ks={class:"value"},hs={key:2,class:"no-data-placeholder"},bs=ie({__name:"FilesRecentView",setup(ms){const{t:G}=ce(),Q=h([]),I=de(),{app:H,urlTokenKey:y}=re(I),r=h([]),{selectedIds:p,allChecked:S,realAllChecked:P,clearSelection:b,toggleAllChecked:T,toggleSelect:L,total:w,checked:V,shiftEffectingIds:$,handleItemClick:J,handleMouseOver:X,selectAll:j,shouldSelect:W}=Oe(r),{downloadFile:F,downloadFiles:Y}=_e(y),{view:Z}=Me(Q,(e,n)=>{I.lightbox={sources:e,index:n,visible:!0}}),{keyDown:x,keyUp:A}=Ge(j,b,()=>{}),B=h([]),N=h([]),q=e=>{B.value.push(e)},ee=e=>{N.value.push(e)},{mutate:se,onDone:te}=ue({document:we});te(e=>{Y(e.data.setTempValue.key),b()});const U=e=>{Ne(e.name)?window.open(Ue(y.value,e.path),"_blank"):Ke(e.name)?Z(r.value,e):F(e.path)},{loading:E,fetch:K}=pe({handle:async(e,n)=>{if(n)Ce(G(n),"error");else{const u=[];for(const C of e.recentFiles)u.push(De(C,y.value));r.value=u,w.value=u.length}},document:Ee}),oe=()=>{se({key:Re(),value:JSON.stringify(p.value.map(e=>({path:e})))})},M=e=>{e.status==="done"&&setTimeout(()=>{K()},1e3)},ne=e=>{e.forEach(n=>{ze(r.value,u=>u.id===n.id)}),b()},R=e=>{ne([e.item])};return ve(()=>{K(),f.on("upload_task_done",M),f.on("file_deleted",R),window.addEventListener("keydown",x),window.addEventListener("keyup",A)}),ke(()=>{f.off("upload_task_done",M),f.off("file_deleted",R),window.removeEventListener("keydown",x),window.removeEventListener("keyup",A)}),(e,n)=>{const u=ge,C=Te,ae=Ae,le=Be,k=me("tooltip");return a(),l(z,null,[o("div",Qe,[o("md-checkbox",{"touch-target":"wrapper",checked:s(S),indeterminate:!s(S)&&s(V),onChange:n[0]||(n[0]=(...c)=>s(T)&&s(T)(...c))},null,40,He),s(p).length?(a(),l("span",Pe,d(e.$t("x_selected",{count:s(P)?s(w).toLocaleString():s(p).length.toLocaleString()})),1)):(a(),l("span",Je,d(e.$t("recent_files"))+" ("+d(s(w).toLocaleString())+")",1)),s(V)?g((a(),l("button",{key:2,class:"btn-icon",onClick:_(oe,["stop"])},[n[1]||(n[1]=o("md-ripple",null,null,-1)),v(u)])),[[k,e.$t("download")]]):m("",!0)]),s(E)&&r.value.length===0?(a(),l("div",Xe,[(a(),l(z,null,fe(20,c=>o("section",{key:c,class:"file-item selectable-card-skeleton"},[o("div",je,[n[2]||(n[2]=o("div",{class:"checkbox"},[o("div",{class:"skeleton-checkbox"})],-1)),o("span",We,d(c),1)]),n[3]||(n[3]=Ie('<div class="image"><div class="skeleton-image"></div></div><div class="title"><div class="skeleton-text skeleton-title"></div></div><div class="subtitle"><div class="skeleton-text skeleton-subtitle"></div></div><div class="actions"><div class="skeleton-text skeleton-actions"></div></div>',4))])),64))])):m("",!0),r.value.length>0?(a(),he(s(ye),{key:1,class:"scroller","data-key":"id","data-sources":r.value,"estimate-size":80},{item:D(({index:c,item:t})=>[(a(),l("section",{key:t.id,class:Se(["file-item selectable-card",{selected:s(p).includes(t.id),selecting:s($).includes(t.id)}]),onClick:_(i=>s(J)(i,t,c,()=>{U(t)}),["stop"]),onMouseover:i=>s(X)(i,c)},[o("div",Ze,[s($).includes(t.id)?(a(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:s(W),onClick:_(i=>s(L)(i,t,c),["stop"])},null,8,qe)):(a(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:s(p).includes(t.id),onClick:_(i=>s(L)(i,t,c),["stop"])},null,8,es)),o("span",ss,[v(C,{id:c+1,raw:t},null,8,["id","raw"])])]),o("div",{class:"image",onClick:_(i=>U(t),["stop"])},[N.value.includes(t.id)?(a(),l("img",os)):!B.value.includes(t.id)&&t.fileId?(a(),l("img",{key:1,class:"image-thumb",src:s(Le)(t.fileId,"&w=50&h=50"),onError:i=>q(t.id)},null,40,ns)):t.extension?(a(),l("img",{key:2,src:`/ficons/${t.extension}.svg`,class:"svg",onError:i=>ee(t.id)},null,40,as)):(a(),l("img",ls))],8,ts),o("div",is,d(t.name),1),o("div",cs,[o("span",null,d(s(Ve)(t.size)),1),g((a(),l("span",null,[Fe(d(s(xe)(t.updatedAt)),1)])),[[k,s($e)(t.updatedAt)]])]),o("div",ds,[g((a(),l("button",{class:"btn-icon sm",onClick:_(i=>s(F)(t.path),["stop"])},[n[4]||(n[4]=o("md-ripple",null,null,-1)),v(u)],8,rs)),[[k,e.$t("download")]]),v(le,null,{content:D(i=>[o("section",_s,[o("div",ps,[o("div",vs,d(e.$t("path")),1),o("div",ks,d(t.path),1)])])]),default:D(()=>[g((a(),l("button",us,[n[5]||(n[5]=o("md-ripple",null,null,-1)),v(ae)])),[[k,e.$t("info")]])]),_:2},1024)])],42,Ye))]),_:1},8,["data-sources"])):m("",!0),!s(E)&&r.value.length===0?(a(),l("div",hs,d(e.$t(s(be)(s(E),s(H).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):m("",!0)],64)}}});export{bs as default};
