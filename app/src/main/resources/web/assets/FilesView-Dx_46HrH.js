import{o as i,c,a as n,d as ct,g as rt,h as S,$ as ut,bk as dt,u as pt,s as fe,i as _t,bl as mt,bm as ht,bn as ft,bo as bt,bp as vt,bq as kt,af as be,j as yt,aC as gt,k as Ct,L as Tt,M as wt,t as _,O as b,x as C,w as V,p as v,e as m,V as F,m as l,q as ve,P as X,Q as Dt,ao as $t,br as qt,E as k,al as It,S as St,N as Vt,v as Ft,bs as Bt,bt as xt,ay as Mt,U as zt,X as Et,F as Pt,G as Lt,an as Nt,bu as Ut,Y as P,bv as ke,bw as ye,ah as ge,bx as j,by as Ce,a0 as L,ad as Wt,ap as At,bz as Ht,bA as Rt,bB as Ot,H as Gt}from"./index-BxNI00MG.js";import{_ as Qt}from"./sort-rounded-BbQ1dmh_.js";import{_ as Kt}from"./refresh-rounded-DP3JBWDP.js";import{E as Te}from"./EditValueModal-DZMNikfg.js";import"./vee-validate.esm-9czZ1sUw.js";const Xt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},jt=n("path",{fill:"currentColor",d:"m12 14l-2.35 2.35q.2.375.275.8T10 18q0 1.65-1.175 2.825T6 22t-2.825-1.175T2 18t1.175-2.825T6 14q.425 0 .85.075t.8.275L10 12L7.65 9.65q-.375.2-.8.275T6 10q-1.65 0-2.825-1.175T2 6t1.175-2.825T6 2t2.825 1.175T10 6q0 .425-.075.85t-.275.8L20.6 18.6q.675.675.3 1.538T19.575 21q-.275 0-.537-.112t-.463-.313zm3-3l-2-2l5.575-5.575q.2-.2.463-.312T19.574 3q.95 0 1.313.875t-.313 1.55zM6 8q.825 0 1.413-.587T8 6t-.587-1.412T6 4t-1.412.588T4 6t.588 1.413T6 8m6 4.5q.2 0 .35-.15t.15-.35t-.15-.35t-.35-.15t-.35.15t-.15.35t.15.35t.35.15M6 20q.825 0 1.413-.587T8 18t-.587-1.412T6 16t-1.412.588T4 18t.588 1.413T6 20"},null,-1),Jt=[jt];function Yt(y,o){return i(),c("svg",Xt,[...Jt])}const Zt={name:"material-symbols-content-cut-rounded",render:Yt},es={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ts=n("path",{fill:"currentColor",d:"M9 18q-.825 0-1.412-.587T7 16V4q0-.825.588-1.412T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.587 1.413T18 18zm0-2h9V4H9zm-4 6q-.825 0-1.412-.587T3 20V7q0-.425.288-.712T4 6t.713.288T5 7v13h10q.425 0 .713.288T16 21t-.288.713T15 22zm4-6V4z"},null,-1),ss=[ts];function os(y,o){return i(),c("svg",es,[...ss])}const ns={name:"material-symbols-content-copy-outline-rounded",render:os},T=y=>(Pt("data-v-2f3eab3b"),y=y(),Lt(),y),as={class:"top-app-bar"},ls={class:"title"},is={class:"actions"},cs=T(()=>n("md-ripple",null,null,-1)),rs=T(()=>n("md-ripple",null,null,-1)),us=T(()=>n("md-ripple",null,null,-1)),ds=T(()=>n("md-ripple",null,null,-1)),ps={class:"form-check"},_s={class:"form-check-label"},ms=["checked"],hs={class:"form-check"},fs={class:"form-check-label"},bs=["checked"],vs=T(()=>n("md-ripple",null,null,-1)),ks={class:"btn-icon btn-sort"},ys=T(()=>n("md-ripple",null,null,-1)),gs={class:"menu-items"},Cs=["onClick","selected"],Ts={slot:"headline"},ws={class:"panel-container"},Ds={class:"file-items"},$s=["onClick","onDblclick","onContextmenu"],qs=["checked"],Is=["src"],Ss={class:"title"},Vs={style:{"font-size":"0.75rem"}},Fs=["onContextmenu"],Bs={key:0,class:"no-files"},xs={key:0,class:"no-data-placeholder"},Ms={key:0,class:"file-item-info"},zs=ct({__name:"FilesView",setup(y){var pe,_e,me,he;const{t:o}=rt(),we=S([]),J=Dt(),De=J.query,d=J.params.type,Y=S(ut(((pe=De.q)==null?void 0:pe.toString())??"")),N=dt(Y.value),f=S(((_e=N.find(e=>e.name==="path"))==null?void 0:_e.value)??"");let B=((me=N.find(e=>e.name==="dir"))==null?void 0:me.value)??"";B||(((he=N.find(t=>t.name==="isDir"))==null?void 0:he.value)==="1"?B=f.value:B=f.value.substring(0,f.value.lastIndexOf("/")));const $e=S(B),qe=Nt(),w=S(!1),Z=pt(),{fileShowHidden:D,fileSortBy:U}=fe(Z),ee=_t(),{app:$,urlTokenKey:q,selectedFiles:Ie}=fe(ee);let x=$.value.internalStoragePath;d&&(d==="sdcard"?x=$.value.sdcardPath:d.startsWith("usb")?x=$.value.usbDiskPaths[parseInt(d.substring(3))-1]:d==="app"&&(x=$.value.externalFilesDir));const{loading:Se,panels:p,currentDir:M,refetch:W}=mt(q,x,$e.value,U),{createPath:Ve,createVariables:Fe,createMutation:Be}=ht(q,p),{renameValue:xe,renamePath:Me,renameDone:ze,renameMutation:Ee,renameVariables:Pe}=ft(p),{internal:te,sdcard:se,usb:Le,refetch:A}=bt(),{onDeleted:H}=Ht(p,M,A),{downloadFile:oe,downloadDir:Ne,downloadFiles:Ue}=$t(q),{view:R}=Rt(we,(e,t)=>{ee.lightbox={sources:e,index:t,visible:!0}}),{selectedItem:z,select:We}=vt(M,d,Y,Z),{canPaste:ne,copy:O,cut:ae,paste:G}=kt(Ie,W,A),{input:Ae,upload:le,uploadChanged:ie}=be(),{input:He,upload:ce,uploadChanged:re}=be(),{mutate:Re,onDone:Oe}=yt({document:qt,appApi:!0});Oe(e=>{Ue(e.data.setTempValue.key),p.value.forEach(t=>{t.items.forEach(s=>{s.checked=!1})})});const I=()=>{const e=[];return p.value.forEach(t=>{t.items.forEach(s=>{s.checked&&(s.panel=t,e.push(s))})}),e};function Ge(e){w.value=e.target.checked}function Qe(e){D.value=e.target.checked}const Ke=()=>{Re({key:Ut(),value:JSON.stringify(I().map(e=>({path:e.path})))})},Xe=gt(()=>I().length>0),je=()=>{P(ke,{files:I(),onDone:H})};f.value&&Ct(()=>p.value.length,()=>{if(p.value.length>0&&f.value){const t=p.value[p.value.length-1].items.find(s=>s.path===f.value);t&&(z.value=t,f.value="")}});function Je(){var e,t,s,r;if(d){if(d==="sdcard")return`${o("sdcard")} (${o("storage_free_total",{free:k(((e=se.value)==null?void 0:e.freeBytes)??0),total:k(((t=se.value)==null?void 0:t.totalBytes)??0)})})`;if(d==="app")return o("app_name");if(d.startsWith("usb")){const E=parseInt(d.substring(3)),h=Le.value[E-1];return`${o("usb_storage")} ${E} (${o("storage_free_total",{free:k((h==null?void 0:h.freeBytes)??0),total:k((h==null?void 0:h.totalBytes)??0)})})`}}return`${o("page_title.files")} (${o("storage_free_total",{free:k(((s=te.value)==null?void 0:s.freeBytes)??0),total:k(((r=te.value)==null?void 0:r.totalBytes)??0)})})`}function Ye(e,t){if(w.value){t.checked=!t.checked;return}We(e,t)}function Ze(e,t){U.value=t,e.close()}function et(){W(M.value)}function tt(e,t){t.isDir||(ye(t.name)?window.open(ge(q.value,t.path),"_blank"):j(t.name)?R(D?e.items:e.items.filter(s=>!s.name.startsWith(".")),t):oe(t.path))}function st(e,t){e.preventDefault();const s=[{label:o("create_folder"),onClick:()=>{Ve.value=t,P(Te,{title:o("name"),placeholder:o("name"),mutation:Be,getVariables:Fe})}},{label:o("upload_files"),onClick:()=>{le(t)}},{label:o("upload_folder"),onClick:()=>{ce(t)}}];ne()&&s.push({label:o("paste"),onClick:()=>{G(t)}}),Ce({x:e.x,y:e.y,items:s})}function ot(e,t,s){e.preventDefault();let r;s.isDir?r=[{label:o("upload_files"),onClick:()=>{le(s.path)}},{label:o("upload_folder"),onClick:()=>{ce(s.path)}},{label:o("download"),onClick:()=>{Ne(s.path)}}]:(r=[],(ye(s.name)||j(s.name))&&r.push({label:o("open"),onClick:()=>{j(s.name)?R(t.items,s):window.open(ge(q.value,s.path),"_blank")}}),r.push({label:o("download"),onClick:()=>{oe(s.path)}})),r.push({label:o("duplicate"),onClick:()=>{O([s]),G(t.dir)}}),r.push({label:o("cut"),onClick:()=>{s.panel=t,ae([s])}}),r.push({label:o("copy"),onClick:()=>{O([s])}}),s.isDir&&ne()&&r.push({label:o("paste"),onClick:()=>{G(s.path)}}),r=[...r,{label:o("rename"),onClick:()=>{xe.value=s.name,Me.value=s.path,P(Te,{title:o("rename"),placeholder:o("name"),value:s.name,mutation:Ee,getVariables:Pe,done:ze})}},{label:o("delete"),onClick:()=>{P(ke,{files:[s],onDone:H})}}],Ce({x:e.x,y:e.y,items:r})}const ue=e=>{e.status==="done"&&setTimeout(()=>{W(e.dir),A()},1e3)},de=e=>{H([e.item])};return Tt(()=>{L.on("upload_task_done",ue),L.on("file_deleted",de)}),wt(()=>{L.off("upload_task_done",ue),L.off("file_deleted",de)}),(e,t)=>{const s=ns,r=Zt,E=Wt,h=At,nt=Kt,at=Qt,lt=It,it=Ot,g=St("tooltip");return i(),c(b,null,[n("div",as,[n("div",ls,_(Je()),1),n("div",is,[w.value&&Xe.value?(i(),c(b,{key:0},[C((i(),c("button",{class:"btn-icon",onClick:t[0]||(t[0]=V(()=>l(O)(I()),["stop"]))},[cs,v(s)])),[[g,e.$t("copy")]]),C((i(),c("button",{class:"btn-icon",onClick:t[1]||(t[1]=V(()=>l(ae)(I()),["stop"]))},[rs,v(r)])),[[g,e.$t("cut")]]),C((i(),c("button",{class:"btn-icon",onClick:V(je,["stop"])},[us,v(E)])),[[g,e.$t("delete")]]),C((i(),c("button",{class:"btn-icon",onClick:V(Ke,["stop"])},[ds,v(h)])),[[g,e.$t("download")]])],64)):m("",!0),n("div",ps,[n("label",_s,[n("md-checkbox",{"touch-target":"wrapper",onChange:Ge,checked:w.value},null,40,ms),F(" "+_(e.$t("select_mode")),1)])]),n("div",hs,[n("label",fs,[n("md-checkbox",{"touch-target":"wrapper",onChange:Qe,checked:l(D)},null,40,bs),F(_(e.$t("show_hidden")),1)])]),C((i(),c("button",{class:"btn-icon btn-refresh",onClick:et},[vs,v(nt)])),[[g,e.$t("refresh")]]),v(lt,null,{content:ve(u=>[n("div",gs,[(i(!0),c(b,null,X(l(qe),a=>(i(),c("md-menu-item",{onClick:Q=>Ze(u,a.value),key:a.value,selected:a.value===l(U)},[n("div",Ts,_(e.$t(a.label)),1)],8,Cs))),128))])]),default:ve(()=>[C((i(),c("button",ks,[ys,v(at)])),[[g,e.$t("sort")]])]),_:1})])]),n("div",ws,[(i(!0),c(b,null,X(l(p),u=>(i(),c("div",{key:u.dir},[n("div",Ds,[(i(!0),c(b,null,X(u.items,a=>{var Q;return i(),c(b,{key:a.path},[!a.name.startsWith(".")||l(D)?(i(),c("div",{key:0,class:Vt(["file-item",{active:(l(M)+"/").startsWith(a.path+"/")||((Q=l(z))==null?void 0:Q.path)===a.path}]),onClick:K=>Ye(u,a),onDblclick:V(K=>tt(u,a),["prevent"]),onContextmenu:K=>ot(K,u,a)},[w.value?(i(),c("md-checkbox",{key:0,"touch-target":"wrapper",checked:a.checked},null,8,qs)):m("",!0),a.isDir?(i(),Ft(it,{key:1})):m("",!0),l(Bt)(a.name)||l(xt)(a.name)?(i(),c("img",{key:2,src:l(Mt)(a.fileId,"&w=50&h=50"),width:"50",height:"50",onerror:"this.src='/broken-image.png'"},null,8,Is)):m("",!0),n("div",Ss,[F(_(a.name)+" ",1),n("div",Vs,[F(_(l(zt)(a.updatedAt)),1),a.isDir?m("",!0):(i(),c(b,{key:0},[F(", "+_(l(k)(a.size)),1)],64))])])],42,$s)):m("",!0)],64)}),128)),n("div",{class:"empty",onContextmenu:a=>st(a,u.dir)},[u.items.filter(a=>!a.name.startsWith(".")||l(D)).length===0?(i(),c("div",Bs,_(e.$t("no_files")),1)):m("",!0)],40,Fs)])]))),128)),l(p).length===0?(i(),c("div",xs,_(e.$t(l(Et)(l(Se),l($).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):m("",!0)]),l(z)?(i(),c("div",Ms,_(e.$t("path"))+": "+_(l(z).path),1)):m("",!0),n("input",{ref_key:"fileInput",ref:Ae,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...u)=>l(ie)&&l(ie)(...u))},null,544),n("input",{ref_key:"dirFileInput",ref:He,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...u)=>l(re)&&l(re)(...u))},null,544)],64)}}}),Ws=Gt(zs,[["__scopeId","data-v-2f3eab3b"]]);export{Ws as default};
