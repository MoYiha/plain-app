import{_ as Re}from"./VPagination.vuevuetypescriptsetuptruelang-B4JWBRU5.js";import{m as xe,c,o as s,a as l,i as x,bj as Be,I as B,a4 as T,J as j,bk as je,e as Ge,f as Ke,r as R,u as Oe,K as Fe,L as Pe,bl as Je,M as Ze,N as We,k as i,j as D,R as r,l as e,t as $,T as w,O as h,P as Xe,p as _,y as d,U as Ye,S as de,bm as et,V as tt,as as st,bn as ot,E as at,bo as nt,a7 as lt,aU as it,aV as rt,Q as ct,F as ue,d as dt,bp as ut,Z as _t,$ as pt,a0 as mt,A as _e,a1 as pe,a2 as vt,aa as gt,bi as ht,ab as kt,a5 as me,a3 as ft,bq as bt,H as yt}from"./index-CextXMl7.js";import{_ as $t}from"./FieldId.vuevuetypescriptsetuptruelang-B-w7x5OO.js";import{_ as Tt,a as qt}from"./SearchInput-CrMMFD7Q.js";import{_ as Ct}from"./VIconButton.vuevuetypescriptsetuptruelang-BlGK_fBO.js";import{_ as wt}from"./VCheckbox-DS09yxvJ.js";import{u as Nt,b as Lt,a as St}from"./key-events-CRk-BMl_.js";import{u as Dt,a as Vt}from"./tags-DG3enOqx.js";import{u as Et}from"./search-CYaYXsFn.js";import"./VInputChip-CfY98YKA.js";const Mt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function At(E,k){return s(),c("svg",Mt,k[0]||(k[0]=[l("path",{fill:"currentColor",d:"M19 17.7v1.8q0 .2.15.35t.35.15t.35-.15t.15-.35v-3q0-.2-.15-.35T19.5 16h-3q-.2 0-.35.15t-.15.35t.15.35t.35.15h1.8l-2.45 2.45q-.15.15-.15.35t.15.35t.35.15t.35-.15zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v5q0 .425-.288.713T20 11t-.712-.288T19 10V5H5v14h5q.425 0 .713.288T11 20t-.288.713T10 21zm0-3v1V5v6.075V11zm2-2q0 .425.288.713T8 17h2.075q.425 0 .713-.288t.287-.712t-.287-.712t-.713-.288H8q-.425 0-.712.288T7 16m0-4q0 .425.288.713T8 13h5q.425 0 .713-.288T14 12t-.288-.712T13 11H8q-.425 0-.712.288T7 12m0-4q0 .425.288.713T8 9h8q.425 0 .713-.288T17 8t-.288-.712T16 7H8q-.425 0-.712.288T7 8m11 15q-2.075 0-3.537-1.463T13 18t1.463-3.537T18 13t3.538 1.463T23 18t-1.463 3.538T18 23"},null,-1)]))}const It=xe({name:"material-symbols-export-notes-outline-rounded",render:At}),Qt=(E,k)=>{const{mutate:m,onDone:M}=x({document:Be}),f=B(new Map);return M(n=>{f.delete(n.data.trashNotes),E(),k(),T.emit("refetch_tags",j.NOTE),T.emit("notes_actioned",{action:"trash"})}),{trashLoading(n){return f.get(n)??!1},trash(n){f.set(n,!0),m({query:n})}}},Ut=(E,k)=>{const{mutate:m,onDone:M}=x({document:je}),f=B(new Map);return M(n=>{f.delete(n.data.restoreNotes),E(),k(),T.emit("refetch_tags",j.NOTE),T.emit("notes_actioned",{action:"restore"})}),{restoreLoading(n){return f.get(n)??!1},restore(n){f.set(n,!0),m({query:n})}}},zt={class:"top-app-bar"},Ht={class:"title"},Rt={key:0},xt={key:1},Bt={class:"actions"},jt={key:0,class:"scroller"},Gt={class:"start"},Kt={class:"number"},Ot=["href"],Ft=["onClick","onMouseover"],Pt={class:"start"},Jt={class:"number"},Zt={class:"title"},Wt={class:"subtitle"},Xt={class:"actions"},Yt={class:"time"},es={key:2,class:"no-data-placeholder"},V=50,ts=Ge({__name:"NotesView",setup(E){var ne;const k=Ke(),m=R([]),{t:M}=Oe(),{parseQ:f}=Et(),n=B({tagIds:[],trash:!1}),N=j.NOTE,G=Fe(),K=G.query,U=R(parseInt(((ne=K.page)==null?void 0:ne.toString())??"1")),q=R(""),{tags:I,fetch:ve}=Dt(N),{selectedIds:y,allChecked:O,realAllChecked:L,selectRealAll:ge,allCheckedAlertVisible:he,clearSelection:C,toggleAllChecked:ke,toggleSelect:F,total:v,checked:z,shiftEffectingIds:P,handleItemClick:fe,handleMouseOver:be,selectAll:ye,shouldSelect:$e}=Nt(m),{addToTags:Te}=Vt(N,I),J=t=>{const o=G.query.q;_e(k,o?`/notes?page=${t}&q=${o}`:`/notes?page=${t}`)},{keyDown:Z,keyUp:W}=St(v,V,U,ye,C,J,()=>{X(y.value,L.value,v.value,q.value)}),{loading:H,fetch:S}=Pe({handle:(t,o)=>{o?at(M(o),"error"):t&&(m.value=t.notes,v.value=t.noteCount)},document:ot,variables:()=>({offset:(U.value-1)*V,limit:V,query:q.value})});function qe(t){pe(vt,{type:N,tags:I.value,item:{key:t.id,title:"",size:0},selected:I.value.filter(o=>t.tags.some(A=>A.id===o.id))})}function Ce(t){return t?`/notes?q=${t}`:"/notes"}const{mutate:we,onDone:Ne}=x({document:nt}),Le=()=>{we({query:Q()})},Q=()=>{let t=q.value;return L.value||(t=`ids:${y.value.join(",")}`),t};Ne(t=>{Je(t.data.exportNotes,"application/json","notes.json")});const{deleteItems:X}=Lt(bt,()=>{C(),S()});function Se(t){pe(kt,{id:t.id,name:ht(t.title,{length:20}),gql:gt`
      mutation DeleteNote($query: String!) {
        deleteNotes(query: $query)
      }
    `,variables:()=>({query:`ids:${t.id}`}),done:()=>{C(),v.value--},typeName:"Note"})}const{trashLoading:De,trash:Y}=Qt(C,S),{restoreLoading:ee,restore:te}=Ut(C,S);function Ve(t){_e(k,se(t))}function se(t){const o=me.currentRoute.value.query.q;return o?`/notes/${t.id}?q=${o}`:`/notes/${t.id}`}function Ee(){me.push("/notes/create")}const oe=t=>{t.type===N&&(C(),S())},ae=t=>{t.type===N&&S()};return Ze(()=>{var t;q.value=ft(((t=K.q)==null?void 0:t.toString())??""),f(n,q.value),n.trash===void 0&&(n.trash=!1),ve(),S(),T.on("item_tags_updated",ae),T.on("items_tags_updated",oe),window.addEventListener("keydown",Z),window.addEventListener("keyup",W)}),We(()=>{T.off("item_tags_updated",ae),T.off("items_tags_updated",oe),window.removeEventListener("keydown",Z),window.removeEventListener("keyup",W)}),(t,o)=>{const A=wt,le=lt,b=Ct,ie=it,re=rt,ce=ct,Me=It,Ae=Tt,Ie=st,Qe=qt,Ue=$t,ze=_t,He=Re,g=Xe("tooltip");return s(),c(w,null,[l("div",zt,[i(A,{"touch-target":"wrapper",checked:e(O),indeterminate:!e(O)&&e(z),onChange:e(ke)},null,8,["checked","indeterminate","onChange"]),l("div",Ht,[e(y).length?(s(),c("span",Rt,$(t.$t("x_selected",{count:e(L)?e(v).toLocaleString():e(y).length.toLocaleString()})),1)):(s(),c("span",xt,$(t.$t("page_title.notes"))+" ("+$(e(v).toLocaleString())+")",1)),e(z)?(s(),c(w,{key:2},[n.trash?(s(),c(w,{key:0},[h((s(),r(b,{onClick:o[0]||(o[0]=d(u=>e(X)(e(y),e(L),e(v),q.value),["stop"]))},{icon:_(()=>[i(le)]),_:1})),[[g,t.$t("delete")]]),h((s(),r(b,{loading:e(ee)(Q()),onClick:o[1]||(o[1]=d(u=>e(te)(Q()),["stop"]))},{icon:_(()=>[i(ie)]),_:1},8,["loading"])),[[g,t.$t("restore")]])],64)):(s(),c(w,{key:1},[h((s(),r(b,{onClick:o[2]||(o[2]=d(u=>e(Y)(Q()),["stop"]))},{icon:_(()=>[i(re)]),_:1})),[[g,t.$t("move_to_trash")]]),h((s(),r(b,{onClick:o[3]||(o[3]=d(u=>e(Te)(e(y),e(L),q.value),["stop"]))},{icon:_(()=>[i(ce)]),_:1})),[[g,t.$t("add_to_tags")]]),h((s(),r(b,{onClick:d(Le,["stop"])},{icon:_(()=>[i(Me)]),_:1})),[[g,t.$t("export_notes")]])],64))],64)):D("",!0)]),l("div",Bt,[i(Ae,{filter:n,tags:e(I),"get-url":Ce,"show-trash":!0},null,8,["filter","tags"]),n.trash?D("",!0):(s(),r(Ie,{key:0,class:"btn-sm",onClick:d(Ee,["prevent"])},{default:_(()=>[ue($(t.$t("create")),1)]),_:1}))])]),i(Qe,{limit:V,total:e(v),"all-checked-alert-visible":e(he),"real-all-checked":e(L),"select-real-all":e(ge),"clear-selection":e(C)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(H)&&m.value.length===0?(s(),c("div",jt,[(s(),c(w,null,Ye(20,u=>l("article",{key:u,class:"note-item selectable-card-skeleton"},[l("div",Gt,[o[4]||(o[4]=l("div",{class:"checkbox"},[l("div",{class:"skeleton-checkbox"})],-1)),l("span",Kt,$(u),1)]),o[5]||(o[5]=dt('<div class="title" data-v-b87d0a8b><div class="skeleton-text skeleton-title" data-v-b87d0a8b></div></div><div class="subtitle" data-v-b87d0a8b><div class="skeleton-text skeleton-subtitle" data-v-b87d0a8b></div></div><div class="actions" data-v-b87d0a8b><div class="skeleton-text skeleton-actions" data-v-b87d0a8b></div></div><div class="time" data-v-b87d0a8b><div class="skeleton-text skeleton-time" data-v-b87d0a8b></div></div>',4))])),64))])):D("",!0),m.value.length?(s(),r(e(et),{key:1,class:de(["scroller",{"select-mode":e(z)}]),"data-key":"id","data-sources":m.value,"estimate-size":100},{item:_(({index:u,item:a})=>[(s(),c("a",{key:a.id,class:"item-link",href:se(a)},[l("article",{class:de(["note-item selectable-card",{selected:e(y).includes(a.id)||a.id==t.$route.params.id,selecting:e(P).includes(a.id)}]),onClick:d(p=>e(fe)(p,a,u,()=>{Ve(a)}),["stop","prevent"]),onMouseover:p=>e(be)(p,u)},[l("div",Pt,[e(P).includes(a.id)?(s(),r(A,{key:0,class:"checkbox","touch-target":"wrapper",checked:e($e),onClick:d(p=>e(F)(p,a,u),["stop"])},null,8,["checked","onClick"])):(s(),r(A,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(y).includes(a.id),onClick:d(p=>e(F)(p,a,u),["stop"])},null,8,["checked","onClick"])),l("span",Jt,[i(Ue,{id:u+1,raw:a},null,8,["id","raw"])])]),l("div",Zt,$(e(ut)(a.title.split(`
`)[0].trimStart())||t.$t("meta_no_title")),1),l("div",Wt,[i(ze,{tags:a.tags,type:e(N),"only-links":!0},null,8,["tags","type"])]),l("div",Xt,[n.trash?(s(),c(w,{key:0},[h((s(),r(b,{class:"sm",onClick:d(p=>Se(a),["stop","prevent"])},{icon:_(()=>[i(le)]),_:2},1032,["onClick"])),[[g,t.$t("delete")]]),h((s(),r(b,{class:"sm",loading:e(ee)(`ids:${a.id}`),onClick:d(p=>e(te)(`ids:${a.id}`),["stop","prevent"])},{icon:_(()=>[i(ie)]),_:2},1032,["loading","onClick"])),[[g,t.$t("restore")]])],64)):(s(),c(w,{key:1},[h((s(),r(b,{class:"sm",loading:e(De)(`ids:${a.id}`),onClick:d(p=>e(Y)(`ids:${a.id}`),["stop","prevent"])},{icon:_(()=>[i(re)]),_:2},1032,["loading","onClick"])),[[g,t.$t("move_to_trash")]]),h((s(),r(b,{class:"sm",onClick:d(p=>qe(a),["stop","prevent"])},{icon:_(()=>[i(ce)]),_:2},1032,["onClick"])),[[g,t.$t("add_to_tags")]])],64))]),l("div",Yt,[h((s(),c("span",null,[ue($(e(mt)(a.updatedAt)),1)])),[[g,e(pt)(a.updatedAt)]])])],42,Ft)],8,Ot))]),footer:_(()=>[e(v)>V?(s(),r(He,{key:0,page:U.value,go:J,total:e(v),limit:V},null,8,["page","total"])):D("",!0)]),_:1},8,["data-sources","class"])):D("",!0),!e(H)&&m.value.length===0?(s(),c("div",es,$(t.$t(e(tt)(e(H)))),1)):D("",!0)],64)}}}),_s=yt(ts,[["__scopeId","data-v-b87d0a8b"]]);export{_s as default};
