import{_ as Re}from"./VPagination.vuevuetypescriptsetuptruelang-BzK-L-Ey.js";import{a1 as z,e as je,r as I,s as ie,g as He,ae as Oe,af as Je,f as We,u as Xe,G as Ye,I as Ze,ag as et,H as tt,i as de,J as ce,K as st,L as at,c as o,o as l,a as n,k as g,l as s,p as _,j as q,t as i,M as nt,y as r,ah as lt,a2 as pe,ai as ot,O as re,aj as it,P as ue,Q as L,R as K,S as dt,ak as ct,al as pt,D as F,am as rt,an as ut,ao as _t,ap as vt,n as kt,X as Q,a5 as mt,aq as gt,ar as _e,W as ve,d as ft,z as ht,a0 as yt,F as bt}from"./index-BaWXnnLZ.js";import{_ as wt}from"./FieldId.vuevuetypescriptsetuptruelang-eOYRhci9.js";import{_ as $t,a as Ct}from"./SearchInput-Cq5_Bnx2.js";import{_ as St,a as Dt}from"./upload-rounded-BleGzatb.js";import{u as At,a as It}from"./key-events-B0Jq4BkE.js";import{u as Lt}from"./search-brnXFXDL.js";import"./search-rounded-Dmop53vQ.js";const b=$=>{z.emit("tap_phone",$)};function Pt($,c){const C=$.findIndex(S=>S.id===c);C!==-1&&$.splice(C,1)}const Ut={class:"top-app-bar"},Nt=["checked","indeterminate"],qt={class:"title"},Ft={key:0},Bt={key:1},Et={class:"actions"},Mt=["disabled"],Tt={key:0,indeterminate:""},xt={class:"menu-items"},Vt=["selected","onClick"],Kt={slot:"headline"},Qt=["onClick","onMouseover"],zt={class:"start"},Gt=["checked","onClick"],Rt=["checked","onClick"],jt={class:"number"},Ht=["src"],Ot={class:"title"},Jt={class:"subtitle"},Wt={class:"actions"},Xt={indeterminate:"",class:"spinner-sm"},Yt=["onClick"],Zt=["onClick"],es=["onClick"],ts={class:"time"},ss={class:"start"},as={class:"number"},ns={key:0,class:"no-data-placeholder"},w=50,ls=je({__name:"AppsView",setup($){var oe;const c=I([]),{app:C,urlTokenKey:S,uploads:G}=ie(He()),{input:ke,upload:me,uploadChanged:R}=Oe(G),{dropping:ge,fileDragEnter:j,fileDragLeave:H,dropFiles:fe}=Je(G),O=We(),v=I([]),{t:f}=Xe(),{appSortBy:P}=ie(O),{parseQ:he}=Lt(),J=Ye({tagIds:[]}),ye=vt(),U=I(!1),W=Ze(),X=W.query,B=I(parseInt(((oe=X.page)==null?void 0:oe.toString())??"1")),N=I(""),{selectedIds:D,allChecked:Y,realAllChecked:E,selectRealAll:be,allCheckedAlertVisible:we,clearSelection:M,toggleAllChecked:Z,toggleSelect:ee,total:h,checked:T,shiftEffectingIds:te,handleItemClick:$e,handleMouseOver:Ce,selectAll:Se,shouldSelect:De}=At(v),{downloadItems:Ae}=et(S,tt.PACKAGE,M,"apps.zip"),{downloadFile:Ie}=gt(S),x=e=>{const t=W.query.q;ht(O,t?`/apps?page=${e}&q=${t}`:`/apps?page=${e}`)},{keyDown:se,keyUp:ae}=It(h,w,B,Se,M,x,()=>{}),Le=()=>{me(C.value.downloadsDir)},{mutate:Pe}=de({document:ct}),Ue=["user","system"].map(e=>({id:e,name:f("app_type."+e)})),Ne=e=>{e.isUninstalling=!1},{loading:V,fetch:ne}=ce({handle:(e,t)=>{U.value=!1,t?F(f(t),"error"):e&&(v.value=e.packages.map(d=>({...d,isUninstalling:!1,icon:rt(S.value,"pkgicon://"+d.id)})),h.value=e.packageCount)},document:pt,variables:()=>({offset:(B.value-1)*w,limit:w,query:N.value,sortBy:P.value})});function qe(e){return e?`/apps?q=${e}`:"/apps"}function Fe(e,t){if(P.value===t){e.close();return}U.value=!0,P.value=t,x(1),e.close()}const{mutate:Be}=de({document:ut});function Ee(e){e.isUninstalling=!0,b(f("confirm_uninstallation_on_phone")),Be({id:e.id})}const{loading:Me,fetch:Te}=ce({handle:e=>{if(e)for(const t of e.packageStatuses){const d=c.value.find(k=>k.id===t.id);if(d){const k=d.isNew&&t.exist,A=!d.isNew&&t.exist&&d.updatedAt<t.updatedAt;(k||A)&&(c.value=c.value.filter(y=>y.id!==t.id),b(""),k?F(f("app_installation_completed"),"success"):F(f("app_upgrade_completed"),"success"),ne())}else t.exist||(Pt(v.value,t.id),b(""))}},document:_t,variables:()=>({ids:[...v.value.filter(e=>e.isUninstalling).map(e=>e.id),...c.value.map(e=>e.id)]})}),le=e=>{e.status==="done"&&Pe({path:e.dir+"/"+e.fileName}).then(t=>{if(b(f("confirm_installation_on_phone")),t&&t.data&&t.data.installPackage){const{packageName:d,updatedAt:k,isNew:A}=t.data.installPackage;d&&(c.value.push({id:d,updatedAt:k,isNew:A}),setTimeout(()=>{c.value.some(y=>y.id===d)&&(c.value=c.value.filter(y=>y.id!==d),b(""))},12e4))}}).catch(t=>{b(""),F(f("app_installation_failed")+": "+t.message,"error")})};function xe(e){fe(e,C.value.downloadsDir,"application")}return st(()=>{var e;setInterval(()=>{(v.value.some(t=>t.isUninstalling)||c.value.length>0)&&!Me.value&&Te()},1e3),N.value=yt(((e=X.q)==null?void 0:e.toString())??""),he(J,N.value),ne(),z.on("upload_task_done",le),window.addEventListener("keydown",se),window.addEventListener("keyup",ae)}),at(()=>{z.off("upload_task_done",le),window.removeEventListener("keydown",se),window.removeEventListener("keyup",ae)}),(e,t)=>{const d=lt,k=$t,A=St,y=Dt,Ve=ot,Ke=Ct,Qe=wt,ze=mt,Ge=Re,m=nt("tooltip");return l(),o(L,null,[n("div",Ut,[n("md-checkbox",{"touch-target":"wrapper",checked:s(Y),indeterminate:!s(Y)&&s(T),onChange:t[0]||(t[0]=(...a)=>s(Z)&&s(Z)(...a))},null,40,Nt),n("div",qt,[s(D).length?(l(),o("span",Ft,i(e.$t("x_selected",{count:s(E)?s(h).toLocaleString():s(D).length.toLocaleString()})),1)):(l(),o("span",Bt,i(e.$t("page_title.apps"))+" ("+i(s(h).toLocaleString())+")",1)),s(T)?_((l(),o("button",{key:2,class:"btn-icon",onClick:t[1]||(t[1]=r(a=>s(Ae)(s(E),s(D),N.value),["stop"]))},[t[5]||(t[5]=n("md-ripple",null,null,-1)),g(d)])),[[m,e.$t("download")]]):q("",!0)]),n("div",Et,[g(k,{filter:J,types:s(Ue),"get-url":qe},null,8,["filter","types"]),_((l(),o("button",{class:"btn-icon",onClick:r(Le,["stop"])},[t[6]||(t[6]=n("md-ripple",null,null,-1)),g(A)])),[[m,e.$t("install_app")]]),g(Ve,null,{content:pe(a=>[n("div",xt,[(l(!0),o(L,null,K(s(ye),u=>(l(),o("md-menu-item",{key:u.value,selected:u.value===s(P),onClick:p=>Fe(a,u.value)},[n("div",Kt,i(e.$t(u.label)),1)],8,Vt))),128))])]),default:pe(()=>[_((l(),o("button",{class:"btn-icon btn-sort",disabled:U.value},[t[7]||(t[7]=n("md-ripple",null,null,-1)),U.value?(l(),o("md-circular-progress",Tt)):(l(),re(y,{key:1}))],8,Mt)),[[m,e.$t("sort")]])]),_:1})])]),g(Ke,{limit:w,total:s(h),"all-checked-alert-visible":s(we),"real-all-checked":s(E),"select-real-all":s(be),"clear-selection":s(M)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),n("div",{class:"scroll-content",onDragover:t[4]||(t[4]=r((...a)=>s(j)&&s(j)(...a),["stop","prevent"]))},[_(n("div",{class:"drag-mask",onDrop:r(xe,["stop","prevent"]),onDragleave:t[2]||(t[2]=r((...a)=>s(H)&&s(H)(...a),["stop","prevent"]))},i(e.$t("release_to_send_files")),545),[[it,s(ge)]]),n("div",{class:ue(["app-list",{"select-mode":s(T)}])},[(l(!0),o(L,null,K(v.value,(a,u)=>(l(),o("section",{key:a.id,class:ue(["app-item selectable-card",{selected:s(D).includes(a.id),selecting:s(te).includes(a.id)}]),onClick:r(p=>s($e)(p,a,u,()=>{}),["stop"]),onMouseover:p=>s(Ce)(p,u)},[n("div",zt,[s(te).includes(a.id)?(l(),o("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:s(De),onClick:r(p=>s(ee)(p,a,u),["stop"])},null,8,Gt)):(l(),o("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:s(D).includes(a.id),onClick:r(p=>s(ee)(p,a,u),["stop"])},null,8,Rt)),n("span",jt,[g(Qe,{id:u+1,raw:a},null,8,["id","raw"])])]),n("img",{class:"image",width:"50",height:"50",src:a.icon},null,8,Ht),n("div",Ot,i(a.name)+" ("+i(a.version)+")",1),n("div",Jt,[n("span",null,i(a.id),1),n("span",null,i(s(kt)(a.size)),1),n("span",null,i(e.$t("app_type."+a.type)),1)]),n("div",Wt,[a.isUninstalling?(l(),o(L,{key:0},[_(n("md-circular-progress",Xt,null,512),[[m,e.$t("uninstalling")]]),t[8]||(t[8]=Q(" Â ")),n("md-outlined-button",{class:"btn-sm",onClick:r(p=>Ne(a),["stop"])},i(e.$t("cancel")),9,Yt)],64)):_((l(),o("button",{key:1,class:"btn-icon sm",onClick:r(p=>Ee(a),["stop"])},[t[9]||(t[9]=n("md-ripple",null,null,-1)),g(ze)],8,Zt)),[[m,e.$t("uninstall")]]),_((l(),o("button",{class:"btn-icon sm",onClick:r(p=>s(Ie)(a.path,`${a.name.replace(" ","")}-${a.id}.apk`),["stop"])},[t[10]||(t[10]=n("md-ripple",null,null,-1)),g(d)],8,es)),[[m,e.$t("download")]])]),n("div",ts,[_((l(),o("span",null,[Q(i(e.$t("installed_at"))+": "+i(s(ve)(a.installedAt)),1)])),[[m,s(_e)(a.installedAt)]]),_((l(),o("span",null,[Q(i(e.$t("updated_at"))+": "+i(s(ve)(a.updatedAt)),1)])),[[m,s(_e)(a.updatedAt)]])])],42,Qt))),128)),s(V)&&v.value.length===0?(l(),o(L,{key:0},K(20,a=>n("section",{key:a,class:"app-item selectable-card-skeleton"},[n("div",ss,[t[11]||(t[11]=n("div",{class:"checkbox"},[n("div",{class:"skeleton-checkbox"})],-1)),n("span",as,i(a),1)]),t[12]||(t[12]=ft('<div class="image" data-v-23ed87a5><div class="skeleton-image" data-v-23ed87a5></div></div><div class="title" data-v-23ed87a5><div class="skeleton-text skeleton-title" data-v-23ed87a5></div></div><div class="subtitle" data-v-23ed87a5><div class="skeleton-text skeleton-subtitle" data-v-23ed87a5></div></div><div class="actions" data-v-23ed87a5><div class="skeleton-text skeleton-actions" data-v-23ed87a5></div></div><div class="time" data-v-23ed87a5><div class="skeleton-text skeleton-time" data-v-23ed87a5></div><div class="skeleton-text skeleton-time" data-v-23ed87a5></div></div>',5))])),64)):q("",!0)],2),!s(V)&&v.value.length===0?(l(),o("div",ns,i(e.$t(s(dt)(s(V)))),1)):q("",!0),s(h)>w?(l(),re(Ge,{key:1,page:B.value,go:x,total:s(h),limit:w},null,8,["page","total"])):q("",!0),n("input",{ref_key:"fileInput",ref:ke,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:t[3]||(t[3]=(...a)=>s(R)&&s(R)(...a))},null,544)],32)],64)}}}),vs=bt(ls,[["__scopeId","data-v-23ed87a5"]]);export{vs as default};
