import{_ as ye}from"./VPagination.vuevuetypescriptsetuptruelang-C9URNuao.js";import{d as fe,u as be,s as we,i as Ce,h as w,g as Se,I as Te,J as $e,K as Le,j as Me,L as Ie,M as Ae,c as n,a,m as e,t as d,x as C,w as p,p as r,e as F,N as O,O as j,P as De,v as qe,Q as Ee,f as Ve,C as Ue,R as Be,B as Re,S as He,o,T as Ke,U as Ne,V as Qe,W as xe,X as ze,F as Ge,G as Pe,Y as Fe,Z as Oe,$ as je,a0 as S,a1 as Je,a2 as We,a3 as Xe,H as Ye}from"./index-BxNI00MG.js";import{_ as Ze}from"./call-outline-rounded-CD5u8H3j.js";import{u as es,_ as ss,a as ts,b as as}from"./key-events-B5RXeznw.js";import{u as os,a as ns}from"./tags-BUfgTqH4.js";import{u as ls}from"./search-D1_YTViL.js";import"./rss-feed-rounded-Dj4EQ17i.js";import"./vee-validate.esm-9czZ1sUw.js";const A=h=>(Ge("data-v-e043523c"),h=h(),Pe(),h),cs={class:"top-app-bar"},is=["checked","indeterminate"],ds={class:"title"},rs={key:0},_s={key:1},ps=A(()=>a("md-ripple",null,null,-1)),us={class:"actions"},ms={class:"scroll-content"},gs=["onClick","onMouseover"],hs={class:"start"},ks=["onClick","checked"],vs=["onClick","checked"],ys={class:"number"},fs={class:"title"},bs=["innerHTML"],ws={class:"actions"},Cs=["onClick"],Ss=A(()=>a("md-ripple",null,null,-1)),Ts={key:0,indeterminate:"",class:"spinner-sm"},$s=["onClick"],Ls=A(()=>a("md-ripple",null,null,-1)),Ms={class:"info"},Is={class:"time"},As={key:1,class:"no-data-placeholder"},u=50,Ds=fe({__name:"MessagesView",setup(h){var P;const J=be(),{app:W}=we(Ce()),k=w([]),{t:D}=Se(),{parseQ:X}=ls(),q=Te({tagIds:[]}),_=$e.SMS,E=Ee(),V=E.query,T=w(parseInt(((P=V.page)==null?void 0:P.toString())??"1")),v=w(""),{tags:y,fetch:Y}=os(_),{addToTags:Z}=ns(_,y),{selectedIds:m,allChecked:U,realAllChecked:$,selectRealAll:ee,allCheckedAlertVisible:se,clearSelection:L,toggleAllChecked:B,toggleSelect:R,total:i,checked:M,shiftEffectingIds:H,handleItemClick:te,handleMouseOver:ae,selectAll:oe,shouldSelect:ne}=es(k),K=s=>{const l=E.query.q;Ve(J,l?`/messages?page=${s}&q=${l}`:`/messages?page=${s}`)},{keyDown:N,keyUp:Q}=as(i,u,T,oe,L,K,()=>{}),{loading:le,fetch:I}=Le({handle:(s,l)=>{l?Ue(D(l),"error"):s&&(k.value=s.messages,i.value=s.messageCount)},document:Be,variables:()=>({offset:(T.value-1)*u,limit:u,query:v.value}),appApi:!0}),ce=["1","2","3"].map(s=>({id:s,name:D("message_type."+s)}));function ie(s){Fe(Oe,{type:_,tags:y.value,item:{key:s.id,title:"",size:0},selected:y.value.filter(l=>s.tags.some(f=>f.id===l.id))})}const x=w(""),{mutate:de,loading:re}=Me({document:Re,appApi:!0});function _e(s){x.value=s.id,de({number:s.address})}function pe(s){return s?`/messages?q=${s}`:"/messages"}const z=s=>{s.type===_&&(L(),I())},G=s=>{s.type===_&&I()};return Ie(()=>{var s;v.value=je(((s=V.q)==null?void 0:s.toString())??""),X(q,v.value),Y(),I(),S.on("item_tags_updated",G),S.on("items_tags_updated",z),window.addEventListener("keydown",N),window.addEventListener("keyup",Q)}),Ae(()=>{S.off("item_tags_updated",G),S.off("items_tags_updated",z),window.removeEventListener("keydown",N),window.removeEventListener("keyup",Q)}),(s,l)=>{const f=Je,ue=ss,me=ts,ge=We,he=Ze,ke=Xe,ve=ye,b=He("tooltip");return o(),n(j,null,[a("div",cs,[a("md-checkbox",{"touch-target":"wrapper",onChange:l[0]||(l[0]=(...t)=>e(B)&&e(B)(...t)),checked:e(U),indeterminate:!e(U)&&e(M)},null,40,is),a("div",ds,[e(m).length?(o(),n("span",rs,d(s.$t("x_selected",{count:e($)?e(i).toLocaleString():e(m).length.toLocaleString()})),1)):(o(),n("span",_s,d(s.$t("page_title.messages"))+" ("+d(e(i).toLocaleString())+")",1)),e(M)?C((o(),n("button",{key:2,class:"btn-icon",onClick:l[1]||(l[1]=p(t=>e(Z)(e(m),e($),v.value),["stop"]))},[ps,r(f)])),[[b,s.$t("add_to_tags")]]):F("",!0)]),a("div",us,[r(ue,{filter:q,tags:e(y),types:e(ce),"get-url":pe},null,8,["filter","tags","types"])])]),r(me,{limit:u,total:e(i),"all-checked-alert-visible":e(se),"real-all-checked":e($),"select-real-all":e(ee),"clear-selection":e(L)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",ms,[k.value.length?(o(),n("div",{key:0,class:O(["sms-list",{"select-mode":e(M)}])},[(o(!0),n(j,null,De(k.value,(t,g)=>(o(),n("section",{class:O(["sms-item selectable-card",{selected:e(m).includes(t.id),selecting:e(H).includes(t.id)}]),key:t.id,onClick:p(c=>e(te)(c,t,g,()=>{}),["stop"]),onMouseover:c=>e(ae)(c,g)},[a("div",hs,[e(H).includes(t.id)?(o(),n("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:p(c=>e(R)(c,t,g),["stop"]),checked:e(ne)},null,8,ks)):(o(),n("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:p(c=>e(R)(c,t,g),["stop"]),checked:e(m).includes(t.id)},null,8,vs)),a("span",ys,[r(ge,{id:g+1,raw:t},null,8,["id","raw"])])]),a("div",fs,d(t.address),1),a("div",{class:"subtitle",innerHTML:e(Ke)(t.body)},null,8,bs),a("div",ws,[C((o(),n("button",{class:"btn-icon sm",onClick:p(c=>ie(t),["stop"])},[Ss,r(f)],8,Cs)),[[b,s.$t("add_to_tags")]]),e(re)&&x.value===t.id?(o(),n("md-circular-progress",Ts)):C((o(),n("button",{key:1,class:"btn-icon sm",onClick:p(c=>_e(t),["stop"])},[Ls,r(he)],8,$s)),[[b,s.$t("make_a_phone_call")]])]),a("div",Ms,[a("span",null,d(s.$t(`message_type.${t.type}`)),1),r(ke,{tags:t.tags,type:e(_),"only-links":!0},null,8,["tags","type"])]),a("div",Is,[C((o(),n("span",null,[Qe(d(e(xe)(t.date)),1)])),[[b,e(Ne)(t.date)]])])],42,gs))),128))],2)):(o(),n("div",As,d(s.$t(e(ze)(e(le),e(W).permissions,"READ_SMS"))),1)),e(i)>u?(o(),qe(ve,{key:2,page:T.value,go:K,total:e(i),limit:u},null,8,["page","total"])):F("",!0)])],64)}}}),Ns=Ye(Ds,[["__scopeId","data-v-e043523c"]]);export{Ns as default};
