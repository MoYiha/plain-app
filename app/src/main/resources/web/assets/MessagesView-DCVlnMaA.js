import{_ as ye}from"./VPagination.vuevuetypescriptsetuptruelang-CEZVU5HQ.js";import{e as Ce,f as $e,s as we,g as Te,r as y,u as Se,I as Le,J as Me,K as Ae,L as De,i as Ie,M as qe,N as xe,c as l,o,a,k as i,l as e,O as Ee,P as C,j as $,t as d,Q as Ve,y as u,R as Ue,S as w,T as j,U as q,V as J,W as Ne,X as Re,E as Be,G as He,Y as Ke,Z as Qe,$ as ze,a0 as Ge,F as Pe,a1 as Fe,d as Oe,A as je,a2 as Je,a3 as We,a4 as Xe,a5 as T,H as Ye}from"./index-CuU5w3Fk.js";import{_ as Ze}from"./call-outline-rounded-BecyQYRR.js";import{_ as es}from"./FieldId.vuevuetypescriptsetuptruelang-BAr-ccW2.js";import{_ as ss,a as ts}from"./SearchInput-Do4mYLNe.js";import{u as as,a as os}from"./tags-C_c-1fHE.js";import{u as ns,a as ls}from"./key-events-CMYOn2tc.js";import{u as cs}from"./search-cTEMyIe9.js";import"./VInputChip-Cze1-7DF.js";const is={class:"top-app-bar"},ds={class:"title"},rs={key:0},_s={key:1},us={class:"actions"},ps={class:"scroll-content"},vs=["onClick","onMouseover"],ms={class:"start"},gs={class:"number"},fs={class:"title"},ks=["innerHTML"],hs={class:"actions"},bs=["onClick"],ys=["onClick"],Cs={class:"info"},$s={class:"time"},ws={class:"start"},Ts={class:"number"},Ss={key:0,class:"no-data-placeholder"},p=50,Ls=Ce({__name:"MessagesView",setup(Ms){var F;const W=$e(),{app:X}=we(Te()),v=y([]),{t:x}=Se(),{parseQ:Y}=cs(),E=Le({tagIds:[]}),_=Me.SMS,V=Ae(),U=V.query,S=y(parseInt(((F=U.page)==null?void 0:F.toString())??"1")),k=y(""),{tags:h,fetch:Z}=as(_),{addToTags:ee}=os(_,h),{selectedIds:m,allChecked:N,realAllChecked:L,selectRealAll:se,allCheckedAlertVisible:te,clearSelection:M,toggleAllChecked:ae,toggleSelect:R,total:r,checked:A,shiftEffectingIds:B,handleItemClick:oe,handleMouseOver:ne,selectAll:le,shouldSelect:ce}=ns(v),H=s=>{const n=V.query.q;je(W,n?`/messages?page=${s}&q=${n}`:`/messages?page=${s}`)},{keyDown:K,keyUp:Q}=ls(r,p,S,le,M,H,()=>{}),{loading:D,fetch:I}=De({handle:(s,n)=>{n?Be(x(n),"error"):s&&(v.value=s.messages,r.value=s.messageCount)},document:Re,variables:()=>({offset:(S.value-1)*p,limit:p,query:k.value})}),ie=["1","2","3"].map(s=>({id:s,name:x("message_type."+s)}));function de(s){Je(We,{type:_,tags:h.value,item:{key:s.id,title:"",size:0},selected:h.value.filter(n=>s.tags.some(g=>g.id===n.id))})}const z=y(""),{mutate:re,loading:_e}=Ie({document:He});function ue(s){z.value=s.id,re({number:s.address})}function pe(s){return s?`/messages?q=${s}`:"/messages"}const G=s=>{s.type===_&&(M(),I())},P=s=>{s.type===_&&I()};return qe(()=>{var s;k.value=Xe(((s=U.q)==null?void 0:s.toString())??""),Y(E,k.value),Z(),I(),T.on("item_tags_updated",P),T.on("items_tags_updated",G),window.addEventListener("keydown",K),window.addEventListener("keyup",Q)}),xe(()=>{T.off("item_tags_updated",P),T.off("items_tags_updated",G),window.removeEventListener("keydown",K),window.removeEventListener("keyup",Q)}),(s,n)=>{const g=Ee,O=Ue,ve=ss,me=ts,ge=es,fe=Qe,ke=Ze,he=ze,be=ye,b=Ve("tooltip");return o(),l(q,null,[a("div",is,[i(g,{"touch-target":"wrapper",checked:e(N),indeterminate:!e(N)&&e(A),onChange:e(ae)},null,8,["checked","indeterminate","onChange"]),a("div",ds,[e(m).length?(o(),l("span",rs,d(s.$t("x_selected",{count:e(L)?e(r).toLocaleString():e(m).length.toLocaleString()})),1)):(o(),l("span",_s,d(s.$t("page_title.messages"))+" ("+d(e(r).toLocaleString())+")",1)),e(A)?C((o(),l("button",{key:2,class:"btn-icon",onClick:n[0]||(n[0]=u(t=>e(ee)(e(m),e(L),k.value),["stop"]))},[i(O)])),[[b,s.$t("add_to_tags")]]):$("",!0)]),a("div",us,[i(ve,{filter:E,tags:e(h),types:e(ie),"get-url":pe},null,8,["filter","tags","types"])])]),i(me,{limit:p,total:e(r),"all-checked-alert-visible":e(te),"real-all-checked":e(L),"select-real-all":e(se),"clear-selection":e(M)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",ps,[a("div",{class:j(["sms-list",{"select-mode":e(A)}])},[(o(!0),l(q,null,J(v.value,(t,f)=>(o(),l("section",{key:t.id,class:j(["sms-item selectable-card",{selected:e(m).includes(t.id),selecting:e(B).includes(t.id)}]),onClick:u(c=>e(oe)(c,t,f,()=>{}),["stop"]),onMouseover:c=>e(ne)(c,f)},[a("div",ms,[e(B).includes(t.id)?(o(),w(g,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(ce),onClick:u(c=>e(R)(c,t,f),["stop"])},null,8,["checked","onClick"])):(o(),w(g,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(m).includes(t.id),onClick:u(c=>e(R)(c,t,f),["stop"])},null,8,["checked","onClick"])),a("span",gs,[i(ge,{id:f+1,raw:t},null,8,["id","raw"])])]),a("div",fs,d(t.address),1),a("div",{class:"subtitle",innerHTML:e(Ke)(t.body)},null,8,ks),a("div",hs,[C((o(),l("button",{class:"btn-icon sm",onClick:u(c=>de(t),["stop"])},[i(O)],8,bs)),[[b,s.$t("add_to_tags")]]),e(_e)&&z.value===t.id?(o(),w(fe,{key:0,indeterminate:"",class:"sm"})):C((o(),l("button",{key:1,class:"btn-icon sm",onClick:u(c=>ue(t),["stop"])},[i(ke)],8,ys)),[[b,s.$t("make_a_phone_call")]])]),a("div",Cs,[a("span",null,d(s.$t(`message_type.${t.type}`)),1),i(he,{tags:t.tags,type:e(_),"only-links":!0},null,8,["tags","type"])]),a("div",$s,[C((o(),l("span",null,[Pe(d(e(Fe)(t.date)),1)])),[[b,e(Ge)(t.date)]])])],42,vs))),128)),e(D)&&v.value.length===0?(o(),l(q,{key:0},J(20,t=>a("section",{key:t,class:"sms-item selectable-card-skeleton"},[a("div",ws,[n[1]||(n[1]=a("div",{class:"checkbox"},[a("div",{class:"skeleton-checkbox"})],-1)),a("span",Ts,d(t),1)]),n[2]||(n[2]=Oe('<div class="title" data-v-f5fbb585><div class="skeleton-text skeleton-title" data-v-f5fbb585></div></div><div class="subtitle" data-v-f5fbb585><div class="skeleton-text skeleton-subtitle" data-v-f5fbb585></div><div class="skeleton-text skeleton-subtitle" data-v-f5fbb585></div></div><div class="actions" data-v-f5fbb585><div class="skeleton-text skeleton-actions" data-v-f5fbb585></div></div><div class="info" data-v-f5fbb585><div class="skeleton-text skeleton-info" data-v-f5fbb585></div></div><div class="time" data-v-f5fbb585><div class="skeleton-text skeleton-time" data-v-f5fbb585></div></div>',5))])),64)):$("",!0)],2),!e(D)&&v.value.length===0?(o(),l("div",Ss,d(s.$t(e(Ne)(e(D),e(X).permissions,"READ_SMS"))),1)):$("",!0),e(r)>p?(o(),w(be,{key:1,page:S.value,go:H,total:e(r),limit:p},null,8,["page","total"])):$("",!0)])],64)}}}),Rs=Ye(Ls,[["__scopeId","data-v-f5fbb585"]]);export{Rs as default};
