import{e as re,u as ue,r as f,g as _e,s as pe,i as ve,at as he,L as ke,M as me,N as fe,c as a,o,a as n,j as g,R as T,k as _,O as y,l as s,t as i,P as ge,y as p,aj as ye,T as H,U as be,p as D,bp as we,V as Ee,bI as Ce,bU as Ie,E as Te,bH as De,d as Le,S as Se,bK as O,aH as Ve,n as $e,$ as Fe,F as Ae,a0 as Ne,bL as Re,bV as Ue,bP as xe,ao as Me,bQ as Be,bR as Ke,bM as ze,a4 as v,bT as He}from"./index-Eg2Dz6vI.js";import{_ as Oe}from"./FieldId.vuevuetypescriptsetuptruelang-lzcc_jvg.js";import{_ as Qe}from"./VCheckbox-BuMj4nO3.js";import{u as Ge,c as Pe}from"./key-events-BNPqExTk.js";const je={class:"top-app-bar"},Je={key:0},We={key:1},Xe={key:0,class:"scroller"},qe={class:"start"},Ye={class:"number"},Ze=["onClick","onMouseover"],es={class:"start"},ss={class:"number"},ts=["onClick"],os={key:0,class:"svg",src:O},ns=["src","onError"],as=["src","onError"],ls={key:3,class:"svg",src:O},cs={class:"title"},is={class:"subtitle"},ds={class:"actions"},rs=["onClick"],us={class:"btn-icon sm"},_s={class:"card card-info"},ps={class:"key-value vertical"},vs={class:"key"},hs={class:"value"},ks={key:2,class:"no-data-placeholder"},ws=re({__name:"FilesRecentView",setup(ms){const{t:Q}=ue(),G=f([]),L=_e(),{app:P,urlTokenKey:b}=pe(L),r=f([]),{selectedIds:h,allChecked:S,realAllChecked:j,clearSelection:w,toggleAllChecked:J,toggleSelect:V,total:E,checked:$,shiftEffectingIds:F,handleItemClick:W,handleMouseOver:X,selectAll:q,shouldSelect:Y}=Ge(r),{downloadFile:A,downloadFiles:Z}=he(b),{view:ee}=Ke(G,(e,l)=>{L.lightbox={sources:e,index:l,visible:!0}}),{keyDown:N,keyUp:R}=Pe(q,w,()=>{}),U=f([]),x=f([]),se=e=>{U.value.push(e)},te=e=>{x.value.push(e)},{mutate:oe,onDone:ne}=ve({document:Ce});ne(e=>{Z(e.data.setTempValue.key),w()});const M=e=>{xe(e.name)?window.open(Me(b.value,e.path),"_blank"):Be(e.name)?ee(r.value,e):A(e.path)},{loading:C,fetch:I}=ke({handle:async(e,l)=>{if(l)Te(Q(l),"error");else{const d=[];for(const k of e.recentFiles)d.push(De(k,b.value));r.value=d,E.value=d.length}},document:Ie}),ae=()=>{oe({key:ze(),value:JSON.stringify(h.value.map(e=>({path:e})))})},B=e=>{e.status==="done"&&setTimeout(()=>{I()},1e3)},le=e=>{e.forEach(l=>{He(r.value,d=>d.id===l.id)}),w()},K=e=>{le([e.item])},z=e=>{I()};return me(()=>{I(),v.on("upload_task_done",B),v.on("file_deleted",K),v.on("file_renamed",z),window.addEventListener("keydown",N),window.addEventListener("keyup",R)}),fe(()=>{v.off("upload_task_done",B),v.off("file_deleted",K),v.off("file_renamed",z),window.removeEventListener("keydown",N),window.removeEventListener("keyup",R)}),(e,l)=>{const d=Qe,k=ye,ce=Oe,ie=Re,de=Ue,m=ge("tooltip");return o(),a(H,null,[n("div",je,[_(d,{"touch-target":"wrapper",checked:s(S),indeterminate:!s(S)&&s($),onChange:s(J)},null,8,["checked","indeterminate","onChange"]),s(h).length?(o(),a("span",Je,i(e.$t("x_selected",{count:s(j)?s(E).toLocaleString():s(h).length.toLocaleString()})),1)):(o(),a("span",We,i(e.$t("recent_files"))+" ("+i(s(E).toLocaleString())+")",1)),s($)?y((o(),a("button",{key:2,class:"btn-icon",onClick:p(ae,["stop"])},[_(k)])),[[m,e.$t("download")]]):g("",!0)]),s(C)&&r.value.length===0?(o(),a("div",Xe,[(o(),a(H,null,be(20,u=>n("section",{key:u,class:"file-item selectable-card-skeleton"},[n("div",qe,[l[0]||(l[0]=n("div",{class:"checkbox"},[n("div",{class:"skeleton-checkbox"})],-1)),n("span",Ye,i(u),1)]),l[1]||(l[1]=Le('<div class="image"><div class="skeleton-image"></div></div><div class="title"><div class="skeleton-text skeleton-title"></div></div><div class="subtitle"><div class="skeleton-text skeleton-subtitle"></div></div><div class="actions"><div class="skeleton-text skeleton-actions"></div></div>',4))])),64))])):g("",!0),r.value.length>0?(o(),T(s(we),{key:1,class:"scroller","data-key":"id","data-sources":r.value,"estimate-size":80},{item:D(({index:u,item:t})=>[(o(),a("section",{key:t.id,class:Se(["file-item selectable-card",{selected:s(h).includes(t.id),selecting:s(F).includes(t.id)}]),onClick:p(c=>s(W)(c,t,u,()=>{M(t)}),["stop"]),onMouseover:c=>s(X)(c,u)},[n("div",es,[s(F).includes(t.id)?(o(),T(d,{key:0,class:"checkbox","touch-target":"wrapper",checked:s(Y),onClick:p(c=>s(V)(c,t,u),["stop"])},null,8,["checked","onClick"])):(o(),T(d,{key:1,class:"checkbox","touch-target":"wrapper",checked:s(h).includes(t.id),onClick:p(c=>s(V)(c,t,u),["stop"])},null,8,["checked","onClick"])),n("span",ss,[_(ce,{id:u+1,raw:t},null,8,["id","raw"])])]),n("div",{class:"image",onClick:p(c=>M(t),["stop"])},[x.value.includes(t.id)?(o(),a("img",os)):!U.value.includes(t.id)&&t.fileId?(o(),a("img",{key:1,class:"image-thumb",src:s(Ve)(t.fileId,"&w=50&h=50"),onError:c=>se(t.id)},null,40,ns)):t.extension?(o(),a("img",{key:2,src:`/ficons/${t.extension}.svg`,class:"svg",onError:c=>te(t.id)},null,40,as)):(o(),a("img",ls))],8,ts),n("div",cs,i(t.name),1),n("div",is,[n("span",null,i(s($e)(t.size)),1),y((o(),a("span",null,[Ae(i(s(Ne)(t.updatedAt)),1)])),[[m,s(Fe)(t.updatedAt)]])]),n("div",ds,[y((o(),a("button",{class:"btn-icon sm",onClick:p(c=>s(A)(t.path),["stop"])},[_(k)],8,rs)),[[m,e.$t("download")]]),_(de,null,{content:D(()=>[n("section",_s,[n("div",ps,[n("div",vs,i(e.$t("path")),1),n("div",hs,i(t.path),1)])])]),default:D(()=>[y((o(),a("button",us,[_(ie)])),[[m,e.$t("info")]])]),_:2},1024)])],42,Ze))]),_:1},8,["data-sources"])):g("",!0),!s(C)&&r.value.length===0?(o(),a("div",ks,i(e.$t(s(Ee)(s(C),s(P).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):g("",!0)],64)}}});export{ws as default};
