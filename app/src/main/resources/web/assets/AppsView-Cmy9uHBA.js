import{_ as We}from"./VPagination.vuevuetypescriptsetuptruelang-CEZVU5HQ.js";import{a5 as H,e as Je,r as w,s as ue,g as Ze,ah as Xe,ai as Ye,f as ea,u as aa,I as ta,K as sa,aj as na,J as la,i as re,L as _e,M as oa,N as ia,c as o,o as l,a as n,k as p,l as a,O as ca,P as v,j as q,t as i,Q as da,y as u,ak as pa,p as z,al as ua,S as L,am as ra,T as R,U,V as j,W as _a,an as va,ao as ka,E,ap as ma,aq as ga,ar as fa,as as ha,Z as ya,n as wa,F as M,at as ba,a8 as Ca,au as $a,av as ve,a0 as ke,d as Sa,A as Da,aw as Aa,a4 as Ia,H as La}from"./index-CuU5w3Fk.js";import{_ as Ua}from"./FieldId.vuevuetypescriptsetuptruelang-BAr-ccW2.js";import{_ as Pa,a as Na}from"./SearchInput-Do4mYLNe.js";import{_ as Va,a as Fa}from"./upload-rounded-Bty2yz0H.js";import{u as qa,a as Ea}from"./key-events-CMYOn2tc.js";import{u as Ma}from"./search-cTEMyIe9.js";import"./VInputChip-Cze1-7DF.js";const b=$=>{H.emit("tap_phone",$)};function Ta($,d){const S=$.findIndex(D=>D.id===d);S!==-1&&$.splice(S,1)}const Ba={class:"top-app-bar"},Ka={class:"title"},Qa={key:0},xa={key:1},Ga={class:"actions"},za=["disabled"],Ra={class:"menu-items"},ja=["onClick"],Ha=["onClick","onMouseover"],Oa={class:"start"},Wa={class:"number"},Ja=["src"],Za={class:"title"},Xa={class:"subtitle"},Ya={class:"actions"},et=["onClick"],at=["onClick"],tt={class:"time"},st={class:"start"},nt={class:"number"},lt={key:0,class:"no-data-placeholder"},C=50,ot=Je({__name:"AppsView",setup($){var de;const d=w([]),{app:S,urlTokenKey:D,uploads:O}=ue(Ze()),{input:me,upload:ge,uploadChanged:W}=Xe(O),{dropping:fe,fileDragEnter:J,fileDragLeave:Z,dropFiles:he}=Ye(O),X=ea(),k=w([]),{t:g}=aa(),{appSortBy:P}=ue(X),{parseQ:ye}=Ma(),Y=ta({tagIds:[]}),we=ha(),N=w(!1),ee=sa(),ae=ee.query,T=w(parseInt(((de=ae.page)==null?void 0:de.toString())??"1")),V=w(""),{selectedIds:A,allChecked:te,realAllChecked:B,selectRealAll:be,allCheckedAlertVisible:Ce,clearSelection:K,toggleAllChecked:$e,toggleSelect:se,total:f,checked:Q,shiftEffectingIds:ne,handleItemClick:Se,handleMouseOver:De,selectAll:Ae,shouldSelect:Ie}=qa(k),{downloadItems:Le}=na(D,la.PACKAGE,K,()=>Aa("apps")),{downloadFile:Ue}=$a(D),x=e=>{const s=ee.query.q;Da(X,s?`/apps?page=${e}&q=${s}`:`/apps?page=${e}`)},{keyDown:le,keyUp:oe}=Ea(f,C,T,Ae,K,x,()=>{}),Pe=()=>{ge(S.value.downloadsDir)},{mutate:Ne}=re({document:va}),Ve=["user","system"].map(e=>({id:e,name:g("app_type."+e)})),Fe=e=>{e.isUninstalling=!1},{loading:G,fetch:ie}=_e({handle:(e,s)=>{N.value=!1,s?E(g(s),"error"):e&&(k.value=e.packages.map(c=>({...c,isUninstalling:!1,icon:ma(D.value,"pkgicon://"+c.id)})),f.value=e.packageCount)},document:ka,variables:()=>({offset:(T.value-1)*C,limit:C,query:V.value,sortBy:P.value})});function qe(e){return e?`/apps?q=${e}`:"/apps"}const F=w(!1);function Ee(e){if(P.value===e){F.value=!1;return}N.value=!0,P.value=e,x(1),F.value=!1}const{mutate:Me}=re({document:ga});function Te(e){e.isUninstalling=!0,b(g("confirm_uninstallation_on_phone")),Me({id:e.id})}const{loading:Be,fetch:Ke}=_e({handle:e=>{if(e)for(const s of e.packageStatuses){const c=d.value.find(_=>_.id===s.id);if(c){const _=c.isNew&&s.exist,I=!c.isNew&&s.exist&&c.updatedAt<s.updatedAt;(_||I)&&(d.value=d.value.filter(h=>h.id!==s.id),b(""),_?E(g("app_installation_completed"),"success"):E(g("app_upgrade_completed"),"success"),ie())}else s.exist||(Ta(k.value,s.id),b(""))}},document:fa,variables:()=>({ids:[...k.value.filter(e=>e.isUninstalling).map(e=>e.id),...d.value.map(e=>e.id)]})}),ce=e=>{e.status==="done"&&Ne({path:e.dir+"/"+e.fileName}).then(s=>{if(b(g("confirm_installation_on_phone")),s&&s.data&&s.data.installPackage){const{packageName:c,updatedAt:_,isNew:I}=s.data.installPackage;c&&(d.value.push({id:c,updatedAt:_,isNew:I}),setTimeout(()=>{d.value.some(h=>h.id===c)&&(d.value=d.value.filter(h=>h.id!==c),b(""))},12e4))}}).catch(s=>{b(""),E(g("app_installation_failed")+": "+s.message,"error")})};function Qe(e){he(e,S.value.downloadsDir,s=>s.name.endsWith(".apk"))}return oa(()=>{var e;setInterval(()=>{(k.value.some(s=>s.isUninstalling)||d.value.length>0)&&!Be.value&&Ke()},1e3),V.value=Ia(((e=ae.q)==null?void 0:e.toString())??""),ye(Y,V.value),ie(),H.on("upload_task_done",ce),window.addEventListener("keydown",le),window.addEventListener("keyup",oe)}),ia(()=>{H.off("upload_task_done",ce),window.removeEventListener("keydown",le),window.removeEventListener("keyup",oe)}),(e,s)=>{const c=ca,_=pa,I=Pa,h=Va,pe=ya,xe=Fa,Ge=ua,ze=Na,Re=Ua,je=ba,He=Ca,Oe=We,m=da("tooltip");return l(),o(U,null,[n("div",Ba,[p(c,{"touch-target":"wrapper",checked:a(te),indeterminate:!a(te)&&a(Q),onChange:a($e)},null,8,["checked","indeterminate","onChange"]),n("div",Ka,[a(A).length?(l(),o("span",Qa,i(e.$t("x_selected",{count:a(B)?a(f).toLocaleString():a(A).length.toLocaleString()})),1)):(l(),o("span",xa,i(e.$t("page_title.apps"))+" ("+i(a(f).toLocaleString())+")",1)),a(Q)?v((l(),o("button",{key:2,class:"btn-icon",onClick:s[0]||(s[0]=u(t=>a(Le)(a(B),a(A),V.value),["stop"]))},[p(_)])),[[m,e.$t("download")]]):q("",!0)]),n("div",Ga,[p(I,{filter:Y,types:a(Ve),"get-url":qe},null,8,["filter","types"]),v((l(),o("button",{class:"btn-icon",onClick:u(Pe,["stop"])},[p(h)])),[[m,e.$t("install_app")]]),p(Ge,{modelValue:F.value,"onUpdate:modelValue":s[1]||(s[1]=t=>F.value=t)},{trigger:z(()=>[v((l(),o("button",{class:"btn-icon btn-sort",disabled:N.value},[N.value?(l(),L(pe,{key:0,indeterminate:""})):(l(),L(xe,{key:1}))],8,za)),[[m,e.$t("sort")]])]),default:z(()=>[n("div",Ra,[(l(!0),o(U,null,j(a(we),t=>(l(),o("div",{key:t.value,class:R(["dropdown-item",{selected:t.value===a(P)}]),onClick:y=>Ee(t.value)},i(e.$t(t.label)),11,ja))),128))])]),_:1},8,["modelValue"])])]),p(ze,{limit:C,total:a(f),"all-checked-alert-visible":a(Ce),"real-all-checked":a(B),"select-real-all":a(be),"clear-selection":a(K)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),n("div",{class:"scroll-content",onDragover:s[4]||(s[4]=u((...t)=>a(J)&&a(J)(...t),["stop","prevent"]))},[v(n("div",{class:"drag-mask",onDrop:u(Qe,["stop","prevent"]),onDragleave:s[2]||(s[2]=u((...t)=>a(Z)&&a(Z)(...t),["stop","prevent"]))},i(e.$t("release_to_send_files")),545),[[ra,a(fe)]]),n("div",{class:R(["app-list",{"select-mode":a(Q)}])},[(l(!0),o(U,null,j(k.value,(t,y)=>(l(),o("section",{key:t.id,class:R(["app-item selectable-card",{selected:a(A).includes(t.id),selecting:a(ne).includes(t.id)}]),onClick:u(r=>a(Se)(r,t,y,()=>{}),["stop"]),onMouseover:r=>a(De)(r,y)},[n("div",Oa,[a(ne).includes(t.id)?(l(),L(c,{key:0,class:"checkbox","touch-target":"wrapper",checked:a(Ie),onClick:u(r=>a(se)(r,t,y),["stop"])},null,8,["checked","onClick"])):(l(),L(c,{key:1,class:"checkbox","touch-target":"wrapper",checked:a(A).includes(t.id),onClick:u(r=>a(se)(r,t,y),["stop"])},null,8,["checked","onClick"])),n("span",Wa,[p(Re,{id:y+1,raw:t},null,8,["id","raw"])])]),n("img",{class:"image",width:"50",height:"50",src:t.icon},null,8,Ja),n("div",Za,i(t.name)+" ("+i(t.version)+")",1),n("div",Xa,[n("span",null,i(t.id),1),n("span",null,i(a(wa)(t.size)),1),n("span",null,i(e.$t("app_type."+t.type)),1)]),n("div",Ya,[t.isUninstalling?(l(),o(U,{key:0},[v(p(pe,{indeterminate:"",class:"sm"},null,512),[[m,e.$t("uninstalling")]]),s[5]||(s[5]=M(" Â ")),p(je,{class:"btn-sm",onClick:u(r=>Fe(t),["stop"])},{default:z(()=>[M(i(e.$t("cancel")),1)]),_:2},1032,["onClick"])],64)):v((l(),o("button",{key:1,class:"btn-icon sm",onClick:u(r=>Te(t),["stop"])},[p(He)],8,et)),[[m,e.$t("uninstall")]]),v((l(),o("button",{class:"btn-icon sm",onClick:u(r=>a(Ue)(t.path,`${t.name.replace(" ","")}-${t.id}.apk`),["stop"])},[p(_)],8,at)),[[m,e.$t("download")]])]),n("div",tt,[v((l(),o("span",null,[M(i(e.$t("installed_at"))+": "+i(a(ke)(t.installedAt)),1)])),[[m,a(ve)(t.installedAt)]]),v((l(),o("span",null,[M(i(e.$t("updated_at"))+": "+i(a(ke)(t.updatedAt)),1)])),[[m,a(ve)(t.updatedAt)]])])],42,Ha))),128)),a(G)&&k.value.length===0?(l(),o(U,{key:0},j(20,t=>n("section",{key:t,class:"app-item selectable-card-skeleton"},[n("div",st,[s[6]||(s[6]=n("div",{class:"checkbox"},[n("div",{class:"skeleton-checkbox"})],-1)),n("span",nt,i(t),1)]),s[7]||(s[7]=Sa('<div class="image" data-v-3a46a6e1><div class="skeleton-image" data-v-3a46a6e1></div></div><div class="title" data-v-3a46a6e1><div class="skeleton-text skeleton-title" data-v-3a46a6e1></div></div><div class="subtitle" data-v-3a46a6e1><div class="skeleton-text skeleton-subtitle" data-v-3a46a6e1></div></div><div class="actions" data-v-3a46a6e1><div class="skeleton-text skeleton-actions" data-v-3a46a6e1></div></div><div class="time" data-v-3a46a6e1><div class="skeleton-text skeleton-time" data-v-3a46a6e1></div><div class="skeleton-text skeleton-time" data-v-3a46a6e1></div></div>',5))])),64)):q("",!0)],2),!a(G)&&k.value.length===0?(l(),o("div",lt,i(e.$t(a(_a)(a(G)))),1)):q("",!0),a(f)>C?(l(),L(Oe,{key:1,page:T.value,go:x,total:a(f),limit:C},null,8,["page","total"])):q("",!0),n("input",{ref_key:"fileInput",ref:me,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:s[3]||(s[3]=(...t)=>a(W)&&a(W)(...t))},null,544)],32)],64)}}}),kt=La(ot,[["__scopeId","data-v-3a46a6e1"]]);export{kt as default};
