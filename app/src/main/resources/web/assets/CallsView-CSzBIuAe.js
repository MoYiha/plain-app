import{_ as we}from"./VPagination.vuevuetypescriptsetuptruelang-C9URNuao.js";import{_ as Se}from"./call-outline-rounded-CD5u8H3j.js";import{d as Le,u as Te,s as Ie,i as qe,h as I,g as Ae,I as De,J as Ee,K as Me,j as Ve,L as Be,M as Ge,c as n,a as o,m as t,t as i,O as E,x as g,w as _,p as d,e as W,N as J,P as Ne,v as Qe,Q as Ue,f as Ke,C as xe,a8 as Re,B as ze,S as He,o as l,a9 as Oe,U as Pe,V as je,W as Fe,X as We,F as Je,G as Xe,a0 as v,aa as Ye,Y as X,Z as Ze,ab as et,ac as tt,$ as st,ad as at,a1 as ot,a2 as lt,a3 as nt,H as ct}from"./index-BxNI00MG.js";import{c as it,u as dt,_ as rt,a as ut,b as _t}from"./key-events-B5RXeznw.js";import{u as pt}from"./search-D1_YTViL.js";import{u as mt,a as ht}from"./tags-BUfgTqH4.js";import"./rss-feed-rounded-Dj4EQ17i.js";import"./vee-validate.esm-9czZ1sUw.js";const b=C=>(Je("data-v-7c2e8c41"),C=C(),Xe(),C),gt={class:"top-app-bar"},vt=["checked","indeterminate"],kt={class:"title"},ft={key:0},yt={key:1},bt=b(()=>o("md-ripple",null,null,-1)),Ct=b(()=>o("md-ripple",null,null,-1)),$t={class:"actions"},wt={class:"scroll-content"},St=["onClick","onMouseover"],Lt={class:"start"},Tt=["onClick","checked"],It=["onClick","checked"],qt={class:"number"},At={class:"title"},Dt={class:"subtitle"},Et={class:"actions"},Mt=["onClick"],Vt=b(()=>o("md-ripple",null,null,-1)),Bt={key:0,indeterminate:"",class:"spinner-sm"},Gt=["onClick"],Nt=b(()=>o("md-ripple",null,null,-1)),Qt=["onClick"],Ut=b(()=>o("md-ripple",null,null,-1)),Kt={class:"geo"},xt={class:"time"},Rt={key:1,class:"no-data-placeholder"},k=50,zt=Le({__name:"CallsView",setup(C){var j;const Y=Te(),{app:Z}=Ie(qe()),$=I([]),{t:q}=Ae(),{parseQ:ee}=pt(),M=De({tagIds:[]}),r=Ee.CALL,V=Ue(),B=V.query,A=I(parseInt(((j=B.page)==null?void 0:j.toString())??"1")),m=I(""),{tags:w,fetch:te}=mt(r),{addToTags:se}=ht(r,w),{deleteItems:G}=it(Ye,()=>{S(),L(),v.emit("refetch_tags",r)}),{selectedIds:p,allChecked:N,realAllChecked:f,selectRealAll:ae,allCheckedAlertVisible:oe,clearSelection:S,toggleAllChecked:Q,toggleSelect:U,total:u,checked:D,shiftEffectingIds:K,handleItemClick:le,handleMouseOver:ne,selectAll:ce,shouldSelect:ie}=dt($),x=e=>{const a=V.query.q;Ke(Y,a?`/calls?page=${e}&q=${a}`:`/calls?page=${e}`)},{keyDown:R,keyUp:z}=_t(u,k,A,ce,S,x,()=>{G(f.value,p.value,m.value)}),{loading:de,fetch:L}=Me({handle:(e,a)=>{a?xe(q(a),"error"):e&&($.value=e.calls,u.value=e.callCount)},document:Re,variables:()=>({offset:(A.value-1)*k,limit:k,query:m.value}),appApi:!0}),re=["1","2","3"].map(e=>({id:e,name:q("call_type."+e)}));function ue(e){X(Ze,{type:r,tags:w.value,item:{key:e.id,title:"",size:0},selected:w.value.filter(a=>e.tags.some(T=>T.id===a.id))})}function _e(e){return e?`/calls?q=${e}`:"/calls"}const H=e=>{e.type===r&&(S(),L())},O=e=>{e.type===r&&L()};function pe(e){if(!e)return"";const a=[];return e.isp&&a.push(q("phone_isp_type."+e.isp)),e.city===e.province?a.push(e.city):a.push(`${e.province}${e.city}`),a.join(", ")}const P=I(""),{mutate:me,loading:he}=Ve({document:ze,appApi:!0});function ge(e){P.value=e.id,me({number:e.number})}function ve(e){X(tt,{id:e.id,name:e.id,gql:et`
      mutation DeleteCall($query: String!) {
        deleteCalls(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),appApi:!0,typeName:"Call",done:()=>{u.value--,e.tags.length&&v.emit("refetch_tags",r)}})}return Be(()=>{var e;m.value=st(((e=B.q)==null?void 0:e.toString())??""),ee(M,m.value),te(),L(),v.on("item_tags_updated",O),v.on("items_tags_updated",H),window.addEventListener("keydown",R),window.addEventListener("keyup",z)}),Ge(()=>{v.off("item_tags_updated",O),v.off("items_tags_updated",H),window.removeEventListener("keydown",R),window.removeEventListener("keyup",z)}),(e,a)=>{const T=at,F=ot,ke=rt,fe=ut,ye=lt,be=nt,Ce=Se,$e=we,h=He("tooltip");return l(),n(E,null,[o("div",gt,[o("md-checkbox",{"touch-target":"wrapper",onChange:a[0]||(a[0]=(...s)=>t(Q)&&t(Q)(...s)),checked:t(N),indeterminate:!t(N)&&t(D)},null,40,vt),o("div",kt,[t(p).length?(l(),n("span",ft,i(e.$t("x_selected",{count:t(f)?t(u).toLocaleString():t(p).length.toLocaleString()})),1)):(l(),n("span",yt,i(e.$t("page_title.calls"))+" ("+i(t(u).toLocaleString())+")",1)),t(D)?(l(),n(E,{key:2},[g((l(),n("button",{class:"btn-icon",onClick:a[1]||(a[1]=_(s=>t(G)(t(f),t(p),m.value),["stop"]))},[bt,d(T)])),[[h,e.$t("delete")]]),g((l(),n("button",{class:"btn-icon",onClick:a[2]||(a[2]=_(s=>t(se)(t(p),t(f),m.value),["stop"]))},[Ct,d(F)])),[[h,e.$t("add_to_tags")]])],64)):W("",!0)]),o("div",$t,[d(ke,{filter:M,tags:t(w),types:t(re),"get-url":_e},null,8,["filter","tags","types"])])]),d(fe,{limit:k,total:t(u),"all-checked-alert-visible":t(oe),"real-all-checked":t(f),"select-real-all":t(ae),"clear-selection":t(S)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),o("div",wt,[$.value.length?(l(),n("div",{key:0,class:J(["call-list",{"select-mode":t(D)}])},[(l(!0),n(E,null,Ne($.value,(s,y)=>(l(),n("section",{class:J(["call-item selectable-card",{selected:t(p).includes(s.id),selecting:t(K).includes(s.id)}]),key:s.id,onClick:_(c=>t(le)(c,s,y,()=>{}),["stop"]),onMouseover:c=>t(ne)(c,y)},[o("div",Lt,[t(K).includes(s.id)?(l(),n("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:_(c=>t(U)(c,s,y),["stop"]),checked:t(ie)},null,8,Tt)):(l(),n("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:_(c=>t(U)(c,s,y),["stop"]),checked:t(p).includes(s.id)},null,8,It)),o("span",qt,[d(ye,{id:y+1,raw:s},null,8,["id","raw"])])]),o("div",At,i(s.name?s.name+" "+s.number:s.number),1),o("div",Dt,[o("span",null,i(t(Oe)(s.duration)),1),o("span",null,i(e.$t("call_type."+s.type)),1),d(be,{tags:s.tags,type:t(r),"only-links":!0},null,8,["tags","type"])]),o("div",Et,[g((l(),n("button",{class:"btn-icon sm",onClick:_(c=>ve(s),["stop"])},[Vt,d(T)],8,Mt)),[[h,e.$t("delete")]]),t(he)&&P.value===s.id?(l(),n("md-circular-progress",Bt)):g((l(),n("button",{key:1,class:"btn-icon sm",onClick:_(c=>ge(s),["stop"])},[Nt,d(Ce)],8,Gt)),[[h,e.$t("make_a_phone_call")]]),g((l(),n("button",{class:"btn-icon sm",onClick:_(c=>ue(s),["stop"])},[Ut,d(F)],8,Qt)),[[h,e.$t("add_to_tags")]])]),o("div",Kt,i(pe(s.geo)),1),o("div",xt,[g((l(),n("span",null,[je(i(t(Fe)(s.startedAt)),1)])),[[h,t(Pe)(s.startedAt)]])])],42,St))),128))],2)):(l(),n("div",Rt,i(e.$t(t(We)(t(de),t(Z).permissions,"WRITE_CALL_LOG"))),1)),t(u)>k?(l(),Qe($e,{key:2,page:A.value,go:x,total:t(u),limit:k},null,8,["page","total"])):W("",!0)])],64)}}}),Yt=ct(zt,[["__scopeId","data-v-7c2e8c41"]]);export{Yt as default};
