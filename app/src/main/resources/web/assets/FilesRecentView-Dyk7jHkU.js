import{e as re,u as ue,r as g,g as _e,s as pe,i as ve,au as he,L as ke,M as me,N as ge,c as a,o,a as n,j as f,S,k as _,P as y,l as s,O as fe,t as i,Q as ye,y as p,ak as be,U as O,V as we,p as T,bq as Ee,W as Ce,bJ as Ie,bV as Se,E as Te,bI as De,d as Le,T as Ve,bL as Q,aI as $e,n as Fe,a0 as Ae,F as Ne,a1 as Ue,bM as xe,bW as Me,bQ as Re,ap as Be,bR as ze,bS as Ke,bN as Oe,a5 as v,bU as Qe}from"./index-CuU5w3Fk.js";import{_ as Ge}from"./FieldId.vuevuetypescriptsetuptruelang-BAr-ccW2.js";import{u as He,c as We}from"./key-events-CMYOn2tc.js";const Je={class:"top-app-bar"},Pe={key:0},je={key:1},qe={key:0,class:"scroller"},Xe={class:"start"},Ye={class:"number"},Ze=["onClick","onMouseover"],es={class:"start"},ss={class:"number"},ts=["onClick"],os={key:0,class:"svg",src:Q},ns=["src","onError"],as=["src","onError"],ls={key:3,class:"svg",src:Q},cs={class:"title"},is={class:"subtitle"},ds={class:"actions"},rs=["onClick"],us={class:"btn-icon sm"},_s={class:"card card-info"},ps={class:"key-value vertical"},vs={class:"key"},hs={class:"value"},ks={key:2,class:"no-data-placeholder"},bs=re({__name:"FilesRecentView",setup(ms){const{t:G}=ue(),H=g([]),D=_e(),{app:W,urlTokenKey:b}=pe(D),r=g([]),{selectedIds:h,allChecked:L,realAllChecked:J,clearSelection:w,toggleAllChecked:P,toggleSelect:V,total:E,checked:$,shiftEffectingIds:F,handleItemClick:j,handleMouseOver:q,selectAll:X,shouldSelect:Y}=He(r),{downloadFile:A,downloadFiles:Z}=he(b),{view:ee}=Ke(H,(e,l)=>{D.lightbox={sources:e,index:l,visible:!0}}),{keyDown:N,keyUp:U}=We(X,w,()=>{}),x=g([]),M=g([]),se=e=>{x.value.push(e)},te=e=>{M.value.push(e)},{mutate:oe,onDone:ne}=ve({document:Ie});ne(e=>{Z(e.data.setTempValue.key),w()});const R=e=>{Re(e.name)?window.open(Be(b.value,e.path),"_blank"):ze(e.name)?ee(r.value,e):A(e.path)},{loading:C,fetch:I}=ke({handle:async(e,l)=>{if(l)Te(G(l),"error");else{const d=[];for(const k of e.recentFiles)d.push(De(k,b.value));r.value=d,E.value=d.length}},document:Se}),ae=()=>{oe({key:Oe(),value:JSON.stringify(h.value.map(e=>({path:e})))})},B=e=>{e.status==="done"&&setTimeout(()=>{I()},1e3)},le=e=>{e.forEach(l=>{Qe(r.value,d=>d.id===l.id)}),w()},z=e=>{le([e.item])},K=e=>{I()};return me(()=>{I(),v.on("upload_task_done",B),v.on("file_deleted",z),v.on("file_renamed",K),window.addEventListener("keydown",N),window.addEventListener("keyup",U)}),ge(()=>{v.off("upload_task_done",B),v.off("file_deleted",z),v.off("file_renamed",K),window.removeEventListener("keydown",N),window.removeEventListener("keyup",U)}),(e,l)=>{const d=fe,k=be,ce=Ge,ie=xe,de=Me,m=ye("tooltip");return o(),a(O,null,[n("div",Je,[_(d,{"touch-target":"wrapper",checked:s(L),indeterminate:!s(L)&&s($),onChange:s(P)},null,8,["checked","indeterminate","onChange"]),s(h).length?(o(),a("span",Pe,i(e.$t("x_selected",{count:s(J)?s(E).toLocaleString():s(h).length.toLocaleString()})),1)):(o(),a("span",je,i(e.$t("recent_files"))+" ("+i(s(E).toLocaleString())+")",1)),s($)?y((o(),a("button",{key:2,class:"btn-icon",onClick:p(ae,["stop"])},[_(k)])),[[m,e.$t("download")]]):f("",!0)]),s(C)&&r.value.length===0?(o(),a("div",qe,[(o(),a(O,null,we(20,u=>n("section",{key:u,class:"file-item selectable-card-skeleton"},[n("div",Xe,[l[0]||(l[0]=n("div",{class:"checkbox"},[n("div",{class:"skeleton-checkbox"})],-1)),n("span",Ye,i(u),1)]),l[1]||(l[1]=Le('<div class="image"><div class="skeleton-image"></div></div><div class="title"><div class="skeleton-text skeleton-title"></div></div><div class="subtitle"><div class="skeleton-text skeleton-subtitle"></div></div><div class="actions"><div class="skeleton-text skeleton-actions"></div></div>',4))])),64))])):f("",!0),r.value.length>0?(o(),S(s(Ee),{key:1,class:"scroller","data-key":"id","data-sources":r.value,"estimate-size":80},{item:T(({index:u,item:t})=>[(o(),a("section",{key:t.id,class:Ve(["file-item selectable-card",{selected:s(h).includes(t.id),selecting:s(F).includes(t.id)}]),onClick:p(c=>s(j)(c,t,u,()=>{R(t)}),["stop"]),onMouseover:c=>s(q)(c,u)},[n("div",es,[s(F).includes(t.id)?(o(),S(d,{key:0,class:"checkbox","touch-target":"wrapper",checked:s(Y),onClick:p(c=>s(V)(c,t,u),["stop"])},null,8,["checked","onClick"])):(o(),S(d,{key:1,class:"checkbox","touch-target":"wrapper",checked:s(h).includes(t.id),onClick:p(c=>s(V)(c,t,u),["stop"])},null,8,["checked","onClick"])),n("span",ss,[_(ce,{id:u+1,raw:t},null,8,["id","raw"])])]),n("div",{class:"image",onClick:p(c=>R(t),["stop"])},[M.value.includes(t.id)?(o(),a("img",os)):!x.value.includes(t.id)&&t.fileId?(o(),a("img",{key:1,class:"image-thumb",src:s($e)(t.fileId,"&w=50&h=50"),onError:c=>se(t.id)},null,40,ns)):t.extension?(o(),a("img",{key:2,src:`/ficons/${t.extension}.svg`,class:"svg",onError:c=>te(t.id)},null,40,as)):(o(),a("img",ls))],8,ts),n("div",cs,i(t.name),1),n("div",is,[n("span",null,i(s(Fe)(t.size)),1),y((o(),a("span",null,[Ne(i(s(Ue)(t.updatedAt)),1)])),[[m,s(Ae)(t.updatedAt)]])]),n("div",ds,[y((o(),a("button",{class:"btn-icon sm",onClick:p(c=>s(A)(t.path),["stop"])},[_(k)],8,rs)),[[m,e.$t("download")]]),_(de,null,{content:T(()=>[n("section",_s,[n("div",ps,[n("div",vs,i(e.$t("path")),1),n("div",hs,i(t.path),1)])])]),default:T(()=>[y((o(),a("button",us,[_(ie)])),[[m,e.$t("info")]])]),_:2},1024)])],42,Ze))]),_:1},8,["data-sources"])):f("",!0),!s(C)&&r.value.length===0?(o(),a("div",ks,i(e.$t(s(Ce)(s(C),s(W).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):f("",!0)],64)}}});export{bs as default};
