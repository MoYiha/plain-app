import{_ as Y}from"./MonacoEditor.vuevuetypescriptsetuptruelang-BkGrgQtj.js";import{_ as Z}from"./print-outline-rounded-CG3OuEWH.js";import{bg as ee,bh as z,bi as te,m as ne,c as k,o as v,a as p,e as ae,f as oe,u as se,r as T,s as ie,g as re,h as ue,N as le,i as ce,bj as de,ae as me,M as _e,a5 as S,af as fe,Q as q,R as ve,z as Q,k as M,G as A,J as pe,j as F,t as ge,l as G,ar as he,$ as be,U as j,S as Te,w as ke,a0 as ye,bk as we,F as O,bl as Me,bm as Ne,a6 as $e,B as Ce,a2 as Le,a3 as xe,bn as Ee,I as Se}from"./index-DRp6xo3j.js";import{_ as qe}from"./FieldId.vuevuetypescriptsetuptruelang-slfJ4h1L.js";import{u as Ie}from"./markdown-x8nGVkF0.js";var U=function(){return ee.Date.now()},Re="Expected a function",Ve=Math.max,De=Math.min;function Be($,i,u){var d,a,o,r,s,l,_=0,C=!1,f=!1,g=!0;if(typeof $!="function")throw new TypeError(Re);i=z(i)||0,te(u)&&(C=!!u.leading,f="maxWait"in u,o=f?Ve(z(u.maxWait)||0,i):o,g="trailing"in u?!!u.trailing:g);function y(n){var c=d,e=a;return d=a=void 0,_=n,r=$.apply(e,c),r}function L(n){return _=n,s=setTimeout(m,i),C?y(n):r}function I(n){var c=n-l,e=n-_,t=i-c;return f?De(t,o-e):t}function h(n){var c=n-l,e=n-_;return l===void 0||c>=i||c<0||f&&e>=o}function m(){var n=U();if(h(n))return x(n);s=setTimeout(m,I(n))}function x(n){return s=void 0,g&&d?y(n):(d=a=void 0,r)}function R(){s!==void 0&&clearTimeout(s),_=0,d=l=a=s=void 0}function V(){return s===void 0?r:x(U())}function w(){var n=U(),c=h(n);if(d=arguments,a=this,l=n,c){if(s===void 0)return L(l);if(f)return clearTimeout(s),s=setTimeout(m,i),y(l)}return s===void 0&&(s=setTimeout(m,i)),r}return w.cancel=R,w.flush=V,w}const Qe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ue($,i){return v(),k("svg",Qe,i[0]||(i[0]=[p("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1)]))}const He=ne({name:"material-symbols-arrow-back-rounded",render:Ue}),We={class:"top-app-bar"},ze={class:"title"},Ae={class:"state-point"},Fe={class:"actions"},Ge={class:"panel-container"},je=["innerHTML"],N="NOTE",Oe=ae({__name:"NoteEditView",setup($){const i=oe(),{t:u}=se(),d=_e(),a=T(""),o=T(),r=T(""),s=T(""),l=T(!1),{app:_,urlTokenKey:C}=ie(re());function f(){const e=$e.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),Ce(i,t)}const{render:g}=Ie(_,C),y=Be(()=>{l.value=!1,x({id:a.value,input:{content:r.value,title:Ee(r.value,{length:250,omission:""})}})},500),L=()=>{ke(r,async e=>{l.value=!0,s.value=await g(e),y()})},I=()=>{window.print()},h=T();ue({handle:(e,t)=>{t?O(u(t),"error"):e&&(h.value=e.tags)},document:we,variables:{type:N}});const{fetch:m}=le({handle:async(e,t)=>{t?O(u(t),"error"):(o.value=e.note,r.value=e.note.content,s.value=await g(r.value),L())},document:Me,variables:()=>({id:a.value}),options:{fetchPolicy:"no-cache"}}),{mutate:x,onDone:R}=ce({document:Ne});R(e=>{var t,b;o.value=e.data.saveNote,!a.value&&((t=o.value)!=null&&t.id)&&(a.value=(b=o.value)==null?void 0:b.id,de(i,`/notes/${a.value}`))});function V(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${u("updated_at")}: ${ye(e)})`:""}function w(){var e,t;Le(xe,{type:N,tags:h.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=h.value)==null?void 0:t.filter(b=>{var E;return(E=o.value)==null?void 0:E.tags.some(D=>D.id===b.id)})})}const n=e=>{e.type===N&&m()},c=e=>{e.type===N&&m()};return me(()=>{a.value=d.params.id,a.value==="create"&&(a.value=""),a.value?m():L(),S.on("item_tags_updated",c),S.on("items_tags_updated",n)}),fe(()=>{S.off("item_tags_updated",c),S.off("items_tags_updated",n)}),(e,t)=>{var H,W;const b=He,E=qe,D=be,P=Te,J=Z,K=Y,B=ve("tooltip");return v(),k(j,null,[p("div",We,[q((v(),k("button",{class:"btn-icon",onClick:Q(f,["prevent"])},[M(b)])),[[B,e.$t("back")]]),p("div",ze,[A(ge(a.value?G(u)("edit"):G(u)("create"))+" ",1),q(p("span",Ae,"*",512),[[he,l.value]]),t[1]||(t[1]=A()),(H=o.value)!=null&&H.updatedAt?(v(),pe(E,{key:0,id:V(),class:"time",raw:o.value},null,8,["id","raw"])):F("",!0)]),p("div",Fe,[M(D,{tags:(W=o.value)==null?void 0:W.tags,type:N,"only-links":!0},null,8,["tags"]),a.value?(v(),k(j,{key:0},[q((v(),k("button",{class:"btn-icon",onClick:Q(w,["prevent"])},[M(P)])),[[B,e.$t("add_to_tags")]]),q((v(),k("button",{class:"btn-icon",onClick:Q(I,["prevent"])},[M(J)])),[[B,e.$t("print")]])],64)):F("",!0)])]),p("div",Ge,[M(K,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=X=>r.value=X),language:"html"},null,8,["modelValue"]),p("div",{class:"md-container",innerHTML:s.value},null,8,je)])],64)}}}),Ze=Se(Oe,[["__scopeId","data-v-fac1e980"]]);export{Ze as default};
