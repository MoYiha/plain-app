import{_ as Z}from"./MonacoEditor.vuevuetypescriptsetuptruelang-s8Smj5H6.js";import{_ as Y}from"./print-outline-rounded-CZlB3M-x.js";import{b7 as ee,b8 as z,b9 as te,m as ne,c as h,o as v,a as c,e as ae,f as oe,u as se,r as y,s as ie,g as le,h as ue,J as re,i as de,ba as ce,ab as me,I as fe,a1 as q,ac as _e,p as S,M as pe,y as W,k as M,X as A,O as ve,j as F,t as ge,l as O,aj as be,V as Te,Q as j,N as ye,w as he,W as ke,bb as we,D as G,bc as Me,bd as Ne,a3 as $e,z as Ce,Z as Le,$ as xe,be as Ee,F as qe}from"./index-BaWXnnLZ.js";import{_ as Se}from"./FieldId.vuevuetypescriptsetuptruelang-eOYRhci9.js";import{u as Ve}from"./markdown-D840EUCJ.js";var B=function(){return ee.Date.now()},Ie="Expected a function",De=Math.max,Re=Math.min;function Qe($,i,u){var m,a,o,l,s,r,_=0,C=!1,p=!1,g=!0;if(typeof $!="function")throw new TypeError(Ie);i=z(i)||0,te(u)&&(C=!!u.leading,p="maxWait"in u,o=p?De(z(u.maxWait)||0,i):o,g="trailing"in u?!!u.trailing:g);function k(n){var d=m,e=a;return m=a=void 0,_=n,l=$.apply(e,d),l}function L(n){return _=n,s=setTimeout(f,i),C?k(n):l}function V(n){var d=n-r,e=n-_,t=i-d;return p?Re(t,o-e):t}function b(n){var d=n-r,e=n-_;return r===void 0||d>=i||d<0||p&&e>=o}function f(){var n=B();if(b(n))return x(n);s=setTimeout(f,V(n))}function x(n){return s=void 0,g&&m?k(n):(m=a=void 0,l)}function I(){s!==void 0&&clearTimeout(s),_=0,m=r=a=s=void 0}function D(){return s===void 0?l:x(B())}function w(){var n=B(),d=b(n);if(m=arguments,a=this,r=n,d){if(s===void 0)return L(r);if(p)return clearTimeout(s),s=setTimeout(f,i),k(r)}return s===void 0&&(s=setTimeout(f,i)),l}return w.cancel=I,w.flush=D,w}const We={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Be($,i){return v(),h("svg",We,i[0]||(i[0]=[c("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1)]))}const He=ne({name:"material-symbols-arrow-back-rounded",render:Be}),Ue={class:"top-app-bar"},ze={class:"title"},Ae={class:"state-point"},Fe={class:"actions"},Oe={class:"panel-container"},je=["innerHTML"],N="NOTE",Ge=ae({__name:"NoteEditView",setup($){const i=oe(),{t:u}=se(),m=fe(),a=y(""),o=y(),l=y(""),s=y(""),r=y(!1),{app:_,urlTokenKey:C}=ie(le());function p(){const e=$e.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),Ce(i,t)}const{render:g}=Ve(_,C),k=Qe(()=>{r.value=!1,x({id:a.value,input:{content:l.value,title:Ee(l.value,{length:250,omission:""})}})},500),L=()=>{he(l,async e=>{r.value=!0,s.value=await g(e),k()})},V=()=>{window.print()},b=y();ue({handle:(e,t)=>{t?G(u(t),"error"):e&&(b.value=e.tags)},document:we,variables:{type:N}});const{fetch:f}=re({handle:async(e,t)=>{t?G(u(t),"error"):(o.value=e.note,l.value=e.note.content,s.value=await g(l.value),L())},document:Me,variables:()=>({id:a.value}),options:{fetchPolicy:"no-cache"}}),{mutate:x,onDone:I}=de({document:Ne});I(e=>{var t,T;o.value=e.data.saveNote,!a.value&&((t=o.value)!=null&&t.id)&&(a.value=(T=o.value)==null?void 0:T.id,ce(i,`/notes/${a.value}`))});function D(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${u("updated_at")}: ${ke(e)})`:""}function w(){var e,t;Le(xe,{type:N,tags:b.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=b.value)==null?void 0:t.filter(T=>{var E;return(E=o.value)==null?void 0:E.tags.some(R=>R.id===T.id)})})}const n=e=>{e.type===N&&f()},d=e=>{e.type===N&&f()};return me(()=>{a.value=m.params.id,a.value==="create"&&(a.value=""),a.value?f():L(),q.on("item_tags_updated",d),q.on("items_tags_updated",n)}),_e(()=>{q.off("item_tags_updated",d),q.off("items_tags_updated",n)}),(e,t)=>{var H,U;const T=He,E=Se,R=Te,P=ye,X=Y,J=Z,Q=pe("tooltip");return v(),h(j,null,[c("div",Ue,[S((v(),h("button",{class:"btn-icon",onClick:W(p,["prevent"])},[t[1]||(t[1]=c("md-ripple",null,null,-1)),M(T)])),[[Q,e.$t("back")]]),c("div",ze,[A(ge(a.value?O(u)("edit"):O(u)("create"))+" ",1),S(c("span",Ae,"*",512),[[be,r.value]]),t[2]||(t[2]=A()),(H=o.value)!=null&&H.updatedAt?(v(),ve(E,{key:0,id:D(),class:"time",raw:o.value},null,8,["id","raw"])):F("",!0)]),c("div",Fe,[M(R,{tags:(U=o.value)==null?void 0:U.tags,type:N,"only-links":!0},null,8,["tags"]),a.value?(v(),h(j,{key:0},[S((v(),h("button",{class:"btn-icon",onClick:W(w,["prevent"])},[t[3]||(t[3]=c("md-ripple",null,null,-1)),M(P)])),[[Q,e.$t("add_to_tags")]]),S((v(),h("button",{class:"btn-icon",onClick:W(V,["prevent"])},[t[4]||(t[4]=c("md-ripple",null,null,-1)),M(X)])),[[Q,e.$t("print")]])],64)):F("",!0)])]),c("div",Oe,[M(J,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=K=>l.value=K),language:"html"},null,8,["modelValue"]),c("div",{class:"md-container",innerHTML:s.value},null,8,je)])],64)}}}),Ye=qe(Ge,[["__scopeId","data-v-eb5effca"]]);export{Ye as default};
