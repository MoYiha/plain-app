import{_ as Me}from"./VPagination.vuevuetypescriptsetuptruelang-JQdiaM3z.js";import{a2 as V,e as Pe,s as W,g as Te,af as Ve,f as xe,r as S,u as Ke,G as ze,I as Qe,ag as Ge,H as Ne,J as Z,i as Re,K as je,L as He,c as o,o as l,a,k as v,l as t,p as k,j as I,t as i,M as Oe,y as r,ah as Je,Y as D,a3 as ee,ai as Xe,O as te,P as se,Q as b,R as T,S as Ye,aj as We,D as Ze,ak as et,al as tt,am as st,an as nt,U as at,n as lt,a6 as ot,ao as it,ap as ne,X as ae,d as ct,z as dt,a1 as ut,F as rt}from"./index-BjwOe50_.js";import{_ as pt,a as _t}from"./SearchInput-CiogdeIK.js";import{_ as vt}from"./sort-rounded-_U94qvL7.js";import{u as kt,a as mt}from"./key-events-C_0dFOja.js";import{u as gt}from"./search-Cp54c8dH.js";import"./search-rounded-DTTX8wGU.js";const le=h=>{V.emit("tap_phone",h)};function ht(h,A){const m=h.findIndex(L=>L.id===A);m!==-1&&h.splice(m,1)}const ft={class:"top-app-bar"},yt=["checked","indeterminate"],bt={class:"title"},wt={key:0},Ct={key:1},$t={class:"actions"},St=["disabled"],It={key:0,indeterminate:""},Dt={class:"menu-items"},At=["selected","onClick"],Lt={slot:"headline"},Ut={class:"scroll-content"},qt=["onClick","onMouseover"],Bt={class:"start"},Et=["checked","onClick"],Ft=["checked","onClick"],Mt={class:"number"},Pt=["src"],Tt={class:"title"},Vt={class:"subtitle"},xt={class:"actions"},Kt={indeterminate:"",class:"spinner-sm"},zt=["onClick"],Qt=["onClick"],Gt=["onClick"],Nt={class:"time"},Rt={class:"start"},jt={class:"number"},Ht={key:0,class:"no-data-placeholder"},g=50,Ot=Pe({__name:"AppsView",setup(h){var Y;const{app:A,urlTokenKey:m,uploads:L}=W(Te()),{input:oe,upload:ie,uploadChanged:x}=Ve(L),K=xe(),u=S([]),{t:U}=Ke(),{appSortBy:w}=W(K),{parseQ:ce}=gt(),z=ze({tagIds:[]}),de=nt(),C=S(!1),Q=Qe(),G=Q.query,q=S(parseInt(((Y=G.page)==null?void 0:Y.toString())??"1")),$=S(""),{selectedIds:f,allChecked:N,realAllChecked:B,selectRealAll:ue,allCheckedAlertVisible:re,clearSelection:E,toggleAllChecked:R,toggleSelect:j,total:p,checked:F,shiftEffectingIds:H,handleItemClick:pe,handleMouseOver:_e,selectAll:ve,shouldSelect:ke}=kt(u),{downloadItems:me}=Ge(m,Ne.PACKAGE,E,"apps.zip"),{downloadFile:ge}=it(m),M=e=>{const s=Q.query.q;dt(K,s?`/apps?page=${e}&q=${s}`:`/apps?page=${e}`)},{keyDown:O,keyUp:J}=mt(p,g,q,ve,E,M,()=>{}),he=()=>{ie(A.value.downloadsDir)},fe=["user","system"].map(e=>({id:e,name:U("app_type."+e)})),ye=e=>{e.isUninstalling=!1},{loading:P,fetch:be}=Z({handle:(e,s)=>{C.value=!1,s?Ze(U(s),"error"):e&&(u.value=e.packages.map(y=>({...y,isUninstalling:!1,icon:et(m.value,"pkgicon://"+y.id)})),p.value=e.packageCount)},document:We,variables:()=>({offset:(q.value-1)*g,limit:g,query:$.value,sortBy:w.value})});function we(e){return e?`/apps?q=${e}`:"/apps"}function Ce(e,s){if(w.value===s){e.close();return}C.value=!0,w.value=s,M(1),e.close()}const{mutate:$e}=Re({document:tt});function Se(e){e.isUninstalling=!0,le(U("confirm_uninstallation_on_phone")),$e({id:e.id})}const{loading:Ie,fetch:De}=Z({handle:e=>{if(e)for(const s of e.packageStatuses)s.exist||(ht(u.value,s.id),le(""))},document:st,variables:()=>({ids:u.value.filter(e=>e.isUninstalling).map(e=>e.id)})}),X=e=>{e.status};return je(()=>{var e;setInterval(()=>{u.value.some(s=>s.isUninstalling)&&!Ie.value&&De()},1e3),$.value=ut(((e=G.q)==null?void 0:e.toString())??""),ce(z,$.value),be(),V.on("upload_task_done",X),window.addEventListener("keydown",O),window.addEventListener("keyup",J)}),He(()=>{V.off("upload_task_done",X),window.removeEventListener("keydown",O),window.removeEventListener("keyup",J)}),(e,s)=>{const y=Je,Ae=pt,Le=vt,Ue=Xe,qe=_t,Be=at,Ee=ot,Fe=Me,_=Oe("tooltip");return l(),o(b,null,[a("div",ft,[a("md-checkbox",{"touch-target":"wrapper",checked:t(N),indeterminate:!t(N)&&t(F),onChange:s[0]||(s[0]=(...n)=>t(R)&&t(R)(...n))},null,40,yt),a("div",bt,[t(f).length?(l(),o("span",wt,i(e.$t("x_selected",{count:t(B)?t(p).toLocaleString():t(f).length.toLocaleString()})),1)):(l(),o("span",Ct,i(e.$t("page_title.apps"))+" ("+i(t(p).toLocaleString())+")",1)),t(F)?k((l(),o("button",{key:2,class:"btn-icon",onClick:s[1]||(s[1]=r(n=>t(me)(t(B),t(f),$.value),["stop"]))},[s[3]||(s[3]=a("md-ripple",null,null,-1)),v(y)])),[[_,e.$t("download")]]):I("",!0)]),a("div",$t,[v(Ae,{filter:z,types:t(fe),"get-url":we},null,8,["filter","types"]),a("button",{class:"btn-icon",style:{display:"none"},onClick:r(he,["stop"])},[s[4]||(s[4]=a("md-ripple",null,null,-1)),D(" "+i(e.$t("install")),1)]),v(Ue,null,{content:ee(n=>[a("div",Dt,[(l(!0),o(b,null,T(t(de),d=>(l(),o("md-menu-item",{key:d.value,selected:d.value===t(w),onClick:c=>Ce(n,d.value)},[a("div",Lt,i(e.$t(d.label)),1)],8,At))),128))])]),default:ee(()=>[k((l(),o("button",{class:"btn-icon btn-sort",disabled:C.value},[s[5]||(s[5]=a("md-ripple",null,null,-1)),C.value?(l(),o("md-circular-progress",It)):(l(),te(Le,{key:1}))],8,St)),[[_,e.$t("sort")]])]),_:1})])]),v(qe,{limit:g,total:t(p),"all-checked-alert-visible":t(re),"real-all-checked":t(B),"select-real-all":t(ue),"clear-selection":t(E)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",Ut,[a("div",{class:se(["app-list",{"select-mode":t(F)}])},[(l(!0),o(b,null,T(u.value,(n,d)=>(l(),o("section",{key:n.id,class:se(["app-item selectable-card",{selected:t(f).includes(n.id),selecting:t(H).includes(n.id)}]),onClick:r(c=>t(pe)(c,n,d,()=>{}),["stop"]),onMouseover:c=>t(_e)(c,d)},[a("div",Bt,[t(H).includes(n.id)?(l(),o("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:t(ke),onClick:r(c=>t(j)(c,n,d),["stop"])},null,8,Et)):(l(),o("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:t(f).includes(n.id),onClick:r(c=>t(j)(c,n,d),["stop"])},null,8,Ft)),a("span",Mt,[v(Be,{id:d+1,raw:n},null,8,["id","raw"])])]),a("img",{class:"image",width:"50",height:"50",src:n.icon},null,8,Pt),a("div",Tt,i(n.name)+" ("+i(n.version)+")",1),a("div",Vt,[a("span",null,i(n.id),1),a("span",null,i(t(lt)(n.size)),1),a("span",null,i(e.$t("app_type."+n.type)),1)]),a("div",xt,[n.isUninstalling?(l(),o(b,{key:0},[k(a("md-circular-progress",Kt,null,512),[[_,e.$t("uninstalling")]]),s[6]||(s[6]=D(" Â ")),a("md-outlined-button",{class:"btn-sm",onClick:r(c=>ye(n),["stop"])},i(e.$t("cancel")),9,zt)],64)):k((l(),o("button",{key:1,class:"btn-icon sm",onClick:r(c=>Se(n),["stop"])},[s[7]||(s[7]=a("md-ripple",null,null,-1)),v(Ee)],8,Qt)),[[_,e.$t("uninstall")]]),k((l(),o("button",{class:"btn-icon sm",onClick:r(c=>t(ge)(n.path,`${n.name.replace(" ","")}-${n.id}.apk`),["stop"])},[s[8]||(s[8]=a("md-ripple",null,null,-1)),v(y)],8,Gt)),[[_,e.$t("download")]])]),a("div",Nt,[k((l(),o("span",null,[D(i(e.$t("installed_at"))+": "+i(t(ae)(n.installedAt)),1)])),[[_,t(ne)(n.installedAt)]]),k((l(),o("span",null,[D(i(e.$t("updated_at"))+": "+i(t(ae)(n.updatedAt)),1)])),[[_,t(ne)(n.updatedAt)]])])],42,qt))),128)),t(P)&&u.value.length===0?(l(),o(b,{key:0},T(20,n=>a("section",{key:n,class:"app-item selectable-card-skeleton"},[a("div",Rt,[s[9]||(s[9]=a("div",{class:"checkbox"},[a("div",{class:"skeleton-checkbox"})],-1)),a("span",jt,i(n),1)]),s[10]||(s[10]=ct('<div class="image" data-v-61e13043><div class="skeleton-image" data-v-61e13043></div></div><div class="title" data-v-61e13043><div class="skeleton-text skeleton-title" data-v-61e13043></div></div><div class="subtitle" data-v-61e13043><div class="skeleton-text skeleton-subtitle" data-v-61e13043></div></div><div class="actions" data-v-61e13043><div class="skeleton-text skeleton-actions" data-v-61e13043></div></div><div class="time" data-v-61e13043><div class="skeleton-text skeleton-time" data-v-61e13043></div><div class="skeleton-text skeleton-time" data-v-61e13043></div></div>',5))])),64)):I("",!0)],2),!t(P)&&u.value.length===0?(l(),o("div",Ht,i(e.$t(t(Ye)(t(P)))),1)):I("",!0),t(p)>g?(l(),te(Fe,{key:1,page:q.value,go:M,total:t(p),limit:g},null,8,["page","total"])):I("",!0),a("input",{ref_key:"fileInput",ref:oe,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:s[2]||(s[2]=(...n)=>t(x)&&t(x)(...n))},null,544)])],64)}}}),ss=rt(Ot,[["__scopeId","data-v-61e13043"]]);export{ss as default};
