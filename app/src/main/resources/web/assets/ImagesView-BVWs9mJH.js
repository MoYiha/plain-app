import{_ as fo}from"./VPagination.vuevuetypescriptsetuptruelang-DUdPyPtr.js";import{_ as Co,a as $o,b as bo,c as wo,d as Io}from"./grid-view-outline-rounded-0fx6hZgv.js";import{d as Do,u as To,s as Ue,h as G,g as So,I as Ao,i as Eo,ag as Be,aD as Fo,J as Mo,aE as Lo,aF as Re,aG as Vo,ah as zo,K as qo,L as Uo,M as Bo,c as p,a as r,m as e,t as y,O as f,x as u,v as i,q as d,w as a,e as M,p as l,aH as Ro,N as B,P as O,Q as No,aI as Ho,f as Ko,C as Po,aJ as Qo,aK as Go,am as Oo,S as Jo,o as t,aL as re,aA as ue,aM as L,E as Ne,U as Wo,V as Xo,W as jo,X as Zo,ap as Yo,ao as xo,Z as es,$ as os,a0 as ss,a1 as V,ae as ts,aq as ns,a2 as as,aN as ls,a4 as is,a3 as cs,aO as ds}from"./index-B-S542RM.js";import{_ as rs,a as us,b as _s}from"./SearchInput-D0d2xIiv.js";import{_ as ps}from"./sort-rounded-BVzv_GA2.js";import{_ as ms}from"./upload-rounded-_5wwNL4r.js";import{_ as ks}from"./restore-from-trash-outline-rounded-Ck6P-VkW.js";import{_ as gs}from"./IconButton.vuevuetypescriptsetuptruelang-CxW8gnDA.js";import{u as vs}from"./search-k8SzNgo1.js";import{a as hs}from"./tags-x91i2rzh.js";import{u as ys,a as fs}from"./key-events-D1Kh05Em.js";import{u as Cs,a as $s}from"./media-trash-C0Lwc6-9.js";import{h as _e}from"./feature-Cs4tKJbl.js";import"./search-rounded-TCa6qTC1.js";import"./rss-feed-rounded-DzJ3TVan.js";import"./vee-validate.esm-D5u4WlYW.js";const bs={class:"top-app-bar"},ws=["checked","indeterminate"],Is={class:"title"},Ds={key:0},Ts={key:1},Ss={class:"actions"},As=["onClick"],Es={slot:"headline"},Fs=["onClick"],Ms={slot:"headline"},Ls={class:"menu-items"},Vs=["onClick","selected"],zs={slot:"headline"},qs={class:"sm"},Us=["selected"],Bs=["selected"],Rs=["onClick","onMouseover"],Ns=["src"],Hs={key:1,class:"actions"},Ks={class:"right"},Ps=["onClick","onMouseover"],Qs={class:"start"},Gs=["onClick","checked"],Os=["onClick","checked"],Js={class:"number"},Ws=["src"],Xs={class:"title"},js={class:"subtitle"},Zs=["onClick"],Ys={class:"actions"},xs={class:"time"},et={key:2,class:"no-data-placeholder"},T=55,ht=Do({__name:"ImagesView",setup(ot){var Le;const I=To(),{imageSortBy:J}=Ue(I),D=G([]),{t:He}=So(),{parseQ:Ke}=vs(),S=Ao({tagIds:[]}),pe=Eo(),{app:z,urlTokenKey:W,uploads:X}=Ue(pe),{input:Pe,upload:Qe,uploadChanged:me}=Be(X),{input:Ge,upload:Oe,uploadChanged:ke}=Be(X),{dropping:Je,fileDragEnter:ge,fileDragLeave:ve,dropFiles:We}=Fo(X),j=G(!1),k=Mo.IMAGE,he=No(),ye=he.query,Z=G(parseInt(((Le=ye.page)==null?void 0:Le.toString())??"1")),{tags:R,buckets:Y,fetch:Xe}=Lo(k),je=Re(()=>{const o={};return Y.value.forEach(n=>{o[n.id]=n}),o}),$=G(""),{addToTags:Ze}=hs(k,R),{deleteItems:x,deleteItem:N}=Vo(),{view:Ye}=Ho(k),{selectedIds:h,allChecked:fe,realAllChecked:w,selectRealAll:xe,allCheckedAlertVisible:eo,clearSelection:A,toggleAllChecked:Ce,toggleSelect:q,total:b,checked:U,shiftEffectingIds:H,handleItemClick:$e,handleMouseOver:be,selectAll:oo,shouldSelect:we}=ys(D),{downloadItems:Ie}=zo(W,k,A,"images.zip"),{downloadFile:K}=Yo(W),De=o=>{const n=he.query.q;Ko(I,n?`/images?page=${o}&q=${n}`:`/images?page=${o}`)},{keyDown:Te,keyUp:Se}=fs(b,T,Z,oo,A,De,()=>{x(k,h.value,w.value,b.value,$.value)}),so=xo(),to=Re(()=>D.value.map(o=>({src:ue(o.fileId),name:L(o.path),duration:0,size:o.size,path:o.path,type:k,data:o})));function ee(o){pe.lightbox={sources:to.value,index:o,visible:!0}}const P=()=>{let o=$.value;return w.value||(o=`ids:${h.value.join(",")}`),o};function Ae(o){es(os,{type:k,tags:R.value,item:{key:o.id,title:o.title,size:o.size},selected:R.value.filter(n=>o.tags.some(C=>C.id===n.id))})}function no(o,n){j.value=!0,J.value=n,o.close()}const{loading:Q,fetch:E}=qo({handle:async(o,n)=>{if(j.value=!1,n)Po(He(n),"error");else if(o){const C=[];for(const c of o.images)C.push({...c,fileId:Qo(W.value,c.path,c.id)});D.value=C,b.value=o.imageCount}},document:Go,variables:()=>({offset:(Z.value-1)*T,limit:T,query:$.value,sortBy:J.value}),appApi:!0}),{trashLoading:oe,trash:se}=Cs(k,A,E),{restoreLoading:te,restore:ne}=$s(k,A,E);function ao(o){return o?`/images?q=${o}`:"/images"}function ae(){const o=Y.value.find(n=>n.id===S.bucketId);return o?ds(o.topItems[0]):`${z.value.internalStoragePath}/Pictures`}function lo(o){Qe(ae()),o.close()}function io(o){Oe(ae()),o.close()}function co(o){We(o,ae(),"image")}const Ee=o=>{o.type===k&&(A(),E())},Fe=o=>{o.type===k&&E()},Me=o=>{o.type===k&&(A(),E())};return Uo(()=>{var o;$.value=ss(((o=ye.q)==null?void 0:o.toString())??""),Ke(S,$.value),Xe(),E(),V.on("item_tags_updated",Fe),V.on("items_tags_updated",Ee),V.on("media_items_actioned",Me),window.addEventListener("keydown",Te),window.addEventListener("keyup",Se)}),Bo(()=>{V.off("item_tags_updated",Fe),V.off("items_tags_updated",Ee),V.off("media_items_actioned",Me),window.removeEventListener("keydown",Te),window.removeEventListener("keyup",Se)}),(o,n)=>{const C=ts,c=gs,le=ks,F=ns,ie=_s,ce=as,ro=rs,uo=ms,Ve=Oo,_o=ps,po=Co,mo=$o,ko=us,de=bo,ze=wo,go=ls,qe=is,vo=cs,ho=Io,yo=fo,_=Jo("tooltip");return t(),p(f,null,[r("div",bs,[r("md-checkbox",{"touch-target":"wrapper",onChange:n[0]||(n[0]=(...s)=>e(Ce)&&e(Ce)(...s)),checked:e(fe),indeterminate:!e(fe)&&e(U)},null,40,ws),r("div",Is,[e(h).length?(t(),p("span",Ds,y(o.$t("x_selected",{count:e(w)?e(b).toLocaleString():e(h).length.toLocaleString()})),1)):(t(),p("span",Ts,y(o.$t("page_title.images"))+" ("+y(e(b).toLocaleString())+")",1)),e(U)?(t(),p(f,{key:2},[S.trash?(t(),p(f,{key:0},[u((t(),i(c,{onClick:n[1]||(n[1]=a(s=>e(x)(e(k),e(h),e(w),e(b),$.value),["stop"]))},{icon:d(()=>[l(C)]),_:1})),[[_,o.$t("delete")]]),u((t(),i(c,{onClick:n[2]||(n[2]=a(s=>e(ne)(P()),["stop"])),loading:e(te)(P())},{icon:d(()=>[l(le)]),_:1},8,["loading"])),[[_,o.$t("restore")]]),u((t(),i(c,{onClick:n[3]||(n[3]=a(s=>e(Ie)(e(w),e(h),$.value),["stop"]))},{icon:d(()=>[l(F)]),_:1})),[[_,o.$t("download")]])],64)):(t(),p(f,{key:1},[e(_e)(e(re).MEDIA_TRASH,e(z).osVersion)?u((t(),i(c,{key:0,onClick:n[4]||(n[4]=a(s=>e(se)(P()),["stop"])),loading:e(oe)(P())},{icon:d(()=>[l(ie)]),_:1},8,["loading"])),[[_,o.$t("move_to_trash")]]):u((t(),i(c,{key:1,onClick:n[5]||(n[5]=a(s=>e(x)(e(k),e(h),e(w),e(b),$.value),["stop"]))},{icon:d(()=>[l(C)]),_:1})),[[_,o.$t("delete")]]),u((t(),i(c,{onClick:n[6]||(n[6]=a(s=>e(Ie)(e(w),e(h),$.value),["stop"]))},{icon:d(()=>[l(F)]),_:1})),[[_,o.$t("download")]]),u((t(),i(c,{onClick:n[7]||(n[7]=a(s=>e(Ze)(e(h),e(w),$.value),["stop"]))},{icon:d(()=>[l(ce)]),_:1})),[[_,o.$t("add_to_tags")]])],64))],64)):M("",!0)]),r("div",Ss,[l(ro,{filter:S,tags:e(R),buckets:e(Y),"get-url":ao},null,8,["filter","tags","buckets"]),S.trash?M("",!0):(t(),i(Ve,{key:0},{content:d(s=>[r("md-menu-item",{onClick:a(g=>lo(s),["stop"])},[r("div",Es,y(o.$t("upload_files")),1)],8,As),r("md-menu-item",{onClick:a(g=>io(s),["stop"])},[r("div",Ms,y(o.$t("upload_folder")),1)],8,Fs)]),default:d(()=>[u((t(),i(c,null,{icon:d(()=>[l(uo)]),_:1})),[[_,o.$t("upload")]])]),_:1})),l(Ve,null,{content:d(s=>[r("div",Ls,[(t(!0),p(f,null,O(e(so),g=>(t(),p("md-menu-item",{onClick:m=>no(s,g.value),key:g.value,selected:g.value===e(J)},[r("div",zs,y(o.$t(g.label)),1)],8,Vs))),128))])]),default:d(()=>[u((t(),i(c,{loading:j.value},{icon:d(()=>[l(_o)]),_:1},8,["loading"])),[[_,o.$t("sort")]])]),_:1}),r("md-outlined-segmented-button-set",qs,[r("md-outlined-segmented-button",{"data-value":"grid","no-checkmark":"",selected:!e(I).imagesCardView,onClick:n[8]||(n[8]=s=>e(I).imagesCardView=!1)},[l(po,{slot:"icon"})],8,Us),r("md-outlined-segmented-button",{"data-value":"card","no-checkmark":"",selected:e(I).imagesCardView,onClick:n[9]||(n[9]=s=>e(I).imagesCardView=!0)},[l(mo,{slot:"icon"})],8,Bs)])])]),l(ko,{limit:T,total:e(b),"all-checked-alert-visible":e(eo),"real-all-checked":e(w),"select-real-all":e(xe),"clear-selection":e(A)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),r("div",{class:"scroll-content",onDragover:n[13]||(n[13]=a((...s)=>e(ge)&&e(ge)(...s),["stop","prevent"]))},[u(r("div",{class:"drag-mask",onDrop:a(co,["stop","prevent"]),onDragleave:n[10]||(n[10]=a((...s)=>e(ve)&&e(ve)(...s),["stop","prevent"]))},y(o.$t("release_to_send_files")),545),[[Ro,e(Je)]]),e(I).imagesCardView?(t(),p("div",{key:1,class:B(["media-list",{"select-mode":e(U)}])},[(t(!0),p(f,null,O(D.value,(s,g)=>{var m;return t(),p("section",{class:B(["media-item selectable-card",{selected:e(h).includes(s.id),selecting:e(H).includes(s.id)}]),key:s.id,onClick:a(v=>e($e)(v,s,g,ee),["stop"]),onMouseover:v=>e(be)(v,g)},[r("div",Qs,[e(H).includes(s.id)?(t(),p("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:a(v=>e(q)(v,s,g),["stop"]),checked:e(we)},null,8,Gs)):(t(),p("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:a(v=>e(q)(v,s,g),["stop"]),checked:e(h).includes(s.id)},null,8,Os)),r("span",Js,[l(vo,{id:g+1,raw:s},null,8,["id","raw"])])]),r("img",{class:"image",src:e(ue)(s.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,Ws),r("div",Xs,y(e(L)(s.path)),1),r("div",js,[r("span",null,y(e(Ne)(s.size)),1),r("a",{onClick:a(v=>e(Ye)(e(I),s.bucketId),["stop","prevent"])},y((m=je.value[s.bucketId])==null?void 0:m.name),9,Zs),l(qe,{tags:s.tags,type:e(k),"only-links":!0},null,8,["tags","type"])]),r("div",Ys,[S.trash?(t(),p(f,{key:0},[u((t(),i(c,{class:"sm",onClick:a(v=>e(N)(e(k),s),["stop"])},{icon:d(()=>[l(C)]),_:2},1032,["onClick"])),[[_,o.$t("delete")]]),u((t(),i(c,{class:"sm",onClick:a(v=>e(ne)(`ids:${s.id}`),["stop"]),loading:e(te)(`ids:${s.id}`)},{icon:d(()=>[l(le)]),_:2},1032,["onClick","loading"])),[[_,o.$t("restore")]]),u((t(),i(c,{class:"sm",onClick:a(v=>e(K)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(F)]),_:2},1032,["onClick"])),[[_,o.$t("download")]])],64)):(t(),p(f,{key:1},[e(_e)(e(re).MEDIA_TRASH,e(z).osVersion)?u((t(),i(c,{key:0,class:"sm",onClick:a(v=>e(se)(`ids:${s.id}`),["stop"]),loading:e(oe)(`ids:${s.id}`)},{icon:d(()=>[l(ie)]),_:2},1032,["onClick","loading"])),[[_,o.$t("move_to_trash")]]):u((t(),i(c,{key:1,class:"sm",onClick:a(v=>e(N)(e(k),s),["stop"])},{icon:d(()=>[l(C)]),_:2},1032,["onClick"])),[[_,o.$t("delete")]]),u((t(),i(c,{class:"sm",onClick:a(v=>e(K)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(F)]),_:2},1032,["onClick"])),[[_,o.$t("download")]]),u((t(),i(c,{class:"sm",onClick:a(v=>Ae(s),["stop"])},{icon:d(()=>[l(ce)]),_:2},1032,["onClick"])),[[_,o.$t("add_to_tags")]])],64))]),r("div",xs,[u((t(),p("span",null,[Xo(y(e(jo)(s.createdAt)),1)])),[[_,e(Wo)(s.createdAt)]])])],42,Ps)}),128)),e(Q)&&D.value.length===0?(t(),i(ho,{key:0,limit:T})):M("",!0)],2)):(t(),p("div",{key:0,class:B(["media-grid",{"select-mode":e(U)}])},[(t(!0),p(f,null,O(D.value,(s,g)=>(t(),p("section",{class:B(["media-item",{selected:e(h).includes(s.id),selecting:e(H).includes(s.id)}]),key:s.id,onClick:a(m=>e($e)(m,s,g,ee),["stop"]),onMouseover:m=>e(be)(m,g)},[r("img",{class:"image-thumb image",src:e(ue)(s.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,Ns),e(H).includes(s.id)?(t(),i(c,{key:0,class:"btn-checkbox",onClick:a(m=>e(q)(m,s,g),["stop"])},{icon:d(()=>[e(we)?(t(),i(de,{key:0})):(t(),i(ze,{key:1}))]),_:2},1032,["onClick"])):e(h).includes(s.id)?(t(),i(c,{key:1,class:"btn-checkbox",onClick:a(m=>e(q)(m,s,g),["stop"])},{icon:d(()=>[l(de)]),_:2},1032,["onClick"])):(t(),p(f,{key:2},[l(c,{class:"btn-checkbox",onClick:a(m=>e(q)(m,s,g),["stop"])},{icon:d(()=>[e(h).includes(s.id)?(t(),i(de,{key:0})):(t(),i(ze,{key:1}))]),_:2},1032,["onClick"]),e(U)?u((t(),i(c,{key:0,class:"btn-zoom sm",onClick:a(m=>ee(g),["stop"])},{icon:d(()=>[l(go)]),_:2},1032,["onClick"])),[[_,o.$t("open")]]):(t(),p("div",Hs,[S.trash?(t(),p(f,{key:0},[u((t(),i(c,{class:"sm",onClick:a(m=>e(N)(e(k),s),["stop"])},{icon:d(()=>[l(C)]),_:2},1032,["onClick"])),[[_,o.$t("delete")]]),u((t(),i(c,{class:"sm",onClick:a(m=>e(ne)(`ids:${s.id}`),["stop"]),loading:e(te)(`ids:${s.id}`)},{icon:d(()=>[l(le)]),_:2},1032,["onClick","loading"])),[[_,o.$t("restore")]]),u((t(),i(c,{class:"sm",onClick:a(m=>e(K)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(F)]),_:2},1032,["onClick"])),[[_,o.$t("download")]])],64)):(t(),p(f,{key:1},[e(_e)(e(re).MEDIA_TRASH,e(z).osVersion)?u((t(),i(c,{key:0,class:"sm",onClick:a(m=>e(se)(`ids:${s.id}`),["stop"]),loading:e(oe)(`ids:${s.id}`)},{icon:d(()=>[l(ie)]),_:2},1032,["onClick","loading"])),[[_,o.$t("move_to_trash")]]):u((t(),i(c,{key:1,class:"sm",onClick:a(m=>e(N)(e(k),s),["stop"])},{icon:d(()=>[l(C)]),_:2},1032,["onClick"])),[[_,o.$t("delete")]]),u((t(),i(c,{class:"sm",onClick:a(m=>e(K)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(F)]),_:2},1032,["onClick"])),[[_,o.$t("download")]]),u((t(),i(c,{class:"sm",onClick:a(m=>Ae(s),["stop"])},{icon:d(()=>[l(ce)]),_:2},1032,["onClick"])),[[_,o.$t("add_to_tags")]])],64))])),r("div",{class:B(["info",{"has-tags":s.tags.length>0}])},[l(qe,{tags:s.tags,type:e(k)},null,8,["tags","type"]),r("span",Ks,y(e(Ne)(s.size)),1)],2)],64))],42,Rs))),128)),e(Q)&&D.value.length===0?(t(),p(f,{key:0},O(T,s=>r("section",{class:"skeleton-image media-item",key:s})),64)):M("",!0)],2)),!e(Q)&&D.value.length===0?(t(),p("div",et,y(o.$t(e(Zo)(e(Q),e(z).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):M("",!0),e(b)>T?(t(),i(yo,{key:3,page:Z.value,go:De,total:e(b),limit:T},null,8,["page","total"])):M("",!0),r("input",{ref_key:"fileInput",ref:Pe,style:{display:"none"},type:"file",accept:"image/*",multiple:"",onChange:n[11]||(n[11]=(...s)=>e(me)&&e(me)(...s))},null,544),r("input",{ref_key:"dirFileInput",ref:Ge,style:{display:"none"},type:"file",accept:"image/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[12]||(n[12]=(...s)=>e(ke)&&e(ke)(...s))},null,544)],32)],64)}}});export{ht as default};
