import{_ as Ue}from"./VPagination.vuevuetypescriptsetuptruelang-CUh5gD9j.js";import{m as xe,c as r,o as s,a as l,i as x,bm as Be,I as B,a4 as b,J as G,bn as Ge,e as Ke,f as Oe,r as U,u as je,K as Fe,L as Pe,bo as Je,M as We,N as Xe,k as i,j as D,R as c,l as e,t as T,T as w,O as h,P as Ze,p as _,y as d,U as Ye,S as de,bp as et,V as tt,aT as st,as as ot,bq as at,E as nt,br as lt,a7 as it,aW as ct,aX as rt,Q as dt,F as ue,d as ut,bs as _t,Z as pt,$ as mt,a0 as vt,A as _e,a1 as pe,a2 as gt,aa as ht,bl as kt,ab as ft,a5 as me,a3 as yt,bt as $t,H as Tt}from"./index-Dd8UjYtJ.js";import{_ as bt}from"./FieldId.vuevuetypescriptsetuptruelang-BnKTOzAN.js";import{_ as qt,a as Ct}from"./SearchInput-CX6-UxKh.js";import{_ as wt}from"./VCheckbox-lCJ3fupj.js";import{u as Nt,b as Lt,a as St}from"./key-events-U1fzVka7.js";import{u as Dt,a as Vt}from"./tags-YQVchJJ5.js";import{u as Et}from"./search-CEqTgbsb.js";import"./VInputChip-xYeMr_VW.js";const Mt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function At(E,k){return s(),r("svg",Mt,k[0]||(k[0]=[l("path",{fill:"currentColor",d:"M19 17.7v1.8q0 .2.15.35t.35.15t.35-.15t.15-.35v-3q0-.2-.15-.35T19.5 16h-3q-.2 0-.35.15t-.15.35t.15.35t.35.15h1.8l-2.45 2.45q-.15.15-.15.35t.15.35t.35.15t.35-.15zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v5q0 .425-.288.713T20 11t-.712-.288T19 10V5H5v14h5q.425 0 .713.288T11 20t-.288.713T10 21zm0-3v1V5v6.075V11zm2-2q0 .425.288.713T8 17h2.075q.425 0 .713-.288t.287-.712t-.287-.712t-.713-.288H8q-.425 0-.712.288T7 16m0-4q0 .425.288.713T8 13h5q.425 0 .713-.288T14 12t-.288-.712T13 11H8q-.425 0-.712.288T7 12m0-4q0 .425.288.713T8 9h8q.425 0 .713-.288T17 8t-.288-.712T16 7H8q-.425 0-.712.288T7 8m11 15q-2.075 0-3.537-1.463T13 18t1.463-3.537T18 13t3.538 1.463T23 18t-1.463 3.538T18 23"},null,-1)]))}const It=xe({name:"material-symbols-export-notes-outline-rounded",render:At}),Qt=(E,k)=>{const{mutate:m,onDone:M}=x({document:Be}),f=B(new Map);return M(n=>{f.delete(n.data.trashNotes),E(),k(),b.emit("refetch_tags",G.NOTE),b.emit("notes_actioned",{action:"trash"})}),{trashLoading(n){return f.get(n)??!1},trash(n){f.set(n,!0),m({query:n})}}},zt=(E,k)=>{const{mutate:m,onDone:M}=x({document:Ge}),f=B(new Map);return M(n=>{f.delete(n.data.restoreNotes),E(),k(),b.emit("refetch_tags",G.NOTE),b.emit("notes_actioned",{action:"restore"})}),{restoreLoading(n){return f.get(n)??!1},restore(n){f.set(n,!0),m({query:n})}}},Ht={class:"top-app-bar"},Rt={class:"title"},Ut={key:0},xt={key:1},Bt={class:"actions"},Gt={key:0,class:"scroller"},Kt={class:"start"},Ot={class:"number"},jt=["href"],Ft=["onClick","onMouseover"],Pt={class:"start"},Jt={class:"number"},Wt={class:"title"},Xt={class:"subtitle"},Zt={class:"actions"},Yt={class:"time"},es={key:2,class:"no-data-placeholder"},V=50,ts=Ke({__name:"NotesView",setup(E){var ne;const k=Oe(),m=U([]),{t:M}=je(),{parseQ:f}=Et(),n=B({tagIds:[],trash:!1}),N=G.NOTE,K=Fe(),O=K.query,z=U(parseInt(((ne=O.page)==null?void 0:ne.toString())??"1")),q=U(""),{tags:I,fetch:ve}=Dt(N),{selectedIds:$,allChecked:j,realAllChecked:L,selectRealAll:ge,allCheckedAlertVisible:he,clearSelection:C,toggleAllChecked:ke,toggleSelect:F,total:v,checked:H,shiftEffectingIds:P,handleItemClick:fe,handleMouseOver:ye,selectAll:$e,shouldSelect:Te}=Nt(m),{addToTags:be}=Vt(N,I),J=t=>{const o=K.query.q;_e(k,o?`/notes?page=${t}&q=${o}`:`/notes?page=${t}`)},{keyDown:W,keyUp:X}=St(v,V,z,$e,C,J,()=>{Z($.value,L.value,v.value,q.value)}),{loading:R,fetch:S}=Pe({handle:(t,o)=>{o?nt(M(o),"error"):t&&(m.value=t.notes,v.value=t.noteCount)},document:at,variables:()=>({offset:(z.value-1)*V,limit:V,query:q.value})});function qe(t){pe(gt,{type:N,tags:I.value,item:{key:t.id,title:"",size:0},selected:I.value.filter(o=>t.tags.some(A=>A.id===o.id))})}function Ce(t){return t?`/notes?q=${t}`:"/notes"}const{mutate:we,onDone:Ne}=x({document:lt}),Le=()=>{we({query:Q()})},Q=()=>{let t=q.value;return L.value||(t=`ids:${$.value.join(",")}`),t};Ne(t=>{Je(t.data.exportNotes,"application/json","notes.json")});const{deleteItems:Z}=Lt($t,()=>{C(),S()});function Se(t){pe(ft,{id:t.id,name:kt(t.title,{length:20}),gql:ht`
      mutation DeleteNote($query: String!) {
        deleteNotes(query: $query)
      }
    `,variables:()=>({query:`ids:${t.id}`}),done:()=>{C(),v.value--},typeName:"Note"})}const{trashLoading:De,trash:Y}=Qt(C,S),{restoreLoading:ee,restore:te}=zt(C,S);function Ve(t){_e(k,se(t))}function se(t){const o=me.currentRoute.value.query.q;return o?`/notes/${t.id}?q=${o}`:`/notes/${t.id}`}function Ee(){me.push("/notes/create")}const oe=t=>{t.type===N&&(C(),S())},ae=t=>{t.type===N&&S()};return We(()=>{var t;q.value=yt(((t=O.q)==null?void 0:t.toString())??""),f(n,q.value),n.trash===void 0&&(n.trash=!1),ve(),S(),b.on("item_tags_updated",ae),b.on("items_tags_updated",oe),window.addEventListener("keydown",W),window.addEventListener("keyup",X)}),Xe(()=>{b.off("item_tags_updated",ae),b.off("items_tags_updated",oe),window.removeEventListener("keydown",W),window.removeEventListener("keyup",X)}),(t,o)=>{const A=wt,le=it,y=st,ie=ct,ce=rt,re=dt,Me=It,Ae=qt,Ie=ot,Qe=Ct,ze=bt,He=pt,Re=Ue,g=Ze("tooltip");return s(),r(w,null,[l("div",Ht,[i(A,{"touch-target":"wrapper",checked:e(j),indeterminate:!e(j)&&e(H),onChange:e(ke)},null,8,["checked","indeterminate","onChange"]),l("div",Rt,[e($).length?(s(),r("span",Ut,T(t.$t("x_selected",{count:e(L)?e(v).toLocaleString():e($).length.toLocaleString()})),1)):(s(),r("span",xt,T(t.$t("page_title.notes"))+" ("+T(e(v).toLocaleString())+")",1)),e(H)?(s(),r(w,{key:2},[n.trash?(s(),r(w,{key:0},[h((s(),c(y,{onClick:o[0]||(o[0]=d(u=>e(Z)(e($),e(L),e(v),q.value),["stop"]))},{default:_(()=>[i(le)]),_:1})),[[g,t.$t("delete")]]),h((s(),c(y,{loading:e(ee)(Q()),onClick:o[1]||(o[1]=d(u=>e(te)(Q()),["stop"]))},{default:_(()=>[i(ie)]),_:1},8,["loading"])),[[g,t.$t("restore")]])],64)):(s(),r(w,{key:1},[h((s(),c(y,{onClick:o[2]||(o[2]=d(u=>e(Y)(Q()),["stop"]))},{default:_(()=>[i(ce)]),_:1})),[[g,t.$t("move_to_trash")]]),h((s(),c(y,{onClick:o[3]||(o[3]=d(u=>e(be)(e($),e(L),q.value),["stop"]))},{default:_(()=>[i(re)]),_:1})),[[g,t.$t("add_to_tags")]]),h((s(),c(y,{onClick:d(Le,["stop"])},{default:_(()=>[i(Me)]),_:1})),[[g,t.$t("export_notes")]])],64))],64)):D("",!0)]),l("div",Bt,[i(Ae,{filter:n,tags:e(I),"get-url":Ce,"show-trash":!0},null,8,["filter","tags"]),n.trash?D("",!0):(s(),c(Ie,{key:0,class:"btn-sm",onClick:d(Ee,["prevent"])},{default:_(()=>[ue(T(t.$t("create")),1)]),_:1}))])]),i(Qe,{limit:V,total:e(v),"all-checked-alert-visible":e(he),"real-all-checked":e(L),"select-real-all":e(ge),"clear-selection":e(C)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(R)&&m.value.length===0?(s(),r("div",Gt,[(s(),r(w,null,Ye(20,u=>l("article",{key:u,class:"note-item selectable-card-skeleton"},[l("div",Kt,[o[4]||(o[4]=l("div",{class:"checkbox"},[l("div",{class:"skeleton-checkbox"})],-1)),l("span",Ot,T(u),1)]),o[5]||(o[5]=ut('<div class="title" data-v-c544c579><div class="skeleton-text skeleton-title" data-v-c544c579></div></div><div class="subtitle" data-v-c544c579><div class="skeleton-text skeleton-subtitle" data-v-c544c579></div></div><div class="actions" data-v-c544c579><div class="skeleton-text skeleton-actions" data-v-c544c579></div></div><div class="time" data-v-c544c579><div class="skeleton-text skeleton-time" data-v-c544c579></div></div>',4))])),64))])):D("",!0),m.value.length?(s(),c(e(et),{key:1,class:de(["scroller",{"select-mode":e(H)}]),"data-key":"id","data-sources":m.value,"estimate-size":100},{item:_(({index:u,item:a})=>[(s(),r("a",{key:a.id,class:"item-link",href:se(a)},[l("article",{class:de(["note-item selectable-card",{selected:e($).includes(a.id)||a.id==t.$route.params.id,selecting:e(P).includes(a.id)}]),onClick:d(p=>e(fe)(p,a,u,()=>{Ve(a)}),["stop","prevent"]),onMouseover:p=>e(ye)(p,u)},[l("div",Pt,[e(P).includes(a.id)?(s(),c(A,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(Te),onClick:d(p=>e(F)(p,a,u),["stop"])},null,8,["checked","onClick"])):(s(),c(A,{key:1,class:"checkbox","touch-target":"wrapper",checked:e($).includes(a.id),onClick:d(p=>e(F)(p,a,u),["stop"])},null,8,["checked","onClick"])),l("span",Jt,[i(ze,{id:u+1,raw:a},null,8,["id","raw"])])]),l("div",Wt,T(e(_t)(a.title.split(`
`)[0].trimStart())||t.$t("meta_no_title")),1),l("div",Xt,[i(He,{tags:a.tags,type:e(N),"only-links":!0},null,8,["tags","type"])]),l("div",Zt,[n.trash?(s(),r(w,{key:0},[h((s(),c(y,{class:"sm",onClick:d(p=>Se(a),["stop","prevent"])},{default:_(()=>[i(le)]),_:2},1032,["onClick"])),[[g,t.$t("delete")]]),h((s(),c(y,{class:"sm",loading:e(ee)(`ids:${a.id}`),onClick:d(p=>e(te)(`ids:${a.id}`),["stop","prevent"])},{default:_(()=>[i(ie)]),_:2},1032,["loading","onClick"])),[[g,t.$t("restore")]])],64)):(s(),r(w,{key:1},[h((s(),c(y,{class:"sm",loading:e(De)(`ids:${a.id}`),onClick:d(p=>e(Y)(`ids:${a.id}`),["stop","prevent"])},{default:_(()=>[i(ce)]),_:2},1032,["loading","onClick"])),[[g,t.$t("move_to_trash")]]),h((s(),c(y,{class:"sm",onClick:d(p=>qe(a),["stop","prevent"])},{default:_(()=>[i(re)]),_:2},1032,["onClick"])),[[g,t.$t("add_to_tags")]])],64))]),l("div",Yt,[h((s(),r("span",null,[ue(T(e(vt)(a.updatedAt)),1)])),[[g,e(mt)(a.updatedAt)]])])],42,Ft)],8,jt))]),footer:_(()=>[e(v)>V?(s(),c(Re,{key:0,page:z.value,go:J,total:e(v),limit:V},null,8,["page","total"])):D("",!0)]),_:1},8,["data-sources","class"])):D("",!0),!e(R)&&m.value.length===0?(s(),r("div",es,T(t.$t(e(tt)(e(R)))),1)):D("",!0)],64)}}}),us=Tt(ts,[["__scopeId","data-v-c544c579"]]);export{us as default};
