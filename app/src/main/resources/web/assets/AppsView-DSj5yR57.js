import{_ as xe}from"./VPagination.vuevuetypescriptsetuptruelang-BmXTgLz3.js";import{a0 as P,d as Fe,s as Y,f as Me,af as Pe,e as Te,r as S,u as Ke,D as Ne,F as ze,ag as Ge,E as Qe,G as Z,i as Re,H as je,I as He,c as o,o as l,a,j as v,k as t,n as k,h as I,t as i,J as Oe,x as r,ah as Je,V as A,a1 as ee,ai as Xe,L as te,M as se,N as b,O as M,P as We,aj as Ye,A as Ze,ak as et,al as tt,am as st,an as nt,R as at,l as lt,a6 as ot,ao as it,ap as ne,U as ae,X as ct,y as dt,$ as ut,C as rt}from"./index-Dohfv8Fq.js";import{_ as pt,a as _t}from"./SearchInput-NYtHFioA.js";import{_ as vt}from"./sort-rounded-BtOUJVUp.js";import{u as kt,a as mt}from"./key-events-COB8z-tk.js";import{u as gt}from"./search-BGPnRmZx.js";import"./search-rounded-DoLKRhlL.js";import"./rss-feed-rounded-DCFCzJSD.js";const le=h=>{P.emit("tap_phone",h)};function ht(h,D){const m=h.findIndex(L=>L.id===D);m!==-1&&h.splice(m,1)}const ft={class:"top-app-bar"},yt=["checked","indeterminate"],bt={class:"title"},wt={key:0},Ct={key:1},$t={class:"actions"},St=["disabled"],It={key:0,indeterminate:""},At={class:"menu-items"},Dt=["selected","onClick"],Lt={slot:"headline"},Ut={class:"scroll-content"},qt=["onClick","onMouseover"],Bt={class:"start"},Et=["checked","onClick"],Vt=["checked","onClick"],xt={class:"number"},Ft=["src"],Mt={class:"title"},Pt={class:"subtitle"},Tt={class:"actions"},Kt={indeterminate:"",class:"spinner-sm"},Nt=["onClick"],zt=["onClick"],Gt=["onClick"],Qt={class:"time"},Rt={class:"start"},jt={class:"number"},Ht={key:0,class:"no-data-placeholder"},g=50,Ot=Fe({__name:"AppsView",setup(h){var W;const{app:D,urlTokenKey:m,uploads:L}=Y(Me()),{input:oe,upload:ie,uploadChanged:T}=Pe(L),K=Te(),u=S([]),{t:U}=Ke(),{appSortBy:w}=Y(K),{parseQ:ce}=gt(),N=Ne({tagIds:[]}),de=nt(),C=S(!1),z=ze(),G=z.query,q=S(parseInt(((W=G.page)==null?void 0:W.toString())??"1")),$=S(""),{selectedIds:f,allChecked:Q,realAllChecked:B,selectRealAll:ue,allCheckedAlertVisible:re,clearSelection:E,toggleAllChecked:R,toggleSelect:j,total:p,checked:V,shiftEffectingIds:H,handleItemClick:pe,handleMouseOver:_e,selectAll:ve,shouldSelect:ke}=kt(u),{downloadItems:me}=Ge(m,Qe.PACKAGE,E,"apps.zip"),{downloadFile:ge}=it(m),x=e=>{const s=z.query.q;dt(K,s?`/apps?page=${e}&q=${s}`:`/apps?page=${e}`)},{keyDown:O,keyUp:J}=mt(p,g,q,ve,E,x,()=>{}),he=()=>{ie(D.value.downloadsDir)},fe=["user","system"].map(e=>({id:e,name:U("app_type."+e)})),ye=e=>{e.isUninstalling=!1},{loading:F,fetch:be}=Z({handle:(e,s)=>{C.value=!1,s?Ze(U(s),"error"):e&&(u.value=e.packages.map(y=>({...y,isUninstalling:!1,icon:et(m.value,"pkgicon://"+y.id)})),p.value=e.packageCount)},document:Ye,variables:()=>({offset:(q.value-1)*g,limit:g,query:$.value,sortBy:w.value})});function we(e){return e?`/apps?q=${e}`:"/apps"}function Ce(e,s){if(w.value===s){e.close();return}C.value=!0,w.value=s,x(1),e.close()}const{mutate:$e}=Re({document:tt});function Se(e){e.isUninstalling=!0,le(U("confirm_uninstallation_on_phone")),$e({id:e.id})}const{loading:Ie,fetch:Ae}=Z({handle:e=>{if(e)for(const s of e.packageStatuses)s.exist||(ht(u.value,s.id),le(""))},document:st,variables:()=>({ids:u.value.filter(e=>e.isUninstalling).map(e=>e.id)})}),X=e=>{e.status};return je(()=>{var e;setInterval(()=>{u.value.some(s=>s.isUninstalling)&&!Ie.value&&Ae()},1e3),$.value=ut(((e=G.q)==null?void 0:e.toString())??""),ce(N,$.value),be(),P.on("upload_task_done",X),window.addEventListener("keydown",O),window.addEventListener("keyup",J)}),He(()=>{P.off("upload_task_done",X),window.removeEventListener("keydown",O),window.removeEventListener("keyup",J)}),(e,s)=>{const y=Je,De=pt,Le=vt,Ue=Xe,qe=_t,Be=at,Ee=ot,Ve=xe,_=Oe("tooltip");return l(),o(b,null,[a("div",ft,[a("md-checkbox",{"touch-target":"wrapper",checked:t(Q),indeterminate:!t(Q)&&t(V),onChange:s[0]||(s[0]=(...n)=>t(R)&&t(R)(...n))},null,40,yt),a("div",bt,[t(f).length?(l(),o("span",wt,i(e.$t("x_selected",{count:t(B)?t(p).toLocaleString():t(f).length.toLocaleString()})),1)):(l(),o("span",Ct,i(e.$t("page_title.apps"))+" ("+i(t(p).toLocaleString())+")",1)),t(V)?k((l(),o("button",{key:2,class:"btn-icon",onClick:s[1]||(s[1]=r(n=>t(me)(t(B),t(f),$.value),["stop"]))},[s[3]||(s[3]=a("md-ripple",null,null,-1)),v(y)])),[[_,e.$t("download")]]):I("",!0)]),a("div",$t,[v(De,{filter:N,types:t(fe),"get-url":we},null,8,["filter","types"]),a("button",{class:"btn-icon",style:{display:"none"},onClick:r(he,["stop"])},[s[4]||(s[4]=a("md-ripple",null,null,-1)),A(" "+i(e.$t("install")),1)]),v(Ue,null,{content:ee(n=>[a("div",At,[(l(!0),o(b,null,M(t(de),d=>(l(),o("md-menu-item",{key:d.value,selected:d.value===t(w),onClick:c=>Ce(n,d.value)},[a("div",Lt,i(e.$t(d.label)),1)],8,Dt))),128))])]),default:ee(()=>[k((l(),o("button",{class:"btn-icon btn-sort",disabled:C.value},[s[5]||(s[5]=a("md-ripple",null,null,-1)),C.value?(l(),o("md-circular-progress",It)):(l(),te(Le,{key:1}))],8,St)),[[_,e.$t("sort")]])]),_:1})])]),v(qe,{limit:g,total:t(p),"all-checked-alert-visible":t(re),"real-all-checked":t(B),"select-real-all":t(ue),"clear-selection":t(E)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",Ut,[a("div",{class:se(["app-list",{"select-mode":t(V)}])},[(l(!0),o(b,null,M(u.value,(n,d)=>(l(),o("section",{key:n.id,class:se(["app-item selectable-card",{selected:t(f).includes(n.id),selecting:t(H).includes(n.id)}]),onClick:r(c=>t(pe)(c,n,d,()=>{}),["stop"]),onMouseover:c=>t(_e)(c,d)},[a("div",Bt,[t(H).includes(n.id)?(l(),o("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:t(ke),onClick:r(c=>t(j)(c,n,d),["stop"])},null,8,Et)):(l(),o("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:t(f).includes(n.id),onClick:r(c=>t(j)(c,n,d),["stop"])},null,8,Vt)),a("span",xt,[v(Be,{id:d+1,raw:n},null,8,["id","raw"])])]),a("img",{class:"image",width:"50",height:"50",src:n.icon},null,8,Ft),a("div",Mt,i(n.name)+" ("+i(n.version)+")",1),a("div",Pt,[a("span",null,i(n.id),1),a("span",null,i(t(lt)(n.size)),1),a("span",null,i(e.$t("app_type."+n.type)),1)]),a("div",Tt,[n.isUninstalling?(l(),o(b,{key:0},[k(a("md-circular-progress",Kt,null,512),[[_,e.$t("uninstalling")]]),s[6]||(s[6]=A(" Â ")),a("md-outlined-button",{class:"btn-sm",onClick:r(c=>ye(n),["stop"])},i(e.$t("cancel")),9,Nt)],64)):k((l(),o("button",{key:1,class:"btn-icon sm",onClick:r(c=>Se(n),["stop"])},[s[7]||(s[7]=a("md-ripple",null,null,-1)),v(Ee)],8,zt)),[[_,e.$t("uninstall")]]),k((l(),o("button",{class:"btn-icon sm",onClick:r(c=>t(ge)(n.path,`${n.name.replace(" ","")}-${n.id}.apk`),["stop"])},[s[8]||(s[8]=a("md-ripple",null,null,-1)),v(y)],8,Gt)),[[_,e.$t("download")]])]),a("div",Qt,[k((l(),o("span",null,[A(i(e.$t("installed_at"))+": "+i(t(ae)(n.installedAt)),1)])),[[_,t(ne)(n.installedAt)]]),k((l(),o("span",null,[A(i(e.$t("updated_at"))+": "+i(t(ae)(n.updatedAt)),1)])),[[_,t(ne)(n.updatedAt)]])])],42,qt))),128)),t(F)&&u.value.length===0?(l(),o(b,{key:0},M(20,n=>a("section",{key:n,class:"app-item selectable-card-skeleton"},[a("div",Rt,[s[9]||(s[9]=a("div",{class:"checkbox"},[a("div",{class:"skeleton-checkbox"})],-1)),a("span",jt,i(n),1)]),s[10]||(s[10]=ct('<div class="image" data-v-61e13043><div class="skeleton-image" data-v-61e13043></div></div><div class="title" data-v-61e13043><div class="skeleton-text skeleton-title" data-v-61e13043></div></div><div class="subtitle" data-v-61e13043><div class="skeleton-text skeleton-subtitle" data-v-61e13043></div></div><div class="actions" data-v-61e13043><div class="skeleton-text skeleton-actions" data-v-61e13043></div></div><div class="time" data-v-61e13043><div class="skeleton-text skeleton-time" data-v-61e13043></div><div class="skeleton-text skeleton-time" data-v-61e13043></div></div>',5))])),64)):I("",!0)],2),!t(F)&&u.value.length===0?(l(),o("div",Ht,i(e.$t(t(We)(t(F)))),1)):I("",!0),t(p)>g?(l(),te(Ve,{key:1,page:q.value,go:x,total:t(p),limit:g},null,8,["page","total"])):I("",!0),a("input",{ref_key:"fileInput",ref:oe,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:s[2]||(s[2]=(...n)=>t(T)&&t(T)(...n))},null,544)])],64)}}}),ns=rt(Ot,[["__scopeId","data-v-61e13043"]]);export{ns as default};
