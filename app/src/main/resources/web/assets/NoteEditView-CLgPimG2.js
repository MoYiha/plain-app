import{_ as J}from"./MonacoEditor.vuevuetypescriptsetuptruelang-Cs9Ayf7M.js";import{_ as Y}from"./print-outline-rounded-DHFirScU.js";import{be as ee,bf as W,bg as te,m as ne,c as y,o as v,a as p,e as ae,f as oe,u as se,r as b,s as ie,g as re,h as ue,L as le,i as ce,bh as de,ad as me,K as _e,a4 as q,ae as fe,O as S,P as ve,y as Q,k as L,F,R as pe,j as O,t as ge,l as P,al as he,Z as Te,T as j,Q as be,w as ye,$ as ke,bi as we,E as z,bj as Le,bk as $e,a5 as Ce,A as Ee,a1 as Me,a2 as Ne,bl as xe,H as qe}from"./index-CRAs9Aby.js";import{_ as Se}from"./FieldId.vuevuetypescriptsetuptruelang-DwatImZq.js";import{u as Re}from"./markdown-CGGkP78T.js";var A=function(){return ee.Date.now()},Ve="Expected a function",Ie=Math.max,De=Math.min;function He(C,i,u){var d,a,o,r,s,l,_=0,E=!1,f=!1,g=!0;if(typeof C!="function")throw new TypeError(Ve);i=W(i)||0,te(u)&&(E=!!u.leading,f="maxWait"in u,o=f?Ie(W(u.maxWait)||0,i):o,g="trailing"in u?!!u.trailing:g);function k(n){var c=d,e=a;return d=a=void 0,_=n,r=C.apply(e,c),r}function M(n){return _=n,s=setTimeout(m,i),E?k(n):r}function R(n){var c=n-l,e=n-_,t=i-c;return f?De(t,o-e):t}function h(n){var c=n-l,e=n-_;return l===void 0||c>=i||c<0||f&&e>=o}function m(){var n=A();if(h(n))return N(n);s=setTimeout(m,R(n))}function N(n){return s=void 0,g&&d?k(n):(d=a=void 0,r)}function V(){s!==void 0&&clearTimeout(s),_=0,d=l=a=s=void 0}function I(){return s===void 0?r:N(A())}function w(){var n=A(),c=h(n);if(d=arguments,a=this,l=n,c){if(s===void 0)return M(l);if(f)return clearTimeout(s),s=setTimeout(m,i),k(l)}return s===void 0&&(s=setTimeout(m,i)),r}return w.cancel=V,w.flush=I,w}const Qe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ae(C,i){return v(),y("svg",Qe,i[0]||(i[0]=[p("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1)]))}const Be=ne({name:"material-symbols-arrow-back-rounded",render:Ae}),Ue={class:"top-app-bar"},We={class:"title"},Fe={class:"state-point"},Oe={class:"actions"},Pe={class:"panel-container"},je=["innerHTML"],$="NOTE",ze=ae({__name:"NoteEditView",setup(C){const i=oe(),{t:u}=se(),d=_e(),a=b(""),o=b(),r=b(""),s=b(""),l=b(!1),{app:_,urlTokenKey:E}=ie(re());function f(){const e=Ce.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),Ee(i,t)}const{render:g}=Re(_,E),k=He(()=>{l.value=!1,N({id:a.value,input:{content:r.value,title:xe(r.value,{length:250,omission:""})}})},500),M=()=>{ye(r,async e=>{l.value=!0,s.value=await g(e),k()})},R=()=>{window.print()},h=b();ue({handle:(e,t)=>{t?z(u(t),"error"):e&&(h.value=e.tags)},document:we,variables:{type:$}});const{fetch:m}=le({handle:async(e,t)=>{t?z(u(t),"error"):(o.value=e.note,r.value=e.note.content,s.value=await g(r.value),M())},document:Le,variables:()=>({id:a.value}),options:{fetchPolicy:"no-cache"}}),{mutate:N,onDone:V}=ce({document:$e});V(e=>{var t,T;o.value=e.data.saveNote,!a.value&&((t=o.value)!=null&&t.id)&&(a.value=(T=o.value)==null?void 0:T.id,de(i,`/notes/${a.value}`))});function I(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${u("updated_at")}: ${ke(e)})`:""}function w(){var e,t;Me(Ne,{type:$,tags:h.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=h.value)==null?void 0:t.filter(T=>{var x;return(x=o.value)==null?void 0:x.tags.some(D=>D.id===T.id)})})}const n=e=>{e.type===$&&m()},c=e=>{e.type===$&&m()};return me(()=>{a.value=d.params.id,a.value==="create"&&(a.value=""),a.value?m():M(),q.on("item_tags_updated",c),q.on("items_tags_updated",n)}),fe(()=>{q.off("item_tags_updated",c),q.off("items_tags_updated",n)}),(e,t)=>{var B,U;const T=Be,x=Se,D=Te,G=be,K=Y,X=J,H=ve("tooltip");return v(),y(j,null,[p("div",Ue,[S((v(),y("button",{class:"btn-icon",onClick:Q(f,["prevent"])},[L(T)])),[[H,e.$t("back")]]),p("div",We,[F(ge(a.value?P(u)("edit"):P(u)("create"))+" ",1),S(p("span",Fe,"*",512),[[he,l.value]]),t[1]||(t[1]=F()),(B=o.value)!=null&&B.updatedAt?(v(),pe(x,{key:0,id:I(),class:"time",raw:o.value},null,8,["id","raw"])):O("",!0)]),p("div",Oe,[L(D,{tags:(U=o.value)==null?void 0:U.tags,type:$,"only-links":!0},null,8,["tags"]),a.value?(v(),y(j,{key:0},[S((v(),y("button",{class:"btn-icon",onClick:Q(w,["prevent"])},[L(G)])),[[H,e.$t("add_to_tags")]]),S((v(),y("button",{class:"btn-icon",onClick:Q(R,["prevent"])},[L(K)])),[[H,e.$t("print")]])],64)):O("",!0)])]),p("div",Pe,[L(X,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=Z=>r.value=Z),language:"html"},null,8,["modelValue"]),p("div",{class:"md-container",innerHTML:s.value},null,8,je)])],64)}}}),Ye=qe(ze,[["__scopeId","data-v-fac1e980"]]);export{Ye as default};
