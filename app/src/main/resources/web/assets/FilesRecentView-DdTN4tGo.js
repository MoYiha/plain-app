import{d as ce,g as ie,h as k,i as de,s as re,j as ue,K as _e,L as pe,M as he,c as a,a as o,m as s,t as i,x as m,w as _,p as h,e as g,O,P as ve,v as ke,q as D,ar as me,bv as ge,C as fe,bt as be,bE as ye,S as we,o as n,N as Ce,aC as Ee,E as De,U as Ie,V as Se,W as Te,bj as Le,X as Ve,Y as $e,bz as Ae,ak as xe,bA as Fe,bx as Ne,a1 as f,as as Be,a3 as Ue,bB as ze,ao as Ke,bC as Me,bD as Oe}from"./index-W0C8ZaaK.js";import{_ as R}from"./default-BQXvEOng.js";import{u as Re,c as Ge}from"./key-events-D0KC4JyN.js";const Pe={class:"top-app-bar"},Qe=["checked","indeterminate"],je={key:0},He={key:1},We=o("md-ripple",null,null,-1),Xe={key:0,class:"scroller"},qe={class:"start"},Je=o("div",{class:"checkbox"},[o("div",{class:"skeleton-checkbox"})],-1),Ye={class:"number"},Ze=$e('<div class="image"><div class="skeleton-image"></div></div><div class="title"><div class="skeleton-text skeleton-title"></div></div><div class="subtitle"><div class="skeleton-text skeleton-subtitle"></div></div><div class="actions"><div class="skeleton-text skeleton-actions"></div></div>',4),es=["onClick","onMouseover"],ss={class:"start"},ts=["onClick","checked"],os=["onClick","checked"],ns={class:"number"},as=["onClick"],ls={key:0,class:"svg",src:R},cs=["src","onError"],is=["src","onError"],ds={key:3,class:"svg",src:R},rs={class:"title"},us={class:"subtitle"},_s={class:"actions"},ps=["onClick"],hs=o("md-ripple",null,null,-1),vs={class:"btn-icon sm"},ks=o("md-ripple",null,null,-1),ms={class:"card card-info"},gs={class:"key-value vertical"},fs={class:"key"},bs={class:"value"},ys={key:2,class:"no-data-placeholder"},Is=ce({__name:"FilesRecentView",setup(ws){const{t:G}=ie(),P=k([]),I=de(),{app:Q,urlTokenKey:b}=re(I),r=k([]),{selectedIds:p,allChecked:S,realAllChecked:j,clearSelection:y,toggleAllChecked:T,toggleSelect:L,total:w,checked:V,shiftEffectingIds:$,handleItemClick:H,handleMouseOver:W,selectAll:X,shouldSelect:q}=Re(r),{downloadFile:A,downloadFiles:J}=me(b),{view:Y}=Me(P,(e,d)=>{I.lightbox={sources:e,index:d,visible:!0}}),{keyDown:x,keyUp:F}=Ge(X,y,()=>{}),N=k([]),B=k([]),Z=e=>{N.value.push(e)},ee=e=>{B.value.push(e)},{mutate:se,onDone:te}=ue({document:ge,appApi:!0});te(e=>{J(e.data.setTempValue.key),y()});const U=e=>{Ae(e.name)?window.open(xe(b.value,e.path),"_blank"):Fe(e.name)?Y(r.value,e):A(e.path)},{loading:C,fetch:z}=_e({handle:async(e,d)=>{if(d)fe(G(d),"error");else{const u=[];for(const E of e.recentFiles)u.push(be(E,b.value));r.value=u,w.value=u.length}},document:ye,appApi:!0}),oe=()=>{se({key:Ne(),value:JSON.stringify(p.value.map(e=>({path:e})))})},K=e=>{e.status==="done"&&setTimeout(()=>{z()},1e3)},ne=e=>{e.forEach(d=>{Oe(r.value,u=>u.id===d.id)}),y()},M=e=>{ne([e.item])};return pe(()=>{z(),f.on("upload_task_done",K),f.on("file_deleted",M),window.addEventListener("keydown",x),window.addEventListener("keyup",F)}),he(()=>{f.off("upload_task_done",K),f.off("file_deleted",M),window.removeEventListener("keydown",x),window.removeEventListener("keyup",F)}),(e,d)=>{const u=Be,E=Ue,ae=ze,le=Ke,v=we("tooltip");return n(),a(O,null,[o("div",Pe,[o("md-checkbox",{"touch-target":"wrapper",onChange:d[0]||(d[0]=(...c)=>s(T)&&s(T)(...c)),checked:s(S),indeterminate:!s(S)&&s(V)},null,40,Qe),s(p).length?(n(),a("span",je,i(e.$t("x_selected",{count:s(j)?s(w).toLocaleString():s(p).length.toLocaleString()})),1)):(n(),a("span",He,i(e.$t("recent_files"))+" ("+i(s(w).toLocaleString())+")",1)),s(V)?m((n(),a("button",{key:2,class:"btn-icon",onClick:_(oe,["stop"])},[We,h(u)])),[[v,e.$t("download")]]):g("",!0)]),s(C)&&r.value.length===0?(n(),a("div",Xe,[(n(),a(O,null,ve(20,c=>o("section",{class:"file-item selectable-card-skeleton",key:c},[o("div",qe,[Je,o("span",Ye,i(c),1)]),Ze])),64))])):g("",!0),r.value.length>0?(n(),ke(s(Le),{key:1,class:"scroller","data-key":"id","data-sources":r.value,"estimate-size":80},{item:D(({index:c,item:t})=>[(n(),a("section",{class:Ce(["file-item selectable-card",{selected:s(p).includes(t.id),selecting:s($).includes(t.id)}]),key:t.id,onClick:_(l=>s(H)(l,t,c,()=>{U(t)}),["stop"]),onMouseover:l=>s(W)(l,c)},[o("div",ss,[s($).includes(t.id)?(n(),a("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:_(l=>s(L)(l,t,c),["stop"]),checked:s(q)},null,8,ts)):(n(),a("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:_(l=>s(L)(l,t,c),["stop"]),checked:s(p).includes(t.id)},null,8,os)),o("span",ns,[h(E,{id:c+1,raw:t},null,8,["id","raw"])])]),o("div",{class:"image",onClick:_(l=>U(t),["stop"])},[B.value.includes(t.id)?(n(),a("img",ls)):!N.value.includes(t.id)&&t.fileId?(n(),a("img",{key:1,class:"image-thumb",src:s(Ee)(t.fileId,"&w=50&h=50"),onError:l=>Z(t.id)},null,40,cs)):t.extension?(n(),a("img",{key:2,src:`/ficons/${t.extension}.svg`,class:"svg",onError:l=>ee(t.id)},null,40,is)):(n(),a("img",ds))],8,as),o("div",rs,i(t.name),1),o("div",us,[o("span",null,i(s(De)(t.size)),1),m((n(),a("span",null,[Se(i(s(Te)(t.updatedAt)),1)])),[[v,s(Ie)(t.updatedAt)]])]),o("div",_s,[m((n(),a("button",{class:"btn-icon sm",onClick:_(l=>s(A)(t.path),["stop"])},[hs,h(u)],8,ps)),[[v,e.$t("download")]]),h(le,null,{content:D(l=>[o("section",ms,[o("div",gs,[o("div",fs,i(e.$t("path")),1),o("div",bs,i(t.path),1)])])]),default:D(()=>[m((n(),a("button",vs,[ks,h(ae)])),[[v,e.$t("info")]])]),_:2},1024)])],42,es))]),_:1},8,["data-sources"])):g("",!0),!s(C)&&r.value.length===0?(n(),a("div",ys,i(e.$t(s(Ve)(s(C),s(Q).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):g("",!0)],64)}}});export{Is as default};
