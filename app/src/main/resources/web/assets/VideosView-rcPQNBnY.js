import{_ as So}from"./VPagination.vuevuetypescriptsetuptruelang-BzK-L-Ey.js";import{_ as Do,a as Eo,b as To,c as Ao,d as Vo}from"./grid-view-outline-rounded-DJh1M8Ae.js";import{_ as Mo}from"./FieldId.vuevuetypescriptsetuptruelang-eOYRhci9.js";import{e as Fo,f as Lo,s as He,r as H,u as Ro,G as zo,g as qo,ae as Ne,af as Uo,H as Bo,I as Ho,aG as No,aH as Ke,aI as Ko,ag as Qo,aJ as M,aC as pe,J as Go,aK as Oo,aL as Po,K as Zo,L as jo,c as u,o as t,a as r,k as l,l as e,j as F,t as y,Q as $,p,M as Wo,O as c,a2 as d,y as a,aM as W,aN as X,ai as Xo,aj as Jo,P as N,R as J,S as Yo,aX as xo,D as es,aP as os,a5 as ss,aQ as ts,ah as ns,aR as as,N as ls,ap as is,aY as Qe,aS as cs,aq as ds,V as rs,n as Ge,a7 as Oe,aT as us,W as _s,X as ps,Y as ks,z as vs,Z as ms,$ as gs,aU as Pe,a0 as hs,a1 as S,aZ as fs}from"./index-BaWXnnLZ.js";import{_ as ys,a as $s}from"./SearchInput-Cq5_Bnx2.js";import{_ as Cs,a as bs}from"./upload-rounded-BleGzatb.js";import{_ as ws}from"./IconButton.vuevuetypescriptsetuptruelang-CHMhruVe.js";import{a as Is}from"./tags-zkWLe_qU.js";import{u as Ss,a as Ds}from"./key-events-B0Jq4BkE.js";import{u as Es}from"./search-brnXFXDL.js";import"./search-rounded-Dmop53vQ.js";const Ts={class:"top-app-bar"},As=["checked","indeterminate"],Vs={class:"title"},Ms={key:0},Fs={key:1},Ls={class:"actions"},Rs=["onClick"],zs={slot:"headline"},qs=["onClick"],Us={slot:"headline"},Bs={class:"menu-items"},Hs=["selected","onClick"],Ns={slot:"headline"},Ks={class:"sm"},Qs=["selected"],Gs=["selected"],Os=["onClick","onMouseover"],Ps=["src"],Zs=["src","onError"],js={key:1,class:"actions"},Ws={class:"right"},Xs=["onClick","onMouseover"],Js={class:"start"},Ys=["checked","onClick"],xs=["checked","onClick"],et={class:"number"},ot={class:"image"},st=["src"],tt=["src","onError"],nt={class:"title"},at={class:"subtitle"},lt=["onClick"],it={class:"actions"},ct={class:"time"},dt={key:2,class:"no-data-placeholder"},T=55,Ct=Fo({__name:"VideosView",setup(rt){var ze;const D=Lo(),{videoSortBy:L}=He(D),E=H([]),{t:Ze}=Ro(),{parseQ:je}=Es(),w=zo({tagIds:[],bucketId:void 0}),ke=qo(),{app:A,urlTokenKey:Y,uploads:x}=He(ke),{input:We,upload:Xe,uploadChanged:ve}=Ne(x),{input:Je,upload:Ye,uploadChanged:me}=Ne(x),{dropping:xe,fileDragEnter:ge,fileDragLeave:he,dropFiles:eo}=Uo(x),ee=H(!1),_=Bo.VIDEO,fe=Ho(),ye=fe.query,oe=H(parseInt(((ze=ye.page)==null?void 0:ze.toString())??"1")),{tags:K,buckets:Q,fetch:oo}=No(_),so=Ke(()=>{const o={};return Q.value.forEach(n=>{o[n.id]=n}),o}),C=H(""),{addToTags:to}=Is(_,K),{deleteItems:se,deleteItem:G}=Ko(),{view:no}=us(_),{selectedIds:h,allChecked:$e,realAllChecked:I,selectRealAll:ao,allCheckedAlertVisible:lo,clearSelection:R,toggleAllChecked:Ce,toggleSelect:z,total:b,checked:q,shiftEffectingIds:O,handleItemClick:be,handleMouseOver:we,selectAll:io,shouldSelect:Ie}=Ss(E),{downloadItems:Se}=Qo(Y,_,R,"videos.zip"),{downloadFile:P}=ds(Y),De=o=>{const n=fe.query.q;vs(D,n?`/videos?page=${o}&q=${n}`:`/videos?page=${o}`)},{keyDown:Ee,keyUp:Te}=Ds(b,T,oe,io,R,De,()=>{W(X.MEDIA_TRASH,A.value.osVersion)?j(_,B()):se(_,h.value,I.value,b.value,C.value)}),te=H([]),co=is(),ro=Ke(()=>E.value.map(o=>({src:pe(o.fileId),name:M(o.path),duration:o.duration,size:o.size,path:o.path,data:o,type:_}))),Ae=o=>{te.value.push(o)},{loading:Z,fetch:U}=Go({handle:async(o,n)=>{if(ee.value=!1,n)es(Ze(n),"error");else if(o){const f=[];for(const i of o.videos)f.push({...i,fileId:os(Y.value,i.path,i.id)});E.value=f,b.value=o.videoCount}},document:xo,variables:()=>({offset:(oe.value-1)*T,limit:T,query:C.value,sortBy:L.value})}),{trashLoading:ne,trash:j}=Oo(),{restoreLoading:ae,restore:le}=Po();function ie(o){ke.lightbox={sources:ro.value,index:o,visible:!0}}const B=()=>{let o=C.value;return I.value||(o=`ids:${h.value.join(",")}`),o};function uo(o,n){if(L.value===n){o.close();return}ee.value=!0,L.value=n,o.close()}function _o(o){return o?`/videos?q=${o}`:"/videos"}function Ve(o){ms(gs,{type:_,tags:K.value,item:{key:o.id,title:o.title,size:o.size},selected:K.value.filter(n=>o.tags.some(f=>f.id===n.id))})}function ce(){const o=Q.value.find(n=>n.id===w.bucketId);return o?Pe(o.topItems[0]):`${A.value.internalStoragePath}/Movies`}function po(o){Xe(ce()),o.close()}function ko(o){Ye(ce()),o.close()}function vo(o){eo(o,ce(),"video")}const Me=o=>{o.type===_&&(R(),U())},Fe=o=>{o.type===_&&U()},Le=o=>{o.type===_&&(R(),U())},Re=o=>{o.status==="done"&&fs(o.fileName)&&((!w.bucketId||Q.value.some(f=>f.id===w.bucketId&&f.topItems.some(i=>o.dir.startsWith(Pe(i)))))&&setTimeout(()=>{U()},1e3),S.emit("media_items_actioned",{type:_,action:"upload",query:""}))};return Zo(()=>{var o;C.value=hs(((o=ye.q)==null?void 0:o.toString())??""),je(w,C.value),oo(),U(),S.on("item_tags_updated",Fe),S.on("items_tags_updated",Me),S.on("media_items_actioned",Le),S.on("upload_task_done",Re),window.addEventListener("keydown",Ee),window.addEventListener("keyup",Te)}),jo(()=>{S.off("item_tags_updated",Fe),S.off("items_tags_updated",Me),S.off("media_items_actioned",Le),S.off("upload_task_done",Re),window.removeEventListener("keydown",Ee),window.removeEventListener("keyup",Te)}),(o,n)=>{const f=ss,i=ws,de=ts,V=ns,re=as,ue=ls,mo=ys,go=Cs,qe=Xo,ho=bs,fo=Do,yo=Eo,$o=$s,_e=To,Ue=Ao,Co=cs,Be=rs,bo=Mo,wo=Vo,Io=So,k=Wo("tooltip");return t(),u($,null,[r("div",Ts,[r("md-checkbox",{"touch-target":"wrapper",checked:e($e),indeterminate:!e($e)&&e(q),onChange:n[0]||(n[0]=(...s)=>e(Ce)&&e(Ce)(...s))},null,40,As),r("div",Vs,[e(h).length?(t(),u("span",Ms,y(o.$t("x_selected",{count:e(I)?e(b).toLocaleString():e(h).length.toLocaleString()})),1)):(t(),u("span",Fs,y(o.$t("page_title.videos"))+" ("+y(e(b).toLocaleString())+")",1)),e(q)?(t(),u($,{key:2},[w.trash?(t(),u($,{key:0},[p((t(),c(i,{onClick:n[1]||(n[1]=a(s=>e(se)(e(_),e(h),e(I),e(b),C.value),["stop"]))},{icon:d(()=>[l(f)]),_:1})),[[k,o.$t("delete")]]),p((t(),c(i,{loading:e(ae)(B()),onClick:n[2]||(n[2]=a(s=>e(le)(e(_),B()),["stop"]))},{icon:d(()=>[l(de)]),_:1},8,["loading"])),[[k,o.$t("restore")]]),p((t(),c(i,{onClick:n[3]||(n[3]=a(s=>e(Se)(e(I),e(h),C.value),["stop"]))},{icon:d(()=>[l(V)]),_:1})),[[k,o.$t("download")]])],64)):(t(),u($,{key:1},[e(W)(e(X).MEDIA_TRASH,e(A).osVersion)?p((t(),c(i,{key:0,loading:e(ne)(B()),onClick:n[4]||(n[4]=a(s=>e(j)(e(_),B()),["stop"]))},{icon:d(()=>[l(re)]),_:1},8,["loading"])),[[k,o.$t("move_to_trash")]]):p((t(),c(i,{key:1,onClick:n[5]||(n[5]=a(s=>e(se)(e(_),e(h),e(I),e(b),C.value),["stop"]))},{icon:d(()=>[l(f)]),_:1})),[[k,o.$t("delete")]]),p((t(),c(i,{onClick:n[6]||(n[6]=a(s=>e(Se)(e(I),e(h),C.value),["stop"]))},{icon:d(()=>[l(V)]),_:1})),[[k,o.$t("download")]]),p((t(),c(i,{onClick:n[7]||(n[7]=a(s=>e(to)(e(h),e(I),C.value),["stop"]))},{icon:d(()=>[l(ue)]),_:1})),[[k,o.$t("add_to_tags")]])],64))],64)):F("",!0)]),r("div",Ls,[l(mo,{filter:w,tags:e(K),buckets:e(Q),"get-url":_o},null,8,["filter","tags","buckets"]),w.trash?F("",!0):(t(),c(qe,{key:0},{content:d(s=>[r("md-menu-item",{onClick:a(m=>po(s),["stop"])},[r("div",zs,y(o.$t("upload_files")),1)],8,Rs),r("md-menu-item",{onClick:a(m=>ko(s),["stop"])},[r("div",Us,y(o.$t("upload_folder")),1)],8,qs)]),default:d(()=>[p((t(),c(i,null,{icon:d(()=>[l(go)]),_:1})),[[k,o.$t("upload")]])]),_:1})),l(qe,null,{content:d(s=>[r("div",Bs,[(t(!0),u($,null,J(e(co),m=>(t(),u("md-menu-item",{key:m.value,selected:m.value===e(L),onClick:v=>uo(s,m.value)},[r("div",Ns,y(o.$t(m.label)),1)],8,Hs))),128))])]),default:d(()=>[p((t(),c(i,{loading:ee.value},{icon:d(()=>[l(ho)]),_:1},8,["loading"])),[[k,o.$t("sort")]])]),_:1}),r("md-outlined-segmented-button-set",Ks,[r("md-outlined-segmented-button",{"data-value":"grid","no-checkmark":"",selected:!e(D).videosCardView,onClick:n[8]||(n[8]=s=>e(D).videosCardView=!1)},[l(fo,{slot:"icon"})],8,Qs),r("md-outlined-segmented-button",{"data-value":"card","no-checkmark":"",selected:e(D).videosCardView,onClick:n[9]||(n[9]=s=>e(D).videosCardView=!0)},[l(yo,{slot:"icon"})],8,Gs)])])]),l($o,{limit:T,total:e(b),"all-checked-alert-visible":e(lo),"real-all-checked":e(I),"select-real-all":e(ao),"clear-selection":e(R)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),r("div",{class:"scroll-content",onDragover:n[13]||(n[13]=a((...s)=>e(ge)&&e(ge)(...s),["stop","prevent"]))},[p(r("div",{class:"drag-mask",onDrop:a(vo,["stop","prevent"]),onDragleave:n[10]||(n[10]=a((...s)=>e(he)&&e(he)(...s),["stop","prevent"]))},y(o.$t("release_to_send_files")),545),[[Jo,e(xe)]]),e(D).videosCardView?(t(),u("div",{key:1,class:N(["media-list",{"select-mode":e(q)}])},[(t(!0),u($,null,J(E.value,(s,m)=>{var v;return t(),u("section",{key:s.id,class:N(["media-item selectable-card",{selected:e(h).includes(s.id),selecting:e(O).includes(s.id)}]),onClick:a(g=>e(be)(g,s,m,ie),["stop"]),onMouseover:g=>e(we)(g,m)},[r("div",Js,[e(O).includes(s.id)?(t(),u("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:e(Ie),onClick:a(g=>e(z)(g,s,m),["stop"])},null,8,Ys)):(t(),u("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:e(h).includes(s.id),onClick:a(g=>e(z)(g,s,m),["stop"])},null,8,xs)),r("span",et,[l(bo,{id:m+1,raw:s},null,8,["id","raw"])])]),r("div",ot,[te.value.includes(s.id)?(t(),u("img",{key:0,src:`/ficons/${e(Qe)(s.path)}.svg`,class:"svg"},null,8,st)):(t(),u("img",{key:1,class:"image-thumb",src:e(pe)(s.fileId,"&w=200&h=200"),onError:g=>Ae(s.id)},null,40,tt))]),r("div",nt,y(e(M)(s.path)),1),r("div",at,[r("span",null,y(e(Ge)(s.size)),1),r("span",null,y(e(Oe)(s.duration)),1),r("a",{onClick:a(g=>e(no)(e(D),s.bucketId),["stop","prevent"])},y((v=so.value[s.bucketId])==null?void 0:v.name),9,lt),l(Be,{tags:s.tags,type:e(_),"only-links":!0},null,8,["tags","type"])]),r("div",it,[w.trash?(t(),u($,{key:0},[p((t(),c(i,{class:"sm",onClick:a(g=>e(G)(e(_),s),["stop"])},{icon:d(()=>[l(f)]),_:2},1032,["onClick"])),[[k,o.$t("delete")]]),p((t(),c(i,{class:"sm",loading:e(ae)(`ids:${s.id}`),onClick:a(g=>e(le)(e(_),`ids:${s.id}`),["stop"])},{icon:d(()=>[l(de)]),_:2},1032,["loading","onClick"])),[[k,o.$t("restore")]]),p((t(),c(i,{class:"sm",onClick:a(g=>e(P)(s.path,e(M)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(V)]),_:2},1032,["onClick"])),[[k,o.$t("download")]])],64)):(t(),u($,{key:1},[e(W)(e(X).MEDIA_TRASH,e(A).osVersion)?p((t(),c(i,{key:0,class:"sm",loading:e(ne)(`ids:${s.id}`),onClick:a(g=>e(j)(e(_),`ids:${s.id}`),["stop"])},{icon:d(()=>[l(re)]),_:2},1032,["loading","onClick"])),[[k,o.$t("move_to_trash")]]):p((t(),c(i,{key:1,class:"sm",onClick:a(g=>e(G)(e(_),s),["stop"])},{icon:d(()=>[l(f)]),_:2},1032,["onClick"])),[[k,o.$t("delete")]]),p((t(),c(i,{class:"sm",onClick:a(g=>e(P)(s.path,e(M)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(V)]),_:2},1032,["onClick"])),[[k,o.$t("download")]]),p((t(),c(i,{class:"sm",onClick:a(g=>Ve(s),["stop"])},{icon:d(()=>[l(ue)]),_:2},1032,["onClick"])),[[k,o.$t("add_to_tags")]])],64))]),r("div",ct,[p((t(),u("span",null,[ps(y(e(ks)(s.createdAt)),1)])),[[k,e(_s)(s.createdAt)]])])],42,Xs)}),128)),e(Z)&&E.value.length===0?(t(),c(wo,{key:0,limit:T})):F("",!0)],2)):(t(),u("div",{key:0,class:N(["media-grid",{"select-mode":e(q)}])},[(t(!0),u($,null,J(E.value,(s,m)=>(t(),u("section",{key:s.id,class:N(["media-item",{selected:e(h).includes(s.id),selecting:e(O).includes(s.id)}]),onClick:a(v=>e(be)(v,s,m,ie),["stop"]),onMouseover:v=>e(we)(v,m)},[te.value.includes(s.id)?(t(),u("img",{key:0,src:`/ficons/${e(Qe)(s.path)}.svg`,class:"image svg"},null,8,Ps)):(t(),u("img",{key:1,class:"image image-thumb",src:e(pe)(s.fileId,"&w=200&h=200"),onError:v=>Ae(s.id)},null,40,Zs)),e(O).includes(s.id)?(t(),c(i,{key:2,class:"btn-checkbox",onClick:a(v=>e(z)(v,s,m),["stop"])},{icon:d(()=>[e(Ie)?(t(),c(_e,{key:0})):(t(),c(Ue,{key:1}))]),_:2},1032,["onClick"])):e(h).includes(s.id)?(t(),c(i,{key:3,class:"btn-checkbox",onClick:a(v=>e(z)(v,s,m),["stop"])},{icon:d(()=>[l(_e)]),_:2},1032,["onClick"])):(t(),u($,{key:4},[l(i,{class:"btn-checkbox",onClick:a(v=>e(z)(v,s,m),["stop"])},{icon:d(()=>[e(h).includes(s.id)?(t(),c(_e,{key:0})):(t(),c(Ue,{key:1}))]),_:2},1032,["onClick"]),e(q)?p((t(),c(i,{key:0,class:"btn-zoom sm",onClick:a(v=>ie(m),["stop"])},{icon:d(()=>[l(Co)]),_:2},1032,["onClick"])),[[k,o.$t("open")]]):(t(),u("div",js,[w.trash?(t(),u($,{key:0},[p((t(),c(i,{class:"sm",onClick:a(v=>e(G)(e(_),s),["stop"])},{icon:d(()=>[l(f)]),_:2},1032,["onClick"])),[[k,o.$t("delete")]]),p((t(),c(i,{class:"sm",loading:e(ae)(`ids:${s.id}`),onClick:a(v=>e(le)(e(_),`ids:${s.id}`),["stop"])},{icon:d(()=>[l(de)]),_:2},1032,["loading","onClick"])),[[k,o.$t("restore")]]),p((t(),c(i,{class:"sm",onClick:a(v=>e(P)(s.path,e(M)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(V)]),_:2},1032,["onClick"])),[[k,o.$t("download")]])],64)):(t(),u($,{key:1},[e(W)(e(X).MEDIA_TRASH,e(A).osVersion)?p((t(),c(i,{key:0,class:"sm",loading:e(ne)(`ids:${s.id}`),onClick:a(v=>e(j)(e(_),`ids:${s.id}`),["stop"])},{icon:d(()=>[l(re)]),_:2},1032,["loading","onClick"])),[[k,o.$t("move_to_trash")]]):p((t(),c(i,{key:1,class:"sm",onClick:a(v=>e(G)(e(_),s),["stop"])},{icon:d(()=>[l(f)]),_:2},1032,["onClick"])),[[k,o.$t("delete")]]),p((t(),c(i,{class:"sm",onClick:a(v=>e(P)(s.path,e(M)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(V)]),_:2},1032,["onClick"])),[[k,o.$t("download")]]),p((t(),c(i,{class:"sm",onClick:a(v=>Ve(s),["stop"])},{icon:d(()=>[l(ue)]),_:2},1032,["onClick"])),[[k,o.$t("add_to_tags")]])],64))])),r("div",{class:N(["info",{"has-tags":s.tags.length>0}])},[l(Be,{tags:s.tags,type:e(_)},null,8,["tags","type"]),r("span",Ws,y(["SIZE_ASC","SIZE_DESC"].includes(e(L))?e(Ge)(s.size):e(Oe)(s.duration)),1)],2)],64))],42,Os))),128)),e(Z)&&E.value.length===0?(t(),u($,{key:0},J(T,s=>r("section",{key:s,class:"skeleton-image media-item"})),64)):F("",!0)],2)),!e(Z)&&E.value.length===0?(t(),u("div",dt,y(o.$t(e(Yo)(e(Z),e(A).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):F("",!0),e(b)>T?(t(),c(Io,{key:3,page:oe.value,go:De,total:e(b),limit:T},null,8,["page","total"])):F("",!0),r("input",{ref_key:"fileInput",ref:We,style:{display:"none"},type:"file",accept:"video/*",multiple:"",onChange:n[11]||(n[11]=(...s)=>e(ve)&&e(ve)(...s))},null,544),r("input",{ref_key:"dirFileInput",ref:Je,style:{display:"none"},type:"file",accept:"video/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[12]||(n[12]=(...s)=>e(me)&&e(me)(...s))},null,544)],32)],64)}}});export{Ct as default};
