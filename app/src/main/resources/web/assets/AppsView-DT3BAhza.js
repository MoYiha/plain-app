import{_ as Je}from"./VPagination.vuevuetypescriptsetuptruelang-DZpCvrfT.js";import{a4 as H,e as Ye,r as b,s as ue,g as We,ag as Xe,ah as Ze,f as et,u as tt,I as at,K as st,ai as nt,J as ot,i as re,L as _e,M as lt,N as it,c as l,o,a as n,k as p,l as t,O as v,j as q,t as i,P as ct,y as u,aj as dt,p as z,ak as pt,R as L,al as ut,S as R,T as U,U as j,V as rt,am as _t,an as vt,E,ao as kt,ap as mt,aq as gt,ar as ft,Y as ht,n as yt,F as M,as as bt,a7 as wt,at as $t,au as ve,$ as ke,d as Ct,A as St,av as Dt,a3 as At,H as It}from"./index-Eg2Dz6vI.js";import{_ as Lt}from"./FieldId.vuevuetypescriptsetuptruelang-lzcc_jvg.js";import{_ as Ut,a as Pt}from"./SearchInput-DFrEaFdp.js";import{_ as Nt,a as Vt}from"./upload-rounded-DxjQpv8E.js";import{_ as Ft}from"./VCheckbox-BuMj4nO3.js";import{u as qt,a as Et}from"./key-events-BNPqExTk.js";import{u as Mt}from"./search-BrbvAB1e.js";import"./VInputChip-BoCl3y34.js";const w=C=>{H.emit("tap_phone",C)};function Tt(C,d){const S=C.findIndex(D=>D.id===d);S!==-1&&C.splice(S,1)}const Bt={class:"top-app-bar"},Kt={class:"title"},xt={key:0},Qt={key:1},Gt={class:"actions"},zt=["disabled"],Rt={class:"menu-items"},jt=["onClick"],Ht=["onClick","onMouseover"],Ot={class:"start"},Jt={class:"number"},Yt=["src"],Wt={class:"title"},Xt={class:"subtitle"},Zt={class:"actions"},ea=["onClick"],ta=["onClick"],aa={class:"time"},sa={class:"start"},na={class:"number"},oa={key:0,class:"no-data-placeholder"},$=50,la=Ye({__name:"AppsView",setup(C){var de;const d=b([]),{app:S,urlTokenKey:D,uploads:O}=ue(We()),{input:me,upload:ge,uploadChanged:J}=Xe(O),{dropping:fe,fileDragEnter:Y,fileDragLeave:W,dropFiles:he}=Ze(O),X=et(),k=b([]),{t:g}=tt(),{appSortBy:P}=ue(X),{parseQ:ye}=Mt(),Z=at({tagIds:[]}),be=ft(),N=b(!1),ee=st(),te=ee.query,T=b(parseInt(((de=te.page)==null?void 0:de.toString())??"1")),V=b(""),{selectedIds:A,allChecked:ae,realAllChecked:B,selectRealAll:we,allCheckedAlertVisible:$e,clearSelection:K,toggleAllChecked:Ce,toggleSelect:se,total:f,checked:x,shiftEffectingIds:ne,handleItemClick:Se,handleMouseOver:De,selectAll:Ae,shouldSelect:Ie}=qt(k),{downloadItems:Le}=nt(D,ot.PACKAGE,K,()=>Dt("apps")),{downloadFile:Ue}=$t(D),Q=e=>{const s=ee.query.q;St(X,s?`/apps?page=${e}&q=${s}`:`/apps?page=${e}`)},{keyDown:oe,keyUp:le}=Et(f,$,T,Ae,K,Q,()=>{}),Pe=()=>{ge(S.value.downloadsDir)},{mutate:Ne}=re({document:_t}),Ve=["user","system"].map(e=>({id:e,name:g("app_type."+e)})),Fe=e=>{e.isUninstalling=!1},{loading:G,fetch:ie}=_e({handle:(e,s)=>{N.value=!1,s?E(g(s),"error"):e&&(k.value=e.packages.map(c=>({...c,isUninstalling:!1,icon:kt(D.value,"pkgicon://"+c.id)})),f.value=e.packageCount)},document:vt,variables:()=>({offset:(T.value-1)*$,limit:$,query:V.value,sortBy:P.value})});function qe(e){return e?`/apps?q=${e}`:"/apps"}const F=b(!1);function Ee(e){if(P.value===e){F.value=!1;return}N.value=!0,P.value=e,Q(1),F.value=!1}const{mutate:Me}=re({document:mt});function Te(e){e.isUninstalling=!0,w(g("confirm_uninstallation_on_phone")),Me({id:e.id})}const{loading:Be,fetch:Ke}=_e({handle:e=>{if(e)for(const s of e.packageStatuses){const c=d.value.find(_=>_.id===s.id);if(c){const _=c.isNew&&s.exist,I=!c.isNew&&s.exist&&c.updatedAt<s.updatedAt;(_||I)&&(d.value=d.value.filter(h=>h.id!==s.id),w(""),_?E(g("app_installation_completed"),"success"):E(g("app_upgrade_completed"),"success"),ie())}else s.exist||(Tt(k.value,s.id),w(""))}},document:gt,variables:()=>({ids:[...k.value.filter(e=>e.isUninstalling).map(e=>e.id),...d.value.map(e=>e.id)]})}),ce=e=>{e.status==="done"&&Ne({path:e.dir+"/"+e.fileName}).then(s=>{if(w(g("confirm_installation_on_phone")),s&&s.data&&s.data.installPackage){const{packageName:c,updatedAt:_,isNew:I}=s.data.installPackage;c&&(d.value.push({id:c,updatedAt:_,isNew:I}),setTimeout(()=>{d.value.some(h=>h.id===c)&&(d.value=d.value.filter(h=>h.id!==c),w(""))},12e4))}}).catch(s=>{w(""),E(g("app_installation_failed")+": "+s.message,"error")})};function xe(e){he(e,S.value.downloadsDir,"application")}return lt(()=>{var e;setInterval(()=>{(k.value.some(s=>s.isUninstalling)||d.value.length>0)&&!Be.value&&Ke()},1e3),V.value=At(((e=te.q)==null?void 0:e.toString())??""),ye(Z,V.value),ie(),H.on("upload_task_done",ce),window.addEventListener("keydown",oe),window.addEventListener("keyup",le)}),it(()=>{H.off("upload_task_done",ce),window.removeEventListener("keydown",oe),window.removeEventListener("keyup",le)}),(e,s)=>{const c=Ft,_=dt,I=Ut,h=Nt,pe=ht,Qe=Vt,Ge=pt,ze=Pt,Re=Lt,je=bt,He=wt,Oe=Je,m=ct("tooltip");return o(),l(U,null,[n("div",Bt,[p(c,{"touch-target":"wrapper",checked:t(ae),indeterminate:!t(ae)&&t(x),onChange:t(Ce)},null,8,["checked","indeterminate","onChange"]),n("div",Kt,[t(A).length?(o(),l("span",xt,i(e.$t("x_selected",{count:t(B)?t(f).toLocaleString():t(A).length.toLocaleString()})),1)):(o(),l("span",Qt,i(e.$t("page_title.apps"))+" ("+i(t(f).toLocaleString())+")",1)),t(x)?v((o(),l("button",{key:2,class:"btn-icon",onClick:s[0]||(s[0]=u(a=>t(Le)(t(B),t(A),V.value),["stop"]))},[p(_)])),[[m,e.$t("download")]]):q("",!0)]),n("div",Gt,[p(I,{filter:Z,types:t(Ve),"get-url":qe},null,8,["filter","types"]),v((o(),l("button",{class:"btn-icon",onClick:u(Pe,["stop"])},[p(h)])),[[m,e.$t("install_app")]]),p(Ge,{modelValue:F.value,"onUpdate:modelValue":s[1]||(s[1]=a=>F.value=a)},{trigger:z(()=>[v((o(),l("button",{class:"btn-icon btn-sort",disabled:N.value},[N.value?(o(),L(pe,{key:0,indeterminate:""})):(o(),L(Qe,{key:1}))],8,zt)),[[m,e.$t("sort")]])]),default:z(()=>[n("div",Rt,[(o(!0),l(U,null,j(t(be),a=>(o(),l("div",{key:a.value,class:R(["dropdown-item",{selected:a.value===t(P)}]),onClick:y=>Ee(a.value)},i(e.$t(a.label)),11,jt))),128))])]),_:1},8,["modelValue"])])]),p(ze,{limit:$,total:t(f),"all-checked-alert-visible":t($e),"real-all-checked":t(B),"select-real-all":t(we),"clear-selection":t(K)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),n("div",{class:"scroll-content",onDragover:s[4]||(s[4]=u((...a)=>t(Y)&&t(Y)(...a),["stop","prevent"]))},[v(n("div",{class:"drag-mask",onDrop:u(xe,["stop","prevent"]),onDragleave:s[2]||(s[2]=u((...a)=>t(W)&&t(W)(...a),["stop","prevent"]))},i(e.$t("release_to_send_files")),545),[[ut,t(fe)]]),n("div",{class:R(["app-list",{"select-mode":t(x)}])},[(o(!0),l(U,null,j(k.value,(a,y)=>(o(),l("section",{key:a.id,class:R(["app-item selectable-card",{selected:t(A).includes(a.id),selecting:t(ne).includes(a.id)}]),onClick:u(r=>t(Se)(r,a,y,()=>{}),["stop"]),onMouseover:r=>t(De)(r,y)},[n("div",Ot,[t(ne).includes(a.id)?(o(),L(c,{key:0,class:"checkbox","touch-target":"wrapper",checked:t(Ie),onClick:u(r=>t(se)(r,a,y),["stop"])},null,8,["checked","onClick"])):(o(),L(c,{key:1,class:"checkbox","touch-target":"wrapper",checked:t(A).includes(a.id),onClick:u(r=>t(se)(r,a,y),["stop"])},null,8,["checked","onClick"])),n("span",Jt,[p(Re,{id:y+1,raw:a},null,8,["id","raw"])])]),n("img",{class:"image",width:"50",height:"50",src:a.icon},null,8,Yt),n("div",Wt,i(a.name)+" ("+i(a.version)+")",1),n("div",Xt,[n("span",null,i(a.id),1),n("span",null,i(t(yt)(a.size)),1),n("span",null,i(e.$t("app_type."+a.type)),1)]),n("div",Zt,[a.isUninstalling?(o(),l(U,{key:0},[v(p(pe,{indeterminate:"",class:"sm"},null,512),[[m,e.$t("uninstalling")]]),s[5]||(s[5]=M(" Â ")),p(je,{class:"btn-sm",onClick:u(r=>Fe(a),["stop"])},{default:z(()=>[M(i(e.$t("cancel")),1)]),_:2},1032,["onClick"])],64)):v((o(),l("button",{key:1,class:"btn-icon sm",onClick:u(r=>Te(a),["stop"])},[p(He)],8,ea)),[[m,e.$t("uninstall")]]),v((o(),l("button",{class:"btn-icon sm",onClick:u(r=>t(Ue)(a.path,`${a.name.replace(" ","")}-${a.id}.apk`),["stop"])},[p(_)],8,ta)),[[m,e.$t("download")]])]),n("div",aa,[v((o(),l("span",null,[M(i(e.$t("installed_at"))+": "+i(t(ke)(a.installedAt)),1)])),[[m,t(ve)(a.installedAt)]]),v((o(),l("span",null,[M(i(e.$t("updated_at"))+": "+i(t(ke)(a.updatedAt)),1)])),[[m,t(ve)(a.updatedAt)]])])],42,Ht))),128)),t(G)&&k.value.length===0?(o(),l(U,{key:0},j(20,a=>n("section",{key:a,class:"app-item selectable-card-skeleton"},[n("div",sa,[s[6]||(s[6]=n("div",{class:"checkbox"},[n("div",{class:"skeleton-checkbox"})],-1)),n("span",na,i(a),1)]),s[7]||(s[7]=Ct('<div class="image" data-v-c6fcca22><div class="skeleton-image" data-v-c6fcca22></div></div><div class="title" data-v-c6fcca22><div class="skeleton-text skeleton-title" data-v-c6fcca22></div></div><div class="subtitle" data-v-c6fcca22><div class="skeleton-text skeleton-subtitle" data-v-c6fcca22></div></div><div class="actions" data-v-c6fcca22><div class="skeleton-text skeleton-actions" data-v-c6fcca22></div></div><div class="time" data-v-c6fcca22><div class="skeleton-text skeleton-time" data-v-c6fcca22></div><div class="skeleton-text skeleton-time" data-v-c6fcca22></div></div>',5))])),64)):q("",!0)],2),!t(G)&&k.value.length===0?(o(),l("div",oa,i(e.$t(t(rt)(t(G)))),1)):q("",!0),t(f)>$?(o(),L(Oe,{key:1,page:T.value,go:Q,total:t(f),limit:$},null,8,["page","total"])):q("",!0),n("input",{ref_key:"fileInput",ref:me,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:s[3]||(s[3]=(...a)=>t(J)&&t(J)(...a))},null,544)],32)],64)}}}),ma=It(la,[["__scopeId","data-v-c6fcca22"]]);export{ma as default};
