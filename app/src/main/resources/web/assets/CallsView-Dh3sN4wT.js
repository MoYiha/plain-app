import{_ as Ee}from"./VPagination.vuevuetypescriptsetuptruelang-CHD_8v0v.js";import{_ as Me,b as Pe,u as Be,a as Ne}from"./key-events-cECSsEaK.js";import{e as ne,c as o,J as b,o as a,a as l,d as Qe,t as r,f as Ge,s as Ue,g as Ke,r as A,u as Re,K as je,L as ze,M as Fe,N as Oe,i as He,O as We,P as Je,k as c,j as I,l as t,U as D,Q as y,R as Ze,z as u,a8 as Xe,S as Ye,p as et,T as ee,V as te,W as tt,a9 as st,F as at,H as nt,aa as lt,$ as ot,Z as ct,a0 as it,G as dt,a1 as rt,B as se,a2 as ae,a3 as _t,ab as ut,ac as pt,a4 as mt,a5 as p,ad as ht,I as vt}from"./index-DRp6xo3j.js";import{_ as gt}from"./call-outline-rounded-CPF2tTKf.js";import{_ as kt}from"./FieldId.vuevuetypescriptsetuptruelang-slfJ4h1L.js";import{_ as yt,a as ft,b as bt}from"./SearchInput-BJwFSU_P.js";import{_ as Ct}from"./VCheckbox-COaKMA3E.js";import{u as $t}from"./search-VN1T4MU3.js";import{u as wt,a as St}from"./tags-DBIbojtk.js";import"./search-rounded-DveNm3Pb.js";const Tt={key:0,class:"call-item selectable-card-skeleton"},Lt={class:"list-item-start"},It={class:"number"},qt=ne({__name:"CallSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(le){return(m,h)=>{const V=Me;return m.isPhone?(a(),b(V,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"}],"action-count":3})):(a(),o("section",Tt,[l("div",Lt,[h[0]||(h[0]=l("div",{class:"skeleton-checkbox"},null,-1)),l("span",It,r(m.index),1)]),h[1]||(h[1]=Qe('<div class="title"><div class="skeleton-text lg" style="width:160px;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:80px;"></div></div><div class="actions"><div class="skeleton-text lg" style="width:120px;"></div></div><div class="geo"><div class="skeleton-text" style="width:100px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',5))]))}}}),xt={class:"top-app-bar"},At={class:"title"},Dt={key:0},Vt={key:1},Et={class:"actions"},Mt={class:"scroll-content"},Pt=["onClick","onMouseover"],Bt={class:"list-item-start"},Nt={class:"number"},Qt={class:"title"},Gt={class:"subtitle"},Ut={class:"actions"},Kt=["onClick"],Rt=["onClick"],jt=["onClick"],zt={class:"geo"},Ft={class:"time"},Ot={key:0,class:"no-data-placeholder"},f=50,Ht=ne({__name:"CallsView",setup(le){var Z;const m=et("isPhone"),h=Ge(),{app:V}=Ue(Ke()),C=A([]),{t:E}=Re(),{parseQ:oe,buildQ:ce}=$t(),$=je({tagIds:[]}),_=ze.CALL,N=Fe(),Q=N.query,M=A(parseInt(((Z=Q.page)==null?void 0:Z.toString())??"1")),g=A(""),{tags:w,fetch:ie}=wt(_),{addToTags:de}=St(_,w),{deleteItems:G}=Pe(ht,()=>{q(),x(),p.emit("refetch_tags",_),p.emit("calls_deleted")}),{selectedIds:v,allChecked:U,realAllChecked:S,selectRealAll:re,allCheckedAlertVisible:_e,clearSelection:q,toggleAllChecked:ue,toggleSelect:K,total:i,checked:P,shiftEffectingIds:R,handleItemClick:pe,handleMouseOver:me,selectAll:he,shouldSelect:ve}=Be(C),j=e=>{const n=N.query.q;se(h,n?`/calls?page=${e}&q=${n}`:`/calls?page=${e}`)},{keyDown:z,keyUp:F}=Ne(i,f,M,he,q,j,()=>{G(v.value,S.value,i.value,g.value)}),{loading:B,fetch:x}=Oe({handle:(e,n)=>{n?at(E(n),"error"):e&&(C.value=e.calls,i.value=e.callCount)},document:st,variables:()=>({offset:(M.value-1)*f,limit:f,query:g.value})}),ge=["1","2","3"].map(e=>({id:e,name:E("call_type."+e)}));function ke(e){ae(_t,{type:_,tags:w.value,item:{key:e.id,title:"",size:0},selected:w.value.filter(n=>e.tags.some(T=>T.id===n.id))})}function O(e){return e?`/calls?q=${e}`:"/calls"}const H=e=>{e.type===_&&(q(),x())},W=e=>{e.type===_&&x()};function ye(e){if(!e)return"";const n=[];return e.isp&&n.push(E("phone_isp_type."+e.isp)),e.city===e.province?n.push(e.city):n.push(`${e.province}${e.city}`),n.join(", ")}const J=A(""),{mutate:fe,loading:be}=He({document:nt});function Ce(e){J.value=e.id,fe({number:e.number})}function $e(e){ae(pt,{id:e.id,name:e.number,gql:ut`
      mutation DeleteCall($query: String!) {
        deleteCalls(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),typeName:"Call",done:()=>{i.value--,e.tags.length&&p.emit("refetch_tags",_),p.emit("calls_deleted")}})}function we(e){Object.assign($,e),se(h,O(ce($)))}return We(()=>{var e;g.value=mt(((e=Q.q)==null?void 0:e.toString())??""),oe($,g.value),ie(),x(),p.on("item_tags_updated",W),p.on("items_tags_updated",H),window.addEventListener("keydown",z),window.addEventListener("keyup",F)}),Je(()=>{p.off("item_tags_updated",W),p.off("items_tags_updated",H),window.removeEventListener("keydown",z),window.removeEventListener("keyup",F)}),(e,n)=>{const T=Ct,X=Xe,Y=Ye,Se=yt,Te=bt,Le=ft,Ie=kt,qe=ot,xe=ct,Ae=gt,De=qt,Ve=Ee,k=Ze("tooltip");return a(),o(D,null,[l("div",xt,[c(T,{"touch-target":"wrapper",checked:t(U),indeterminate:!t(U)&&t(P),onChange:t(ue)},null,8,["checked","indeterminate","onChange"]),l("div",At,[t(v).length?(a(),o("span",Dt,r(e.$t("x_selected",{count:t(S)?t(i).toLocaleString():t(v).length.toLocaleString()})),1)):(a(),o("span",Vt,r(e.$t("page_title.calls"))+" ("+r(t(i).toLocaleString())+")",1)),t(P)?(a(),o(D,{key:2},[y((a(),o("button",{class:"btn-icon",onClick:n[0]||(n[0]=u(s=>t(G)(t(v),t(S),t(i),g.value),["stop"]))},[c(X)])),[[k,e.$t("delete")]]),y((a(),o("button",{class:"btn-icon",onClick:n[1]||(n[1]=u(s=>t(de)(t(v),t(S),g.value),["stop"]))},[c(Y)])),[[k,e.$t("add_to_tags")]])],64)):I("",!0)]),l("div",Et,[c(Se,{filter:$,tags:t(w),types:t(ge),"get-url":O,"show-chips":!t(m),"is-phone":t(m)},null,8,["filter","tags","types","show-chips","is-phone"])]),t(m)?(a(),b(Te,{key:0,class:"mobile-search-filters",filter:$,tags:t(w),feeds:[],buckets:[],types:[],onFilterChange:we},null,8,["filter","tags"])):I("",!0)]),c(Le,{limit:f,total:t(i),"all-checked-alert-visible":t(_e),"real-all-checked":t(S),"select-real-all":t(re),"clear-selection":t(q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),l("div",Mt,[l("div",{class:ee(["call-list",{"select-mode":t(P)}])},[(a(!0),o(D,null,te(C.value,(s,L)=>(a(),o("section",{key:s.id,class:ee(["call-item selectable-card",{selected:t(v).includes(s.id),selecting:t(R).includes(s.id)}]),onClick:u(d=>t(pe)(d,s,L,()=>{}),["stop"]),onMouseover:d=>t(me)(d,L)},[l("div",Bt,[t(R).includes(s.id)?(a(),b(T,{key:0,class:"checkbox","touch-target":"wrapper",checked:t(ve),onClick:u(d=>t(K)(d,s,L),["stop"])},null,8,["checked","onClick"])):(a(),b(T,{key:1,class:"checkbox","touch-target":"wrapper",checked:t(v).includes(s.id),onClick:u(d=>t(K)(d,s,L),["stop"])},null,8,["checked","onClick"])),l("span",Nt,[c(Ie,{id:L+1,raw:s},null,8,["id","raw"])])]),l("div",Qt,r(s.name?s.name+" "+s.number:s.number),1),l("div",Gt,[l("span",null,r(t(lt)(s.duration)),1),l("span",null,r(e.$t("call_type."+s.type)),1),c(qe,{tags:s.tags,type:t(_),"only-links":!0},null,8,["tags","type"])]),l("div",Ut,[y((a(),o("button",{class:"btn-icon sm",onClick:u(d=>$e(s),["stop"])},[c(X)],8,Kt)),[[k,e.$t("delete")]]),t(be)&&J.value===s.id?(a(),b(xe,{key:0,indeterminate:"",class:"sm"})):y((a(),o("button",{key:1,class:"btn-icon sm",onClick:u(d=>Ce(s),["stop"])},[c(Ae)],8,Rt)),[[k,e.$t("make_a_phone_call")]]),y((a(),o("button",{class:"btn-icon sm",onClick:u(d=>ke(s),["stop"])},[c(Y)],8,jt)),[[k,e.$t("add_to_tags")]])]),l("div",zt,r(ye(s.geo)),1),l("div",Ft,[y((a(),o("span",null,[dt(r(t(rt)(s.startedAt)),1)])),[[k,t(it)(s.startedAt)]])])],42,Pt))),128)),t(B)&&C.value.length===0?(a(),o(D,{key:0},te(20,s=>c(De,{key:s,index:s,"is-phone":t(m)},null,8,["index","is-phone"])),64)):I("",!0)],2),!t(B)&&C.value.length===0?(a(),o("div",Ot,r(e.$t(t(tt)(t(B),t(V).permissions,"WRITE_CALL_LOG"))),1)):I("",!0),t(i)>f?(a(),b(Ve,{key:1,page:M.value,go:j,total:t(i),limit:f},null,8,["page","total"])):I("",!0)])],64)}}}),ls=vt(Ht,[["__scopeId","data-v-66dc1b05"]]);export{ls as default};
