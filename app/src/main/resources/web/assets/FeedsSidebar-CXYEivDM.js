import{_ as $e}from"./LeftSidebar.vuevuetypescriptsetuptruelang-CF3KQ8wQ.js";import{a as ke,_ as ye}from"./TagFilter.vuevuetypescriptsetuptruelang-DA-dvEFf.js";import{_ as ge}from"./more-vert-rfLdxqnE.js";import{d as D,h as c,j as S,cr as be,ar as H,at as J,as as A,o as v,c as $,a as e,t as l,x as I,y as W,m as n,z as X,A as Z,V as G,H as Ce,cs as Fe,g as we,u as Me,s as xe,i as Ee,I as Ae,K as Le,k as Se,l as Ie,ct as Ve,C as z,v as Te,q as V,cu as Qe,a5 as j,$ as Re,cv as qe,cw as De,cx as Ge,S as Ne,p as T,P as U,O as Y,w as L,N as Q,e as R,Y as q,cy as Be,f as Ke,ac as Oe}from"./index-BxNI00MG.js";import{u as ee,a as te}from"./vee-validate.esm-9czZ1sUw.js";import{u as Pe}from"./feeds-D_-bRH1Y.js";import{u as ze}from"./search-D1_YTViL.js";import"./sidebar-JKGKmRjc.js";import"./EditValueModal-DZMNikfg.js";const je={slot:"headline"},Ue={slot:"content"},Ye={class:"form-row"},He=["label","error","error-text"],Je={class:"form-row"},We={class:"form-check-label"},Xe=["checked"],Ze={slot:"actions"},et=["disabled"],tt=D({__name:"AddFeedModal",props:{done:{type:Function}},setup(M){const{handleSubmit:b}=ee(),k=c(),d=c(!1);function x(t){d.value=t.target.checked}const f=M,{mutate:F,loading:E,onDone:C}=S({document:be,appApi:!0}),{value:i,resetField:p,errorMessage:r}=te("inputValue",H().required());p();function y(){A()}(async()=>{var t;await J(),(t=k.value)==null||t.focus()})();const m=b(()=>{F({url:i.value??"",fetchContent:d.value})});return C(()=>{var t;(t=f.done)==null||t.call(this),A()}),(t,a)=>(v(),$("md-dialog",null,[e("div",je,l(t.$t("add_subscription")),1),e("div",Ue,[e("div",Ye,[I(e("md-outlined-text-field",{ref_key:"inputRef",ref:k,label:t.$t("rss_url"),"onUpdate:modelValue":a[0]||(a[0]=_=>X(i)?i.value=_:null),onKeyup:a[1]||(a[1]=Z((..._)=>n(m)&&n(m)(..._),["enter"])),error:n(r),"error-text":n(r)?t.$t(n(r)):""},null,40,He),[[W,n(i)]])]),e("div",Je,[e("label",We,[e("md-checkbox",{"touch-target":"wrapper",onChange:x,checked:d.value},null,40,Xe),G(" "+l(t.$t("fetch_content_automatically")),1)])])]),e("div",Ze,[e("md-outlined-button",{value:"cancel",onClick:y},l(t.$t("cancel")),1),e("md-filled-button",{value:"save",disabled:n(E),onClick:a[2]||(a[2]=(..._)=>n(m)&&n(m)(..._)),autofocus:""},l(t.$t("save")),9,et)])]))}}),ot=Ce(tt,[["__scopeId","data-v-24d21569"]]),nt={slot:"headline"},st={slot:"content"},at={class:"form-label"},lt={class:"form-row"},it=["label","error","error-text"],dt={class:"form-row"},ut={class:"form-check-label"},rt=["checked"],ct={slot:"actions"},pt=["disabled"],ft=D({__name:"FeedModal",props:{data:{type:Object}},setup(M){var y,m;const{handleSubmit:b}=ee(),k=c(),d=c(!1);function x(t){d.value=t.target.checked}const f=M,{mutate:F,loading:E,onDone:C}=S({document:Fe,appApi:!0}),{value:i,errorMessage:p}=te("inputValue",H().required());i.value=((y=f.data)==null?void 0:y.name)??"",d.value=((m=f.data)==null?void 0:m.fetchContent)??!1,(async()=>{var t;await J(),(t=k.value)==null||t.focus()})();const r=b(()=>{var t;F({id:(t=f.data)==null?void 0:t.id,name:i.value,fetchContent:d.value})});return C(()=>{A()}),(t,a)=>{var _;return v(),$("md-dialog",null,[e("div",nt,l(t.$t("update_subscription")),1),e("div",st,[e("div",at,l((_=M.data)==null?void 0:_.url),1),e("div",lt,[I(e("md-outlined-text-field",{ref_key:"inputRef",ref:k,class:"form-control",label:t.$t("name"),error:n(p),"error-text":n(p)?t.$t(n(p)):"","onUpdate:modelValue":a[0]||(a[0]=h=>X(i)?i.value=h:null),onKeyup:a[1]||(a[1]=Z((...h)=>n(r)&&n(r)(...h),["enter"]))},null,40,it),[[W,n(i)]])]),e("div",dt,[e("label",ut,[e("md-checkbox",{"touch-target":"wrapper",onChange:x,checked:d.value},null,40,rt),G(" "+l(t.$t("fetch_content_automatically")),1)])])]),e("div",ct,[e("md-outlined-button",{value:"cancel",onClick:a[2]||(a[2]=(...h)=>n(A)&&n(A)(...h))},l(t.$t("cancel")),1),e("md-filled-button",{value:"save",disabled:n(E),onClick:a[3]||(a[3]=(...h)=>n(r)&&n(r)(...h)),autofocus:""},l(t.$t("save")),9,pt)])])}}}),vt=e("md-ripple",null,null,-1),mt=["open"],_t=["onClick"],ht={slot:"headline"},$t={class:"nav"},kt={class:"title"},yt={key:0,class:"count"},gt={class:"title"},bt={key:0,class:"count"},Ct=["onClick"],Ft={class:"title"},wt=["id","onClick"],Mt=e("md-ripple",null,null,-1),xt={key:0,class:"count"},Et=["anchor","open"],At={slot:"headline"},Lt={slot:"headline"},Nt=D({__name:"FeedsSidebar",setup(M){const{t:b}=we(),k=Me(),{counter:d}=xe(Ee()),{parseQ:x}=ze(),f=Ae({tagIds:[]}),F=c([]),E=[{text:"add_subscription",click:se},{text:"import_opml_file",click:ue},{text:"export_opml_file",click:re}],C=c(!1),i=c(""),p=c(""),r=c(!1),y=c(),m=c(new Map),t=c(!1),a=c(),{fetch:_}=Le({handle:o=>{o&&(d.value.feedEntries=o.total,d.value.feedEntriesToday=o.today,o.feedsCount.forEach(s=>{m.value.set(s.id,s.count)}))},document:Qe,variables:()=>({}),appApi:!0});function h(o){return m.value.get(o)??-1}function N(){var g;const o=j.currentRoute.value,s=Re(((g=o.query.q)==null?void 0:g.toString())??"");x(f,s),i.value=f.tagIds.length===1?f.tagIds[0]:"",p.value=f.feedId??"",r.value=f.today??!1,r.value?(i.value="",p.value=""):i.value&&p.value&&(i.value=""),_()}N(),Se(()=>j.currentRoute.value,()=>{N()});const{viewFeed:oe,viewAll:B,viewToday:K}=Pe(k),{refetch:O}=Ie({handle:(o,s)=>{s?z(b(s),"error"):o&&(F.value=o.feeds)},document:qe,appApi:!0});function ne(o){const s=o.target.files;if(!s)return;const g=new FileReader;g.addEventListener("load",()=>{ie({content:g.result})},!1),g.readAsText(s[0])}function se(){q(ot,{done:()=>{O()}})}const{mutate:ae,onDone:le}=S({document:De,appApi:!0});le(o=>{Ve(o.data.exportFeeds,"application/xml","feeds.xml")});const{mutate:ie,onDone:de}=S({document:Ge,appApi:!0});de(()=>{z(b("imported")),O()});function ue(){y.value.value="",y.value.click()}function re(){ae()}function ce(o){a.value=o,t.value=!0}function pe(o){q(ft,{data:o})}function fe(o){q(Oe,{id:o.id,name:o.name,gql:Be,appApi:!0,typeName:"Feed",done:()=>{Ke(k,"/feeds")}})}return(o,s)=>{const g=ke,ve=ge,me=ye,_e=$e,P=Ne("tooltip");return v(),Te(_e,null,{title:V(()=>[G(l(o.$t("page_title.feeds")),1)]),actions:V(()=>[I((v(),$("button",{class:"btn-icon",id:"add-feed-ref",onClick:s[0]||(s[0]=()=>C.value=!0)},[vt,T(g)])),[[P,n(b)("add_subscription")]]),e("md-menu",{anchor:"add-feed-ref",positioning:"fixed","stay-open-on-focusout":"",quick:"",open:C.value,onClosed:s[1]||(s[1]=()=>C.value=!1)},[(v(),$(Y,null,U(E,w=>e("md-menu-item",{key:w.text,onClick:w.click},[e("div",ht,l(o.$t(w.text)),1)],8,_t)),64))],40,mt)]),body:V(()=>{var w;return[e("ul",$t,[e("li",{onClick:s[2]||(s[2]=L((...u)=>n(B)&&n(B)(...u),["prevent"])),class:Q({active:!r.value&&!i.value&&!p.value})},[e("span",kt,l(o.$t("all")),1),n(d).feedEntries>=0?(v(),$("span",yt,l(n(d).feedEntries.toLocaleString()),1)):R("",!0)],2),e("li",{onClick:s[3]||(s[3]=L((...u)=>n(K)&&n(K)(...u),["prevent"])),class:Q({active:r.value})},[e("span",gt,l(o.$t("today")),1),n(d).feedEntriesToday>=0?(v(),$("span",bt,l(n(d).feedEntriesToday.toLocaleString()),1)):R("",!0)],2),(v(!0),$(Y,null,U(F.value,u=>(v(),$("li",{key:u.id,onClick:L(he=>n(oe)(u),["stop","prevent"]),class:Q({active:p.value&&u.id===p.value})},[e("span",Ft,l(u.name),1),I((v(),$("button",{id:"feed-"+u.id,class:"btn-icon sm",onClick:L(he=>ce(u),["prevent","stop"])},[Mt,T(ve)],8,wt)),[[P,o.$t("actions")]]),h(u.id)>=0?(v(),$("span",xt,l(h(u.id).toLocaleString()),1)):R("",!0)],10,Ct))),128))]),e("md-menu",{positioning:"popover",anchor:"feed-"+((w=a.value)==null?void 0:w.id),"stay-open-on-focusout":"",quick:"",open:t.value,onClosed:s[6]||(s[6]=u=>t.value=!1)},[e("md-menu-item",{onClick:s[4]||(s[4]=u=>pe(a.value))},[e("div",At,l(o.$t("edit")),1)]),e("md-menu-item",{onClick:s[5]||(s[5]=u=>fe(a.value))},[e("div",Lt,l(o.$t("delete")),1)])],40,Et),T(me,{type:"FEED_ENTRY",selected:i.value},null,8,["selected"]),e("input",{ref_key:"fileInput",ref:y,style:{display:"none"},accept:".xml",type:"file",onChange:ne},null,544)]}),_:1})}}});export{Nt as default};
