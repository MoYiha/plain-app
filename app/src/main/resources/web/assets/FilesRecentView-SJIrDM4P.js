import{e as ce,u as de,r as m,g as re,s as ue,i as _e,ao as pe,J as ve,K as ke,L as he,c as l,o as a,a as o,j as f,O as me,p as g,l as s,t as d,M as fe,y as _,k,ah as ge,Q as O,R as be,a3 as I,bj as ye,S as we,bA as Ee,bM as Ce,D as De,bz as Ie,d as Le,P as Se,U as Te,bC as H,aA as Ve,n as $e,X as Ae,Y as Fe,Z as xe,bD as Me,ai as Ne,bH as Re,ak as Ue,bI as ze,bJ as Be,bE as Ke,a2 as p,bL as Oe}from"./index-BaB8vEEK.js";import{u as He,c as Qe}from"./key-events-BJVXFo5r.js";const Ge={class:"top-app-bar"},Je=["checked","indeterminate"],Pe={key:0},je={key:1},Xe={key:0,class:"scroller"},We={class:"start"},Ye={class:"number"},Ze=["onClick","onMouseover"],qe={class:"start"},es=["checked","onClick"],ss=["checked","onClick"],ts={class:"number"},os=["onClick"],ns={key:0,class:"svg",src:H},as=["src","onError"],ls=["src","onError"],is={key:3,class:"svg",src:H},cs={class:"title"},ds={class:"subtitle"},rs={class:"actions"},us=["onClick"],_s={class:"btn-icon sm"},ps={class:"card card-info"},vs={class:"key-value vertical"},ks={class:"key"},hs={class:"value"},ms={key:2,class:"no-data-placeholder"},ys=ce({__name:"FilesRecentView",setup(fs){const{t:Q}=de(),G=m([]),L=re(),{app:J,urlTokenKey:b}=ue(L),r=m([]),{selectedIds:v,allChecked:S,realAllChecked:P,clearSelection:y,toggleAllChecked:T,toggleSelect:V,total:w,checked:$,shiftEffectingIds:A,handleItemClick:j,handleMouseOver:X,selectAll:W,shouldSelect:Y}=He(r),{downloadFile:F,downloadFiles:Z}=pe(b),{view:q}=Be(G,(e,n)=>{L.lightbox={sources:e,index:n,visible:!0}}),{keyDown:x,keyUp:M}=Qe(W,y,()=>{}),N=m([]),R=m([]),ee=e=>{N.value.push(e)},se=e=>{R.value.push(e)},{mutate:te,onDone:oe}=_e({document:Ee});oe(e=>{Z(e.data.setTempValue.key),y()});const U=e=>{Re(e.name)?window.open(Ue(b.value,e.path),"_blank"):ze(e.name)?q(r.value,e):F(e.path)},{loading:E,fetch:C}=ve({handle:async(e,n)=>{if(n)De(Q(n),"error");else{const u=[];for(const D of e.recentFiles)u.push(Ie(D,b.value));r.value=u,w.value=u.length}},document:Ce}),ne=()=>{te({key:Ke(),value:JSON.stringify(v.value.map(e=>({path:e})))})},z=e=>{e.status==="done"&&setTimeout(()=>{C()},1e3)},ae=e=>{e.forEach(n=>{Oe(r.value,u=>u.id===n.id)}),y()},B=e=>{ae([e.item])},K=e=>{C()};return ke(()=>{C(),p.on("upload_task_done",z),p.on("file_deleted",B),p.on("file_renamed",K),window.addEventListener("keydown",x),window.addEventListener("keyup",M)}),he(()=>{p.off("upload_task_done",z),p.off("file_deleted",B),p.off("file_renamed",K),window.removeEventListener("keydown",x),window.removeEventListener("keyup",M)}),(e,n)=>{const u=ge,D=Te,le=Me,ie=Ne,h=fe("tooltip");return a(),l(O,null,[o("div",Ge,[o("md-checkbox",{"touch-target":"wrapper",checked:s(S),indeterminate:!s(S)&&s($),onChange:n[0]||(n[0]=(...c)=>s(T)&&s(T)(...c))},null,40,Je),s(v).length?(a(),l("span",Pe,d(e.$t("x_selected",{count:s(P)?s(w).toLocaleString():s(v).length.toLocaleString()})),1)):(a(),l("span",je,d(e.$t("recent_files"))+" ("+d(s(w).toLocaleString())+")",1)),s($)?g((a(),l("button",{key:2,class:"btn-icon",onClick:_(ne,["stop"])},[n[1]||(n[1]=o("md-ripple",null,null,-1)),k(u)])),[[h,e.$t("download")]]):f("",!0)]),s(E)&&r.value.length===0?(a(),l("div",Xe,[(a(),l(O,null,be(20,c=>o("section",{key:c,class:"file-item selectable-card-skeleton"},[o("div",We,[n[2]||(n[2]=o("div",{class:"checkbox"},[o("div",{class:"skeleton-checkbox"})],-1)),o("span",Ye,d(c),1)]),n[3]||(n[3]=Le('<div class="image"><div class="skeleton-image"></div></div><div class="title"><div class="skeleton-text skeleton-title"></div></div><div class="subtitle"><div class="skeleton-text skeleton-subtitle"></div></div><div class="actions"><div class="skeleton-text skeleton-actions"></div></div>',4))])),64))])):f("",!0),r.value.length>0?(a(),me(s(ye),{key:1,class:"scroller","data-key":"id","data-sources":r.value,"estimate-size":80},{item:I(({index:c,item:t})=>[(a(),l("section",{key:t.id,class:Se(["file-item selectable-card",{selected:s(v).includes(t.id),selecting:s(A).includes(t.id)}]),onClick:_(i=>s(j)(i,t,c,()=>{U(t)}),["stop"]),onMouseover:i=>s(X)(i,c)},[o("div",qe,[s(A).includes(t.id)?(a(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:s(Y),onClick:_(i=>s(V)(i,t,c),["stop"])},null,8,es)):(a(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:s(v).includes(t.id),onClick:_(i=>s(V)(i,t,c),["stop"])},null,8,ss)),o("span",ts,[k(D,{id:c+1,raw:t},null,8,["id","raw"])])]),o("div",{class:"image",onClick:_(i=>U(t),["stop"])},[R.value.includes(t.id)?(a(),l("img",ns)):!N.value.includes(t.id)&&t.fileId?(a(),l("img",{key:1,class:"image-thumb",src:s(Ve)(t.fileId,"&w=50&h=50"),onError:i=>ee(t.id)},null,40,as)):t.extension?(a(),l("img",{key:2,src:`/ficons/${t.extension}.svg`,class:"svg",onError:i=>se(t.id)},null,40,ls)):(a(),l("img",is))],8,os),o("div",cs,d(t.name),1),o("div",ds,[o("span",null,d(s($e)(t.size)),1),g((a(),l("span",null,[Fe(d(s(xe)(t.updatedAt)),1)])),[[h,s(Ae)(t.updatedAt)]])]),o("div",rs,[g((a(),l("button",{class:"btn-icon sm",onClick:_(i=>s(F)(t.path),["stop"])},[n[4]||(n[4]=o("md-ripple",null,null,-1)),k(u)],8,us)),[[h,e.$t("download")]]),k(ie,null,{content:I(i=>[o("section",ps,[o("div",vs,[o("div",ks,d(e.$t("path")),1),o("div",hs,d(t.path),1)])])]),default:I(()=>[g((a(),l("button",_s,[n[5]||(n[5]=o("md-ripple",null,null,-1)),k(le)])),[[h,e.$t("info")]])]),_:2},1024)])],42,Ze))]),_:1},8,["data-sources"])):f("",!0),!s(E)&&r.value.length===0?(a(),l("div",ms,d(e.$t(s(we)(s(E),s(J).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):f("",!0)],64)}}});export{ys as default};
