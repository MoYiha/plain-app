import{_ as Io}from"./VPagination.vuevuetypescriptsetuptruelang-B4JWBRU5.js";import{_ as To,a as Do,b as So,c as Vo,d as Ao}from"./grid-view-outline-rounded-DoVxzMo6.js";import{_ as Eo}from"./FieldId.vuevuetypescriptsetuptruelang-B-w7x5OO.js";import{e as Mo,f as Fo,s as Ne,r as L,u as Lo,I as Ro,g as Uo,ag as He,ah as zo,J as qo,K as Bo,aK as No,aL as Ke,aM as Ho,ai as Ko,aN as R,aG as ge,L as Po,aO as Qo,aP as Go,M as Oo,N as jo,c as m,o as t,a as _,k as a,l as e,j as U,t as y,T as h,O as u,P as Wo,R as l,p as c,y as i,aQ as J,aR as Y,ak as Xo,S as A,al as Zo,U as x,V as Jo,aS as Yo,E as xo,aT as es,a7 as os,aU as ss,aj as ts,aV as ns,Q as as,ar as ls,aW as is,at as cs,Z as ds,n as Pe,aX as rs,$ as us,F as ps,a0 as _s,A as ms,a1 as gs,a2 as ks,aY as Qe,a3 as vs,a4 as D,aZ as fs}from"./index-CextXMl7.js";import{_ as ys,a as hs}from"./SearchInput-CrMMFD7Q.js";import{_ as $s,a as Cs}from"./upload-rounded-Dxk1aS2W.js";import{_ as bs}from"./VIconButton.vuevuetypescriptsetuptruelang-BlGK_fBO.js";import{_ as ws}from"./VCheckbox-DS09yxvJ.js";import{u as Is}from"./search-CYaYXsFn.js";import{a as Ts}from"./tags-DG3enOqx.js";import{u as Ds,a as Ss}from"./key-events-CRk-BMl_.js";import"./VInputChip-CfY98YKA.js";const Vs={class:"top-app-bar"},As={class:"title"},Es={key:0},Ms={key:1},Fs={class:"actions"},Ls=["onClick"],Rs={class:"button-group"},Us=["onClick","onMouseover"],zs=["src"],qs={key:1,class:"actions"},Bs={class:"right"},Ns=["onClick","onMouseover"],Hs={class:"start"},Ks={class:"number"},Ps=["src"],Qs={class:"title"},Gs={class:"subtitle"},Os=["onClick"],js={class:"actions"},Ws={class:"time"},Xs={key:2,class:"no-data-placeholder"},E=55,dt=Mo({__name:"ImagesView",setup(Zs){var Ue;const S=Fo(),{imageSortBy:K}=Ne(S),V=L([]),{t:Ge}=Lo(),{parseQ:Oe}=Is(),I=Ro({tagIds:[],bucketId:void 0}),ke=Uo(),{app:M,urlTokenKey:ee,uploads:oe}=Ne(ke),P=L(!1),se=L(!1),{input:je,upload:We,uploadChanged:ve}=He(oe),{input:Xe,upload:Ze,uploadChanged:fe}=He(oe),{dropping:Je,fileDragEnter:ye,fileDragLeave:he,dropFiles:Ye}=zo(oe),te=L(!1),r=qo.IMAGE,$e=Bo(),Ce=$e.query,ne=L(parseInt(((Ue=Ce.page)==null?void 0:Ue.toString())??"1")),{tags:Q,buckets:G,fetch:xe}=No(r),eo=Ke(()=>{const s={};return G.value.forEach(n=>{s[n.id]=n}),s}),b=L(""),{addToTags:oo}=Ts(r,Q),{deleteItems:ae,deleteItem:O}=Ho(),{view:so}=rs(r),{selectedIds:v,allChecked:be,realAllChecked:T,selectRealAll:to,allCheckedAlertVisible:no,clearSelection:z,toggleAllChecked:ao,toggleSelect:q,total:w,checked:B,shiftEffectingIds:j,handleItemClick:we,handleMouseOver:Ie,selectAll:lo,shouldSelect:Te}=Ds(V),{downloadItems:De}=Ko(ee,r,z,"images.zip"),{downloadFile:W}=cs(ee),Se=s=>{const n=$e.query.q;ms(S,n?`/images?page=${s}&q=${n}`:`/images?page=${s}`)},{keyDown:Ve,keyUp:Ae}=Ss(w,E,ne,lo,z,Se,()=>{J(Y.MEDIA_TRASH,M.value.osVersion)?Z(r,N()):ae(r,v.value,T.value,w.value,b.value)}),io=ls(),co=Ke(()=>V.value.map(s=>({src:ge(s.fileId),name:R(s.path),duration:0,size:s.size,path:s.path,type:r,data:s})));function le(s){ke.lightbox={sources:co.value,index:s,visible:!0}}const N=()=>{let s=b.value;return T.value||(s=`ids:${v.value.join(",")}`),s};function Ee(s){gs(ks,{type:r,tags:Q.value,item:{key:s.id,title:s.title,size:s.size},selected:Q.value.filter(n=>s.tags.some(C=>C.id===n.id))})}function ro(s){K.value!==s&&(te.value=!0,K.value=s)}const{loading:X,fetch:H}=Po({handle:async(s,n)=>{if(te.value=!1,n)xo(Ge(n),"error");else if(s){const C=[];for(const $ of s.images)C.push({...$,fileId:es(ee.value,$.path,$.id)});V.value=C,w.value=s.imageCount}},document:Yo,variables:()=>({offset:(ne.value-1)*E,limit:E,query:b.value,sortBy:K.value})}),{trashLoading:ie,trash:Z}=Qo(),{restoreLoading:ce,restore:de}=Go();function uo(s){return s?`/images?q=${s}`:"/images"}function re(){const s=G.value.find(n=>n.id===I.bucketId);return s?Qe(s.topItems[0]):`${M.value.internalStoragePath}/Pictures`}function po(){We(re())}function _o(){Ze(re())}function mo(s){Ye(s,re(),"image")}const Me=s=>{s.type===r&&(z(),H())},Fe=s=>{s.type===r&&H()},Le=s=>{s.type===r&&(z(),H())},Re=s=>{s.status==="done"&&fs(s.fileName)&&((!I.bucketId||G.value.some(C=>C.id===I.bucketId&&C.topItems.some($=>s.dir.startsWith(Qe($)))))&&setTimeout(()=>{H()},1e3),D.emit("media_items_actioned",{type:r,action:"upload",query:""}))};return Oo(()=>{var s;b.value=vs(((s=Ce.q)==null?void 0:s.toString())??""),Oe(I,b.value),xe(),H(),D.on("item_tags_updated",Fe),D.on("items_tags_updated",Me),D.on("media_items_actioned",Le),D.on("upload_task_done",Re),window.addEventListener("keydown",Ve),window.addEventListener("keyup",Ae)}),jo(()=>{D.off("item_tags_updated",Fe),D.off("items_tags_updated",Me),D.off("media_items_actioned",Le),D.off("upload_task_done",Re),window.removeEventListener("keydown",Ve),window.removeEventListener("keyup",Ae)}),(s,n)=>{const C=ws,$=os,d=bs,ue=ss,F=ts,pe=ns,_e=as,go=ys,ko=$s,ze=Xo,vo=Cs,fo=To,yo=Do,ho=hs,me=So,qe=Vo,$o=is,Be=ds,Co=Eo,bo=Ao,wo=Io,p=Wo("tooltip");return t(),m(h,null,[_("div",Vs,[a(C,{"touch-target":"wrapper",checked:e(be),indeterminate:!e(be)&&e(B),onChange:e(ao)},null,8,["checked","indeterminate","onChange"]),_("div",As,[e(v).length?(t(),m("span",Es,y(s.$t("x_selected",{count:e(T)?e(w).toLocaleString():e(v).length.toLocaleString()})),1)):(t(),m("span",Ms,y(s.$t("page_title.images"))+" ("+y(e(w).toLocaleString())+")",1)),e(B)?(t(),m(h,{key:2},[I.trash?(t(),m(h,{key:0},[u((t(),l(d,{onClick:n[0]||(n[0]=i(o=>e(ae)(e(r),e(v),e(T),e(w),b.value),["stop"]))},{icon:c(()=>[a($)]),_:1})),[[p,s.$t("delete")]]),u((t(),l(d,{loading:e(ce)(N()),onClick:n[1]||(n[1]=i(o=>e(de)(e(r),N()),["stop"]))},{icon:c(()=>[a(ue)]),_:1},8,["loading"])),[[p,s.$t("restore")]]),u((t(),l(d,{onClick:n[2]||(n[2]=i(o=>e(De)(e(T),e(v),b.value),["stop"]))},{icon:c(()=>[a(F)]),_:1})),[[p,s.$t("download")]])],64)):(t(),m(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(M).osVersion)?u((t(),l(d,{key:0,loading:e(ie)(N()),onClick:n[3]||(n[3]=i(o=>e(Z)(e(r),N()),["stop"]))},{icon:c(()=>[a(pe)]),_:1},8,["loading"])),[[p,s.$t("move_to_trash")]]):u((t(),l(d,{key:1,onClick:n[4]||(n[4]=i(o=>e(ae)(e(r),e(v),e(T),e(w),b.value),["stop"]))},{icon:c(()=>[a($)]),_:1})),[[p,s.$t("delete")]]),u((t(),l(d,{onClick:n[5]||(n[5]=i(o=>e(De)(e(T),e(v),b.value),["stop"]))},{icon:c(()=>[a(F)]),_:1})),[[p,s.$t("download")]]),u((t(),l(d,{onClick:n[6]||(n[6]=i(o=>e(oo)(e(v),e(T),b.value),["stop"]))},{icon:c(()=>[a(_e)]),_:1})),[[p,s.$t("add_to_tags")]])],64))],64)):U("",!0)]),_("div",Fs,[a(go,{filter:I,tags:e(Q),buckets:e(G),"get-url":uo},null,8,["filter","tags","buckets"]),I.trash?U("",!0):(t(),l(ze,{key:0,modelValue:P.value,"onUpdate:modelValue":n[9]||(n[9]=o=>P.value=o)},{trigger:c(()=>[u((t(),l(d,null,{icon:c(()=>[a(ko)]),_:1})),[[p,s.$t("upload")]])]),default:c(()=>[_("div",{class:"dropdown-item",onClick:n[7]||(n[7]=i(o=>{po(),P.value=!1},["stop"]))},y(s.$t("upload_files")),1),_("div",{class:"dropdown-item",onClick:n[8]||(n[8]=i(o=>{_o(),P.value=!1},["stop"]))},y(s.$t("upload_folder")),1)]),_:1},8,["modelValue"])),a(ze,{modelValue:se.value,"onUpdate:modelValue":n[10]||(n[10]=o=>se.value=o)},{trigger:c(()=>[u((t(),l(d,{loading:te.value},{icon:c(()=>[a(vo)]),_:1},8,["loading"])),[[p,s.$t("sort")]])]),default:c(()=>[(t(!0),m(h,null,x(e(io),o=>(t(),m("div",{key:o.value,class:A(["dropdown-item",{selected:o.value===e(K)}]),onClick:f=>{ro(o.value),se.value=!1}},y(s.$t(o.label)),11,Ls))),128))]),_:1},8,["modelValue"]),_("div",Rs,[_("button",{class:A({selected:!e(S).imagesCardView}),onClick:n[11]||(n[11]=o=>e(S).imagesCardView=!1)},[a(fo)],2),_("button",{class:A({selected:e(S).imagesCardView}),onClick:n[12]||(n[12]=o=>e(S).imagesCardView=!0)},[a(yo)],2)])])]),a(ho,{limit:E,total:e(w),"all-checked-alert-visible":e(no),"real-all-checked":e(T),"select-real-all":e(to),"clear-selection":e(z)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),_("div",{class:"scroll-content",onDragover:n[16]||(n[16]=i((...o)=>e(ye)&&e(ye)(...o),["stop","prevent"]))},[u(_("div",{class:"drag-mask",onDrop:i(mo,["stop","prevent"]),onDragleave:n[13]||(n[13]=i((...o)=>e(he)&&e(he)(...o),["stop","prevent"]))},y(s.$t("release_to_send_files")),545),[[Zo,e(Je)]]),e(S).imagesCardView?(t(),m("div",{key:1,class:A(["media-list",{"select-mode":e(B)}])},[(t(!0),m(h,null,x(V.value,(o,f)=>{var g;return t(),m("section",{key:o.id,class:A(["media-item selectable-card",{selected:e(v).includes(o.id),selecting:e(j).includes(o.id)}]),onClick:i(k=>e(we)(k,o,f,le),["stop"]),onMouseover:k=>e(Ie)(k,f)},[_("div",Hs,[e(j).includes(o.id)?(t(),l(C,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(Te),onClick:i(k=>e(q)(k,o,f),["stop"])},null,8,["checked","onClick"])):(t(),l(C,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(v).includes(o.id),onClick:i(k=>e(q)(k,o,f),["stop"])},null,8,["checked","onClick"])),_("span",Ks,[a(Co,{id:f+1,raw:o},null,8,["id","raw"])])]),_("img",{class:"image",src:e(ge)(o.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,Ps),_("div",Qs,y(e(R)(o.path)),1),_("div",Gs,[_("span",null,y(e(Pe)(o.size)),1),_("a",{onClick:i(k=>e(so)(e(S),o.bucketId),["stop","prevent"])},y((g=eo.value[o.bucketId])==null?void 0:g.name),9,Os),a(Be,{tags:o.tags,type:e(r),"only-links":!0},null,8,["tags","type"])]),_("div",js,[I.trash?(t(),m(h,{key:0},[u((t(),l(d,{class:"sm",onClick:i(k=>e(O)(e(r),o),["stop"])},{icon:c(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),u((t(),l(d,{class:"sm",loading:e(ce)(`ids:${o.id}`),onClick:i(k=>e(de)(e(r),`ids:${o.id}`),["stop"])},{icon:c(()=>[a(ue)]),_:2},1032,["loading","onClick"])),[[p,s.$t("restore")]]),u((t(),l(d,{class:"sm",onClick:i(k=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[a(F)]),_:2},1032,["onClick"])),[[p,s.$t("download")]])],64)):(t(),m(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(M).osVersion)?u((t(),l(d,{key:0,class:"sm",loading:e(ie)(`ids:${o.id}`),onClick:i(k=>e(Z)(e(r),`ids:${o.id}`),["stop"])},{icon:c(()=>[a(pe)]),_:2},1032,["loading","onClick"])),[[p,s.$t("move_to_trash")]]):u((t(),l(d,{key:1,class:"sm",onClick:i(k=>e(O)(e(r),o),["stop"])},{icon:c(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),u((t(),l(d,{class:"sm",onClick:i(k=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[a(F)]),_:2},1032,["onClick"])),[[p,s.$t("download")]]),u((t(),l(d,{class:"sm",onClick:i(k=>Ee(o),["stop"])},{icon:c(()=>[a(_e)]),_:2},1032,["onClick"])),[[p,s.$t("add_to_tags")]])],64))]),_("div",Ws,[u((t(),m("span",null,[ps(y(e(_s)(o.createdAt)),1)])),[[p,e(us)(o.createdAt)]])])],42,Ns)}),128)),e(X)&&V.value.length===0?(t(),l(bo,{key:0,limit:E})):U("",!0)],2)):(t(),m("div",{key:0,class:A(["media-grid",{"select-mode":e(B)}])},[(t(!0),m(h,null,x(V.value,(o,f)=>(t(),m("section",{key:o.id,class:A(["media-item",{selected:e(v).includes(o.id),selecting:e(j).includes(o.id)}]),onClick:i(g=>e(we)(g,o,f,le),["stop"]),onMouseover:g=>e(Ie)(g,f)},[_("img",{class:"image-thumb image",src:e(ge)(o.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,zs),e(j).includes(o.id)?(t(),l(d,{key:0,class:"btn-checkbox",onClick:i(g=>e(q)(g,o,f),["stop"])},{icon:c(()=>[e(Te)?(t(),l(me,{key:0})):(t(),l(qe,{key:1}))]),_:2},1032,["onClick"])):e(v).includes(o.id)?(t(),l(d,{key:1,class:"btn-checkbox",onClick:i(g=>e(q)(g,o,f),["stop"])},{icon:c(()=>[a(me)]),_:2},1032,["onClick"])):(t(),m(h,{key:2},[a(d,{class:"btn-checkbox",onClick:i(g=>e(q)(g,o,f),["stop"])},{icon:c(()=>[e(v).includes(o.id)?(t(),l(me,{key:0})):(t(),l(qe,{key:1}))]),_:2},1032,["onClick"]),e(B)?u((t(),l(d,{key:0,class:"btn-zoom sm",onClick:i(g=>le(f),["stop"])},{icon:c(()=>[a($o)]),_:2},1032,["onClick"])),[[p,s.$t("open")]]):(t(),m("div",qs,[I.trash?(t(),m(h,{key:0},[u((t(),l(d,{class:"sm",onClick:i(g=>e(O)(e(r),o),["stop"])},{icon:c(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),u((t(),l(d,{class:"sm",loading:e(ce)(`ids:${o.id}`),onClick:i(g=>e(de)(e(r),`ids:${o.id}`),["stop"])},{icon:c(()=>[a(ue)]),_:2},1032,["loading","onClick"])),[[p,s.$t("restore")]]),u((t(),l(d,{class:"sm",onClick:i(g=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[a(F)]),_:2},1032,["onClick"])),[[p,s.$t("download")]])],64)):(t(),m(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(M).osVersion)?u((t(),l(d,{key:0,class:"sm",loading:e(ie)(`ids:${o.id}`),onClick:i(g=>e(Z)(e(r),`ids:${o.id}`),["stop"])},{icon:c(()=>[a(pe)]),_:2},1032,["loading","onClick"])),[[p,s.$t("move_to_trash")]]):u((t(),l(d,{key:1,class:"sm",onClick:i(g=>e(O)(e(r),o),["stop"])},{icon:c(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),u((t(),l(d,{class:"sm",onClick:i(g=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[a(F)]),_:2},1032,["onClick"])),[[p,s.$t("download")]]),u((t(),l(d,{class:"sm",onClick:i(g=>Ee(o),["stop"])},{icon:c(()=>[a(_e)]),_:2},1032,["onClick"])),[[p,s.$t("add_to_tags")]])],64))])),_("div",{class:A(["info",{"has-tags":o.tags.length>0}])},[a(Be,{tags:o.tags,type:e(r)},null,8,["tags","type"]),_("span",Bs,y(e(Pe)(o.size)),1)],2)],64))],42,Us))),128)),e(X)&&V.value.length===0?(t(),m(h,{key:0},x(E,o=>_("section",{key:o,class:"skeleton-image media-item"})),64)):U("",!0)],2)),!e(X)&&V.value.length===0?(t(),m("div",Xs,y(s.$t(e(Jo)(e(X),e(M).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):U("",!0),e(w)>E?(t(),l(wo,{key:3,page:ne.value,go:Se,total:e(w),limit:E},null,8,["page","total"])):U("",!0),_("input",{ref_key:"fileInput",ref:je,style:{display:"none"},type:"file",accept:"image/*",multiple:"",onChange:n[14]||(n[14]=(...o)=>e(ve)&&e(ve)(...o))},null,544),_("input",{ref_key:"dirFileInput",ref:Xe,style:{display:"none"},type:"file",accept:"image/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[15]||(n[15]=(...o)=>e(fe)&&e(fe)(...o))},null,544)],32)],64)}}});export{dt as default};
