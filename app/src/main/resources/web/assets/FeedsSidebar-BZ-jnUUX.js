import{_ as ge}from"./LeftSidebar.vuevuetypescriptsetuptruelang-CbCF_-pF.js";import{_ as ye,a as Ce}from"./TagFilter.vuevuetypescriptsetuptruelang-BkMRTiB-.js";import{_ as Fe}from"./more-vert-XVOmELru.js";import{d as N,r as c,i as D,bW as we,ar as X,at as Z,as as x,c as v,o as f,a as e,t as l,n as Q,v as ee,k as o,p as te,q as oe,V,h as S,C as Me,bX as Ee,u as Le,e as xe,s as Se,f as Ve,D as Ie,G as Te,w as De,g as Qe,bg as Re,A as z,ac as qe,a0 as I,ad as Ae,L as Ge,a1 as R,a2 as H,$ as Ne,bY as Be,bZ as Oe,b_ as Ke,b$ as Pe,j as q,x as T,M as A,O as J,J as Ue,N as W,Y as G,aa as Ye,c0 as je,y as ze}from"./index-Dohfv8Fq.js";import{u as ne,a as se}from"./vee-validate-BgwL6Mce.js";import{u as He}from"./feeds-C8QCcad_.js";import{u as Je}from"./search-BGPnRmZx.js";import"./EditValueModal-BR2lNZFL.js";const We={slot:"headline"},Xe={slot:"content"},Ze={class:"form-row"},et=["label","error","error-text"],tt={class:"form-row"},ot={class:"form-check-label"},nt=["checked"],st={slot:"actions"},at=["disabled"],lt={key:0,slot:"icon",indeterminate:""},dt=N({__name:"AddFeedModal",props:{done:{type:Function}},setup(E){const{handleSubmit:y}=ne(),k=c(),i=c(!1);function L(t){i.value=t.target.checked}const _=E,{mutate:w,loading:C,onDone:F}=D({document:we}),{value:d,resetField:p,errorMessage:u}=se("inputValue",X().required());p();function b(){x()}(async()=>{var t;await Z(),(t=k.value)==null||t.focus()})();const h=y(()=>{w({url:d.value??"",fetchContent:i.value})});return F(()=>{var t;(t=_.done)==null||t.call(this),x()}),(t,a)=>(f(),v("md-dialog",null,[e("div",We,l(t.$t("add_subscription")),1),e("div",Xe,[e("div",Ze,[Q(e("md-outlined-text-field",{ref_key:"inputRef",ref:k,"onUpdate:modelValue":a[0]||(a[0]=m=>oe(d)?d.value=m:null),label:t.$t("rss_url"),error:o(u),"error-text":o(u)?t.$t(o(u)):"",onKeyup:a[1]||(a[1]=te((...m)=>o(h)&&o(h)(...m),["enter"]))},null,40,et),[[ee,o(d)]])]),e("div",tt,[e("label",ot,[e("md-checkbox",{"touch-target":"wrapper",checked:i.value,onChange:L},null,40,nt),V(" "+l(t.$t("fetch_content_automatically")),1)])])]),e("div",st,[e("md-outlined-button",{value:"cancel",onClick:b},l(t.$t("cancel")),1),e("md-filled-button",{value:"save",disabled:o(C),autofocus:"",onClick:a[2]||(a[2]=(...m)=>o(h)&&o(h)(...m))},[o(C)?(f(),v("md-circular-progress",lt)):S("",!0),V(" "+l(t.$t("save")),1)],8,at)])]))}}),it=Me(dt,[["__scopeId","data-v-cf73b901"]]),rt={slot:"headline"},ut={slot:"content"},ct={class:"form-label"},ft={class:"form-row"},pt=["label","error","error-text"],mt={class:"form-row"},vt={class:"form-check-label"},_t=["checked"],ht={slot:"actions"},$t=["disabled"],kt={key:0,slot:"icon",indeterminate:""},bt=N({__name:"FeedModal",props:{data:{type:Object}},setup(E){var b,h;const{handleSubmit:y}=ne(),k=c(),i=c(!1);function L(t){i.value=t.target.checked}const _=E,{mutate:w,loading:C,onDone:F}=D({document:Ee}),{value:d,errorMessage:p}=se("inputValue",X().required());d.value=((b=_.data)==null?void 0:b.name)??"",i.value=((h=_.data)==null?void 0:h.fetchContent)??!1,(async()=>{var t;await Z(),(t=k.value)==null||t.focus()})();const u=y(()=>{var t;w({id:(t=_.data)==null?void 0:t.id,name:d.value,fetchContent:i.value})});return F(()=>{x()}),(t,a)=>{var m;return f(),v("md-dialog",null,[e("div",rt,l(t.$t("update_subscription")),1),e("div",ut,[e("div",ct,l((m=E.data)==null?void 0:m.url),1),e("div",ft,[Q(e("md-outlined-text-field",{ref_key:"inputRef",ref:k,"onUpdate:modelValue":a[0]||(a[0]=$=>oe(d)?d.value=$:null),class:"form-control",label:t.$t("name"),error:o(p),"error-text":o(p)?t.$t(o(p)):"",onKeyup:a[1]||(a[1]=te((...$)=>o(u)&&o(u)(...$),["enter"]))},null,40,pt),[[ee,o(d)]])]),e("div",mt,[e("label",vt,[e("md-checkbox",{"touch-target":"wrapper",checked:i.value,onChange:L},null,40,_t),V(" "+l(t.$t("fetch_content_automatically")),1)])])]),e("div",ht,[e("md-outlined-button",{value:"cancel",onClick:a[2]||(a[2]=(...$)=>o(x)&&o(x)(...$))},l(t.$t("cancel")),1),e("md-filled-button",{value:"save",disabled:o(C),autofocus:"",onClick:a[3]||(a[3]=(...$)=>o(u)&&o(u)(...$))},[o(C)?(f(),v("md-circular-progress",kt)):S("",!0),V(" "+l(t.$t("save")),1)],8,$t)])])}}}),gt=["open"],yt=["onClick"],Ct={slot:"headline"},Ft={class:"nav"},wt={class:"title"},Mt={key:0,class:"count"},Et={class:"title"},Lt={key:0,class:"count"},xt=["onClick"],St={class:"title"},Vt=["id","onClick"],It={key:0,class:"count"},Tt=["anchor","open"],Dt={slot:"headline"},Qt={slot:"headline"},Pt=N({__name:"FeedsSidebar",setup(E){const{t:y}=Le(),k=xe(),{counter:i}=Se(Ve()),{parseQ:L}=Je(),_=Ie({tagIds:[]}),w=c([]),C=[{text:"add_subscription",click:de},{text:"import_opml_file",click:fe},{text:"export_opml_file",click:pe}],F=c(!1),d=c(""),p=c(""),u=c(!1),b=c(),h=c(new Map),t=c(!1),a=c(),{fetch:m}=Te({handle:n=>{n&&(i.value.feedEntries=n.total,i.value.feedEntriesToday=n.today,n.feedsCount.forEach(s=>{h.value.set(s.id,s.count)}))},document:Be,variables:()=>({})});function $(n){return h.value.get(n)??-1}function B(){var g;const n=H.currentRoute.value,s=Ne(((g=n.query.q)==null?void 0:g.toString())??"");L(_,s),d.value=_.tagIds.length===1?_.tagIds[0]:"",p.value=_.feedId??"",u.value=_.today??!1,u.value?(d.value="",p.value=""):d.value&&p.value&&(d.value=""),m()}B(),De(()=>H.currentRoute.value,()=>{B()});const{viewFeed:ae,viewAll:O,viewToday:K}=He(k),{refetch:P}=Qe({handle:(n,s)=>{s?z(y(s),"error"):n&&(w.value=n.feeds)},document:Oe});function le(n){const s=n.target.files;if(!s)return;const g=new FileReader;g.addEventListener("load",()=>{ue({content:g.result})},!1),g.readAsText(s[0])}function de(){G(it,{done:()=>{P()}})}const{mutate:ie,onDone:re}=D({document:Ke});re(n=>{Re(n.data.exportFeeds,"application/xml","feeds.xml")});const{mutate:ue,onDone:ce}=D({document:Pe});ce(()=>{z(y("imported")),P()});function fe(){b.value.value="",b.value.click()}function pe(){ie()}function me(n){a.value=n,t.value=!0}function ve(n){G(bt,{data:n})}function _e(n){G(Ye,{id:n.id,name:n.name,gql:je,typeName:"Feed",done:()=>{ze(k,"/feeds")}})}const U=()=>{m()},Y=()=>{m()};return qe(()=>{I.on("feed_entries_deleted",U),I.on("feeds_fetched",Y)}),Ae(()=>{I.off("feed_entries_deleted",U),I.off("feeds_fetched",Y)}),(n,s)=>{const g=Ce,he=Fe,$e=ye,ke=ge,j=Ue("tooltip");return f(),Ge(ke,null,{title:R(()=>[V(l(n.$t("page_title.feeds")),1)]),actions:R(()=>[Q((f(),v("button",{id:"add-feed-ref",class:"btn-icon",onClick:s[0]||(s[0]=()=>F.value=!0)},[s[7]||(s[7]=e("md-ripple",null,null,-1)),q(g)])),[[j,o(y)("add_subscription")]]),e("md-menu",{anchor:"add-feed-ref",positioning:"fixed","stay-open-on-focusout":"",quick:"",open:F.value,onClosed:s[1]||(s[1]=()=>F.value=!1)},[(f(),v(W,null,J(C,M=>e("md-menu-item",{key:M.text,onClick:M.click},[e("div",Ct,l(n.$t(M.text)),1)],8,yt)),64))],40,gt)]),body:R(()=>{var M;return[e("ul",Ft,[e("li",{class:A({active:!u.value&&!d.value&&!p.value}),onClick:s[2]||(s[2]=T((...r)=>o(O)&&o(O)(...r),["prevent"]))},[e("span",wt,l(n.$t("all")),1),o(i).feedEntries>=0?(f(),v("span",Mt,l(o(i).feedEntries.toLocaleString()),1)):S("",!0)],2),e("li",{class:A({active:u.value}),onClick:s[3]||(s[3]=T((...r)=>o(K)&&o(K)(...r),["prevent"]))},[e("span",Et,l(n.$t("today")),1),o(i).feedEntriesToday>=0?(f(),v("span",Lt,l(o(i).feedEntriesToday.toLocaleString()),1)):S("",!0)],2),(f(!0),v(W,null,J(w.value,r=>(f(),v("li",{key:r.id,class:A({active:p.value&&r.id===p.value}),onClick:T(be=>o(ae)(r),["stop","prevent"])},[e("span",St,l(r.name),1),Q((f(),v("button",{id:"feed-"+r.id,class:"btn-icon sm",onClick:T(be=>me(r),["prevent","stop"])},[s[8]||(s[8]=e("md-ripple",null,null,-1)),q(he)],8,Vt)),[[j,n.$t("actions")]]),$(r.id)>=0?(f(),v("span",It,l($(r.id).toLocaleString()),1)):S("",!0)],10,xt))),128))]),e("md-menu",{positioning:"popover",anchor:"feed-"+((M=a.value)==null?void 0:M.id),"stay-open-on-focusout":"",quick:"",open:t.value,onClosed:s[6]||(s[6]=r=>t.value=!1)},[e("md-menu-item",{onClick:s[4]||(s[4]=r=>ve(a.value))},[e("div",Dt,l(n.$t("edit")),1)]),e("md-menu-item",{onClick:s[5]||(s[5]=r=>_e(a.value))},[e("div",Qt,l(n.$t("delete")),1)])],40,Tt),q($e,{type:"FEED_ENTRY",selected:d.value},null,8,["selected"]),e("input",{ref_key:"fileInput",ref:b,style:{display:"none"},accept:".xml",type:"file",onChange:le},null,544)]}),_:1})}}});export{Pt as default};
