import{_ as Be}from"./more-vert-DylU1d9b.js";import{u as ue,r as b,J as _e,ca as Ge,D as E,e as He,f as Ke,s as Pe,g as We,G as xe,H as je,I as Oe,aH as ne,a3 as ae,i as le,K as Ye,L as Je,c as l,o as n,a as o,k as r,j as q,O as Xe,l as e,t as p,Q as ie,p as D,M as Ze,y as f,a5 as es,N as ss,R as ts,a2 as de,bi as os,S as ns,c9 as as,bP as ls,cb as is,cc as ds,cd as cs,d as rs,P as us,W as _s,X as ps,Y as fs,V as ms,aC as vs,z as ce,a0 as gs,a1 as m,ce as hs,F as ks}from"./index-BaWXnnLZ.js";import{_ as ys}from"./FieldId.vuevuetypescriptsetuptruelang-eOYRhci9.js";import{_ as bs,a as ws}from"./SearchInput-Cq5_Bnx2.js";import{_ as $s,a as Cs}from"./add-notes-outline-rounded-BY9C4n0f.js";import{u as Ss}from"./feeds-s6wWq14G.js";import{u as Ts,b as Ls,a as Fs}from"./key-events-B0Jq4BkE.js";import{a as qs}from"./tags-zkWLe_qU.js";import{u as Ds}from"./search-brnXFXDL.js";import"./search-rounded-Dmop53vQ.js";const Es=(N,u,w)=>{const{t:$}=ue(),v=b(1),I=100,d=b(!1),{loading:C,fetch:A}=_e({handle:(g,S)=>{if(S)E($(S),"error");else if(g){g.items.length<I&&(d.value=!0);const T=g.items;v.value===1?N.value=T:N.value=N.value.concat(T),w.value=g.total}},document:Ge,variables:()=>({offset:(v.value-1)*I,limit:I,query:u.value})});return{page:v,noMore:d,loading:C,fetch:A,loadMore:()=>{d.value||C.value||v.value++}}},Is={class:"top-app-bar"},Ms=["checked","indeterminate"],Ns={class:"title"},As={key:0},Qs={key:1},Rs={key:0,indeterminate:"",class:"spinner-sm"},Vs={class:"actions"},zs={key:0,indeterminate:"",class:"spinner-sm"},Us=["disabled"],Bs={key:0,class:"scroller"},Gs={class:"subtitle"},Hs={class:"number"},Ks=["href"],Ps=["onClick","onMouseover"],Ws={class:"title"},xs=["checked","onClick"],js=["checked","onClick"],Os={class:"text"},Ys={class:"subtitle"},Js={class:"number"},Xs={class:"info"},Zs=["onClick"],et={class:"time"},st={class:"btn-icon sm",style:{display:"none"}},tt=["src"],ot={key:0,indeterminate:"",class:"spinner-sm"},nt={key:2,class:"no-data-placeholder"},re=100,at=He({__name:"FeedsSidebar2",setup(N){var te;const u=Ke(),{feedsSyncing:w}=Pe(We()),{t:$}=ue(),v=xe({tagIds:[]}),{parseQ:I}=Ds(),d=je.FEED_ENTRY,C=Oe(),A=C.query,g=b(parseInt(((te=A.page)==null?void 0:te.toString())??"1")),S=b([]),T=b([]),z=ne(()=>{const s={};return T.value.forEach(t=>{s[t.id]=t}),s}),h=b([]),k=b(""),{selectedIds:c,allChecked:U,realAllChecked:L,selectRealAll:pe,allCheckedAlertVisible:fe,clearSelection:Q,toggleAllChecked:B,toggleSelect:G,total:y,checked:H,shiftEffectingIds:K,handleItemClick:me,handleMouseOver:ve,selectAll:ge,shouldSelect:he}=Ts(h),ke=s=>{g.value=s;const t=C.query.q;ce(u,t?`/feeds?page=${s}&q=${t}`:`/feeds?page=${s}`)},{keyDown:P,keyUp:W}=Fs(y,re,g,ge,Q,ke,()=>{O(c.value,L.value,y.value,k.value)}),{page:x,loading:V,loadMore:ye,fetch:be,noMore:j}=Es(h,k,y),{addToTags:we}=qs(d,S),M=()=>{x.value=1,be()},{deleteItems:O}=Ls(hs,()=>{Q(),M(),h.value.some(s=>s.tags.length)&&m.emit("refetch_tags",d),m.emit("feed_entries_deleted")}),$e=ne(()=>ae.currentRoute.value.path!=="/feeds"),{resizeWidth:Y}=as(300,()=>u.sidebar2Width,s=>{u.sidebar2Width=s}),{mutate:J,loading:Ce,onDone:Se}=le({document:is});function Te(){if(L)J({query:k.value});else{if(c.value.length===0){E($("select_first"),"error");return}J({query:`ids:${c.value.join(",")}`})}}Se(()=>{E($("saved"))});function Le(s){return s?`/feeds?q=${s}`:"/feeds"}const{fetch:Fe}=_e({handle:async(s,t)=>{t?E($(t),"error"):s&&(S.value=s.tags,T.value=s.feeds)},document:ds,variables:{type:d}});function X(s){const t=ae.currentRoute.value.query.q;return t?`/feeds/${s.feedId}/entries/${s.id}?q=${t}`:`/feeds/${s.feedId}/entries/${s.id}`}function qe(s){ce(u,X(s))}const{viewFeed:De}=Ss(u),{mutate:Ee}=le({document:cs});function Ie(){w.value=!0,Ee({id:""})}const Z=s=>{w.value=!1,M(),s.error?E(s.error,"error"):E($("feeds_synced"))},ee=s=>{s.type===d&&(Q(),M())},se=s=>{s.type===d&&M()};return Ye(()=>{var t,R;const s=(t=document.getElementsByClassName("scroller"))==null?void 0:t[0];s&&(s.scrollTop=0),k.value=gs(((R=A.q)==null?void 0:R.toString())??""),I(v,k.value),Fe(),M(),m.on("item_tags_updated",se),m.on("items_tags_updated",ee),m.on("feeds_fetched",Z),window.addEventListener("keydown",P),window.addEventListener("keyup",W)}),Je(()=>{x.value=1,j.value=!1,m.off("item_tags_updated",se),m.off("items_tags_updated",ee),m.off("feeds_fetched",Z),window.removeEventListener("keydown",P),window.removeEventListener("keyup",W)}),(s,t)=>{const R=es,Me=ss,Ne=$s,Ae=bs,Qe=Cs,Re=ws,Ve=ys,ze=ms,Ue=Be,F=Ze("tooltip");return n(),l("aside",{class:"sidebar2",style:ls({width:e(C).params.id?e(u).sidebar2Width+"px":"auto"})},[o("div",Is,[o("md-checkbox",{"touch-target":"wrapper",checked:e(U),indeterminate:!e(U)&&e(H),onChange:t[0]||(t[0]=(...i)=>e(B)&&e(B)(...i))},null,40,Ms),o("div",Ns,[e(c).length?(n(),l("span",As,p(s.$t("x_selected",{count:e(L)?e(y).toLocaleString():e(c).length.toLocaleString()})),1)):(n(),l("span",Qs,p(s.$t("page_title.feeds"))+" ("+p(e(y).toLocaleString())+")",1)),e(H)?(n(),l(ie,{key:2},[D((n(),l("button",{class:"btn-icon",onClick:t[1]||(t[1]=f(i=>e(O)(e(c),e(L),e(y),k.value),["stop"]))},[t[4]||(t[4]=o("md-ripple",null,null,-1)),r(R)])),[[F,s.$t("delete")]]),D((n(),l("button",{class:"btn-icon",onClick:t[2]||(t[2]=f(i=>e(we)(e(c),e(L),k.value),["stop"]))},[t[5]||(t[5]=o("md-ripple",null,null,-1)),r(Me)])),[[F,s.$t("add_to_tags")]]),e(Ce)?(n(),l("md-circular-progress",Rs)):D((n(),l("button",{key:1,class:"btn-icon sm",onClick:f(Te,["prevent"])},[t[6]||(t[6]=o("md-ripple",null,null,-1)),r(Ne)])),[[F,s.$t("save_to_notes")]])],64)):q("",!0)]),o("div",Vs,[r(Ae,{filter:v,tags:S.value,feeds:T.value,"show-chips":!$e.value,"get-url":Le,"show-today":!0},null,8,["filter","tags","feeds","show-chips"]),e(w)?(n(),l("md-circular-progress",zs)):D((n(),l("button",{key:1,class:"btn-icon",disabled:e(w),onClick:f(Ie,["prevent"])},[t[7]||(t[7]=o("md-ripple",null,null,-1)),r(Qe)],8,Us)),[[F,s.$t("sync_feeds")]])])]),r(Re,{limit:re,total:e(y),"all-checked-alert-visible":e(fe),"real-all-checked":e(L),"select-real-all":e(pe),"clear-selection":e(Q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(V)&&h.value.length===0?(n(),l("div",Bs,[(n(),l(ie,null,ts(20,i=>o("section",{key:i,class:"feed-item selectable-card-skeleton"},[t[9]||(t[9]=rs('<div class="title" data-v-9fe1976f><div class="checkbox" data-v-9fe1976f><div class="skeleton-checkbox" data-v-9fe1976f></div></div><div class="text" data-v-9fe1976f><div class="skeleton-text skeleton-title" data-v-9fe1976f></div></div></div>',1)),o("div",Gs,[o("span",Hs,p(i),1),t[8]||(t[8]=o("div",{class:"info"},[o("div",{class:"skeleton-text skeleton-info"})],-1))]),t[10]||(t[10]=o("div",{class:"image"},[o("div",{class:"skeleton-image"})],-1))])),64))])):q("",!0),h.value.length>0?(n(),Xe(e(os),{key:1,class:"scroller","data-key":"id","data-sources":h.value,"estimate-size":100,onTobottom:e(ye)},{item:de(({index:i,item:a})=>{var oe;return[o("a",{class:"item-link",href:X(a)},[o("article",{class:us(["feed-item selectable-card",{selected:e(c).includes(a.id)||a.id==s.$route.params.id,selecting:e(K).includes(a.id)}]),onClick:f(_=>e(me)(_,a,i,()=>{qe(a)}),["stop","prevent"]),onMouseover:_=>e(ve)(_,i)},[o("div",Ws,[e(K).includes(a.id)?(n(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:e(he),onClick:f(_=>e(G)(_,a,i),["stop"])},null,8,xs)):(n(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:e(c).includes(a.id),onClick:f(_=>e(G)(_,a,i),["stop"])},null,8,js)),o("div",Os,p(a.title||s.$t("no_content")),1)]),o("div",Ys,[o("span",Js,[r(Ve,{id:i+1,raw:a},null,8,["id","raw"])]),o("div",Xs,[o("a",{onClick:f(_=>e(De)(z.value[a.feedId]),["stop","prevent"])},p((oe=z.value[a.feedId])==null?void 0:oe.name),9,Zs),t[11]||(t[11]=o("span",null,"Â·",-1)),D((n(),l("span",et,[ps(p(e(fs)(a.publishedAt)),1)])),[[F,e(_s)(a.publishedAt)]]),r(ze,{tags:a.tags,type:e(d),"only-links":!0},null,8,["tags","type"])])]),D((n(),l("button",st,[t[12]||(t[12]=o("md-ripple",null,null,-1)),r(Ue)])),[[F,s.$t("actions")]]),a.image?(n(),l("img",{key:0,class:"image",src:e(vs)(a.image,"&w=200&h=200")},null,8,tt)):q("",!0)],42,Ps)],8,Ks)]}),footer:de(()=>[e(j)?q("",!0):(n(),l("md-circular-progress",ot))]),_:1},8,["data-sources","onTobottom"])):q("",!0),!e(V)&&h.value.length===0?(n(),l("div",nt,p(s.$t(e(ns)(e(V)))),1)):q("",!0),o("div",{class:"sidebar-drag-indicator",onMousedown:t[3]||(t[3]=(...i)=>e(Y)&&e(Y)(...i))},null,32)],4)}}}),vt=ks(at,[["__scopeId","data-v-9fe1976f"]]);export{vt as default};
