import{_ as xe}from"./VPagination.vuevuetypescriptsetuptruelang-DzqpJyre.js";import{m as ze,c as l,o as s,a as i,i as U,be as He,G as B,a2 as b,H as G,bf as Re,e as Ue,f as Be,r as R,u as Ge,I as je,J as Ke,bg as Oe,K as Pe,L as Fe,k as c,j as D,O as _,l as e,t as T,Q as w,p as h,M as Je,a3 as p,y as d,R as We,P as de,bh as Xe,S as Ye,aM as Ze,bi as et,D as tt,bj as st,a6 as ot,aP as at,aQ as nt,N as lt,d as it,U as rt,bk as ct,W as dt,X as ut,Y as _t,Z as pt,z as ue,$ as _e,a0 as vt,a9 as mt,bd as gt,aa as ht,a4 as pe,a1 as kt,bl as ft,F as yt}from"./index-BOocQAqZ.js";import{_ as $t,a as Tt}from"./SearchInput-CGRIMF-l.js";import{u as bt,b as qt,a as Ct}from"./key-events-j-7DpEu_.js";import{u as wt,a as Nt}from"./tags-x5k-cbnO.js";import{u as Lt}from"./search-DtIxMFMN.js";import"./search-rounded-CyzWHMe0.js";import"./vee-validate-CU2Cxe7k.js";const St={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Dt(V,k){return s(),l("svg",St,k[0]||(k[0]=[i("path",{fill:"currentColor",d:"M19 17.7v1.8q0 .2.15.35t.35.15t.35-.15t.15-.35v-3q0-.2-.15-.35T19.5 16h-3q-.2 0-.35.15t-.15.35t.15.35t.35.15h1.8l-2.45 2.45q-.15.15-.15.35t.15.35t.35.15t.35-.15zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v5q0 .425-.288.713T20 11t-.712-.288T19 10V5H5v14h5q.425 0 .713.288T11 20t-.288.713T10 21zm0-3v1V5v6.075V11zm2-2q0 .425.288.713T8 17h2.075q.425 0 .713-.288t.287-.712t-.287-.712t-.713-.288H8q-.425 0-.712.288T7 16m0-4q0 .425.288.713T8 13h5q.425 0 .713-.288T14 12t-.288-.712T13 11H8q-.425 0-.712.288T7 12m0-4q0 .425.288.713T8 9h8q.425 0 .713-.288T17 8t-.288-.712T16 7H8q-.425 0-.712.288T7 8m11 15q-2.075 0-3.537-1.463T13 18t1.463-3.537T18 13t3.538 1.463T23 18t-1.463 3.538T18 23"},null,-1)]))}const Mt=ze({name:"material-symbols-export-notes-outline-rounded",render:Dt}),Vt=(V,k)=>{const{mutate:v,onDone:E}=U({document:He}),f=B(new Map);return E(n=>{f.delete(n.data.trashNotes),V(),k(),b.emit("refetch_tags",G.NOTE),b.emit("notes_actioned",{action:"trash"})}),{trashLoading(n){return f.get(n)??!1},trash(n){f.set(n,!0),v({query:n})}}},Et=(V,k)=>{const{mutate:v,onDone:E}=U({document:Re}),f=B(new Map);return E(n=>{f.delete(n.data.restoreNotes),V(),k(),b.emit("refetch_tags",G.NOTE),b.emit("notes_actioned",{action:"restore"})}),{restoreLoading(n){return f.get(n)??!1},restore(n){f.set(n,!0),v({query:n})}}},It={class:"top-app-bar"},At=["checked","indeterminate"],Qt={class:"title"},xt={key:0},zt={key:1},Ht={class:"actions"},Rt={key:0,class:"scroller"},Ut={class:"start"},Bt={class:"number"},Gt=["href"],jt=["onClick","onMouseover"],Kt={class:"start"},Ot=["checked","onClick"],Pt=["checked","onClick"],Ft={class:"number"},Jt={class:"title"},Wt={class:"subtitle"},Xt={class:"actions"},Yt={class:"time"},Zt={key:2,class:"no-data-placeholder"},M=50,es=Ue({__name:"NotesView",setup(V){var le;const k=Be(),v=R([]),{t:E}=Ge(),{parseQ:f}=Lt(),n=B({tagIds:[],trash:!1}),N=G.NOTE,j=je(),K=j.query,x=R(parseInt(((le=K.page)==null?void 0:le.toString())??"1")),q=R(""),{tags:I,fetch:ve}=wt(N),{selectedIds:$,allChecked:O,realAllChecked:L,selectRealAll:me,allCheckedAlertVisible:ge,clearSelection:C,toggleAllChecked:P,toggleSelect:F,total:m,checked:z,shiftEffectingIds:J,handleItemClick:he,handleMouseOver:ke,selectAll:fe,shouldSelect:ye}=bt(v),{addToTags:$e}=Nt(N,I),W=t=>{const o=j.query.q;ue(k,o?`/notes?page=${t}&q=${o}`:`/notes?page=${t}`)},{keyDown:X,keyUp:Y}=Ct(m,M,x,fe,C,W,()=>{Z($.value,L.value,m.value,q.value)}),{loading:H,fetch:S}=Ke({handle:(t,o)=>{o?tt(E(o),"error"):t&&(v.value=t.notes,m.value=t.noteCount)},document:et,variables:()=>({offset:(x.value-1)*M,limit:M,query:q.value})});function Te(t){_e(vt,{type:N,tags:I.value,item:{key:t.id,title:"",size:0},selected:I.value.filter(o=>t.tags.some(Q=>Q.id===o.id))})}function be(t){return t?`/notes?q=${t}`:"/notes"}const{mutate:qe,onDone:Ce}=U({document:st}),we=()=>{qe({query:A()})},A=()=>{let t=q.value;return L.value||(t=`ids:${$.value.join(",")}`),t};Ce(t=>{Oe(t.data.exportNotes,"application/json","notes.json")});const{deleteItems:Z}=qt(ft,()=>{C(),S()});function Ne(t){_e(ht,{id:t.id,name:gt(t.title,{length:20}),gql:mt`
      mutation DeleteNote($query: String!) {
        deleteNotes(query: $query)
      }
    `,variables:()=>({query:`ids:${t.id}`}),done:()=>{C(),m.value--},typeName:"Note"})}const{trashLoading:Le,trash:ee}=Vt(C,S),{restoreLoading:te,restore:se}=Et(C,S);function Se(t){ue(k,oe(t))}function oe(t){const o=pe.currentRoute.value.query.q;return o?`/notes/${t.id}?q=${o}`:`/notes/${t.id}`}function De(){pe.push("/notes/create")}const ae=t=>{t.type===N&&(C(),S())},ne=t=>{t.type===N&&S()};return Pe(()=>{var t;q.value=kt(((t=K.q)==null?void 0:t.toString())??""),f(n,q.value),n.trash===void 0&&(n.trash=!1),ve(),S(),b.on("item_tags_updated",ne),b.on("items_tags_updated",ae),window.addEventListener("keydown",X),window.addEventListener("keyup",Y)}),Fe(()=>{b.off("item_tags_updated",ne),b.off("items_tags_updated",ae),window.removeEventListener("keydown",X),window.removeEventListener("keyup",Y)}),(t,o)=>{const Q=ot,y=Ze,ie=at,re=nt,ce=lt,Me=Mt,Ve=$t,Ee=Tt,Ie=rt,Ae=dt,Qe=xe,g=Je("tooltip");return s(),l(w,null,[i("div",It,[i("md-checkbox",{"touch-target":"wrapper",checked:e(O),indeterminate:!e(O)&&e(z),onChange:o[0]||(o[0]=(...r)=>e(P)&&e(P)(...r))},null,40,At),i("div",Qt,[e($).length?(s(),l("span",xt,T(t.$t("x_selected",{count:e(L)?e(m).toLocaleString():e($).length.toLocaleString()})),1)):(s(),l("span",zt,T(t.$t("page_title.notes"))+" ("+T(e(m).toLocaleString())+")",1)),e(z)?(s(),l(w,{key:2},[n.trash?(s(),l(w,{key:0},[h((s(),_(y,{onClick:o[1]||(o[1]=d(r=>e(Z)(e($),e(L),e(m),q.value),["stop"]))},{icon:p(()=>[c(Q)]),_:1})),[[g,t.$t("delete")]]),h((s(),_(y,{loading:e(te)(A()),onClick:o[2]||(o[2]=d(r=>e(se)(A()),["stop"]))},{icon:p(()=>[c(ie)]),_:1},8,["loading"])),[[g,t.$t("restore")]])],64)):(s(),l(w,{key:1},[h((s(),_(y,{onClick:o[3]||(o[3]=d(r=>e(ee)(A()),["stop"]))},{icon:p(()=>[c(re)]),_:1})),[[g,t.$t("move_to_trash")]]),h((s(),_(y,{onClick:o[4]||(o[4]=d(r=>e($e)(e($),e(L),q.value),["stop"]))},{icon:p(()=>[c(ce)]),_:1})),[[g,t.$t("add_to_tags")]]),h((s(),_(y,{onClick:d(we,["stop"])},{icon:p(()=>[c(Me)]),_:1})),[[g,t.$t("export_notes")]])],64))],64)):D("",!0)]),i("div",Ht,[c(Ve,{filter:n,tags:e(I),"get-url":be,"show-trash":!0},null,8,["filter","tags"]),n.trash?D("",!0):(s(),l("md-outlined-button",{key:0,class:"btn-sm",onClick:d(De,["prevent"])},T(t.$t("create")),1))])]),c(Ee,{limit:M,total:e(m),"all-checked-alert-visible":e(ge),"real-all-checked":e(L),"select-real-all":e(me),"clear-selection":e(C)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(H)&&v.value.length===0?(s(),l("div",Rt,[(s(),l(w,null,We(20,r=>i("article",{key:r,class:"note-item selectable-card-skeleton"},[i("div",Ut,[o[5]||(o[5]=i("div",{class:"checkbox"},[i("div",{class:"skeleton-checkbox"})],-1)),i("span",Bt,T(r),1)]),o[6]||(o[6]=it('<div class="title" data-v-993a4624><div class="skeleton-text skeleton-title" data-v-993a4624></div></div><div class="subtitle" data-v-993a4624><div class="skeleton-text skeleton-subtitle" data-v-993a4624></div></div><div class="actions" data-v-993a4624><div class="skeleton-text skeleton-actions" data-v-993a4624></div></div><div class="time" data-v-993a4624><div class="skeleton-text skeleton-time" data-v-993a4624></div></div>',4))])),64))])):D("",!0),v.value.length?(s(),_(e(Xe),{key:1,class:de(["scroller",{"select-mode":e(z)}]),"data-key":"id","data-sources":v.value,"estimate-size":100},{item:p(({index:r,item:a})=>[(s(),l("a",{key:a.id,class:"item-link",href:oe(a)},[i("article",{class:de(["note-item selectable-card",{selected:e($).includes(a.id)||a.id==t.$route.params.id,selecting:e(J).includes(a.id)}]),onClick:d(u=>e(he)(u,a,r,()=>{Se(a)}),["stop","prevent"]),onMouseover:u=>e(ke)(u,r)},[i("div",Kt,[e(J).includes(a.id)?(s(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:e(ye),onClick:d(u=>e(F)(u,a,r),["stop"])},null,8,Ot)):(s(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:e($).includes(a.id),onClick:d(u=>e(F)(u,a,r),["stop"])},null,8,Pt)),i("span",Ft,[c(Ie,{id:r+1,raw:a},null,8,["id","raw"])])]),i("div",Jt,T(e(ct)(a.title.split(`
`)[0].trimStart())||t.$t("meta_no_title")),1),i("div",Wt,[c(Ae,{tags:a.tags,type:e(N),"only-links":!0},null,8,["tags","type"])]),i("div",Xt,[n.trash?(s(),l(w,{key:0},[h((s(),_(y,{class:"sm",onClick:d(u=>Ne(a),["stop","prevent"])},{icon:p(()=>[c(Q)]),_:2},1032,["onClick"])),[[g,t.$t("delete")]]),h((s(),_(y,{class:"sm",loading:e(te)(`ids:${a.id}`),onClick:d(u=>e(se)(`ids:${a.id}`),["stop","prevent"])},{icon:p(()=>[c(ie)]),_:2},1032,["loading","onClick"])),[[g,t.$t("restore")]])],64)):(s(),l(w,{key:1},[h((s(),_(y,{class:"sm",loading:e(Le)(`ids:${a.id}`),onClick:d(u=>e(ee)(`ids:${a.id}`),["stop","prevent"])},{icon:p(()=>[c(re)]),_:2},1032,["loading","onClick"])),[[g,t.$t("move_to_trash")]]),h((s(),_(y,{class:"sm",onClick:d(u=>Te(a),["stop","prevent"])},{icon:p(()=>[c(ce)]),_:2},1032,["onClick"])),[[g,t.$t("add_to_tags")]])],64))]),i("div",Yt,[h((s(),l("span",null,[_t(T(e(pt)(a.updatedAt)),1)])),[[g,e(ut)(a.updatedAt)]])])],42,jt)],8,Gt))]),footer:p(()=>[e(m)>M?(s(),_(Qe,{key:0,page:x.value,go:W,total:e(m),limit:M},null,8,["page","total"])):D("",!0)]),_:1},8,["data-sources","class"])):D("",!0),!e(H)&&v.value.length===0?(s(),l("div",Zt,T(t.$t(e(Ye)(e(H)))),1)):D("",!0)],64)}}}),cs=yt(es,[["__scopeId","data-v-993a4624"]]);export{cs as default};
