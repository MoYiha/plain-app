import{_ as We}from"./more-vert-rfLdxqnE.js";import{g as B,h as w,K as R,C as T,cz as me,d as He,u as Pe,s as je,i as Oe,I as Je,J as Xe,aC as re,j as de,L as Ye,M as Ze,c as a,a as l,m as e,t as C,O as xe,x as D,w as b,p as f,e as V,v as es,q as ue,n as ss,Q as ts,cA as os,cB as ns,cC as as,S as ls,o as n,U as cs,V as is,W as rs,ay as ds,N as us,X as _s,F as ps,G as ms,a0 as S,cD as fs,a5 as _e,f as pe,$ as hs,ad as vs,a1 as gs,a2 as ys,a3 as ks,H as bs}from"./index-BxNI00MG.js";import{u as ws,c as $s,_ as Cs,a as Ss,b as Ts}from"./key-events-B5RXeznw.js";import{_ as Is,a as Ls}from"./add-notes-outline-rounded-CGmqzbfx.js";import{u as qs}from"./feeds-D_-bRH1Y.js";import{a as As}from"./tags-BUfgTqH4.js";import{V as Fs}from"./virtual-list-DocfBp0t.js";import{u as Ds}from"./search-D1_YTViL.js";import{u as Es}from"./sidebar-JKGKmRjc.js";import"./rss-feed-rounded-Dj4EQ17i.js";import"./vee-validate.esm-9czZ1sUw.js";const Ms=(d,u,h)=>{const{t:p}=B(),_=w(1),$=50,c=w(!1),{loading:v,fetch:g}=R({handle:(i,I)=>{if(I)T(p(I),"error");else if(i){i.items.length<$&&(c.value=!0);const L=i.items;_.value===1?d.value=L:d.value=d.value.concat(L),h.value=i.total}},document:me,variables:()=>({offset:(_.value-1)*$,limit:$,query:u.value}),appApi:!0});return{page:_,noMore:c,loading:v,fetch:g,loadMore:()=>{c.value||v.value||_.value++}}},Ns=(d,u,h,p,_)=>{const{t:$}=B(),{loading:c,fetch:v}=R({handle:(g,i)=>{i?T($(i),"error"):g&&(d.value=g.items,h.value=g.total)},document:me,variables:()=>({offset:(p.value-1)*_,limit:_,query:u.value}),appApi:!0});return{page:p,loading:c,fetch:v}},E=d=>(ps("data-v-89619be2"),d=d(),ms(),d),Qs={class:"top-app-bar"},Us=["checked","indeterminate"],Vs={class:"title"},zs={key:0},Bs={key:1},Rs=E(()=>l("md-ripple",null,null,-1)),Gs=E(()=>l("md-ripple",null,null,-1)),Ks={key:0,indeterminate:"",class:"spinner-sm"},Ws=E(()=>l("md-ripple",null,null,-1)),Hs={class:"actions"},Ps={key:0,indeterminate:"",class:"spinner-sm"},js=["disabled"],Os=E(()=>l("md-ripple",null,null,-1)),Js=["href"],Xs=["onClick","onMouseover"],Ys={class:"title"},Zs=["onClick","checked"],xs=["onClick","checked"],et={class:"subtitle"},st={class:"number"},tt={class:"info"},ot=["onClick"],nt=E(()=>l("span",null,"Â·",-1)),at={class:"time"},lt={class:"btn-icon sm",style:{display:"none"}},ct=E(()=>l("md-ripple",null,null,-1)),it=["src"],rt={key:0,indeterminate:"",class:"spinner-sm"},dt={key:1,class:"no-data-placeholder"},z=50,ut=He({__name:"FeedsSidebar2",setup(d){var ce;const u=Pe(),{feedsSyncing:h}=je(Oe()),{t:p}=B(),_=Je({tagIds:[]}),{parseQ:$}=Ds(),c=Xe.FEED_ENTRY,v=ts(),g=v.query,i=w(parseInt(((ce=g.page)==null?void 0:ce.toString())??"1")),I=w([]),L=w([]),G=re(()=>{const s={};return L.value.forEach(t=>{s[t.id]=t}),s}),M=w([]),K=w([]),y=w(""),{selectedIds:m,allChecked:W,realAllChecked:q,selectRealAll:fe,allCheckedAlertVisible:he,clearSelection:N,toggleAllChecked:H,toggleSelect:P,total:A,checked:j,shiftEffectingIds:O,handleItemClick:ve,handleMouseOver:ge,selectAll:ye,shouldSelect:ke}=ws(M),be=s=>{i.value=s;const t=v.query.q;pe(u,t?`/feeds?page=${s}&q=${t}`:`/feeds?page=${s}`)},{keyDown:J,keyUp:X}=Ts(A,z,i,ye,N,be,()=>{ee(q.value,m.value,y.value)}),{page:Y,loading:we,loadMore:$e,fetch:Z,noMore:x}=Ms(M,y,A),{loading:_t,fetch:U}=Ns(K,y,A,i,z),{addToTags:Ce}=As(c,I),Se=()=>{Y.value=1,Z()},{deleteItems:ee}=$s(fs,()=>{N(),U(),K.value.some(s=>s.tags.length)&&S.emit("refetch_tags",c)}),Te=re(()=>_e.currentRoute.value.path!=="/feeds"),{resizeWidth:se}=Es(300,()=>u.sidebar2Width,s=>{u.sidebar2Width=s}),{mutate:te,loading:Ie,onDone:Le}=de({document:os,appApi:!0});function qe(){if(q)te({query:y.value});else{if(m.value.length===0){T(p("select_first"),"error");return}te({query:`ids:${m.value.join(",")}`})}}Le(()=>{T(p("saved"))});function Ae(s){return s?`/feeds?q=${s}`:"/feeds"}const{fetch:Fe}=R({handle:async(s,t)=>{t?T(p(t),"error"):s&&(I.value=s.tags,L.value=s.feeds)},document:ns,variables:{type:c},appApi:!0});function oe(s){const t=_e.currentRoute.value.query.q;return t?`/feeds/${s.feedId}/entries/${s.id}?q=${t}`:`/feeds/${s.feedId}/entries/${s.id}`}function De(s){pe(u,oe(s))}const{viewFeed:Ee}=qs(u),{mutate:Me}=de({document:as,appApi:!0});function Ne(){h.value=!0,Me({id:""})}const ne=s=>{h.value=!1,Z(),s.error?T(s.error,"error"):T(p("feeds_synced"))},ae=s=>{s.type===c&&(N(),U())},le=s=>{s.type===c&&U()};return Ye(()=>{var t,Q;const s=(t=document.getElementsByClassName("scroller"))==null?void 0:t[0];s&&(s.scrollTop=0),y.value=hs(((Q=g.q)==null?void 0:Q.toString())??""),$(_,y.value),Fe(),Se(),S.on("item_tags_updated",le),S.on("items_tags_updated",ae),S.on("feeds_fetched",ne),window.addEventListener("keydown",J),window.addEventListener("keyup",X)}),Ze(()=>{Y.value=1,x.value=!1,S.off("item_tags_updated",le),S.off("items_tags_updated",ae),S.off("feeds_fetched",ne),window.removeEventListener("keydown",J),window.removeEventListener("keyup",X)}),(s,t)=>{const Q=vs,Qe=gs,Ue=Is,Ve=Cs,ze=Ls,Be=Ss,Re=ys,Ge=ks,Ke=We,F=ls("tooltip");return n(),a("aside",{class:"sidebar2",style:ss({width:e(v).params.id?e(u).sidebar2Width+"px":"auto"})},[l("div",Qs,[l("md-checkbox",{"touch-target":"wrapper",onChange:t[0]||(t[0]=(...r)=>e(H)&&e(H)(...r)),checked:e(W),indeterminate:!e(W)&&e(j)},null,40,Us),l("div",Vs,[e(m).length?(n(),a("span",zs,C(s.$t("x_selected",{count:e(q)?e(A).toLocaleString():e(m).length.toLocaleString()})),1)):(n(),a("span",Bs,C(s.$t("page_title.feeds"))+" ("+C(e(A).toLocaleString())+")",1)),e(j)?(n(),a(xe,{key:2},[D((n(),a("button",{class:"btn-icon",onClick:t[1]||(t[1]=b(r=>e(ee)(e(q),e(m),y.value),["stop"]))},[Rs,f(Q)])),[[F,s.$t("delete")]]),D((n(),a("button",{class:"btn-icon",onClick:t[2]||(t[2]=b(r=>e(Ce)(e(m),e(q),y.value),["stop"]))},[Gs,f(Qe)])),[[F,s.$t("add_to_tags")]]),e(Ie)?(n(),a("md-circular-progress",Ks)):D((n(),a("button",{key:1,class:"btn-icon sm",onClick:b(qe,["prevent"])},[Ws,f(Ue)])),[[F,s.$t("save_to_notes")]])],64)):V("",!0)]),l("div",Hs,[f(Ve,{filter:_,tags:I.value,feeds:L.value,"show-chips":!Te.value,"get-url":Ae,"show-today":!0},null,8,["filter","tags","feeds","show-chips"]),e(h)?(n(),a("md-circular-progress",Ps)):D((n(),a("button",{key:1,class:"btn-icon",disabled:e(h),onClick:b(Ne,["prevent"])},[Os,f(ze)],8,js)),[[F,s.$t("sync_feeds")]])])]),f(Be,{limit:z,total:e(A),"all-checked-alert-visible":e(he),"real-all-checked":e(q),"select-real-all":e(fe),"clear-selection":e(N)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),M.value.length?(n(),es(e(Fs),{key:0,class:"scroller","data-key":"id","data-sources":M.value,"estimate-size":100,onTobottom:e($e)},{item:ue(({index:r,item:o})=>{var ie;return[(n(),a("a",{class:"item-link",key:o.id,href:oe(o)},[l("article",{class:us(["feed-item selectable-card",{selected:e(m).includes(o.id)||o.id==s.$route.params.id,selecting:e(O).includes(o.id)}]),onClick:b(k=>e(ve)(k,o,r,()=>{De(o)}),["stop","prevent"]),onMouseover:k=>e(ge)(k,r)},[l("div",Ys,[e(O).includes(o.id)?(n(),a("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:b(k=>e(P)(k,o,r),["stop"]),checked:e(ke)},null,8,Zs)):(n(),a("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:b(k=>e(P)(k,o,r),["stop"]),checked:e(m).includes(o.id)},null,8,xs)),l("span",null,C(o.title||s.$t("no_content")),1)]),l("div",et,[l("span",st,[f(Re,{id:r+1,raw:o},null,8,["id","raw"])]),l("div",tt,[l("a",{onClick:b(k=>e(Ee)(G.value[o.feedId]),["stop","prevent"])},C((ie=G.value[o.feedId])==null?void 0:ie.name),9,ot),nt,D((n(),a("span",at,[is(C(e(rs)(o.publishedAt)),1)])),[[F,e(cs)(o.publishedAt)]]),f(Ge,{tags:o.tags,type:e(c),"only-links":!0},null,8,["tags","type"])])]),D((n(),a("button",lt,[ct,f(Ke)])),[[F,s.$t("actions")]]),o.image?(n(),a("img",{key:0,class:"image",src:e(ds)(o.image,"&w=200&h=200")},null,8,it)):V("",!0)],42,Xs)],8,Js))]}),footer:ue(()=>[e(x)?V("",!0):(n(),a("md-circular-progress",rt))]),_:1},8,["data-sources","onTobottom"])):(n(),a("div",dt,C(s.$t(e(_s)(e(we)))),1)),l("div",{class:"sidebar-drag-indicator",onMousedown:t[3]||(t[3]=(...r)=>e(se)&&e(se)(...r))},null,32)],4)}}}),Ct=bs(ut,[["__scopeId","data-v-89619be2"]]);export{Ct as default};
