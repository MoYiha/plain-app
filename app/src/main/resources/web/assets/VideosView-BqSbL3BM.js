import{_ as Do}from"./VPagination.vuevuetypescriptsetuptruelang-B4JWBRU5.js";import{_ as Vo,a as Ao,b as Mo,c as Fo,d as Lo}from"./grid-view-outline-rounded-DoVxzMo6.js";import{_ as Ro}from"./FieldId.vuevuetypescriptsetuptruelang-B-w7x5OO.js";import{e as Uo,f as zo,s as Ke,r as M,u as qo,I as Bo,g as No,ag as Pe,ah as Ho,J as Ko,K as Po,aK as Qo,aL as Qe,aM as Oo,ai as jo,aN as R,aG as me,L as Go,aO as Wo,aP as Zo,M as Xo,N as Jo,c as r,o as t,a as v,k as a,l as e,j as U,t as f,T as h,O as _,P as Yo,R as l,p as d,y as i,aQ as J,aR as Y,ak as xo,S as V,al as es,U as x,V as os,a$ as ss,E as ts,aT as ns,a7 as as,aU as ls,aj as is,aV as ds,Q as cs,ar as rs,b0 as Oe,aW as us,at as _s,Z as ps,n as je,a9 as Ge,aX as vs,$ as ks,F as ms,a0 as gs,A as fs,a1 as ys,a2 as hs,aY as We,a3 as $s,a4 as S,b1 as Cs}from"./index-CextXMl7.js";import{_ as bs,a as ws}from"./SearchInput-CrMMFD7Q.js";import{_ as Is,a as Es}from"./upload-rounded-Dxk1aS2W.js";import{_ as Ss}from"./VIconButton.vuevuetypescriptsetuptruelang-BlGK_fBO.js";import{_ as Ts}from"./VCheckbox-DS09yxvJ.js";import{a as Ds}from"./tags-DG3enOqx.js";import{u as Vs,a as As}from"./key-events-CRk-BMl_.js";import{u as Ms}from"./search-CYaYXsFn.js";import"./VInputChip-CfY98YKA.js";const Fs={class:"top-app-bar"},Ls={class:"title"},Rs={key:0},Us={key:1},zs={class:"actions"},qs=["onClick"],Bs={class:"button-group"},Ns=["onClick","onMouseover"],Hs=["src"],Ks=["src","onError"],Ps={key:1,class:"actions"},Qs={class:"right"},Os=["onClick","onMouseover"],js={class:"start"},Gs={class:"number"},Ws={class:"image"},Zs=["src"],Xs=["src","onError"],Js={class:"title"},Ys={class:"subtitle"},xs=["onClick"],et={class:"actions"},ot={class:"time"},st={key:2,class:"no-data-placeholder"},A=55,mt=Uo({__name:"VideosView",setup(tt){var qe;const T=zo(),{videoSortBy:z}=Ke(T),D=M([]),{t:Ze}=qo(),{parseQ:Xe}=Ms(),I=Bo({tagIds:[],bucketId:void 0}),ge=No(),{app:F,urlTokenKey:ee,uploads:oe}=Ke(ge),P=M(!1),se=M(!1),{input:Je,upload:Ye,uploadChanged:fe}=Pe(oe),{input:xe,upload:eo,uploadChanged:ye}=Pe(oe),{dropping:oo,fileDragEnter:he,fileDragLeave:$e,dropFiles:so}=Ho(oe),te=M(!1),u=Ko.VIDEO,Ce=Po(),be=Ce.query,ne=M(parseInt(((qe=be.page)==null?void 0:qe.toString())??"1")),{tags:Q,buckets:O,fetch:to}=Qo(u),no=Qe(()=>{const s={};return O.value.forEach(n=>{s[n.id]=n}),s}),b=M(""),{addToTags:ao}=Ds(u,Q),{deleteItems:ae,deleteItem:j}=Oo(),{view:lo}=vs(u),{selectedIds:g,allChecked:we,realAllChecked:E,selectRealAll:io,allCheckedAlertVisible:co,clearSelection:q,toggleAllChecked:ro,toggleSelect:B,total:w,checked:N,shiftEffectingIds:G,handleItemClick:Ie,handleMouseOver:Ee,selectAll:uo,shouldSelect:Se}=Vs(D),{downloadItems:Te}=jo(ee,u,q,"videos.zip"),{downloadFile:W}=_s(ee),De=s=>{const n=Ce.query.q;fs(T,n?`/videos?page=${s}&q=${n}`:`/videos?page=${s}`)},{keyDown:Ve,keyUp:Ae}=As(w,A,ne,uo,q,De,()=>{J(Y.MEDIA_TRASH,F.value.osVersion)?X(u,K()):ae(u,g.value,E.value,w.value,b.value)}),le=M([]),_o=rs(),po=Qe(()=>D.value.map(s=>({src:me(s.fileId),name:R(s.path),duration:s.duration,size:s.size,path:s.path,data:s,type:u}))),Me=s=>{le.value.push(s)},{loading:Z,fetch:H}=Go({handle:async(s,n)=>{if(te.value=!1,n)ts(Ze(n),"error");else if(s){const C=[];for(const $ of s.videos)C.push({...$,fileId:ns(ee.value,$.path,$.id)});D.value=C,w.value=s.videoCount}},document:ss,variables:()=>({offset:(ne.value-1)*A,limit:A,query:b.value,sortBy:z.value})}),{trashLoading:ie,trash:X}=Wo(),{restoreLoading:de,restore:ce}=Zo();function re(s){ge.lightbox={sources:po.value,index:s,visible:!0}}const K=()=>{let s=b.value;return E.value||(s=`ids:${g.value.join(",")}`),s};function vo(s){z.value!==s&&(te.value=!0,z.value=s)}function ko(s){return s?`/videos?q=${s}`:"/videos"}function Fe(s){ys(hs,{type:u,tags:Q.value,item:{key:s.id,title:s.title,size:s.size},selected:Q.value.filter(n=>s.tags.some(C=>C.id===n.id))})}function ue(){const s=O.value.find(n=>n.id===I.bucketId);return s?We(s.topItems[0]):`${F.value.internalStoragePath}/Movies`}function mo(){Ye(ue())}function go(){eo(ue())}function fo(s){so(s,ue(),"video")}const Le=s=>{s.type===u&&(q(),H())},Re=s=>{s.type===u&&H()},Ue=s=>{s.type===u&&(q(),H())},ze=s=>{s.status==="done"&&Cs(s.fileName)&&((!I.bucketId||O.value.some(C=>C.id===I.bucketId&&C.topItems.some($=>s.dir.startsWith(We($)))))&&setTimeout(()=>{H()},1e3),S.emit("media_items_actioned",{type:u,action:"upload",query:""}))};return Xo(()=>{var s;b.value=$s(((s=be.q)==null?void 0:s.toString())??""),Xe(I,b.value),to(),H(),S.on("item_tags_updated",Re),S.on("items_tags_updated",Le),S.on("media_items_actioned",Ue),S.on("upload_task_done",ze),window.addEventListener("keydown",Ve),window.addEventListener("keyup",Ae)}),Jo(()=>{S.off("item_tags_updated",Re),S.off("items_tags_updated",Le),S.off("media_items_actioned",Ue),S.off("upload_task_done",ze),window.removeEventListener("keydown",Ve),window.removeEventListener("keyup",Ae)}),(s,n)=>{const C=Ts,$=as,c=Ss,_e=ls,L=is,pe=ds,ve=cs,yo=bs,ho=Is,Be=xo,$o=Es,Co=Vo,bo=Ao,wo=ws,ke=Mo,Ne=Fo,Io=us,He=ps,Eo=Ro,So=Lo,To=Do,p=Yo("tooltip");return t(),r(h,null,[v("div",Fs,[a(C,{"touch-target":"wrapper",checked:e(we),indeterminate:!e(we)&&e(N),onChange:e(ro)},null,8,["checked","indeterminate","onChange"]),v("div",Ls,[e(g).length?(t(),r("span",Rs,f(s.$t("x_selected",{count:e(E)?e(w).toLocaleString():e(g).length.toLocaleString()})),1)):(t(),r("span",Us,f(s.$t("page_title.videos"))+" ("+f(e(w).toLocaleString())+")",1)),e(N)?(t(),r(h,{key:2},[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{onClick:n[0]||(n[0]=i(o=>e(ae)(e(u),e(g),e(E),e(w),b.value),["stop"]))},{icon:d(()=>[a($)]),_:1})),[[p,s.$t("delete")]]),_((t(),l(c,{loading:e(de)(K()),onClick:n[1]||(n[1]=i(o=>e(ce)(e(u),K()),["stop"]))},{icon:d(()=>[a(_e)]),_:1},8,["loading"])),[[p,s.$t("restore")]]),_((t(),l(c,{onClick:n[2]||(n[2]=i(o=>e(Te)(e(E),e(g),b.value),["stop"]))},{icon:d(()=>[a(L)]),_:1})),[[p,s.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,loading:e(ie)(K()),onClick:n[3]||(n[3]=i(o=>e(X)(e(u),K()),["stop"]))},{icon:d(()=>[a(pe)]),_:1},8,["loading"])),[[p,s.$t("move_to_trash")]]):_((t(),l(c,{key:1,onClick:n[4]||(n[4]=i(o=>e(ae)(e(u),e(g),e(E),e(w),b.value),["stop"]))},{icon:d(()=>[a($)]),_:1})),[[p,s.$t("delete")]]),_((t(),l(c,{onClick:n[5]||(n[5]=i(o=>e(Te)(e(E),e(g),b.value),["stop"]))},{icon:d(()=>[a(L)]),_:1})),[[p,s.$t("download")]]),_((t(),l(c,{onClick:n[6]||(n[6]=i(o=>e(ao)(e(g),e(E),b.value),["stop"]))},{icon:d(()=>[a(ve)]),_:1})),[[p,s.$t("add_to_tags")]])],64))],64)):U("",!0)]),v("div",zs,[a(yo,{filter:I,tags:e(Q),buckets:e(O),"get-url":ko},null,8,["filter","tags","buckets"]),I.trash?U("",!0):(t(),l(Be,{key:0,modelValue:P.value,"onUpdate:modelValue":n[9]||(n[9]=o=>P.value=o)},{trigger:d(()=>[_((t(),l(c,null,{icon:d(()=>[a(ho)]),_:1})),[[p,s.$t("upload")]])]),default:d(()=>[v("div",{class:"dropdown-item",onClick:n[7]||(n[7]=i(o=>{mo(),P.value=!1},["stop"]))},f(s.$t("upload_files")),1),v("div",{class:"dropdown-item",onClick:n[8]||(n[8]=i(o=>{go(),P.value=!1},["stop"]))},f(s.$t("upload_folder")),1)]),_:1},8,["modelValue"])),a(Be,{modelValue:se.value,"onUpdate:modelValue":n[10]||(n[10]=o=>se.value=o)},{trigger:d(()=>[_((t(),l(c,{loading:te.value},{icon:d(()=>[a($o)]),_:1},8,["loading"])),[[p,s.$t("sort")]])]),default:d(()=>[(t(!0),r(h,null,x(e(_o),o=>(t(),r("div",{key:o.value,class:V(["dropdown-item",{selected:o.value===e(z)}]),onClick:y=>{vo(o.value),se.value=!1}},f(s.$t(o.label)),11,qs))),128))]),_:1},8,["modelValue"]),v("div",Bs,[v("button",{class:V({selected:!e(T).videosCardView}),onClick:n[11]||(n[11]=o=>e(T).videosCardView=!1)},[a(Co)],2),v("button",{class:V({selected:e(T).videosCardView}),onClick:n[12]||(n[12]=o=>e(T).videosCardView=!0)},[a(bo)],2)])])]),a(wo,{limit:A,total:e(w),"all-checked-alert-visible":e(co),"real-all-checked":e(E),"select-real-all":e(io),"clear-selection":e(q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),v("div",{class:"scroll-content",onDragover:n[16]||(n[16]=i((...o)=>e(he)&&e(he)(...o),["stop","prevent"]))},[_(v("div",{class:"drag-mask",onDrop:i(fo,["stop","prevent"]),onDragleave:n[13]||(n[13]=i((...o)=>e($e)&&e($e)(...o),["stop","prevent"]))},f(s.$t("release_to_send_files")),545),[[es,e(oo)]]),e(T).videosCardView?(t(),r("div",{key:1,class:V(["media-list",{"select-mode":e(N)}])},[(t(!0),r(h,null,x(D.value,(o,y)=>{var k;return t(),r("section",{key:o.id,class:V(["media-item selectable-card",{selected:e(g).includes(o.id),selecting:e(G).includes(o.id)}]),onClick:i(m=>e(Ie)(m,o,y,re),["stop"]),onMouseover:m=>e(Ee)(m,y)},[v("div",js,[e(G).includes(o.id)?(t(),l(C,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(Se),onClick:i(m=>e(B)(m,o,y),["stop"])},null,8,["checked","onClick"])):(t(),l(C,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(g).includes(o.id),onClick:i(m=>e(B)(m,o,y),["stop"])},null,8,["checked","onClick"])),v("span",Gs,[a(Eo,{id:y+1,raw:o},null,8,["id","raw"])])]),v("div",Ws,[le.value.includes(o.id)?(t(),r("img",{key:0,src:`/ficons/${e(Oe)(o.path)}.svg`,class:"svg"},null,8,Zs)):(t(),r("img",{key:1,class:"image-thumb",src:e(me)(o.fileId,"&w=200&h=200"),onError:m=>Me(o.id)},null,40,Xs))]),v("div",Js,f(e(R)(o.path)),1),v("div",Ys,[v("span",null,f(e(je)(o.size)),1),v("span",null,f(e(Ge)(o.duration)),1),v("a",{onClick:i(m=>e(lo)(e(T),o.bucketId),["stop","prevent"])},f((k=no.value[o.bucketId])==null?void 0:k.name),9,xs),a(He,{tags:o.tags,type:e(u),"only-links":!0},null,8,["tags","type"])]),v("div",et,[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{class:"sm",onClick:i(m=>e(j)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",loading:e(de)(`ids:${o.id}`),onClick:i(m=>e(ce)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(_e)]),_:2},1032,["loading","onClick"])),[[p,s.$t("restore")]]),_((t(),l(c,{class:"sm",onClick:i(m=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,class:"sm",loading:e(ie)(`ids:${o.id}`),onClick:i(m=>e(X)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(pe)]),_:2},1032,["loading","onClick"])),[[p,s.$t("move_to_trash")]]):_((t(),l(c,{key:1,class:"sm",onClick:i(m=>e(j)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",onClick:i(m=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]]),_((t(),l(c,{class:"sm",onClick:i(m=>Fe(o),["stop"])},{icon:d(()=>[a(ve)]),_:2},1032,["onClick"])),[[p,s.$t("add_to_tags")]])],64))]),v("div",ot,[_((t(),r("span",null,[ms(f(e(gs)(o.createdAt)),1)])),[[p,e(ks)(o.createdAt)]])])],42,Os)}),128)),e(Z)&&D.value.length===0?(t(),l(So,{key:0,limit:A})):U("",!0)],2)):(t(),r("div",{key:0,class:V(["media-grid",{"select-mode":e(N)}])},[(t(!0),r(h,null,x(D.value,(o,y)=>(t(),r("section",{key:o.id,class:V(["media-item",{selected:e(g).includes(o.id),selecting:e(G).includes(o.id)}]),onClick:i(k=>e(Ie)(k,o,y,re),["stop"]),onMouseover:k=>e(Ee)(k,y)},[le.value.includes(o.id)?(t(),r("img",{key:0,src:`/ficons/${e(Oe)(o.path)}.svg`,class:"image svg"},null,8,Hs)):(t(),r("img",{key:1,class:"image image-thumb",src:e(me)(o.fileId,"&w=200&h=200"),onError:k=>Me(o.id)},null,40,Ks)),e(G).includes(o.id)?(t(),l(c,{key:2,class:"btn-checkbox",onClick:i(k=>e(B)(k,o,y),["stop"])},{icon:d(()=>[e(Se)?(t(),l(ke,{key:0})):(t(),l(Ne,{key:1}))]),_:2},1032,["onClick"])):e(g).includes(o.id)?(t(),l(c,{key:3,class:"btn-checkbox",onClick:i(k=>e(B)(k,o,y),["stop"])},{icon:d(()=>[a(ke)]),_:2},1032,["onClick"])):(t(),r(h,{key:4},[a(c,{class:"btn-checkbox",onClick:i(k=>e(B)(k,o,y),["stop"])},{icon:d(()=>[e(g).includes(o.id)?(t(),l(ke,{key:0})):(t(),l(Ne,{key:1}))]),_:2},1032,["onClick"]),e(N)?_((t(),l(c,{key:0,class:"btn-zoom sm",onClick:i(k=>re(y),["stop"])},{icon:d(()=>[a(Io)]),_:2},1032,["onClick"])),[[p,s.$t("open")]]):(t(),r("div",Ps,[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{class:"sm",onClick:i(k=>e(j)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",loading:e(de)(`ids:${o.id}`),onClick:i(k=>e(ce)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(_e)]),_:2},1032,["loading","onClick"])),[[p,s.$t("restore")]]),_((t(),l(c,{class:"sm",onClick:i(k=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,class:"sm",loading:e(ie)(`ids:${o.id}`),onClick:i(k=>e(X)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(pe)]),_:2},1032,["loading","onClick"])),[[p,s.$t("move_to_trash")]]):_((t(),l(c,{key:1,class:"sm",onClick:i(k=>e(j)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",onClick:i(k=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]]),_((t(),l(c,{class:"sm",onClick:i(k=>Fe(o),["stop"])},{icon:d(()=>[a(ve)]),_:2},1032,["onClick"])),[[p,s.$t("add_to_tags")]])],64))])),v("div",{class:V(["info",{"has-tags":o.tags.length>0}])},[a(He,{tags:o.tags,type:e(u)},null,8,["tags","type"]),v("span",Qs,f(["SIZE_ASC","SIZE_DESC"].includes(e(z))?e(je)(o.size):e(Ge)(o.duration)),1)],2)],64))],42,Ns))),128)),e(Z)&&D.value.length===0?(t(),r(h,{key:0},x(A,o=>v("section",{key:o,class:"skeleton-image media-item"})),64)):U("",!0)],2)),!e(Z)&&D.value.length===0?(t(),r("div",st,f(s.$t(e(os)(e(Z),e(F).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):U("",!0),e(w)>A?(t(),l(To,{key:3,page:ne.value,go:De,total:e(w),limit:A},null,8,["page","total"])):U("",!0),v("input",{ref_key:"fileInput",ref:Je,style:{display:"none"},type:"file",accept:"video/*",multiple:"",onChange:n[14]||(n[14]=(...o)=>e(fe)&&e(fe)(...o))},null,544),v("input",{ref_key:"dirFileInput",ref:xe,style:{display:"none"},type:"file",accept:"video/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[15]||(n[15]=(...o)=>e(ye)&&e(ye)(...o))},null,544)],32)],64)}}});export{mt as default};
