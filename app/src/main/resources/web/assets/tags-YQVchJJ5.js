import{e as G,ax as j,r as h,ay as E,cq as R,i as C,cr as x,cs as H,R as v,o as p,p as c,k as f,F as y,t as i,l as a,aA as T,as as O,j as U,Y,z as J,a as m,O as K,S as q,c as P,U as W,by as X,T as Z,bx as ee,al as te,aC as ae,a4 as $,bT as se,H as oe,u as A,L as ne,bi as le,E as S,a1 as de}from"./index-Dd8UjYtJ.js";const re={class:"button-group"},ue=G({__name:"AddToTagsModal",props:{type:{type:String,required:!0},tags:{type:Array,default:()=>[]},query:{type:String,required:!0}},setup(d){const{handleSubmit:_}=j(),s=h("add_to_tags"),t=d,{value:o,errorMessage:n}=E("selectedTags",R().test("required","valid.required",e=>e.length),{initialValue:[]}),{mutate:l,loading:g,onDone:F}=C({document:x}),{mutate:L,loading:b,onDone:M}=C({document:H}),k=()=>{$.emit("items_tags_updated",{type:t.type}),$.emit("refetch_tags",t.type),T()};M(k),F(k);function D(e){o.value.includes(e)?se(o.value,r=>r.id===e.id):o.value.push(e)}const V=_(()=>{s.value==="add_to_tags"?L({type:t.type,tagIds:o.value.map(e=>e.id),query:t.query}):l({type:t.type,tagIds:o.value.map(e=>e.id),query:t.query})});return(e,r)=>{const B=X,I=ee,N=O,Q=Y,w=J,z=ae;return p(),v(z,{onClose:a(T)},{headline:c(()=>[y(i(e.$t("tags")),1)]),content:c(()=>[m("div",re,[m("button",{class:q({selected:s.value==="add_to_tags"}),onClick:r[0]||(r[0]=u=>s.value="add_to_tags")},i(e.$t("add_to_tags")),3),m("button",{class:q({selected:s.value==="remove_from_tags"}),onClick:r[1]||(r[1]=u=>s.value="remove_from_tags")},i(e.$t("remove_from_tags")),3)]),f(I,null,{default:c(()=>[(p(!0),P(Z,null,W(d.tags,u=>(p(),v(B,{key:u.id,label:u.name,selected:a(o).includes(u),onClick:ie=>D(u)},null,8,["label","selected","onClick"]))),128))]),_:1}),K(m("div",{class:"invalid-feedback"},i(a(n)?e.$t(a(n)):""),513),[[te,a(n)]])]),actions:c(()=>[f(N,{value:"cancel",onClick:a(T)},{default:c(()=>[y(i(e.$t("cancel")),1)]),_:1},8,["onClick"]),f(w,{value:"save",disabled:a(b)||a(g),onClick:a(V)},{default:c(()=>[a(b)||a(g)?(p(),v(Q,{key:0,indeterminate:""})):U("",!0),y(" "+i(e.$t("save")),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["onClose"])}}}),ce=oe(ue,[["__scopeId","data-v-311a7874"]]),ge=(d,_)=>{const{t:s}=A();return{addToTags:(t,o,n)=>{let l=n;if(!o){if(t.length===0){S(s("select_first"),"error");return}l=`ids:${t.join(",")}`}de(ce,{type:d,tags:_.value,query:l})}}},pe=(d,_=()=>{})=>{const s=h([]),{t}=A(),{loading:o,fetch:n}=ne({handle:async(l,g)=>{g?S(t(g),"error"):l&&(s.value=l.tags,_())},document:le,variables:{type:d}});return{tags:s,loading:o,fetch:n}};export{ge as a,pe as u};
