import{_ as xe}from"./VPagination.vuevuetypescriptsetuptruelang-CHD_8v0v.js";import{_ as et,b as tt,a as st}from"./SearchInput-BJwFSU_P.js";import{a5 as se,e as K,r as V,c as r,o,U as F,k as _,Q as S,R as H,J as v,q as k,ah as nt,ai as oe,aj as ot,V as ne,T as J,t as l,I as ie,a,d as it,G as Q,Z as lt,ak as at,z as $,a8 as dt,al as be,l as t,n as he,am as fe,a0 as R,s as ve,g as ct,an as pt,ao as ut,f as rt,u as mt,K as _t,M as gt,ap as ht,L as ft,i as ke,N as ye,O as vt,P as kt,j as E,p as yt,aq as wt,ar as $t,W as bt,B as we,as as It,at as Ct,F as W,au as St,av as At,aw as Ut,ax as Pt,ay as Dt,a4 as Bt}from"./index-DRp6xo3j.js";import{_ as Ie}from"./VCheckbox-COaKMA3E.js";import{_ as Lt,u as Ft,a as Et}from"./key-events-cECSsEaK.js";import{u as Mt}from"./search-VN1T4MU3.js";import{_ as Nt}from"./sort-rounded-CWaGCvOj.js";import{_ as Vt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-CQmW3Kot.js";import{_ as qt}from"./FieldId.vuevuetypescriptsetuptruelang-slfJ4h1L.js";import"./search-rounded-DveNm3Pb.js";const M=y=>{se.emit("tap_phone",y)};function Tt(y,u){const i=y.findIndex(m=>m.id===u);i!==-1&&y.splice(i,1)}const Qt=["onClick"],Kt=K({__name:"AppsActionButtons",props:{filter:{},types:{},getUrl:{type:Function},showChips:{type:Boolean},isPhone:{type:Boolean},sorting:{type:Boolean},sortItems:{},appSortBy:{}},emits:["install","sort"],setup(y,{emit:u}){const i=u,m=V(!1);function w(){i("install")}function b(d){i("sort",d)}return(d,e)=>{const p=et,A=ot,I=oe,C=Nt,U=nt,c=H("tooltip");return o(),r(F,null,[_(p,{filter:d.filter,types:d.types,"get-url":d.getUrl,"show-chips":d.showChips,"is-phone":d.isPhone},null,8,["filter","types","get-url","show-chips","is-phone"]),S((o(),v(I,{onClick:w},{default:k(()=>[_(A)]),_:1})),[[c,d.$t("install_app")]]),_(U,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=g=>m.value=g)},{trigger:k(()=>[S((o(),v(I,{loading:d.sorting},{default:k(()=>[_(C)]),_:1},8,["loading"])),[[c,d.$t("sort")]])]),default:k(()=>[(o(!0),r(F,null,ne(d.sortItems,g=>(o(),r("div",{key:g.value,class:J(["dropdown-item",{selected:g.value===d.appSortBy}]),onClick:P=>{b(g.value),m.value=!1}},l(d.$t(g.label)),11,Qt))),128))]),_:1},8,["modelValue"])],64)}}}),zt=ie(Kt,[["__scopeId","data-v-1beb52e9"]]),Gt={key:0,class:"app-item selectable-card-skeleton"},Ot={class:"list-item-start"},jt={class:"number"},Rt=K({__name:"AppSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(y){return(u,i)=>{const m=Lt;return u.isPhone?(o(),v(m,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"},{width:"40%"}],"action-count":2})):(o(),r("section",Gt,[a("div",Ot,[i[0]||(i[0]=a("div",{class:"skeleton-checkbox"},null,-1)),a("span",jt,l(u.index),1)]),i[1]||(i[1]=it('<div class="image"><div class="skeleton-image lg"></div></div><div class="title"><div class="skeleton-text lg" style="width:40%;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:55%;"></div></div><div class="list-item-actions"><div class="skeleton-text lg" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:120px;"></div><div class="skeleton-text" style="width:120px;"></div></div>',5))]))}}}),Wt=K({__name:"AppActionButtons",props:{item:{},isPhone:{type:Boolean}},emits:["uninstall","download","cancelUninstall"],setup(y,{emit:u}){const i=u;function m(){i("uninstall")}function w(){i("download")}function b(){i("cancelUninstall")}return(d,e)=>{const p=lt,A=at,I=dt,C=oe,U=be,c=H("tooltip");return o(),r("div",{class:J(["list-item-actions",{mobile:d.isPhone}])},[d.item.isUninstalling?(o(),r(F,{key:0},[S(_(p,{indeterminate:"",class:"sm"},null,512),[[c,d.$t("uninstalling")]]),e[0]||(e[0]=Q(" Â ")),_(A,{class:"btn-sm",onClick:$(b,["stop"])},{default:k(()=>[Q(l(d.$t("cancel")),1)]),_:1})],64)):(o(),r(F,{key:1},[S((o(),v(C,{class:"sm",onClick:$(m,["stop"])},{default:k(()=>[_(I)]),_:1})),[[c,d.$t("uninstall")]]),S((o(),v(C,{class:"sm",onClick:$(w,["stop"])},{default:k(()=>[_(U)]),_:1})),[[c,d.$t("download")]])],64))],2)}}}),$e=ie(Wt,[["__scopeId","data-v-0a9c5fb8"]]),Ht={class:"list-item-start"},Jt={class:"number"},Zt=["src"],Xt={class:"title"},Yt={class:"subtitle"},xt={class:"list-item-actions"},es={class:"time"},ts=["src"],ss={class:"subtitle"},ns={class:"subtitle"},os={class:"subtitle"},is={class:"subtitle"},ls=K({__name:"AppListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["uninstall","download","cancelUninstall"],setup(y,{emit:u}){const i=y,m=u;function w(){m("uninstall",i.item)}function b(){m("download",i.item)}function d(){m("cancelUninstall",i.item)}return(e,p)=>{const A=Ie,I=qt,C=Vt,U=H("tooltip");return e.isPhone?(o(),v(C,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:p[4]||(p[4]=c=>e.handleItemClick(c,e.item,e.index,()=>{})),onMouseover:p[5]||(p[5]=c=>e.handleMouseOver(c,e.index)),onCheckboxClick:p[6]||(p[6]=c=>e.toggleSelect(c,e.item,e.index))},{image:k(()=>[a("img",{class:"image",src:e.item.icon},null,8,ts)]),title:k(()=>[Q(l(e.item.name)+" ("+l(e.item.version)+")",1)]),subtitle:k(()=>[a("div",ss,l(e.item.id),1),a("div",ns,[a("span",null,l(t(he)(e.item.size)),1),a("span",null,l(e.$t("app_type."+e.item.type)),1)]),a("div",os,l(e.$t("installed_at"))+": "+l(t(R)(e.item.installedAt)),1),a("div",is,l(e.$t("updated_at"))+": "+l(t(R)(e.item.updatedAt)),1)]),actions:k(()=>[_($e,{item:e.item,"is-phone":e.isPhone,onUninstall:w,onDownload:b,onCancelUninstall:d},null,8,["item","is-phone"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),r("section",{key:0,class:J(["app-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:p[2]||(p[2]=$(c=>e.handleItemClick(c,e.item,e.index,()=>{}),["stop"])),onMouseover:p[3]||(p[3]=c=>e.handleMouseOver(c,e.index))},[a("div",Ht,[e.shiftEffectingIds.includes(e.item.id)?(o(),v(A,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:p[0]||(p[0]=$(c=>e.toggleSelect(c,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),v(A,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:p[1]||(p[1]=$(c=>e.toggleSelect(c,e.item,e.index),["stop"]))},null,8,["checked"])),a("span",Jt,[_(I,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),a("img",{class:"image",width:"50",height:"50",src:e.item.icon},null,8,Zt),a("div",Xt,l(e.item.name)+" ("+l(e.item.version)+")",1),a("div",Yt,[a("span",null,l(e.item.id),1),a("span",null,l(t(he)(e.item.size)),1),a("span",null,l(e.$t("app_type."+e.item.type)),1)]),a("div",xt,[_($e,{item:e.item,"is-phone":e.isPhone,onUninstall:w,onDownload:b,onCancelUninstall:d},null,8,["item","is-phone"])]),a("div",es,[S((o(),r("span",null,[Q(l(e.$t("installed_at"))+": "+l(t(R)(e.item.installedAt)),1)])),[[U,t(fe)(e.item.installedAt)]]),S((o(),r("span",null,[Q(l(e.$t("updated_at"))+": "+l(t(R)(e.item.updatedAt)),1)])),[[U,t(fe)(e.item.updatedAt)]])])],34))}}}),as={class:"top-app-bar"},ds={class:"title"},cs={key:0},ps={key:1},us={key:0,class:"actions"},rs={key:0,class:"no-data-placeholder"},N=50,ms=K({__name:"AppsView",setup(y){var ge;const u=yt("isPhone"),i=V([]),{app:m,urlTokenKey:w,uploads:b}=ve(ct()),{input:d,upload:e,uploadChanged:p}=pt(b),{dropping:A,fileDragEnter:I,fileDragLeave:C,dropFiles:U}=ut(b),c=rt(),g=V([]),{t:P}=mt(),{appSortBy:z}=ve(c),{parseQ:Ce,buildQ:Se}=Mt(),q=_t({tagIds:[]}),Ae=wt(),Z=V(!1),le=gt(),ae=le.query,X=V(parseInt(((ge=ae.page)==null?void 0:ge.toString())??"1")),G=V(""),{selectedIds:O,allChecked:de,realAllChecked:Y,selectRealAll:Ue,allCheckedAlertVisible:Pe,clearSelection:x,toggleAllChecked:De,toggleSelect:Be,total:B,checked:j,shiftEffectingIds:Le,handleItemClick:Fe,handleMouseOver:Ee,selectAll:Me,shouldSelect:Ne}=Ft(g),{downloadItems:Ve}=ht(w,ft.PACKAGE,x,()=>Dt("apps")),{downloadFile:qe}=Pt(w),ee=s=>{const n=le.query.q;we(c,n?`/apps?page=${s}&q=${n}`:`/apps?page=${s}`)},{keyDown:ce,keyUp:pe}=Et(B,N,X,Me,x,ee,()=>{}),Te=()=>{e(m.value.downloadsDir)},{mutate:Qe}=ke({document:It}),ue=["user","system"].map(s=>({id:s,name:P("app_type."+s)})),Ke=s=>{s.isUninstalling=!1},{loading:te,fetch:re}=ye({handle:(s,n)=>{Z.value=!1,n?W(P(n),"error"):s&&(g.value=s.packages.map(h=>({...h,isUninstalling:!1,icon:St(w.value,"pkgicon://"+h.id)})),B.value=s.packageCount)},document:Ct,variables:()=>({offset:(X.value-1)*N,limit:N,query:G.value,sortBy:z.value})});function me(s){return s?`/apps?q=${s}`:"/apps"}function ze(s){z.value!==s&&(Z.value=!0,z.value=s,ee(1))}function Ge(s){Object.assign(q,s);const n=Se(q);we(c,me(n))}const{mutate:Oe}=ke({document:At});function je(s){s.isUninstalling=!0,M(P("confirm_uninstallation_on_phone")),Oe({id:s.id})}function Re(s){qe(s.path,`${s.name.replace(" ","")}-${s.id}.apk`)}const{loading:We,fetch:He}=ye({handle:s=>{if(s)for(const n of s.packageStatuses){const h=i.value.find(D=>D.id===n.id);if(h){const D=h.isNew&&n.exist,T=!h.isNew&&n.exist&&h.updatedAt<n.updatedAt;(D||T)&&(i.value=i.value.filter(L=>L.id!==n.id),M(""),D?W(P("app_installation_completed"),"success"):W(P("app_upgrade_completed"),"success"),re())}else n.exist||(Tt(g.value,n.id),M(""))}},document:Ut,variables:()=>({ids:[...g.value.filter(s=>s.isUninstalling).map(s=>s.id),...i.value.map(s=>s.id)]})}),_e=s=>{s.status==="done"&&Qe({path:s.dir+"/"+s.fileName}).then(n=>{if(M(P("confirm_installation_on_phone")),n&&n.data&&n.data.installPackage){const{packageName:h,updatedAt:D,isNew:T}=n.data.installPackage;h&&(i.value.push({id:h,updatedAt:D,isNew:T}),setTimeout(()=>{i.value.some(L=>L.id===h)&&(i.value=i.value.filter(L=>L.id!==h),M(""))},12e4))}}).catch(n=>{M(""),W(P("app_installation_failed")+": "+n.message,"error")})};function Je(s){U(s,m.value.downloadsDir,n=>n.name.endsWith(".apk"))}return vt(()=>{var s;setInterval(()=>{(g.value.some(n=>n.isUninstalling)||i.value.length>0)&&!We.value&&He()},1e3),G.value=Bt(((s=ae.q)==null?void 0:s.toString())??""),Ce(q,G.value),re(),se.on("upload_task_done",_e),window.addEventListener("keydown",ce),window.addEventListener("keyup",pe)}),kt(()=>{se.off("upload_task_done",_e),window.removeEventListener("keydown",ce),window.removeEventListener("keyup",pe)}),(s,n)=>{const h=Ie,D=be,T=oe,L=st,Ze=xe,Xe=H("tooltip");return o(),r(F,null,[a("div",as,[_(h,{"touch-target":"wrapper",checked:t(de),indeterminate:!t(de)&&t(j),onChange:t(De)},null,8,["checked","indeterminate","onChange"]),a("div",ds,[t(O).length?(o(),r("span",cs,l(s.$t("x_selected",{count:t(Y)?t(B).toLocaleString():t(O).length.toLocaleString()})),1)):(o(),r("span",ps,l(s.$t("page_title.apps"))+" ("+l(t(B).toLocaleString())+")",1)),t(j)?S((o(),v(T,{key:2,onClick:n[0]||(n[0]=$(f=>t(Ve)(t(Y),t(O),G.value),["stop"]))},{default:k(()=>[_(D)]),_:1})),[[Xe,s.$t("download")]]):E("",!0)]),!t(u)||!t(j)?(o(),r("div",us,[_(zt,{filter:q,types:t(ue),"get-url":me,"show-chips":!t(u),"is-phone":t(u),sorting:Z.value,"sort-items":t(Ae),"app-sort-by":t(z),onInstall:Te,onSort:ze},null,8,["filter","types","show-chips","is-phone","sorting","sort-items","app-sort-by"])])):E("",!0)]),t(u)?(o(),v(tt,{key:0,class:"mobile-search-filters",filter:q,tags:[],feeds:[],buckets:[],types:t(ue),onFilterChange:Ge},null,8,["filter","types"])):E("",!0),_(L,{limit:N,total:t(B),"all-checked-alert-visible":t(Pe),"real-all-checked":t(Y),"select-real-all":t(Ue),"clear-selection":t(x)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",{class:"scroll-content",onDragover:n[3]||(n[3]=$((...f)=>t(I)&&t(I)(...f),["stop","prevent"]))},[S(a("div",{class:"drag-mask",onDrop:$(Je,["stop","prevent"]),onDragleave:n[1]||(n[1]=$((...f)=>t(C)&&t(C)(...f),["stop","prevent"]))},l(s.$t("release_to_send_files")),545),[[$t,t(A)]]),a("div",{class:J(["app-list",{"select-mode":t(j)}])},[(o(!0),r(F,null,ne(g.value,(f,Ye)=>(o(),v(ls,{key:f.id,item:f,index:Ye,"selected-ids":t(O),"shift-effecting-ids":t(Le),"should-select":t(Ne),"is-phone":t(u),"handle-item-click":t(Fe),"handle-mouse-over":t(Ee),"toggle-select":t(Be),onUninstall:je,onDownload:Re,onCancelUninstall:Ke},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(te)&&g.value.length===0?(o(),r(F,{key:0},ne(20,f=>_(Rt,{key:f,index:f,"is-phone":t(u)},null,8,["index","is-phone"])),64)):E("",!0)],2),!t(te)&&g.value.length===0?(o(),r("div",rs,l(s.$t(t(bt)(t(te)))),1)):E("",!0),t(B)>N?(o(),v(Ze,{key:1,page:X.value,go:ee,total:t(B),limit:N},null,8,["page","total"])):E("",!0),a("input",{ref_key:"fileInput",ref:d,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:n[2]||(n[2]=(...f)=>t(p)&&t(p)(...f))},null,544)],32)],64)}}}),Is=ie(ms,[["__scopeId","data-v-1c7227c8"]]);export{Is as default};
