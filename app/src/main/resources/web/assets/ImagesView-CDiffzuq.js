import{_ as $o}from"./VPagination.vuevuetypescriptsetuptruelang-BzK-L-Ey.js";import{_ as bo,a as wo,b as Io,c as To,d as Do}from"./grid-view-outline-rounded-DJh1M8Ae.js";import{_ as So}from"./FieldId.vuevuetypescriptsetuptruelang-eOYRhci9.js";import{e as Ao,f as Eo,s as Ue,r as W,u as Mo,G as Vo,g as Fo,ae as Be,af as Lo,H as Ro,I as zo,aG as qo,aH as He,aI as Uo,ag as Bo,aJ as V,aC as _e,J as Ho,aK as No,aL as Ko,K as Qo,L as Go,c as m,o as t,a as r,k as l,l as e,j as F,t as y,Q as C,p as _,M as Po,O as c,a2 as d,y as a,aM as J,aN as X,ai as Oo,aj as jo,P as B,R as Y,S as Wo,aO as Jo,D as Xo,aP as Yo,a5 as Zo,aQ as xo,ah as es,aR as os,N as ss,ap as ts,aS as ns,aq as as,V as ls,n as Ne,aT as is,W as cs,X as ds,Y as rs,z as us,Z as _s,$ as ps,aU as Ke,a0 as ms,a1 as T,aV as ks}from"./index-BaWXnnLZ.js";import{_ as gs,a as vs}from"./SearchInput-Cq5_Bnx2.js";import{_ as hs,a as fs}from"./upload-rounded-BleGzatb.js";import{_ as ys}from"./IconButton.vuevuetypescriptsetuptruelang-CHMhruVe.js";import{u as Cs}from"./search-brnXFXDL.js";import{a as $s}from"./tags-zkWLe_qU.js";import{u as bs,a as ws}from"./key-events-B0Jq4BkE.js";import"./search-rounded-Dmop53vQ.js";const Is={class:"top-app-bar"},Ts=["checked","indeterminate"],Ds={class:"title"},Ss={key:0},As={key:1},Es={class:"actions"},Ms=["onClick"],Vs={slot:"headline"},Fs=["onClick"],Ls={slot:"headline"},Rs={class:"menu-items"},zs=["selected","onClick"],qs={slot:"headline"},Us={class:"sm"},Bs=["selected"],Hs=["selected"],Ns=["onClick","onMouseover"],Ks=["src"],Qs={key:1,class:"actions"},Gs={class:"right"},Ps=["onClick","onMouseover"],Os={class:"start"},js=["checked","onClick"],Ws=["checked","onClick"],Js={class:"number"},Xs=["src"],Ys={class:"title"},Zs={class:"subtitle"},xs=["onClick"],et={class:"actions"},ot={class:"time"},st={key:2,class:"no-data-placeholder"},A=55,kt=Ao({__name:"ImagesView",setup(tt){var Le;const D=Eo(),{imageSortBy:H}=Ue(D),S=W([]),{t:Qe}=Mo(),{parseQ:Ge}=Cs(),w=Vo({tagIds:[],bucketId:void 0}),pe=Fo(),{app:E,urlTokenKey:Z,uploads:x}=Ue(pe),{input:Pe,upload:Oe,uploadChanged:me}=Be(x),{input:je,upload:We,uploadChanged:ke}=Be(x),{dropping:Je,fileDragEnter:ge,fileDragLeave:ve,dropFiles:Xe}=Lo(x),ee=W(!1),u=Ro.IMAGE,he=zo(),fe=he.query,oe=W(parseInt(((Le=fe.page)==null?void 0:Le.toString())??"1")),{tags:N,buckets:K,fetch:Ye}=qo(u),Ze=He(()=>{const o={};return K.value.forEach(n=>{o[n.id]=n}),o}),$=W(""),{addToTags:xe}=$s(u,N),{deleteItems:se,deleteItem:Q}=Uo(),{view:eo}=is(u),{selectedIds:h,allChecked:ye,realAllChecked:I,selectRealAll:oo,allCheckedAlertVisible:so,clearSelection:L,toggleAllChecked:Ce,toggleSelect:R,total:b,checked:z,shiftEffectingIds:G,handleItemClick:$e,handleMouseOver:be,selectAll:to,shouldSelect:we}=bs(S),{downloadItems:Ie}=Bo(Z,u,L,"images.zip"),{downloadFile:P}=as(Z),Te=o=>{const n=he.query.q;us(D,n?`/images?page=${o}&q=${n}`:`/images?page=${o}`)},{keyDown:De,keyUp:Se}=ws(b,A,oe,to,L,Te,()=>{J(X.MEDIA_TRASH,E.value.osVersion)?j(u,q()):se(u,h.value,I.value,b.value,$.value)}),no=ts(),ao=He(()=>S.value.map(o=>({src:_e(o.fileId),name:V(o.path),duration:0,size:o.size,path:o.path,type:u,data:o})));function te(o){pe.lightbox={sources:ao.value,index:o,visible:!0}}const q=()=>{let o=$.value;return I.value||(o=`ids:${h.value.join(",")}`),o};function Ae(o){_s(ps,{type:u,tags:N.value,item:{key:o.id,title:o.title,size:o.size},selected:N.value.filter(n=>o.tags.some(f=>f.id===n.id))})}function lo(o,n){if(H.value===n){o.close();return}ee.value=!0,H.value=n,o.close()}const{loading:O,fetch:U}=Ho({handle:async(o,n)=>{if(ee.value=!1,n)Xo(Qe(n),"error");else if(o){const f=[];for(const i of o.images)f.push({...i,fileId:Yo(Z.value,i.path,i.id)});S.value=f,b.value=o.imageCount}},document:Jo,variables:()=>({offset:(oe.value-1)*A,limit:A,query:$.value,sortBy:H.value})}),{trashLoading:ne,trash:j}=No(),{restoreLoading:ae,restore:le}=Ko();function io(o){return o?`/images?q=${o}`:"/images"}function ie(){const o=K.value.find(n=>n.id===w.bucketId);return o?Ke(o.topItems[0]):`${E.value.internalStoragePath}/Pictures`}function co(o){Oe(ie()),o.close()}function ro(o){We(ie()),o.close()}function uo(o){Xe(o,ie(),"image")}const Ee=o=>{o.type===u&&(L(),U())},Me=o=>{o.type===u&&U()},Ve=o=>{o.type===u&&(L(),U())},Fe=o=>{o.status==="done"&&ks(o.fileName)&&((!w.bucketId||K.value.some(f=>f.id===w.bucketId&&f.topItems.some(i=>o.dir.startsWith(Ke(i)))))&&setTimeout(()=>{U()},1e3),T.emit("media_items_actioned",{type:u,action:"upload",query:""}))};return Qo(()=>{var o;$.value=ms(((o=fe.q)==null?void 0:o.toString())??""),Ge(w,$.value),Ye(),U(),T.on("item_tags_updated",Me),T.on("items_tags_updated",Ee),T.on("media_items_actioned",Ve),T.on("upload_task_done",Fe),window.addEventListener("keydown",De),window.addEventListener("keyup",Se)}),Go(()=>{T.off("item_tags_updated",Me),T.off("items_tags_updated",Ee),T.off("media_items_actioned",Ve),T.off("upload_task_done",Fe),window.removeEventListener("keydown",De),window.removeEventListener("keyup",Se)}),(o,n)=>{const f=Zo,i=ys,ce=xo,M=es,de=os,re=ss,_o=gs,po=hs,Re=Oo,mo=fs,ko=bo,go=wo,vo=vs,ue=Io,ze=To,ho=ns,qe=ls,fo=So,yo=Do,Co=$o,p=Po("tooltip");return t(),m(C,null,[r("div",Is,[r("md-checkbox",{"touch-target":"wrapper",checked:e(ye),indeterminate:!e(ye)&&e(z),onChange:n[0]||(n[0]=(...s)=>e(Ce)&&e(Ce)(...s))},null,40,Ts),r("div",Ds,[e(h).length?(t(),m("span",Ss,y(o.$t("x_selected",{count:e(I)?e(b).toLocaleString():e(h).length.toLocaleString()})),1)):(t(),m("span",As,y(o.$t("page_title.images"))+" ("+y(e(b).toLocaleString())+")",1)),e(z)?(t(),m(C,{key:2},[w.trash?(t(),m(C,{key:0},[_((t(),c(i,{onClick:n[1]||(n[1]=a(s=>e(se)(e(u),e(h),e(I),e(b),$.value),["stop"]))},{icon:d(()=>[l(f)]),_:1})),[[p,o.$t("delete")]]),_((t(),c(i,{loading:e(ae)(q()),onClick:n[2]||(n[2]=a(s=>e(le)(e(u),q()),["stop"]))},{icon:d(()=>[l(ce)]),_:1},8,["loading"])),[[p,o.$t("restore")]]),_((t(),c(i,{onClick:n[3]||(n[3]=a(s=>e(Ie)(e(I),e(h),$.value),["stop"]))},{icon:d(()=>[l(M)]),_:1})),[[p,o.$t("download")]])],64)):(t(),m(C,{key:1},[e(J)(e(X).MEDIA_TRASH,e(E).osVersion)?_((t(),c(i,{key:0,loading:e(ne)(q()),onClick:n[4]||(n[4]=a(s=>e(j)(e(u),q()),["stop"]))},{icon:d(()=>[l(de)]),_:1},8,["loading"])),[[p,o.$t("move_to_trash")]]):_((t(),c(i,{key:1,onClick:n[5]||(n[5]=a(s=>e(se)(e(u),e(h),e(I),e(b),$.value),["stop"]))},{icon:d(()=>[l(f)]),_:1})),[[p,o.$t("delete")]]),_((t(),c(i,{onClick:n[6]||(n[6]=a(s=>e(Ie)(e(I),e(h),$.value),["stop"]))},{icon:d(()=>[l(M)]),_:1})),[[p,o.$t("download")]]),_((t(),c(i,{onClick:n[7]||(n[7]=a(s=>e(xe)(e(h),e(I),$.value),["stop"]))},{icon:d(()=>[l(re)]),_:1})),[[p,o.$t("add_to_tags")]])],64))],64)):F("",!0)]),r("div",Es,[l(_o,{filter:w,tags:e(N),buckets:e(K),"get-url":io},null,8,["filter","tags","buckets"]),w.trash?F("",!0):(t(),c(Re,{key:0},{content:d(s=>[r("md-menu-item",{onClick:a(g=>co(s),["stop"])},[r("div",Vs,y(o.$t("upload_files")),1)],8,Ms),r("md-menu-item",{onClick:a(g=>ro(s),["stop"])},[r("div",Ls,y(o.$t("upload_folder")),1)],8,Fs)]),default:d(()=>[_((t(),c(i,null,{icon:d(()=>[l(po)]),_:1})),[[p,o.$t("upload")]])]),_:1})),l(Re,null,{content:d(s=>[r("div",Rs,[(t(!0),m(C,null,Y(e(no),g=>(t(),m("md-menu-item",{key:g.value,selected:g.value===e(H),onClick:k=>lo(s,g.value)},[r("div",qs,y(o.$t(g.label)),1)],8,zs))),128))])]),default:d(()=>[_((t(),c(i,{loading:ee.value},{icon:d(()=>[l(mo)]),_:1},8,["loading"])),[[p,o.$t("sort")]])]),_:1}),r("md-outlined-segmented-button-set",Us,[r("md-outlined-segmented-button",{"data-value":"grid","no-checkmark":"",selected:!e(D).imagesCardView,onClick:n[8]||(n[8]=s=>e(D).imagesCardView=!1)},[l(ko,{slot:"icon"})],8,Bs),r("md-outlined-segmented-button",{"data-value":"card","no-checkmark":"",selected:e(D).imagesCardView,onClick:n[9]||(n[9]=s=>e(D).imagesCardView=!0)},[l(go,{slot:"icon"})],8,Hs)])])]),l(vo,{limit:A,total:e(b),"all-checked-alert-visible":e(so),"real-all-checked":e(I),"select-real-all":e(oo),"clear-selection":e(L)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),r("div",{class:"scroll-content",onDragover:n[13]||(n[13]=a((...s)=>e(ge)&&e(ge)(...s),["stop","prevent"]))},[_(r("div",{class:"drag-mask",onDrop:a(uo,["stop","prevent"]),onDragleave:n[10]||(n[10]=a((...s)=>e(ve)&&e(ve)(...s),["stop","prevent"]))},y(o.$t("release_to_send_files")),545),[[jo,e(Je)]]),e(D).imagesCardView?(t(),m("div",{key:1,class:B(["media-list",{"select-mode":e(z)}])},[(t(!0),m(C,null,Y(S.value,(s,g)=>{var k;return t(),m("section",{key:s.id,class:B(["media-item selectable-card",{selected:e(h).includes(s.id),selecting:e(G).includes(s.id)}]),onClick:a(v=>e($e)(v,s,g,te),["stop"]),onMouseover:v=>e(be)(v,g)},[r("div",Os,[e(G).includes(s.id)?(t(),m("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:e(we),onClick:a(v=>e(R)(v,s,g),["stop"])},null,8,js)):(t(),m("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:e(h).includes(s.id),onClick:a(v=>e(R)(v,s,g),["stop"])},null,8,Ws)),r("span",Js,[l(fo,{id:g+1,raw:s},null,8,["id","raw"])])]),r("img",{class:"image",src:e(_e)(s.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,Xs),r("div",Ys,y(e(V)(s.path)),1),r("div",Zs,[r("span",null,y(e(Ne)(s.size)),1),r("a",{onClick:a(v=>e(eo)(e(D),s.bucketId),["stop","prevent"])},y((k=Ze.value[s.bucketId])==null?void 0:k.name),9,xs),l(qe,{tags:s.tags,type:e(u),"only-links":!0},null,8,["tags","type"])]),r("div",et,[w.trash?(t(),m(C,{key:0},[_((t(),c(i,{class:"sm",onClick:a(v=>e(Q)(e(u),s),["stop"])},{icon:d(()=>[l(f)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),_((t(),c(i,{class:"sm",loading:e(ae)(`ids:${s.id}`),onClick:a(v=>e(le)(e(u),`ids:${s.id}`),["stop"])},{icon:d(()=>[l(ce)]),_:2},1032,["loading","onClick"])),[[p,o.$t("restore")]]),_((t(),c(i,{class:"sm",onClick:a(v=>e(P)(s.path,e(V)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(M)]),_:2},1032,["onClick"])),[[p,o.$t("download")]])],64)):(t(),m(C,{key:1},[e(J)(e(X).MEDIA_TRASH,e(E).osVersion)?_((t(),c(i,{key:0,class:"sm",loading:e(ne)(`ids:${s.id}`),onClick:a(v=>e(j)(e(u),`ids:${s.id}`),["stop"])},{icon:d(()=>[l(de)]),_:2},1032,["loading","onClick"])),[[p,o.$t("move_to_trash")]]):_((t(),c(i,{key:1,class:"sm",onClick:a(v=>e(Q)(e(u),s),["stop"])},{icon:d(()=>[l(f)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),_((t(),c(i,{class:"sm",onClick:a(v=>e(P)(s.path,e(V)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(M)]),_:2},1032,["onClick"])),[[p,o.$t("download")]]),_((t(),c(i,{class:"sm",onClick:a(v=>Ae(s),["stop"])},{icon:d(()=>[l(re)]),_:2},1032,["onClick"])),[[p,o.$t("add_to_tags")]])],64))]),r("div",ot,[_((t(),m("span",null,[ds(y(e(rs)(s.createdAt)),1)])),[[p,e(cs)(s.createdAt)]])])],42,Ps)}),128)),e(O)&&S.value.length===0?(t(),c(yo,{key:0,limit:A})):F("",!0)],2)):(t(),m("div",{key:0,class:B(["media-grid",{"select-mode":e(z)}])},[(t(!0),m(C,null,Y(S.value,(s,g)=>(t(),m("section",{key:s.id,class:B(["media-item",{selected:e(h).includes(s.id),selecting:e(G).includes(s.id)}]),onClick:a(k=>e($e)(k,s,g,te),["stop"]),onMouseover:k=>e(be)(k,g)},[r("img",{class:"image-thumb image",src:e(_e)(s.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,Ks),e(G).includes(s.id)?(t(),c(i,{key:0,class:"btn-checkbox",onClick:a(k=>e(R)(k,s,g),["stop"])},{icon:d(()=>[e(we)?(t(),c(ue,{key:0})):(t(),c(ze,{key:1}))]),_:2},1032,["onClick"])):e(h).includes(s.id)?(t(),c(i,{key:1,class:"btn-checkbox",onClick:a(k=>e(R)(k,s,g),["stop"])},{icon:d(()=>[l(ue)]),_:2},1032,["onClick"])):(t(),m(C,{key:2},[l(i,{class:"btn-checkbox",onClick:a(k=>e(R)(k,s,g),["stop"])},{icon:d(()=>[e(h).includes(s.id)?(t(),c(ue,{key:0})):(t(),c(ze,{key:1}))]),_:2},1032,["onClick"]),e(z)?_((t(),c(i,{key:0,class:"btn-zoom sm",onClick:a(k=>te(g),["stop"])},{icon:d(()=>[l(ho)]),_:2},1032,["onClick"])),[[p,o.$t("open")]]):(t(),m("div",Qs,[w.trash?(t(),m(C,{key:0},[_((t(),c(i,{class:"sm",onClick:a(k=>e(Q)(e(u),s),["stop"])},{icon:d(()=>[l(f)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),_((t(),c(i,{class:"sm",loading:e(ae)(`ids:${s.id}`),onClick:a(k=>e(le)(e(u),`ids:${s.id}`),["stop"])},{icon:d(()=>[l(ce)]),_:2},1032,["loading","onClick"])),[[p,o.$t("restore")]]),_((t(),c(i,{class:"sm",onClick:a(k=>e(P)(s.path,e(V)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(M)]),_:2},1032,["onClick"])),[[p,o.$t("download")]])],64)):(t(),m(C,{key:1},[e(J)(e(X).MEDIA_TRASH,e(E).osVersion)?_((t(),c(i,{key:0,class:"sm",loading:e(ne)(`ids:${s.id}`),onClick:a(k=>e(j)(e(u),`ids:${s.id}`),["stop"])},{icon:d(()=>[l(de)]),_:2},1032,["loading","onClick"])),[[p,o.$t("move_to_trash")]]):_((t(),c(i,{key:1,class:"sm",onClick:a(k=>e(Q)(e(u),s),["stop"])},{icon:d(()=>[l(f)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),_((t(),c(i,{class:"sm",onClick:a(k=>e(P)(s.path,e(V)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(M)]),_:2},1032,["onClick"])),[[p,o.$t("download")]]),_((t(),c(i,{class:"sm",onClick:a(k=>Ae(s),["stop"])},{icon:d(()=>[l(re)]),_:2},1032,["onClick"])),[[p,o.$t("add_to_tags")]])],64))])),r("div",{class:B(["info",{"has-tags":s.tags.length>0}])},[l(qe,{tags:s.tags,type:e(u)},null,8,["tags","type"]),r("span",Gs,y(e(Ne)(s.size)),1)],2)],64))],42,Ns))),128)),e(O)&&S.value.length===0?(t(),m(C,{key:0},Y(A,s=>r("section",{key:s,class:"skeleton-image media-item"})),64)):F("",!0)],2)),!e(O)&&S.value.length===0?(t(),m("div",st,y(o.$t(e(Wo)(e(O),e(E).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):F("",!0),e(b)>A?(t(),c(Co,{key:3,page:oe.value,go:Te,total:e(b),limit:A},null,8,["page","total"])):F("",!0),r("input",{ref_key:"fileInput",ref:Pe,style:{display:"none"},type:"file",accept:"image/*",multiple:"",onChange:n[11]||(n[11]=(...s)=>e(me)&&e(me)(...s))},null,544),r("input",{ref_key:"dirFileInput",ref:je,style:{display:"none"},type:"file",accept:"image/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[12]||(n[12]=(...s)=>e(ke)&&e(ke)(...s))},null,544)],32)],64)}}});export{kt as default};
