import{_ as Le}from"./VPagination.vuevuetypescriptsetuptruelang-C8EdHkPn.js";import{_ as Se}from"./call-outline-rounded-CPw30W8z.js";import{e as qe,f as Ae,s as Ie,g as De,r as L,u as Ee,I as Ve,J as xe,K as Me,L as Ne,i as Ge,M as Qe,N as Ue,c as n,o,a as l,k as d,l as t,j as S,t as r,T as q,O as g,P as Be,y as _,a7 as Ke,Q as Re,R as A,S as W,U as Y,V as ze,a8 as He,E as Oe,G as Pe,a9 as je,Z as Fe,Y as Je,$ as We,F as Ye,a0 as Ze,d as Xe,A as et,a1 as Z,a2 as tt,aa as st,ab as at,a3 as lt,a4 as p,ac as ot,H as nt}from"./index-Bm4LvS3o.js";import{_ as ct}from"./FieldId.vuevuetypescriptsetuptruelang-BrgUyHoS.js";import{_ as it,a as dt}from"./SearchInput-DRzs7deS.js";import{_ as rt}from"./VCheckbox-BGOsDzY1.js";import{b as ut,u as _t,a as pt}from"./key-events-CTyRdg-2.js";import{u as vt}from"./search-KPji0eDE.js";import{u as mt,a as ft}from"./tags-Btr3rBM8.js";import"./VInputChip-Cxd-Tq_f.js";const gt={class:"top-app-bar"},kt={class:"title"},ht={key:0},yt={key:1},bt={class:"actions"},Ct={class:"scroll-content"},$t=["onClick","onMouseover"],wt={class:"start"},Tt={class:"number"},Lt={class:"title"},St={class:"subtitle"},qt={class:"actions"},At=["onClick"],It=["onClick"],Dt=["onClick"],Et={class:"geo"},Vt={class:"time"},xt={class:"start"},Mt={class:"number"},Nt={key:0,class:"no-data-placeholder"},k=50,Gt=qe({__name:"CallsView",setup(Qt){var j;const X=Ae(),{app:ee}=Ie(De()),h=L([]),{t:I}=Ee(),{parseQ:te}=vt(),x=Ve({tagIds:[]}),u=xe.CALL,M=Me(),N=M.query,D=L(parseInt(((j=N.page)==null?void 0:j.toString())??"1")),m=L(""),{tags:$,fetch:se}=mt(u),{addToTags:ae}=ft(u,$),{deleteItems:G}=ut(ot,()=>{w(),T(),p.emit("refetch_tags",u),p.emit("calls_deleted")}),{selectedIds:v,allChecked:Q,realAllChecked:y,selectRealAll:le,allCheckedAlertVisible:oe,clearSelection:w,toggleAllChecked:ne,toggleSelect:U,total:c,checked:E,shiftEffectingIds:B,handleItemClick:ce,handleMouseOver:ie,selectAll:de,shouldSelect:re}=_t(h),K=e=>{const a=M.query.q;et(X,a?`/calls?page=${e}&q=${a}`:`/calls?page=${e}`)},{keyDown:R,keyUp:z}=pt(c,k,D,de,w,K,()=>{G(v.value,y.value,c.value,m.value)}),{loading:V,fetch:T}=Ne({handle:(e,a)=>{a?Oe(I(a),"error"):e&&(h.value=e.calls,c.value=e.callCount)},document:He,variables:()=>({offset:(D.value-1)*k,limit:k,query:m.value})}),ue=["1","2","3"].map(e=>({id:e,name:I("call_type."+e)}));function _e(e){Z(tt,{type:u,tags:$.value,item:{key:e.id,title:"",size:0},selected:$.value.filter(a=>e.tags.some(b=>b.id===a.id))})}function pe(e){return e?`/calls?q=${e}`:"/calls"}const H=e=>{e.type===u&&(w(),T())},O=e=>{e.type===u&&T()};function ve(e){if(!e)return"";const a=[];return e.isp&&a.push(I("phone_isp_type."+e.isp)),e.city===e.province?a.push(e.city):a.push(`${e.province}${e.city}`),a.join(", ")}const P=L(""),{mutate:me,loading:fe}=Ge({document:Pe});function ge(e){P.value=e.id,me({number:e.number})}function ke(e){Z(at,{id:e.id,name:e.number,gql:st`
      mutation DeleteCall($query: String!) {
        deleteCalls(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),typeName:"Call",done:()=>{c.value--,e.tags.length&&p.emit("refetch_tags",u),p.emit("calls_deleted")}})}return Qe(()=>{var e;m.value=lt(((e=N.q)==null?void 0:e.toString())??""),te(x,m.value),se(),T(),p.on("item_tags_updated",O),p.on("items_tags_updated",H),window.addEventListener("keydown",R),window.addEventListener("keyup",z)}),Ue(()=>{p.off("item_tags_updated",O),p.off("items_tags_updated",H),window.removeEventListener("keydown",R),window.removeEventListener("keyup",z)}),(e,a)=>{const b=rt,F=Ke,J=Re,he=it,ye=dt,be=ct,Ce=Fe,$e=Je,we=Se,Te=Le,f=Be("tooltip");return o(),n(q,null,[l("div",gt,[d(b,{"touch-target":"wrapper",checked:t(Q),indeterminate:!t(Q)&&t(E),onChange:t(ne)},null,8,["checked","indeterminate","onChange"]),l("div",kt,[t(v).length?(o(),n("span",ht,r(e.$t("x_selected",{count:t(y)?t(c).toLocaleString():t(v).length.toLocaleString()})),1)):(o(),n("span",yt,r(e.$t("page_title.calls"))+" ("+r(t(c).toLocaleString())+")",1)),t(E)?(o(),n(q,{key:2},[g((o(),n("button",{class:"btn-icon",onClick:a[0]||(a[0]=_(s=>t(G)(t(v),t(y),t(c),m.value),["stop"]))},[d(F)])),[[f,e.$t("delete")]]),g((o(),n("button",{class:"btn-icon",onClick:a[1]||(a[1]=_(s=>t(ae)(t(v),t(y),m.value),["stop"]))},[d(J)])),[[f,e.$t("add_to_tags")]])],64)):S("",!0)]),l("div",bt,[d(he,{filter:x,tags:t($),types:t(ue),"get-url":pe},null,8,["filter","tags","types"])])]),d(ye,{limit:k,total:t(c),"all-checked-alert-visible":t(oe),"real-all-checked":t(y),"select-real-all":t(le),"clear-selection":t(w)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),l("div",Ct,[l("div",{class:W(["call-list",{"select-mode":t(E)}])},[(o(!0),n(q,null,Y(h.value,(s,C)=>(o(),n("section",{key:s.id,class:W(["call-item selectable-card",{selected:t(v).includes(s.id),selecting:t(B).includes(s.id)}]),onClick:_(i=>t(ce)(i,s,C,()=>{}),["stop"]),onMouseover:i=>t(ie)(i,C)},[l("div",wt,[t(B).includes(s.id)?(o(),A(b,{key:0,class:"checkbox","touch-target":"wrapper",checked:t(re),onClick:_(i=>t(U)(i,s,C),["stop"])},null,8,["checked","onClick"])):(o(),A(b,{key:1,class:"checkbox","touch-target":"wrapper",checked:t(v).includes(s.id),onClick:_(i=>t(U)(i,s,C),["stop"])},null,8,["checked","onClick"])),l("span",Tt,[d(be,{id:C+1,raw:s},null,8,["id","raw"])])]),l("div",Lt,r(s.name?s.name+" "+s.number:s.number),1),l("div",St,[l("span",null,r(t(je)(s.duration)),1),l("span",null,r(e.$t("call_type."+s.type)),1),d(Ce,{tags:s.tags,type:t(u),"only-links":!0},null,8,["tags","type"])]),l("div",qt,[g((o(),n("button",{class:"btn-icon sm",onClick:_(i=>ke(s),["stop"])},[d(F)],8,At)),[[f,e.$t("delete")]]),t(fe)&&P.value===s.id?(o(),A($e,{key:0,indeterminate:"",class:"sm"})):g((o(),n("button",{key:1,class:"btn-icon sm",onClick:_(i=>ge(s),["stop"])},[d(we)],8,It)),[[f,e.$t("make_a_phone_call")]]),g((o(),n("button",{class:"btn-icon sm",onClick:_(i=>_e(s),["stop"])},[d(J)],8,Dt)),[[f,e.$t("add_to_tags")]])]),l("div",Et,r(ve(s.geo)),1),l("div",Vt,[g((o(),n("span",null,[Ye(r(t(Ze)(s.startedAt)),1)])),[[f,t(We)(s.startedAt)]])])],42,$t))),128)),t(V)&&h.value.length===0?(o(),n(q,{key:0},Y(20,s=>l("section",{key:s,class:"call-item selectable-card-skeleton"},[l("div",xt,[a[2]||(a[2]=l("div",{class:"checkbox"},[l("div",{class:"skeleton-checkbox"})],-1)),l("span",Mt,r(s),1)]),a[3]||(a[3]=Xe('<div class="title" data-v-d3f72c1f><div class="skeleton-text skeleton-title" data-v-d3f72c1f></div></div><div class="subtitle" data-v-d3f72c1f><div class="skeleton-text skeleton-subtitle" data-v-d3f72c1f></div></div><div class="actions" data-v-d3f72c1f><div class="skeleton-text skeleton-actions" data-v-d3f72c1f></div></div><div class="geo" data-v-d3f72c1f><div class="skeleton-text skeleton-geo" data-v-d3f72c1f></div></div><div class="time" data-v-d3f72c1f><div class="skeleton-text skeleton-time" data-v-d3f72c1f></div></div>',5))])),64)):S("",!0)],2),!t(V)&&h.value.length===0?(o(),n("div",Nt,r(e.$t(t(ze)(t(V),t(ee).permissions,"WRITE_CALL_LOG"))),1)):S("",!0),t(c)>k?(o(),A(Te,{key:1,page:D.value,go:K,total:t(c),limit:k},null,8,["page","total"])):S("",!0)])],64)}}}),Jt=nt(Gt,[["__scopeId","data-v-d3f72c1f"]]);export{Jt as default};
