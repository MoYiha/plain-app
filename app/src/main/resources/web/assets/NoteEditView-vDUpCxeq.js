import{_ as Y}from"./MonacoEditor.vuevuetypescriptsetuptruelang-WcUH3tOp.js";import{_ as ee}from"./print-outline-rounded-CtsVPpnN.js";import{b0 as te,b1 as F,b2 as ne,o as g,c as k,a as d,d as ae,u as oe,g as se,h as y,s as ie,i as ue,l as le,K as re,j as ce,b3 as de,a_ as _e,a1 as E,a$ as me,x as I,w as R,p as S,V as G,t as pe,m as O,aH as ve,v as fe,e as z,O as j,Q as ge,b4 as he,k as be,C as K,b5 as Te,b6 as ye,b7 as ke,U as we,a3 as $e,a4 as Se,S as Ce,F as xe,G as Le,a6 as Me,f as Ne,Z as Ee,$ as Ie,a2 as qe,H as Ve}from"./index-B-S542RM.js";import{u as Ae}from"./markdown-DdibuaIZ.js";var Q=function(){return te.Date.now()},De="Expected a function",He=Math.max,Re=Math.min;function Qe(_,u,l){var m,a,o,i,s,r,v=0,x=!1,f=!1,h=!0;if(typeof _!="function")throw new TypeError(De);u=F(u)||0,ne(l)&&(x=!!l.leading,f="maxWait"in l,o=f?He(F(l.maxWait)||0,u):o,h="trailing"in l?!!l.trailing:h);function w(n){var c=m,e=a;return m=a=void 0,v=n,i=_.apply(e,c),i}function L(n){return v=n,s=setTimeout(p,u),x?w(n):i}function q(n){var c=n-r,e=n-v,t=u-c;return f?Re(t,o-e):t}function b(n){var c=n-r,e=n-v;return r===void 0||c>=u||c<0||f&&e>=o}function p(){var n=Q();if(b(n))return M(n);s=setTimeout(p,q(n))}function M(n){return s=void 0,h&&m?w(n):(m=a=void 0,i)}function V(){s!==void 0&&clearTimeout(s),v=0,m=r=a=s=void 0}function A(){return s===void 0?i:M(Q())}function $(){var n=Q(),c=b(n);if(m=arguments,a=this,r=n,c){if(s===void 0)return L(r);if(f)return clearTimeout(s),s=setTimeout(p,u),w(r)}return s===void 0&&(s=setTimeout(p,u)),i}return $.cancel=V,$.flush=A,$}const Ue={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Be=d("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1),We=[Be];function Fe(_,u){return g(),k("svg",Ue,[...We])}const Ge={name:"material-symbols-arrow-back-rounded",render:Fe},U=_=>(xe("data-v-977015b7"),_=_(),Le(),_),Oe={class:"top-app-bar"},ze=U(()=>d("md-ripple",null,null,-1)),je={class:"title"},Ke={class:"state-point"},Pe={class:"actions"},Xe=U(()=>d("md-ripple",null,null,-1)),Ze=U(()=>d("md-ripple",null,null,-1)),Je={class:"panel-container"},Ye=["innerHTML"],C="NOTE",et=ae({__name:"NoteEditView",setup(_){const u=oe(),{t:l}=se(),m=ge(),a=y(""),o=y(),i=y(""),s=y(""),r=y(!1),{app:v,urlTokenKey:x}=ie(ue());function f(){const e=Me.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),Ne(u,t)}const{render:h}=Ae(v,x),w=Qe(()=>{r.value=!1,M({id:a.value,input:{content:i.value,title:he(i.value,{length:250,omission:""})}})},500),L=()=>{be(i,async e=>{r.value=!0,s.value=await h(e),w()})},q=()=>{window.print()},b=y();le({handle:(e,t)=>{t?K(l(t),"error"):e&&(b.value=e.tags)},document:Te,variables:{type:C},appApi:!0});const{fetch:p}=re({handle:async(e,t)=>{t?K(l(t),"error"):(o.value=e.note,i.value=e.note.content,s.value=await h(i.value),L())},document:ye,variables:()=>({id:a.value}),appApi:!0}),{mutate:M,onDone:V}=ce({document:ke,appApi:!0});V(e=>{var t,T;o.value=e.data.saveNote,!a.value&&((t=o.value)!=null&&t.id)&&(a.value=(T=o.value)==null?void 0:T.id,de(u,`/notes/${a.value}`))});function A(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${l("updated_at")}: ${we(e)})`:""}function $(){var e,t;Ee(Ie,{type:C,tags:b.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=b.value)==null?void 0:t.filter(T=>{var N;return(N=o.value)==null?void 0:N.tags.some(D=>D.id===T.id)})})}const n=e=>{e.type===C&&p()},c=e=>{e.type===C&&p()};return _e(()=>{a.value=m.params.id,a.value==="create"&&(a.value=""),a.value?p():L(),E.on("item_tags_updated",c),E.on("items_tags_updated",n)}),me(()=>{E.off("item_tags_updated",c),E.off("items_tags_updated",n)}),(e,t)=>{var B,W;const T=Ge,N=$e,D=Se,P=qe,X=ee,Z=Y,H=Ce("tooltip");return g(),k(j,null,[d("div",Oe,[I((g(),k("button",{class:"btn-icon",onClick:R(f,["prevent"])},[ze,S(T)])),[[H,e.$t("back")]]),d("div",je,[G(pe(a.value?O(l)("edit"):O(l)("create"))+" ",1),I(d("span",Ke,"*",512),[[ve,r.value]]),G(),(B=o.value)!=null&&B.updatedAt?(g(),fe(N,{key:0,class:"time",id:A(),raw:o.value},null,8,["id","raw"])):z("",!0)]),d("div",Pe,[S(D,{tags:(W=o.value)==null?void 0:W.tags,type:C,"only-links":!0},null,8,["tags"]),a.value?(g(),k(j,{key:0},[I((g(),k("button",{class:"btn-icon",onClick:R($,["prevent"])},[Xe,S(P)])),[[H,e.$t("add_to_tags")]]),I((g(),k("button",{class:"btn-icon",onClick:R(q,["prevent"])},[Ze,S(X)])),[[H,e.$t("print")]])],64)):z("",!0)])]),d("div",Je,[S(Z,{language:"html",modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=J=>i.value=J)},null,8,["modelValue"]),d("div",{class:"md-container",innerHTML:s.value},null,8,Ye)])],64)}}}),st=Ve(et,[["__scopeId","data-v-977015b7"]]);export{st as default};
