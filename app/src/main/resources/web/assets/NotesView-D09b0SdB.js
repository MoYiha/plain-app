import{_ as Qe}from"./VPagination.vuevuetypescriptsetuptruelang-DUdPyPtr.js";import{o as s,c as l,a as i,j as B,b8 as ze,I as G,a1 as T,J as K,b9 as He,d as Ue,u as Be,h as U,g as Ge,K as Ke,ba as Oe,L as Re,M as je,m as e,t as $,O as N,x as g,v as _,q as p,w as r,e as D,p as d,P as Fe,N as de,Q as Pe,C as Je,bb as We,bc as Xe,bd as Ye,S as Ze,be as et,U as tt,V as st,W as ot,bf as at,X as nt,Y as lt,f as ue,Z as _e,$ as it,b4 as ct,ac as rt,ad as dt,a6 as pe,a0 as ut,ae as _t,a2 as pt,a3 as mt,a4 as vt,F as ht,G as gt,H as kt}from"./index-B-S542RM.js";import{_ as ft,a as bt,b as yt}from"./SearchInput-D0d2xIiv.js";import{_ as $t}from"./restore-from-trash-outline-rounded-Ck6P-VkW.js";import{_ as Tt}from"./IconButton.vuevuetypescriptsetuptruelang-CxW8gnDA.js";import{u as qt,b as Ct,a as wt}from"./key-events-D1Kh05Em.js";import{u as Nt,a as St}from"./tags-x91i2rzh.js";import{u as Lt}from"./search-k8SzNgo1.js";import"./search-rounded-TCa6qTC1.js";import"./rss-feed-rounded-DzJ3TVan.js";import"./vee-validate.esm-D5u4WlYW.js";const At={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Dt=i("path",{fill:"currentColor",d:"M19 17.7v1.8q0 .2.15.35t.35.15t.35-.15t.15-.35v-3q0-.2-.15-.35T19.5 16h-3q-.2 0-.35.15t-.15.35t.15.35t.35.15h1.8l-2.45 2.45q-.15.15-.15.35t.15.35t.35.15t.35-.15zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v5q0 .425-.288.713T20 11t-.712-.288T19 10V5H5v14h5q.425 0 .713.288T11 20t-.288.713T10 21zm0-3v1V5v6.075V11zm2-2q0 .425.288.713T8 17h2.075q.425 0 .713-.288t.287-.712t-.287-.712t-.713-.288H8q-.425 0-.712.288T7 16m0-4q0 .425.288.713T8 13h5q.425 0 .713-.288T14 12t-.288-.712T13 11H8q-.425 0-.712.288T7 12m0-4q0 .425.288.713T8 9h8q.425 0 .713-.288T17 8t-.288-.712T16 7H8q-.425 0-.712.288T7 8m11 15q-2.075 0-3.537-1.463T13 18t1.463-3.537T18 13t3.538 1.463T23 18t-1.463 3.538T18 23"},null,-1),It=[Dt];function Vt(k,q){return s(),l("svg",At,[...It])}const Mt={name:"material-symbols-export-notes-outline-rounded",render:Vt},Et=(k,q)=>{const{mutate:m,onDone:V}=B({document:ze,appApi:!0}),f=G(new Map);return V(a=>{f.delete(a.data.trashNotes),k(),q(),T.emit("refetch_tags",K.NOTE),T.emit("notes_actioned",{action:"trash"})}),{trashLoading(a){return f.get(a)??!1},trash(a){f.set(a,!0),m({query:a})}}},xt=(k,q)=>{const{mutate:m,onDone:V}=B({document:He,appApi:!0}),f=G(new Map);return V(a=>{f.delete(a.data.restoreNotes),k(),q(),T.emit("refetch_tags",K.NOTE),T.emit("notes_actioned",{action:"restore"})}),{restoreLoading(a){return f.get(a)??!1},restore(a){f.set(a,!0),m({query:a})}}},Qt=k=>(ht("data-v-68f43b2b"),k=k(),gt(),k),zt={class:"top-app-bar"},Ht=["checked","indeterminate"],Ut={class:"title"},Bt={key:0},Gt={key:1},Kt={class:"actions"},Ot={key:0,class:"scroller"},Rt={class:"start"},jt=Qt(()=>i("div",{class:"checkbox"},[i("div",{class:"skeleton-checkbox"})],-1)),Ft={class:"number"},Pt=lt('<div class="title" data-v-68f43b2b><div class="skeleton-text skeleton-title" data-v-68f43b2b></div></div><div class="subtitle" data-v-68f43b2b><div class="skeleton-text skeleton-subtitle" data-v-68f43b2b></div></div><div class="actions" data-v-68f43b2b><div class="skeleton-text skeleton-actions" data-v-68f43b2b></div></div><div class="time" data-v-68f43b2b><div class="skeleton-text skeleton-time" data-v-68f43b2b></div></div>',4),Jt=["href"],Wt=["onClick","onMouseover"],Xt={class:"start"},Yt=["onClick","checked"],Zt=["onClick","checked"],es={class:"number"},ts={class:"title"},ss={class:"subtitle"},os={class:"actions"},as={class:"time"},ns={key:2,class:"no-data-placeholder"},I=50,ls=Ue({__name:"NotesView",setup(k){var le;const q=Be(),m=U([]),{t:V}=Ge(),{parseQ:f}=Lt(),a=G({tagIds:[],trash:!1}),S=K.NOTE,O=Pe(),R=O.query,Q=U(parseInt(((le=R.page)==null?void 0:le.toString())??"1")),C=U(""),{tags:M,fetch:me}=Nt(S),{selectedIds:y,allChecked:j,realAllChecked:L,selectRealAll:ve,allCheckedAlertVisible:he,clearSelection:w,toggleAllChecked:F,toggleSelect:P,total:v,checked:z,shiftEffectingIds:J,handleItemClick:ge,handleMouseOver:ke,selectAll:fe,shouldSelect:be}=qt(m),{addToTags:ye}=St(S,M),W=t=>{const n=O.query.q;ue(q,n?`/notes?page=${t}&q=${n}`:`/notes?page=${t}`)},{keyDown:X,keyUp:Y}=wt(v,I,Q,fe,w,W,()=>{Z(y.value,L.value,v.value,C.value)}),{loading:H,fetch:A}=Ke({handle:(t,n)=>{n?Je(V(n),"error"):t&&(m.value=t.notes,v.value=t.noteCount)},document:We,variables:()=>({offset:(Q.value-1)*I,limit:I,query:C.value}),appApi:!0});function $e(t){_e(it,{type:S,tags:M.value,item:{key:t.id,title:"",size:0},selected:M.value.filter(n=>t.tags.some(x=>x.id===n.id))})}function Te(t){return t?`/notes?q=${t}`:"/notes"}const{mutate:qe,onDone:Ce}=B({document:Xe,appApi:!0}),we=()=>{qe({query:E()})},E=()=>{let t=C.value;return L.value||(t=`ids:${y.value.join(",")}`),t};Ce(t=>{Oe(t.data.exportNotes,"application/json","notes.json")});const{deleteItems:Z}=Ct(Ye,()=>{w(),A()});function Ne(t){_e(dt,{id:t.id,name:ct(t.title,{length:20}),gql:rt`
      mutation DeleteNote($query: String!) {
        deleteNotes(query: $query)
      }
    `,variables:()=>({query:`ids:${t.id}`}),done:()=>{w(),v.value--},appApi:!0,typeName:"Note"})}const{trashLoading:Se,trash:ee}=Et(w,A),{restoreLoading:te,restore:se}=xt(w,A);function Le(t){ue(q,oe(t))}function oe(t){const n=pe.currentRoute.value.query.q;return n?`/notes/${t.id}?q=${n}`:`/notes/${t.id}`}function Ae(){pe.push("/notes/create")}const ae=t=>{t.type===S&&(w(),A())},ne=t=>{t.type===S&&A()};return Re(()=>{var t;C.value=ut(((t=R.q)==null?void 0:t.toString())??""),f(a,C.value),a.trash===void 0&&(a.trash=!1),me(),A(),T.on("item_tags_updated",ne),T.on("items_tags_updated",ae),window.addEventListener("keydown",X),window.addEventListener("keyup",Y)}),je(()=>{T.off("item_tags_updated",ne),T.off("items_tags_updated",ae),window.removeEventListener("keydown",X),window.removeEventListener("keyup",Y)}),(t,n)=>{const x=_t,b=Tt,ie=$t,ce=yt,re=pt,De=Mt,Ie=ft,Ve=bt,Me=mt,Ee=vt,xe=Qe,h=Ze("tooltip");return s(),l(N,null,[i("div",zt,[i("md-checkbox",{"touch-target":"wrapper",onChange:n[0]||(n[0]=(...c)=>e(F)&&e(F)(...c)),checked:e(j),indeterminate:!e(j)&&e(z)},null,40,Ht),i("div",Ut,[e(y).length?(s(),l("span",Bt,$(t.$t("x_selected",{count:e(L)?e(v).toLocaleString():e(y).length.toLocaleString()})),1)):(s(),l("span",Gt,$(t.$t("page_title.notes"))+" ("+$(e(v).toLocaleString())+")",1)),e(z)?(s(),l(N,{key:2},[a.trash?(s(),l(N,{key:0},[g((s(),_(b,{onClick:n[1]||(n[1]=r(c=>e(Z)(e(y),e(L),e(v),C.value),["stop"]))},{icon:p(()=>[d(x)]),_:1})),[[h,t.$t("delete")]]),g((s(),_(b,{onClick:n[2]||(n[2]=r(c=>e(se)(E()),["stop"])),loading:e(te)(E())},{icon:p(()=>[d(ie)]),_:1},8,["loading"])),[[h,t.$t("restore")]])],64)):(s(),l(N,{key:1},[g((s(),_(b,{onClick:n[3]||(n[3]=r(c=>e(ee)(E()),["stop"]))},{icon:p(()=>[d(ce)]),_:1})),[[h,t.$t("move_to_trash")]]),g((s(),_(b,{onClick:n[4]||(n[4]=r(c=>e(ye)(e(y),e(L),C.value),["stop"]))},{icon:p(()=>[d(re)]),_:1})),[[h,t.$t("add_to_tags")]]),g((s(),_(b,{onClick:r(we,["stop"])},{icon:p(()=>[d(De)]),_:1})),[[h,t.$t("export_notes")]])],64))],64)):D("",!0)]),i("div",Kt,[d(Ie,{filter:a,tags:e(M),"get-url":Te,"show-trash":!0},null,8,["filter","tags"]),a.trash?D("",!0):(s(),l("md-outlined-button",{key:0,class:"btn-sm",onClick:r(Ae,["prevent"])},$(t.$t("create")),1))])]),d(Ve,{limit:I,total:e(v),"all-checked-alert-visible":e(he),"real-all-checked":e(L),"select-real-all":e(ve),"clear-selection":e(w)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(H)&&m.value.length===0?(s(),l("div",Ot,[(s(),l(N,null,Fe(20,c=>i("article",{class:"note-item selectable-card-skeleton",key:c},[i("div",Rt,[jt,i("span",Ft,$(c),1)]),Pt])),64))])):D("",!0),m.value.length?(s(),_(e(at),{key:1,class:de(["scroller",{"select-mode":e(z)}]),"data-key":"id","data-sources":m.value,"estimate-size":100},{item:p(({index:c,item:o})=>[(s(),l("a",{class:"item-link",key:o.id,href:oe(o)},[i("article",{class:de(["note-item selectable-card",{selected:e(y).includes(o.id)||o.id==t.$route.params.id,selecting:e(J).includes(o.id)}]),onClick:r(u=>e(ge)(u,o,c,()=>{Le(o)}),["stop","prevent"]),onMouseover:u=>e(ke)(u,c)},[i("div",Xt,[e(J).includes(o.id)?(s(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:r(u=>e(P)(u,o,c),["stop"]),checked:e(be)},null,8,Yt)):(s(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:r(u=>e(P)(u,o,c),["stop"]),checked:e(y).includes(o.id)},null,8,Zt)),i("span",es,[d(Me,{id:c+1,raw:o},null,8,["id","raw"])])]),i("div",ts,$(e(et)(o.title.split(`
`)[0].trimStart())||t.$t("meta_no_title")),1),i("div",ss,[d(Ee,{tags:o.tags,type:e(S),"only-links":!0},null,8,["tags","type"])]),i("div",os,[a.trash?(s(),l(N,{key:0},[g((s(),_(b,{class:"sm",onClick:r(u=>Ne(o),["stop","prevent"])},{icon:p(()=>[d(x)]),_:2},1032,["onClick"])),[[h,t.$t("delete")]]),g((s(),_(b,{class:"sm",onClick:r(u=>e(se)(`ids:${o.id}`),["stop","prevent"]),loading:e(te)(`ids:${o.id}`)},{icon:p(()=>[d(ie)]),_:2},1032,["onClick","loading"])),[[h,t.$t("restore")]])],64)):(s(),l(N,{key:1},[g((s(),_(b,{class:"sm",onClick:r(u=>e(ee)(`ids:${o.id}`),["stop","prevent"]),loading:e(Se)(`ids:${o.id}`)},{icon:p(()=>[d(ce)]),_:2},1032,["onClick","loading"])),[[h,t.$t("move_to_trash")]]),g((s(),_(b,{class:"sm",onClick:r(u=>$e(o),["stop","prevent"])},{icon:p(()=>[d(re)]),_:2},1032,["onClick"])),[[h,t.$t("add_to_tags")]])],64))]),i("div",as,[g((s(),l("span",null,[st($(e(ot)(o.updatedAt)),1)])),[[h,e(tt)(o.updatedAt)]])])],42,Wt)],8,Jt))]),footer:p(()=>[e(v)>I?(s(),_(xe,{key:0,page:Q.value,go:W,total:e(v),limit:I},null,8,["page","total"])):D("",!0)]),_:1},8,["data-sources","class"])):D("",!0),!e(H)&&m.value.length===0?(s(),l("div",ns,$(t.$t(e(nt)(e(H)))),1)):D("",!0)],64)}}}),ks=kt(ls,[["__scopeId","data-v-68f43b2b"]]);export{ks as default};
