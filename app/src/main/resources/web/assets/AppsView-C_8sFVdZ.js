import{_ as Ee}from"./VPagination.vuevuetypescriptsetuptruelang-C9URNuao.js";import{a0 as F,d as Pe,af as Fe,u as Me,h as P,g as Te,s as J,i as Ve,I as Ke,ag as Qe,J as ze,K as X,j as Ge,L as Ne,M as Re,c as l,a as n,m as t,t as i,x as m,w as u,p as r,e as W,V as $,q as Y,N as Z,O as S,P as ee,v as je,Q as He,f as Oe,C as xe,ah as Je,ai as Xe,aj as We,ak as Ye,al as Ze,S as et,o as a,E as tt,am as te,U as se,X as st,F as nt,G as ot,an as at,ao as lt,$ as it,ap as ct,a2 as dt,ad as pt,H as ut}from"./index-BxNI00MG.js";import{u as rt,_ as _t,a as ht,b as kt}from"./key-events-B5RXeznw.js";import{_ as mt}from"./sort-rounded-BbQ1dmh_.js";import{u as gt}from"./search-D1_YTViL.js";import"./rss-feed-rounded-Dj4EQ17i.js";const ne=p=>{F.emit("tap_phone",p)};function vt(p,I){const b=p.findIndex(w=>w.id===I);b!==-1&&p.splice(b,1)}const y=p=>(nt("data-v-9c476493"),p=p(),ot(),p),ft={class:"top-app-bar"},yt=["checked","indeterminate"],bt={class:"title"},wt={key:0},Ct={key:1},$t=y(()=>n("md-ripple",null,null,-1)),St={class:"actions"},It=y(()=>n("md-ripple",null,null,-1)),At={class:"btn-icon btn-sort"},Dt=y(()=>n("md-ripple",null,null,-1)),Lt={class:"menu-items"},Ut=["onClick","selected"],qt={slot:"headline"},Bt={class:"scroll-content"},Et=["onClick","onMouseover"],Pt={class:"start"},Ft=["onClick","checked"],Mt=["onClick","checked"],Tt={class:"number"},Vt=["src"],Kt={class:"title"},Qt={class:"subtitle"},zt={class:"actions"},Gt={indeterminate:"",class:"spinner-sm"},Nt=["onClick"],Rt=["onClick"],jt=y(()=>n("md-ripple",null,null,-1)),Ht=["onClick"],Ot=y(()=>n("md-ripple",null,null,-1)),xt={class:"time"},Jt={key:1,class:"no-data-placeholder"},g=50,Xt=Pe({__name:"AppsView",setup(p){var x;const{input:I,upload:b,uploadChanged:w}=Fe(),M=Me(),_=P([]),{t:A}=Te(),{appSortBy:D}=J(M),{app:oe,urlTokenKey:L}=J(Ve()),{parseQ:ae}=gt(),T=Ke({tagIds:[]}),le=at(),V=He(),K=V.query,U=P(parseInt(((x=K.page)==null?void 0:x.toString())??"1")),C=P(""),{selectedIds:v,allChecked:Q,realAllChecked:q,selectRealAll:ie,allCheckedAlertVisible:ce,clearSelection:B,toggleAllChecked:z,toggleSelect:G,total:h,checked:E,shiftEffectingIds:N,handleItemClick:de,handleMouseOver:pe,selectAll:ue,shouldSelect:re}=rt(_),{downloadItems:_e}=Qe(L,ze.PACKAGE,B,"apps.zip"),{downloadFile:he}=lt(L),R=e=>{const o=V.query.q;Oe(M,o?`/apps?page=${e}&q=${o}`:`/apps?page=${e}`)},{keyDown:j,keyUp:H}=kt(h,g,U,ue,B,R,()=>{}),ke=()=>{b(oe.value.downloadsDir)},me=["user","system"].map(e=>({id:e,name:A("app_type."+e)})),ge=e=>{e.isUninstalling=!1},{loading:ve,fetch:fe}=X({handle:(e,o)=>{o?xe(A(o),"error"):e&&(_.value=e.packages.map(f=>({...f,isUninstalling:!1,icon:Je(L.value,"pkgicon://"+f.id)})),h.value=e.packageCount)},document:Xe,variables:()=>({offset:(U.value-1)*g,limit:g,query:C.value,sortBy:D.value}),appApi:!0});function ye(e){return e?`/apps?q=${e}`:"/apps"}function be(e,o){D.value=o,e.close()}const{mutate:we}=Ge({document:We,appApi:!0});function Ce(e){e.isUninstalling=!0,ne(A("confirm_uninstallation_on_phone")),we({id:e.id})}const{loading:$e,fetch:Se}=X({handle:e=>{if(e)for(const o of e.packageStatuses)o.exist||(vt(_.value,o.id),ne(""))},document:Ye,variables:()=>({ids:_.value.filter(e=>e.isUninstalling).map(e=>e.id)}),appApi:!0}),O=e=>{e.status};return Ne(()=>{var e;setInterval(()=>{_.value.some(o=>o.isUninstalling)&&!$e.value&&Se()},1e3),C.value=it(((e=K.q)==null?void 0:e.toString())??""),ae(T,C.value),fe(),F.on("upload_task_done",O),window.addEventListener("keydown",j),window.addEventListener("keyup",H)}),Re(()=>{F.off("upload_task_done",O),window.removeEventListener("keydown",j),window.removeEventListener("keyup",H)}),(e,o)=>{const f=ct,Ie=_t,Ae=mt,De=Ze,Le=ht,Ue=dt,qe=pt,Be=Ee,k=et("tooltip");return a(),l(S,null,[n("div",ft,[n("md-checkbox",{"touch-target":"wrapper",onChange:o[0]||(o[0]=(...s)=>t(z)&&t(z)(...s)),checked:t(Q),indeterminate:!t(Q)&&t(E)},null,40,yt),n("div",bt,[t(v).length?(a(),l("span",wt,i(e.$t("x_selected",{count:t(q)?t(h).toLocaleString():t(v).length.toLocaleString()})),1)):(a(),l("span",Ct,i(e.$t("page_title.apps"))+" ("+i(t(h).toLocaleString())+")",1)),t(E)?m((a(),l("button",{key:2,class:"btn-icon",onClick:o[1]||(o[1]=u(s=>t(_e)(t(q),t(v),C.value),["stop"]))},[$t,r(f)])),[[k,e.$t("download")]]):W("",!0)]),n("div",St,[r(Ie,{filter:T,types:t(me),"get-url":ye},null,8,["filter","types"]),n("button",{class:"btn-icon",onClick:u(ke,["stop"]),style:{display:"none"}},[It,$(" "+i(e.$t("install")),1)]),r(De,null,{content:Y(s=>[n("div",Lt,[(a(!0),l(S,null,ee(t(le),d=>(a(),l("md-menu-item",{onClick:c=>be(s,d.value),key:d.value,selected:d.value===t(D)},[n("div",qt,i(e.$t(d.label)),1)],8,Ut))),128))])]),default:Y(()=>[m((a(),l("button",At,[Dt,r(Ae)])),[[k,e.$t("sort")]])]),_:1})])]),r(Le,{limit:g,total:t(h),"all-checked-alert-visible":t(ce),"real-all-checked":t(q),"select-real-all":t(ie),"clear-selection":t(B)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),n("div",Bt,[_.value.length>0?(a(),l("div",{key:0,class:Z(["app-list",{"select-mode":t(E)}])},[(a(!0),l(S,null,ee(_.value,(s,d)=>(a(),l("section",{class:Z(["app-item selectable-card",{selected:t(v).includes(s.id),selecting:t(N).includes(s.id)}]),key:s.id,onClick:u(c=>t(de)(c,s,d,()=>{}),["stop"]),onMouseover:c=>t(pe)(c,d)},[n("div",Pt,[t(N).includes(s.id)?(a(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:u(c=>t(G)(c,s,d),["stop"]),checked:t(re)},null,8,Ft)):(a(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:u(c=>t(G)(c,s,d),["stop"]),checked:t(v).includes(s.id)},null,8,Mt)),n("span",Tt,[r(Ue,{id:d+1,raw:s},null,8,["id","raw"])])]),n("img",{class:"image",width:"50",height:"50",src:s.icon},null,8,Vt),n("div",Kt,i(s.name)+" ("+i(s.version)+")",1),n("div",Qt,[n("span",null,i(s.id),1),n("span",null,i(t(tt)(s.size)),1),n("span",null,i(e.$t("app_type."+s.type)),1)]),n("div",zt,[s.isUninstalling?(a(),l(S,{key:0},[m(n("md-circular-progress",Gt,null,512),[[k,e.$t("uninstalling")]]),$(" Â "),n("md-outlined-button",{class:"btn-sm",onClick:u(c=>ge(s),["stop"])},i(e.$t("cancel")),9,Nt)],64)):m((a(),l("button",{key:1,class:"btn-icon sm",onClick:u(c=>Ce(s),["stop"])},[jt,r(qe)],8,Rt)),[[k,e.$t("uninstall")]]),m((a(),l("button",{class:"btn-icon sm",onClick:u(c=>t(he)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},[Ot,r(f)],8,Ht)),[[k,e.$t("download")]])]),n("div",xt,[m((a(),l("span",null,[$(i(e.$t("installed_at"))+": "+i(t(se)(s.installedAt)),1)])),[[k,t(te)(s.installedAt)]]),m((a(),l("span",null,[$(i(e.$t("updated_at"))+": "+i(t(se)(s.updatedAt)),1)])),[[k,t(te)(s.updatedAt)]])])],42,Et))),128))],2)):(a(),l("div",Jt,i(e.$t(t(st)(t(ve)))),1)),t(h)>g?(a(),je(Be,{key:2,page:U.value,go:R,total:t(h),limit:g},null,8,["page","total"])):W("",!0),n("input",{ref_key:"fileInput",ref:I,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:o[2]||(o[2]=(...s)=>t(w)&&t(w)(...s))},null,544)])],64)}}}),ns=ut(Xt,[["__scopeId","data-v-9c476493"]]);export{ns as default};
