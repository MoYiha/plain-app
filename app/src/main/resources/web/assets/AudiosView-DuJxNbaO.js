import{_ as Nt}from"./VPagination.vuevuetypescriptsetuptruelang-CEZVU5HQ.js";import{m as Je,c as g,o as a,a as l,i as _e,b6 as zt,b7 as Qt,s as me,g as Ye,u as Ze,a5 as C,aN as xe,E as ve,r as M,b8 as Ht,e as Kt,f as Gt,I as Ot,ah as Oe,ai as jt,J as Wt,K as Xt,aM as Jt,aO as Yt,aj as Zt,L as xt,aQ as es,aR as ts,M as ss,N as os,k as n,l as e,O as as,j as Y,t as h,U as V,P as u,Q as ns,S as d,p as r,y as i,aS as de,aT as re,al as ls,am as is,T as ue,V as ce,W as ds,aU as rs,aw as us,b9 as cs,a8 as ps,aX as _s,ak as ms,aY as vs,R as gs,as as fs,b3 as ks,aI as ys,n as hs,aa as bs,a_ as $s,$ as Cs,au as Ts,aP as je,ba as Is,Z as ws,a0 as Es,F as As,a1 as Ds,d as qs,A as Ss,bb as We,a2 as Fs,a3 as Ps,b0 as Xe,a4 as Vs,H as Ms}from"./index-CuU5w3Fk.js";import{_ as Rs}from"./FieldId.vuevuetypescriptsetuptruelang-BAr-ccW2.js";import{_ as Ls,a as Bs}from"./SearchInput-Do4mYLNe.js";import{_ as Us,a as Ns}from"./upload-rounded-Bty2yz0H.js";import{_ as zs}from"./MediaKeyboardShortcuts.vuevuetypescriptsetuptruelang-DEaP1BqB.js";import{u as Qs}from"./search-cTEMyIe9.js";import{u as Hs,a as Ks}from"./key-events-CMYOn2tc.js";import{a as Gs}from"./tags-C_c-1fHE.js";import"./VInputChip-Cze1-7DF.js";const Os={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function js(w,y){return a(),g("svg",Os,y[0]||(y[0]=[l("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V9q0-.425-.288-.712T10 8t-.712.288T9 9v6q0 .425.288.713T10 16m4 0q.425 0 .713-.288T15 15V9q0-.425-.288-.712T14 8t-.712.288T13 9v6q0 .425.288.713T14 16m-2 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const Ws=Je({name:"material-symbols-pause-circle-outline-rounded",render:js}),Xs={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Js(w,y){return a(),g("svg",Xs,y[0]||(y[0]=[l("path",{fill:"currentColor",d:"M3 16v-2h7v2zm0-4v-2h11v2zm0-4V6h11v2zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4z"},null,-1)]))}const Ys=Je({name:"material-symbols-playlist-add",render:Js});function pe(w,y,E=500){const v=w.cloneNode(!0),b=w.getBoundingClientRect(),R=y.getBoundingClientRect();v.style.position="absolute",v.style.top=b.top+"px",v.style.left=b.left+"px",v.style.opacity=1,document.body.appendChild(v);let $=0;function A(B){$||($=B);const U=B-$,F=Math.min(U/E,1);v.style.top=b.top+(R.top-b.top)*F+"px",v.style.left=b.left+(R.left-b.left)*F+"px",F<1?requestAnimationFrame(A):document.body.removeChild(v)}requestAnimationFrame(A)}const Zs=(w,y)=>{const{mutate:E,loading:v,onDone:b}=_e({document:zt}),{mutate:R,loading:$,onDone:A}=_e({document:Qt}),{app:B}=me(Ye()),{t:U}=Ze();b(()=>{C.emit("refetch_app"),y()}),A(()=>{C.emit("refetch_app")});const F=xe(()=>{var f;return((f=B.value)==null?void 0:f.audios)??[]}),W=f=>F.value.some(k=>k.path===f.path);return{loading:v,removeLoading:$,isInPlaylist:W,addItemsToPlaylist:(f,k,P,N)=>{let z=N;if(!P){if(k.length===0){ve(U("select_first"),"error");return}z=`ids:${k.join(",")}`}const Q=f.target,L=document.getElementById("quick-audio");pe(Q,L),E({query:z})},removeItemsFromPlaylist:(f,k,P,N)=>{if(P)w.value.filter(L=>W(L)).forEach(L=>{R({path:L.path})});else{if(k.length===0){ve(U("select_first"),"error");return}w.value.filter(H=>k.includes(H.id)&&W(H)).forEach(H=>{R({path:H.path})})}const z=f.target,Q=document.getElementById("quick-audio");pe(z,Q)},addToPlaylist:(f,k)=>{const P=f.target,N=document.getElementById("quick-audio");pe(P,N),E({query:`ids:${k.id}`})},removeFromPlaylist:(f,k)=>{R({path:k.path})}}},xs=()=>{const w=M(""),{mutate:y,loading:E,onDone:v}=_e({document:Ht});return v(()=>{C.emit("play_audio")}),{loading:E,playPath:w,play:b=>{w.value=b.path,y({path:b.path})},pause:()=>{C.emit("pause_audio")}}},eo={class:"top-app-bar"},to={class:"title"},so={key:0},oo={key:1},ao={class:"actions"},no=["onClick"],lo=["onClick","onMouseover"],io={class:"start"},ro={class:"number"},uo={class:"image"},co=["src"],po=["src","onError"],_o={class:"title"},mo={class:"subtitle"},vo={class:"duration"},go=["onClick"],fo={class:"actions"},ko={class:"artist"},yo={class:"time"},ho={class:"start"},bo={class:"number"},$o={key:0,class:"no-data-placeholder"},j=50,Co=Kt({__name:"AudiosView",setup(w){var Be;const y=Gt(),{audioSortBy:E}=me(y),v=M([]),{t:b}=Ze(),{parseQ:R}=Qs(),$=Ot({tagIds:[],bucketId:void 0}),{app:A,urlTokenKey:B,audioPlaying:U,uploads:F}=me(Ye()),W=t=>{var o;return U.value&&((o=A.value)==null?void 0:o.audioCurrent)===t.path},f=M([]),k=M(!1),P=M(!1),{input:N,upload:z,uploadChanged:Q}=Oe(F),{input:L,upload:H,uploadChanged:ge}=Oe(F),{dropping:et,fileDragEnter:fe,fileDragLeave:ke,dropFiles:tt}=jt(F),te=M(!1),m=Wt.AUDIO,ye=Xt(),he=ye.query,se=M(parseInt(((Be=he.page)==null?void 0:Be.toString())??"1")),{tags:Z,buckets:x,fetch:st}=Jt(m),ot=xe(()=>{const t={};return x.value.forEach(o=>{t[o.id]=o}),t}),D=M(""),{addToTags:at}=Gs(m,Z),{deleteItems:oe,deleteItem:be}=Yt(),{view:nt}=$s(m),{selectedIds:T,allChecked:$e,realAllChecked:q,selectRealAll:lt,allCheckedAlertVisible:it,clearSelection:K,toggleAllChecked:dt,toggleSelect:Ce,total:S,checked:ae,shiftEffectingIds:Te,handleItemClick:rt,handleMouseOver:ut,selectAll:ct,shouldSelect:pt}=Hs(v),{downloadItems:Ie}=Zt(B,m,K,()=>us("audios")),{downloadFile:we}=Ts(B),Ee=t=>{const o=ye.query.q;Ss(y,o?`/audios?page=${t}&q=${o}`:`/audios?page=${t}`)},{keyDown:Ae,keyUp:De}=Ks(S,j,se,ct,K,Ee,()=>{de(re.MEDIA_TRASH,A.value.osVersion)?le(m,J()):oe(m,T.value,q.value,S.value,D.value)}),{addItemsToPlaylist:_t,addToPlaylist:mt,removeFromPlaylist:vt,isInPlaylist:gt}=Zs(v,K),ft=fs(),qe=M([]),{play:kt,playPath:yt,loading:ht,pause:bt}=xs(),$t=t=>{qe.value.push(t)},{loading:ne,fetch:X}=xt({handle:(t,o)=>{te.value=!1,o?ve(b(o),"error"):t&&(v.value=t.items,S.value=t.total)},document:cs,variables:()=>({offset:(se.value-1)*j,limit:j,query:D.value,sortBy:E.value})}),{trashLoading:Se,trash:le}=es(),{restoreLoading:Fe,restore:Pe}=ts();function Ct(t){return t?`/audios?q=${t}`:"/audios"}function Tt(t){E.value!==t&&(te.value=!0,E.value=t)}function ie(){const t=x.value.find(o=>o.id===$.bucketId);return t?Xe(t.topItems[0]):`${A.value.internalStoragePath}/Music`}function It(){z(ie())}function wt(){H(ie())}function Et(t){tt(t,ie(),o=>We(o.name))}const J=()=>{let t=D.value;return q.value||(t=`ids:${T.value.join(",")}`),t},Ve=t=>{t.type===m&&(K(),X())},Me=t=>{t.type===m&&X()},Re=t=>{t.type===m&&(K(),X())},Le=t=>{t.status==="done"&&We(t.fileName)&&((!$.bucketId||x.value.some(I=>I.id===$.bucketId&&I.topItems.some(G=>t.dir.startsWith(Xe(G)))))&&setTimeout(()=>{X()},1e3),C.emit("media_items_actioned",{type:m,action:"upload",query:""}))};function At(t){const o=t.tags.map(I=>I.id);Fs(Ps,{type:m,tags:Z.value,item:{key:t.id,title:t.title,size:t.size},selected:Z.value.filter(I=>o.includes(I.id))})}function Dt(t,o){f.value.push(o.id),setTimeout(()=>{vt(t,o),setTimeout(()=>{f.value=f.value.filter(I=>I!==o.id)},300)},150)}return ss(()=>{var t;D.value=Vs(((t=he.q)==null?void 0:t.toString())??""),R($,D.value),st(),X(),C.on("item_tags_updated",Me),C.on("items_tags_updated",Ve),C.on("media_items_actioned",Re),C.on("upload_task_done",Le),window.addEventListener("keydown",Ae),window.addEventListener("keyup",De)}),os(()=>{C.off("item_tags_updated",Me),C.off("items_tags_updated",Ve),C.off("media_items_actioned",Re),C.off("upload_task_done",Le),window.removeEventListener("keydown",Ae),window.removeEventListener("keyup",De)}),(t,o)=>{const I=as,G=ps,c=rs,Ue=_s,ee=ms,Ne=vs,ze=Ys,Qe=gs,qt=Ls,St=zs,Ft=Us,He=ls,Pt=Ns,Vt=Bs,Mt=Rs,Rt=Cs,Ke=Is,Lt=ws,Bt=Ws,Ut=Nt,p=ns("tooltip");return a(),g(V,null,[l("div",eo,[n(I,{"touch-target":"wrapper",checked:e($e),indeterminate:!e($e)&&e(ae),onChange:e(dt)},null,8,["checked","indeterminate","onChange"]),l("div",to,[e(T).length?(a(),g("span",so,h(t.$t("x_selected",{count:e(q)?e(S).toLocaleString():e(T).length.toLocaleString()})),1)):(a(),g("span",oo,h(t.$t("page_title.audios"))+" ("+h(e(S).toLocaleString())+")",1)),e(ae)?(a(),g(V,{key:2},[$.trash?(a(),g(V,{key:0},[u((a(),d(c,{onClick:o[0]||(o[0]=i(s=>e(oe)(e(m),e(T),e(q),e(S),D.value),["stop"]))},{default:r(()=>[n(G)]),_:1})),[[p,t.$t("delete")]]),u((a(),d(c,{loading:e(Fe)(J()),onClick:o[1]||(o[1]=i(s=>e(Pe)(e(m),J()),["stop"]))},{default:r(()=>[n(Ue)]),_:1},8,["loading"])),[[p,t.$t("restore")]]),u((a(),d(c,{onClick:o[2]||(o[2]=i(s=>e(Ie)(e(q),e(T),D.value),["stop"]))},{default:r(()=>[n(ee)]),_:1})),[[p,t.$t("download")]])],64)):(a(),g(V,{key:1},[e(de)(e(re).MEDIA_TRASH,e(A).osVersion)?u((a(),d(c,{key:0,loading:e(Se)(J()),onClick:o[3]||(o[3]=i(s=>e(le)(e(m),J()),["stop"]))},{default:r(()=>[n(Ne)]),_:1},8,["loading"])),[[p,t.$t("move_to_trash")]]):u((a(),d(c,{key:1,onClick:o[4]||(o[4]=i(s=>e(oe)(e(m),e(T),e(q),e(S),D.value),["stop"]))},{default:r(()=>[n(G)]),_:1})),[[p,t.$t("delete")]]),u((a(),d(c,{onClick:o[5]||(o[5]=i(s=>e(Ie)(e(q),e(T),D.value),["stop"]))},{default:r(()=>[n(ee)]),_:1})),[[p,t.$t("download")]]),u((a(),d(c,{onClick:o[6]||(o[6]=i(s=>e(_t)(s,e(T),e(q),D.value),["stop"]))},{default:r(()=>[n(ze)]),_:1})),[[p,t.$t("add_to_playlist")]]),u((a(),d(c,{onClick:o[7]||(o[7]=i(s=>e(at)(e(T),e(q),D.value),["stop"]))},{default:r(()=>[n(Qe)]),_:1})),[[p,t.$t("add_to_tags")]])],64))],64)):Y("",!0)]),l("div",ao,[n(qt,{filter:$,tags:e(Z),buckets:e(x),"get-url":Ct},null,8,["filter","tags","buckets"]),n(St),n(He,{modelValue:k.value,"onUpdate:modelValue":o[10]||(o[10]=s=>k.value=s)},{trigger:r(()=>[u((a(),d(c,null,{default:r(()=>[n(Ft)]),_:1})),[[p,t.$t("upload")]])]),default:r(()=>[l("div",{class:"dropdown-item",onClick:o[8]||(o[8]=i(s=>{It(),k.value=!1},["stop"]))},h(t.$t("upload_files")),1),l("div",{class:"dropdown-item",onClick:o[9]||(o[9]=i(s=>{wt(),k.value=!1},["stop"]))},h(t.$t("upload_folder")),1)]),_:1},8,["modelValue"]),n(He,{modelValue:P.value,"onUpdate:modelValue":o[11]||(o[11]=s=>P.value=s)},{trigger:r(()=>[u((a(),d(c,{loading:te.value},{default:r(()=>[n(Pt)]),_:1},8,["loading"])),[[p,t.$t("sort")]])]),default:r(()=>[(a(!0),g(V,null,ce(e(ft),s=>(a(),g("div",{key:s.value,class:ue(["dropdown-item",{selected:s.value===e(E)}]),onClick:O=>{Tt(s.value),P.value=!1}},h(t.$t(s.label)),11,no))),128))]),_:1},8,["modelValue"])])]),n(Vt,{limit:j,total:e(S),"all-checked-alert-visible":e(it),"real-all-checked":e(q),"select-real-all":e(lt),"clear-selection":e(K)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),l("div",{class:"scroll-content",onDragover:o[16]||(o[16]=i((...s)=>e(fe)&&e(fe)(...s),["stop","prevent"]))},[u(l("div",{class:"drag-mask",onDrop:i(Et,["stop","prevent"]),onDragleave:o[12]||(o[12]=i((...s)=>e(ke)&&e(ke)(...s),["stop","prevent"]))},h(t.$t("release_to_send_files")),545),[[is,e(et)]]),l("div",{class:ue(["audio-list",{"select-mode":e(ae)}])},[(a(!0),g(V,null,ce(v.value,(s,O)=>{var Ge;return a(),g("section",{key:s.id,class:ue(["media-item selectable-card",{selected:e(T).includes(s.id),selecting:e(Te).includes(s.id)}]),onClick:i(_=>e(rt)(_,s,O,()=>{e(kt)(s)}),["stop"]),onMouseover:_=>e(ut)(_,O)},[l("div",io,[e(Te).includes(s.id)?(a(),d(I,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(pt),onClick:i(_=>e(Ce)(_,s,O),["stop"])},null,8,["checked","onClick"])):(a(),d(I,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(T).includes(s.id),onClick:i(_=>e(Ce)(_,s,O),["stop"])},null,8,["checked","onClick"])),l("span",ro,[n(Mt,{id:O+1,raw:s},null,8,["id","raw"])])]),l("div",uo,[qe.value.includes(s.id)?(a(),g("img",{key:0,src:`/ficons/${e(ks)(s.path)}.svg`,class:"svg"},null,8,co)):(a(),g("img",{key:1,class:"image-thumb",src:e(ys)(s.albumFileId,"&w=200&h=200"),onError:_=>$t(s.id)},null,40,po))]),l("div",_o,h(s.title),1),l("div",mo,[l("span",null,h(e(hs)(s.size)),1),l("span",vo,h(e(bs)(s.duration)),1),l("a",{onClick:i(_=>e(nt)(e(y),s.bucketId),["stop","prevent"])},h((Ge=ot.value[s.bucketId])==null?void 0:Ge.name),9,go),n(Rt,{tags:s.tags,type:e(m),"only-links":!0},null,8,["tags","type"])]),l("div",fo,[$.trash?(a(),g(V,{key:0},[u((a(),d(c,{class:"sm",onClick:i(_=>e(be)(e(m),s),["stop"])},{default:r(()=>[n(G)]),_:2},1032,["onClick"])),[[p,t.$t("delete")]]),u((a(),d(c,{class:"sm",loading:e(Fe)(`ids:${s.id}`),onClick:i(_=>e(Pe)(e(m),`ids:${s.id}`),["stop"])},{default:r(()=>[n(Ue)]),_:2},1032,["loading","onClick"])),[[p,t.$t("restore")]]),u((a(),d(c,{class:"sm",onClick:i(_=>e(we)(s.path,e(je)(s.path).replace(" ","-")),["stop"])},{default:r(()=>[n(ee)]),_:2},1032,["onClick"])),[[p,t.$t("download")]])],64)):(a(),g(V,{key:1},[e(de)(e(re).MEDIA_TRASH,e(A).osVersion)?u((a(),d(c,{key:0,class:"sm",loading:e(Se)(`ids:${s.id}`),onClick:i(_=>e(le)(e(m),`ids:${s.id}`),["stop"])},{default:r(()=>[n(Ne)]),_:2},1032,["loading","onClick"])),[[p,t.$t("move_to_trash")]]):u((a(),d(c,{key:1,class:"sm",onClick:i(_=>e(be)(e(m),s),["stop"])},{default:r(()=>[n(G)]),_:2},1032,["onClick"])),[[p,t.$t("delete")]]),u((a(),d(c,{class:"sm",onClick:i(_=>e(we)(s.path,e(je)(s.path).replace(" ","-")),["stop"])},{default:r(()=>[n(ee)]),_:2},1032,["onClick"])),[[p,t.$t("download")]]),e(gt)(s)&&!f.value.includes(s.id)?u((a(),d(c,{key:2,class:"sm",onClick:i(_=>Dt(_,s),["stop","prevent"])},{default:r(()=>[n(Ke,{class:"playlist-remove-icon"})]),_:2},1032,["onClick"])),[[p,t.$t("remove_from_playlist")]]):f.value.includes(s.id)?(a(),d(c,{key:3,class:"sm",disabled:!0},{default:r(()=>[n(Ke,{class:"playlist-remove-icon rotating"})]),_:1})):u((a(),d(c,{key:4,class:"sm",onClick:i(_=>e(mt)(_,s),["stop","prevent"])},{default:r(()=>[n(ze)]),_:2},1032,["onClick"])),[[p,t.$t("add_to_playlist")]]),u((a(),d(c,{class:"sm",onClick:i(_=>At(s),["stop"])},{default:r(()=>[n(Qe)]),_:2},1032,["onClick"])),[[p,t.$t("add_to_tags")]])],64)),e(ht)&&s.path===e(yt)?(a(),d(Lt,{key:2,indeterminate:"",class:"sm"})):W(s)?u((a(),d(c,{key:3,class:"sm",onClick:o[13]||(o[13]=i(_=>e(bt)(),["stop"]))},{default:r(()=>[n(Bt)]),_:1})),[[p,t.$t("pause")]]):Y("",!0)]),l("div",ko,h(s.artist),1),l("div",yo,[u((a(),g("span",null,[As(h(e(Ds)(s.createdAt)),1)])),[[p,e(Es)(s.createdAt)]])])],42,lo)}),128)),e(ne)&&v.value.length===0?(a(),g(V,{key:0},ce(20,s=>l("section",{key:s,class:"media-item selectable-card-skeleton"},[l("div",ho,[o[17]||(o[17]=l("div",{class:"checkbox"},[l("div",{class:"skeleton-checkbox"})],-1)),l("span",bo,h(s),1)]),o[18]||(o[18]=qs('<div class="image" data-v-517b9923><div class="skeleton-image" data-v-517b9923></div></div><div class="title" data-v-517b9923><div class="skeleton-text skeleton-title" data-v-517b9923></div></div><div class="subtitle" data-v-517b9923><div class="skeleton-text skeleton-subtitle" data-v-517b9923></div></div><div class="actions" data-v-517b9923><div class="skeleton-text skeleton-actions" data-v-517b9923></div></div><div class="artist" data-v-517b9923><div class="skeleton-text skeleton-artist" data-v-517b9923></div></div><div class="time" data-v-517b9923><div class="skeleton-text skeleton-time" data-v-517b9923></div></div>',6))])),64)):Y("",!0)],2),!e(ne)&&v.value.length===0?(a(),g("div",$o,h(t.$t(e(ds)(e(ne),e(A).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):Y("",!0),e(S)>j?(a(),d(Ut,{key:1,page:se.value,go:Ee,total:e(S),limit:j},null,8,["page","total"])):Y("",!0),l("input",{ref_key:"fileInput",ref:N,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",onChange:o[14]||(o[14]=(...s)=>e(Q)&&e(Q)(...s))},null,544),l("input",{ref_key:"dirFileInput",ref:L,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:o[15]||(o[15]=(...s)=>e(ge)&&e(ge)(...s))},null,544)],32)],64)}}}),Vo=Ms(Co,[["__scopeId","data-v-517b9923"]]);export{Vo as default};
