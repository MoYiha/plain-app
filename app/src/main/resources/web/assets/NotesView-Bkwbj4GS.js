import{_ as Ve}from"./VPagination.vuevuetypescriptsetuptruelang-C9URNuao.js";import{o as s,c as o,a,d as Me,u as ze,h as z,g as Ee,I as Qe,J as Ue,K as Be,j as se,a0 as S,L as Ge,M as Ke,m as t,t as y,O as b,x as p,w as i,p as c,e as L,v as oe,q as ne,N as ae,Q as He,C as E,b3 as Re,b4 as je,b5 as Oe,S as Fe,b6 as Pe,U as Je,V as We,W as Xe,X as Ye,F as Ze,G as xe,f as le,Y as ie,Z as et,b7 as tt,a$ as st,ab as ot,ac as nt,a5 as ce,$ as at,ad as lt,a1 as it,a2 as ct,a3 as rt,H as dt}from"./index-BxNI00MG.js";import{u as ut,c as _t,_ as pt,a as ht,d as mt,b as vt}from"./key-events-B5RXeznw.js";import{u as gt,a as ft}from"./tags-BUfgTqH4.js";import{u as kt}from"./search-D1_YTViL.js";import{V as yt}from"./virtual-list-DocfBp0t.js";import"./rss-feed-rounded-Dj4EQ17i.js";import"./vee-validate.esm-9czZ1sUw.js";const bt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},$t=a("path",{fill:"currentColor",d:"M7 21q-.825 0-1.412-.587T5 19V6q-.425 0-.712-.288T4 5t.288-.712T5 4h4q0-.425.288-.712T10 3h4q.425 0 .713.288T15 4h4q.425 0 .713.288T20 5t-.288.713T19 6v13q0 .825-.587 1.413T17 21zM17 6H7v13h10zM7 6v13zm4 5.85V15q0 .425.288.713T12 16t.713-.288T13 15v-3.15l.9.875q.275.275.688.275t.712-.3q.275-.275.275-.7t-.275-.7l-2.6-2.6q-.3-.3-.7-.3t-.7.3l-2.6 2.6q-.275.275-.287.688t.287.712q.275.275.688.288t.712-.263z"},null,-1),qt=[$t];function Ct(C,D){return s(),o("svg",bt,[...qt])}const wt={name:"material-symbols-restore-from-trash-outline-rounded",render:Ct},m=C=>(Ze("data-v-f2333052"),C=C(),xe(),C),Tt={class:"top-app-bar"},St=["checked","indeterminate"],Nt={class:"title"},At={key:0},It={key:1},Lt=m(()=>a("md-ripple",null,null,-1)),Dt=m(()=>a("md-ripple",null,null,-1)),Vt=m(()=>a("md-ripple",null,null,-1)),Mt=m(()=>a("md-ripple",null,null,-1)),zt={class:"actions"},Et=["href"],Qt=["onClick","onMouseover"],Ut={class:"start"},Bt=["onClick","checked"],Gt=["onClick","checked"],Kt={class:"number"},Ht={class:"title"},Rt={class:"subtitle"},jt={class:"actions"},Ot=["onClick"],Ft=m(()=>a("md-ripple",null,null,-1)),Pt=["onClick"],Jt=m(()=>a("md-ripple",null,null,-1)),Wt=["onClick"],Xt=m(()=>a("md-ripple",null,null,-1)),Yt=["onClick"],Zt=m(()=>a("md-ripple",null,null,-1)),xt={class:"time"},es={key:1,class:"no-data-placeholder"},q=50,ts=Me({__name:"NotesView",setup(C){var Z;const D=ze(),w=z([]),{t:V}=Ee(),{parseQ:re}=kt(),v=Qe({tagIds:[],trash:!1}),g=Ue.NOTE,Q=He(),U=Q.query,M=z(parseInt(((Z=U.page)==null?void 0:Z.toString())??"1")),f=z(""),{tags:N,fetch:de}=gt(g),{selectedIds:r,allChecked:B,realAllChecked:T,selectRealAll:ue,allCheckedAlertVisible:_e,clearSelection:k,toggleAllChecked:G,toggleSelect:K,total:h,checked:A,shiftEffectingIds:H,handleItemClick:pe,handleMouseOver:he,selectAll:me,shouldSelect:ve}=ut(w),{addToTags:ge}=ft(g,N),R=e=>{const l=Q.query.q;le(D,l?`/notes?page=${e}&q=${l}`:`/notes?page=${e}`)},{keyDown:j,keyUp:O}=vt(h,q,M,me,k,R,()=>{P(T.value,r.value,f.value)}),{loading:fe,fetch:$}=Be({handle:(e,l)=>{l?E(V(l),"error"):e&&(w.value=e.notes,h.value=e.noteCount)},document:Re,variables:()=>({offset:(M.value-1)*q,limit:q,query:f.value?f.value:"trash:false"}),appApi:!0});function ke(e){ie(et,{type:g,tags:N.value,item:{key:e.id,title:"",size:0},selected:N.value.filter(l=>e.tags.some(I=>I.id===l.id))})}function ye(e){return e?`/notes?q=${e}`:"/notes"}const{mutate:F,onDone:be}=se({document:je,appApi:!0});function $e(){if(r.value.length===0){E(V("select_first"),"error");return}F({query:`ids:${r.value.join(",")}`})}const{deleteItems:P}=_t(tt,()=>{k(),$()});be(()=>{k(),$(),w.value.some(e=>e.tags.length)&&S.emit("refetch_tags",g)});const{mutate:J,onDone:qe}=se({document:Oe,appApi:!0});function Ce(){if(r.value.length===0){E(V("select_first"),"error");return}J({query:`ids:${r.value.join(",")}`})}qe(()=>{k(),$()});function we(e){ie(nt,{id:e.id,name:st(e.title,{length:20}),gql:ot`
      mutation DeleteNote($query: String!) {
        deleteNotes(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),done:()=>{k(),h.value--},appApi:!0,typeName:"Note"})}function Te(e){le(D,W(e))}function W(e){const l=ce.currentRoute.value.query.q;return l?`/notes/${e.id}?q=${l}`:`/notes/${e.id}`}function Se(){ce.push("/notes/create")}const X=e=>{e.type===g&&(k(),$())},Y=e=>{e.type===g&&$()};return Ge(()=>{var e;f.value=at(((e=U.q)==null?void 0:e.toString())??""),re(v,f.value),v.trash===void 0&&(v.trash=!1),de(),$(),S.on("item_tags_updated",Y),S.on("items_tags_updated",X),window.addEventListener("keydown",j),window.addEventListener("keyup",O)}),Ke(()=>{S.off("item_tags_updated",Y),S.off("items_tags_updated",X),window.removeEventListener("keydown",j),window.removeEventListener("keyup",O)}),(e,l)=>{const I=lt,x=wt,ee=mt,te=it,Ne=pt,Ae=ht,Ie=ct,Le=rt,De=Ve,u=Fe("tooltip");return s(),o(b,null,[a("div",Tt,[a("md-checkbox",{"touch-target":"wrapper",onChange:l[0]||(l[0]=(..._)=>t(G)&&t(G)(..._)),checked:t(B),indeterminate:!t(B)&&t(A)},null,40,St),a("div",Nt,[t(r).length?(s(),o("span",At,y(e.$t("x_selected",{count:t(T)?t(h).toLocaleString():t(r).length.toLocaleString()})),1)):(s(),o("span",It,y(e.$t("page_title.notes"))+" ("+y(t(h).toLocaleString())+")",1)),v.trash?(s(),o(b,{key:2},[t(A)?(s(),o(b,{key:0},[p((s(),o("button",{class:"btn-icon",onClick:l[1]||(l[1]=i(_=>t(P)(t(T),t(r),f.value),["stop"]))},[Lt,c(I)])),[[u,e.$t("delete")]]),p((s(),o("button",{class:"btn-icon",onClick:i(Ce,["stop"])},[Dt,c(x)])),[[u,e.$t("restore")]])],64)):L("",!0)],64)):(s(),o(b,{key:3},[t(A)?(s(),o(b,{key:0},[p((s(),o("button",{class:"btn-icon",onClick:i($e,["stop"])},[Vt,c(ee)])),[[u,e.$t("move_to_trash")]]),p((s(),o("button",{class:"btn-icon",onClick:l[2]||(l[2]=i(_=>t(ge)(t(r),t(T),f.value),["stop"]))},[Mt,c(te)])),[[u,e.$t("add_to_tags")]])],64)):L("",!0)],64))]),a("div",zt,[c(Ne,{filter:v,tags:t(N),"get-url":ye,"show-trash":!0},null,8,["filter","tags"]),v.trash?L("",!0):(s(),o("md-outlined-button",{key:0,class:"btn-sm",onClick:i(Se,["prevent"])},y(e.$t("create")),1))])]),c(Ae,{limit:q,total:t(h),"all-checked-alert-visible":t(_e),"real-all-checked":t(T),"select-real-all":t(ue),"clear-selection":t(k)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),w.value.length?(s(),oe(t(yt),{key:0,class:ae(["scroller",{"select-mode":t(A)}]),"data-key":"id","data-sources":w.value,"estimate-size":100},{item:ne(({index:_,item:n})=>[(s(),o("a",{class:"item-link",key:n.id,href:W(n)},[a("article",{class:ae(["note-item selectable-card",{selected:t(r).includes(n.id)||n.id==e.$route.params.id,selecting:t(H).includes(n.id)}]),onClick:i(d=>t(pe)(d,n,_,()=>{Te(n)}),["stop","prevent"]),onMouseover:d=>t(he)(d,_)},[a("div",Ut,[t(H).includes(n.id)?(s(),o("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:i(d=>t(K)(d,n,_),["stop"]),checked:t(ve)},null,8,Bt)):(s(),o("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:i(d=>t(K)(d,n,_),["stop"]),checked:t(r).includes(n.id)},null,8,Gt)),a("span",Kt,[c(Ie,{id:_+1,raw:n},null,8,["id","raw"])])]),a("div",Ht,y(t(Pe)(n.title.split(`
`)[0].trimStart())||e.$t("meta_no_title")),1),a("div",Rt,[c(Le,{tags:n.tags,type:t(g),"only-links":!0},null,8,["tags","type"])]),a("div",jt,[v.trash?(s(),o(b,{key:0},[p((s(),o("button",{class:"btn-icon sm",onClick:i(d=>we(n),["stop","prevent"])},[Ft,c(I)],8,Ot)),[[u,e.$t("delete")]]),p((s(),o("button",{class:"btn-icon sm",onClick:i(d=>t(J)({query:`ids:${n.id}`}),["stop","prevent"])},[Jt,c(x)],8,Pt)),[[u,e.$t("restore")]])],64)):(s(),o(b,{key:1},[p((s(),o("button",{class:"btn-icon sm",onClick:i(d=>t(F)({query:`ids:${n.id}`}),["stop","prevent"])},[Xt,c(ee)],8,Wt)),[[u,e.$t("move_to_trash")]]),p((s(),o("button",{class:"btn-icon sm",onClick:i(d=>ke(n),["stop","prevent"])},[Zt,c(te)],8,Yt)),[[u,e.$t("add_to_tags")]])],64))]),a("div",xt,[p((s(),o("span",null,[We(y(t(Xe)(n.updatedAt)),1)])),[[u,t(Je)(n.updatedAt)]])])],42,Qt)],8,Et))]),footer:ne(()=>[t(h)>q?(s(),oe(De,{key:0,page:M.value,go:R,total:t(h),limit:q},null,8,["page","total"])):L("",!0)]),_:1},8,["data-sources","class"])):(s(),o("div",es,y(e.$t(t(Ye)(t(fe)))),1))],64)}}}),ds=dt(ts,[["__scopeId","data-v-f2333052"]]);export{ds as default};
