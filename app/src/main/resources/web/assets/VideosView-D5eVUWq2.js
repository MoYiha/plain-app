import{_ as Vo}from"./VPagination.vuevuetypescriptsetuptruelang-DZpCvrfT.js";import{_ as Ao,a as Mo,b as Fo,c as Lo,d as Ro}from"./grid-view-outline-rounded-CitVomxq.js";import{_ as Uo}from"./FieldId.vuevuetypescriptsetuptruelang-lzcc_jvg.js";import{e as zo,f as qo,s as Ke,r as M,u as Bo,I as No,g as Ho,ag as Pe,ah as Ko,J as Po,K as Qo,aL as Oo,aM as Qe,aN as Zo,ai as jo,aO as R,aH as me,L as Wo,aP as Go,aQ as Xo,M as Jo,N as Yo,c as r,o as t,a as v,k as a,l as e,j as U,t as f,T as h,O as _,P as xo,R as l,p as d,y as i,aR as J,aS as Y,ak as es,S as V,al as os,U as x,V as ss,aT as ts,av as ns,b1 as as,E as ls,aV as is,a7 as ds,aW as cs,aj as rs,aX as us,Q as _s,ar as ps,b2 as Oe,aY as vs,at as ks,Z as ms,n as Ze,a9 as je,aZ as gs,$ as fs,F as ys,a0 as hs,A as $s,a1 as Cs,a2 as bs,a_ as We,a3 as ws,a4 as D,b3 as Is}from"./index-Eg2Dz6vI.js";import{_ as Ss,a as Ds}from"./SearchInput-DFrEaFdp.js";import{_ as Es,a as Ts}from"./upload-rounded-DxjQpv8E.js";import{_ as Vs}from"./MediaKeyboardShortcuts.vuevuetypescriptsetuptruelang-y9_9FBhl.js";import{_ as As}from"./VCheckbox-BuMj4nO3.js";import{a as Ms}from"./tags-BO_i69Sy.js";import{u as Fs,a as Ls}from"./key-events-BNPqExTk.js";import{u as Rs}from"./search-BrbvAB1e.js";import"./VInputChip-BoCl3y34.js";const Us={class:"top-app-bar"},zs={class:"title"},qs={key:0},Bs={key:1},Ns={class:"actions"},Hs=["onClick"],Ks={class:"button-group"},Ps=["onClick","onMouseover"],Qs=["src"],Os=["src","onError"],Zs={key:1,class:"actions"},js={class:"right"},Ws=["onClick","onMouseover"],Gs={class:"start"},Xs={class:"number"},Js={class:"image"},Ys=["src"],xs=["src","onError"],et={class:"title"},ot={class:"subtitle"},st=["onClick"],tt={class:"actions"},nt={class:"time"},at={key:2,class:"no-data-placeholder"},A=55,yt=zo({__name:"VideosView",setup(lt){var qe;const E=qo(),{videoSortBy:z}=Ke(E),T=M([]),{t:Ge}=Bo(),{parseQ:Xe}=Rs(),I=No({tagIds:[],bucketId:void 0}),ge=Ho(),{app:F,urlTokenKey:ee,uploads:oe}=Ke(ge),P=M(!1),se=M(!1),{input:Je,upload:Ye,uploadChanged:fe}=Pe(oe),{input:xe,upload:eo,uploadChanged:ye}=Pe(oe),{dropping:oo,fileDragEnter:he,fileDragLeave:$e,dropFiles:so}=Ko(oe),te=M(!1),u=Po.VIDEO,Ce=Qo(),be=Ce.query,ne=M(parseInt(((qe=be.page)==null?void 0:qe.toString())??"1")),{tags:Q,buckets:O,fetch:to}=Oo(u),no=Qe(()=>{const s={};return O.value.forEach(n=>{s[n.id]=n}),s}),b=M(""),{addToTags:ao}=Ms(u,Q),{deleteItems:ae,deleteItem:Z}=Zo(),{view:lo}=gs(u),{selectedIds:g,allChecked:we,realAllChecked:S,selectRealAll:io,allCheckedAlertVisible:co,clearSelection:q,toggleAllChecked:ro,toggleSelect:B,total:w,checked:N,shiftEffectingIds:j,handleItemClick:Ie,handleMouseOver:Se,selectAll:uo,shouldSelect:De}=Fs(T),{downloadItems:Ee}=jo(ee,u,q,()=>ns("videos")),{downloadFile:W}=ks(ee),Te=s=>{const n=Ce.query.q;$s(E,n?`/videos?page=${s}&q=${n}`:`/videos?page=${s}`)},{keyDown:Ve,keyUp:Ae}=Ls(w,A,ne,uo,q,Te,()=>{J(Y.MEDIA_TRASH,F.value.osVersion)?X(u,K()):ae(u,g.value,S.value,w.value,b.value)}),le=M([]),_o=ps(),po=Qe(()=>T.value.map(s=>({src:me(s.fileId),name:R(s.path),duration:s.duration,size:s.size,path:s.path,data:s,type:u}))),Me=s=>{le.value.push(s)},{loading:G,fetch:H}=Wo({handle:async(s,n)=>{if(te.value=!1,n)ls(Ge(n),"error");else if(s){const C=[];for(const $ of s.videos)C.push({...$,fileId:is(ee.value,$.path,$.id)});T.value=C,w.value=s.videoCount}},document:as,variables:()=>({offset:(ne.value-1)*A,limit:A,query:b.value,sortBy:z.value})}),{trashLoading:ie,trash:X}=Go(),{restoreLoading:de,restore:ce}=Xo();function re(s){ge.lightbox={sources:po.value,index:s,visible:!0}}const K=()=>{let s=b.value;return S.value||(s=`ids:${g.value.join(",")}`),s};function vo(s){z.value!==s&&(te.value=!0,z.value=s)}function ko(s){return s?`/videos?q=${s}`:"/videos"}function Fe(s){Cs(bs,{type:u,tags:Q.value,item:{key:s.id,title:s.title,size:s.size},selected:Q.value.filter(n=>s.tags.some(C=>C.id===n.id))})}function ue(){const s=O.value.find(n=>n.id===I.bucketId);return s?We(s.topItems[0]):`${F.value.internalStoragePath}/Movies`}function mo(){Ye(ue())}function go(){eo(ue())}function fo(s){so(s,ue(),"video")}const Le=s=>{s.type===u&&(q(),H())},Re=s=>{s.type===u&&H()},Ue=s=>{s.type===u&&(q(),H())},ze=s=>{s.status==="done"&&Is(s.fileName)&&((!I.bucketId||O.value.some(C=>C.id===I.bucketId&&C.topItems.some($=>s.dir.startsWith(We($)))))&&setTimeout(()=>{H()},1e3),D.emit("media_items_actioned",{type:u,action:"upload",query:""}))};return Jo(()=>{var s;b.value=ws(((s=be.q)==null?void 0:s.toString())??""),Xe(I,b.value),to(),H(),D.on("item_tags_updated",Re),D.on("items_tags_updated",Le),D.on("media_items_actioned",Ue),D.on("upload_task_done",ze),window.addEventListener("keydown",Ve),window.addEventListener("keyup",Ae)}),Yo(()=>{D.off("item_tags_updated",Re),D.off("items_tags_updated",Le),D.off("media_items_actioned",Ue),D.off("upload_task_done",ze),window.removeEventListener("keydown",Ve),window.removeEventListener("keyup",Ae)}),(s,n)=>{const C=As,$=ds,c=ts,_e=cs,L=rs,pe=us,ve=_s,yo=Ss,ho=Vs,$o=Es,Be=es,Co=Ts,bo=Ao,wo=Mo,Io=Ds,ke=Fo,Ne=Lo,So=vs,He=ms,Do=Uo,Eo=Ro,To=Vo,p=xo("tooltip");return t(),r(h,null,[v("div",Us,[a(C,{"touch-target":"wrapper",checked:e(we),indeterminate:!e(we)&&e(N),onChange:e(ro)},null,8,["checked","indeterminate","onChange"]),v("div",zs,[e(g).length?(t(),r("span",qs,f(s.$t("x_selected",{count:e(S)?e(w).toLocaleString():e(g).length.toLocaleString()})),1)):(t(),r("span",Bs,f(s.$t("page_title.videos"))+" ("+f(e(w).toLocaleString())+")",1)),e(N)?(t(),r(h,{key:2},[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{onClick:n[0]||(n[0]=i(o=>e(ae)(e(u),e(g),e(S),e(w),b.value),["stop"]))},{icon:d(()=>[a($)]),_:1})),[[p,s.$t("delete")]]),_((t(),l(c,{loading:e(de)(K()),onClick:n[1]||(n[1]=i(o=>e(ce)(e(u),K()),["stop"]))},{icon:d(()=>[a(_e)]),_:1},8,["loading"])),[[p,s.$t("restore")]]),_((t(),l(c,{onClick:n[2]||(n[2]=i(o=>e(Ee)(e(S),e(g),b.value),["stop"]))},{icon:d(()=>[a(L)]),_:1})),[[p,s.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,loading:e(ie)(K()),onClick:n[3]||(n[3]=i(o=>e(X)(e(u),K()),["stop"]))},{icon:d(()=>[a(pe)]),_:1},8,["loading"])),[[p,s.$t("move_to_trash")]]):_((t(),l(c,{key:1,onClick:n[4]||(n[4]=i(o=>e(ae)(e(u),e(g),e(S),e(w),b.value),["stop"]))},{icon:d(()=>[a($)]),_:1})),[[p,s.$t("delete")]]),_((t(),l(c,{onClick:n[5]||(n[5]=i(o=>e(Ee)(e(S),e(g),b.value),["stop"]))},{icon:d(()=>[a(L)]),_:1})),[[p,s.$t("download")]]),_((t(),l(c,{onClick:n[6]||(n[6]=i(o=>e(ao)(e(g),e(S),b.value),["stop"]))},{icon:d(()=>[a(ve)]),_:1})),[[p,s.$t("add_to_tags")]])],64))],64)):U("",!0)]),v("div",Ns,[a(yo,{filter:I,tags:e(Q),buckets:e(O),"get-url":ko},null,8,["filter","tags","buckets"]),a(ho),I.trash?U("",!0):(t(),l(Be,{key:0,modelValue:P.value,"onUpdate:modelValue":n[9]||(n[9]=o=>P.value=o)},{trigger:d(()=>[_((t(),l(c,null,{icon:d(()=>[a($o)]),_:1})),[[p,s.$t("upload")]])]),default:d(()=>[v("div",{class:"dropdown-item",onClick:n[7]||(n[7]=i(o=>{mo(),P.value=!1},["stop"]))},f(s.$t("upload_files")),1),v("div",{class:"dropdown-item",onClick:n[8]||(n[8]=i(o=>{go(),P.value=!1},["stop"]))},f(s.$t("upload_folder")),1)]),_:1},8,["modelValue"])),a(Be,{modelValue:se.value,"onUpdate:modelValue":n[10]||(n[10]=o=>se.value=o)},{trigger:d(()=>[_((t(),l(c,{loading:te.value},{icon:d(()=>[a(Co)]),_:1},8,["loading"])),[[p,s.$t("sort")]])]),default:d(()=>[(t(!0),r(h,null,x(e(_o),o=>(t(),r("div",{key:o.value,class:V(["dropdown-item",{selected:o.value===e(z)}]),onClick:y=>{vo(o.value),se.value=!1}},f(s.$t(o.label)),11,Hs))),128))]),_:1},8,["modelValue"]),v("div",Ks,[v("button",{class:V({selected:!e(E).videosCardView}),onClick:n[11]||(n[11]=o=>e(E).videosCardView=!1)},[a(bo)],2),v("button",{class:V({selected:e(E).videosCardView}),onClick:n[12]||(n[12]=o=>e(E).videosCardView=!0)},[a(wo)],2)])])]),a(Io,{limit:A,total:e(w),"all-checked-alert-visible":e(co),"real-all-checked":e(S),"select-real-all":e(io),"clear-selection":e(q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),v("div",{class:"scroll-content",onDragover:n[16]||(n[16]=i((...o)=>e(he)&&e(he)(...o),["stop","prevent"]))},[_(v("div",{class:"drag-mask",onDrop:i(fo,["stop","prevent"]),onDragleave:n[13]||(n[13]=i((...o)=>e($e)&&e($e)(...o),["stop","prevent"]))},f(s.$t("release_to_send_files")),545),[[os,e(oo)]]),e(E).videosCardView?(t(),r("div",{key:1,class:V(["media-list",{"select-mode":e(N)}])},[(t(!0),r(h,null,x(T.value,(o,y)=>{var k;return t(),r("section",{key:o.id,class:V(["media-item selectable-card",{selected:e(g).includes(o.id),selecting:e(j).includes(o.id)}]),onClick:i(m=>e(Ie)(m,o,y,re),["stop"]),onMouseover:m=>e(Se)(m,y)},[v("div",Gs,[e(j).includes(o.id)?(t(),l(C,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(De),onClick:i(m=>e(B)(m,o,y),["stop"])},null,8,["checked","onClick"])):(t(),l(C,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(g).includes(o.id),onClick:i(m=>e(B)(m,o,y),["stop"])},null,8,["checked","onClick"])),v("span",Xs,[a(Do,{id:y+1,raw:o},null,8,["id","raw"])])]),v("div",Js,[le.value.includes(o.id)?(t(),r("img",{key:0,src:`/ficons/${e(Oe)(o.path)}.svg`,class:"svg"},null,8,Ys)):(t(),r("img",{key:1,class:"image-thumb",src:e(me)(o.fileId,"&w=200&h=200"),onError:m=>Me(o.id)},null,40,xs))]),v("div",et,f(e(R)(o.path)),1),v("div",ot,[v("span",null,f(e(Ze)(o.size)),1),v("span",null,f(e(je)(o.duration)),1),v("a",{onClick:i(m=>e(lo)(e(E),o.bucketId),["stop","prevent"])},f((k=no.value[o.bucketId])==null?void 0:k.name),9,st),a(He,{tags:o.tags,type:e(u),"only-links":!0},null,8,["tags","type"])]),v("div",tt,[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{class:"sm",onClick:i(m=>e(Z)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",loading:e(de)(`ids:${o.id}`),onClick:i(m=>e(ce)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(_e)]),_:2},1032,["loading","onClick"])),[[p,s.$t("restore")]]),_((t(),l(c,{class:"sm",onClick:i(m=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,class:"sm",loading:e(ie)(`ids:${o.id}`),onClick:i(m=>e(X)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(pe)]),_:2},1032,["loading","onClick"])),[[p,s.$t("move_to_trash")]]):_((t(),l(c,{key:1,class:"sm",onClick:i(m=>e(Z)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",onClick:i(m=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]]),_((t(),l(c,{class:"sm",onClick:i(m=>Fe(o),["stop"])},{icon:d(()=>[a(ve)]),_:2},1032,["onClick"])),[[p,s.$t("add_to_tags")]])],64))]),v("div",nt,[_((t(),r("span",null,[ys(f(e(hs)(o.createdAt)),1)])),[[p,e(fs)(o.createdAt)]])])],42,Ws)}),128)),e(G)&&T.value.length===0?(t(),l(Eo,{key:0,limit:A})):U("",!0)],2)):(t(),r("div",{key:0,class:V(["media-grid",{"select-mode":e(N)}])},[(t(!0),r(h,null,x(T.value,(o,y)=>(t(),r("section",{key:o.id,class:V(["media-item",{selected:e(g).includes(o.id),selecting:e(j).includes(o.id)}]),onClick:i(k=>e(Ie)(k,o,y,re),["stop"]),onMouseover:k=>e(Se)(k,y)},[le.value.includes(o.id)?(t(),r("img",{key:0,src:`/ficons/${e(Oe)(o.path)}.svg`,class:"image svg"},null,8,Qs)):(t(),r("img",{key:1,class:"image image-thumb",src:e(me)(o.fileId,"&w=200&h=200"),onError:k=>Me(o.id)},null,40,Os)),e(j).includes(o.id)?(t(),l(c,{key:2,class:"btn-checkbox",onClick:i(k=>e(B)(k,o,y),["stop"])},{icon:d(()=>[e(De)?(t(),l(ke,{key:0})):(t(),l(Ne,{key:1}))]),_:2},1032,["onClick"])):e(g).includes(o.id)?(t(),l(c,{key:3,class:"btn-checkbox",onClick:i(k=>e(B)(k,o,y),["stop"])},{icon:d(()=>[a(ke)]),_:2},1032,["onClick"])):(t(),r(h,{key:4},[a(c,{class:"btn-checkbox",onClick:i(k=>e(B)(k,o,y),["stop"])},{icon:d(()=>[e(g).includes(o.id)?(t(),l(ke,{key:0})):(t(),l(Ne,{key:1}))]),_:2},1032,["onClick"]),e(N)?_((t(),l(c,{key:0,class:"btn-zoom sm",onClick:i(k=>re(y),["stop"])},{icon:d(()=>[a(So)]),_:2},1032,["onClick"])),[[p,s.$t("open")]]):(t(),r("div",Zs,[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{class:"sm",onClick:i(k=>e(Z)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",loading:e(de)(`ids:${o.id}`),onClick:i(k=>e(ce)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(_e)]),_:2},1032,["loading","onClick"])),[[p,s.$t("restore")]]),_((t(),l(c,{class:"sm",onClick:i(k=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,class:"sm",loading:e(ie)(`ids:${o.id}`),onClick:i(k=>e(X)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(pe)]),_:2},1032,["loading","onClick"])),[[p,s.$t("move_to_trash")]]):_((t(),l(c,{key:1,class:"sm",onClick:i(k=>e(Z)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",onClick:i(k=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]]),_((t(),l(c,{class:"sm",onClick:i(k=>Fe(o),["stop"])},{icon:d(()=>[a(ve)]),_:2},1032,["onClick"])),[[p,s.$t("add_to_tags")]])],64))])),v("div",{class:V(["info",{"has-tags":o.tags.length>0}])},[a(He,{tags:o.tags,type:e(u)},null,8,["tags","type"]),v("span",js,f(["SIZE_ASC","SIZE_DESC"].includes(e(z))?e(Ze)(o.size):e(je)(o.duration)),1)],2)],64))],42,Ps))),128)),e(G)&&T.value.length===0?(t(),r(h,{key:0},x(A,o=>v("section",{key:o,class:"skeleton-image media-item"})),64)):U("",!0)],2)),!e(G)&&T.value.length===0?(t(),r("div",at,f(s.$t(e(ss)(e(G),e(F).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):U("",!0),e(w)>A?(t(),l(To,{key:3,page:ne.value,go:Te,total:e(w),limit:A},null,8,["page","total"])):U("",!0),v("input",{ref_key:"fileInput",ref:Je,style:{display:"none"},type:"file",accept:"video/*",multiple:"",onChange:n[14]||(n[14]=(...o)=>e(fe)&&e(fe)(...o))},null,544),v("input",{ref_key:"dirFileInput",ref:xe,style:{display:"none"},type:"file",accept:"video/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[15]||(n[15]=(...o)=>e(ye)&&e(ye)(...o))},null,544)],32)],64)}}});export{yt as default};
