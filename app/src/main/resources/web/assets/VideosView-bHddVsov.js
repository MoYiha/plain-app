import{_ as Ao}from"./VPagination.vuevuetypescriptsetuptruelang-CMel8YZq.js";import{_ as Mo,a as Fo,b as Lo,c as Ro,d as Uo}from"./grid-view-outline-rounded-DpTF9CUd.js";import{_ as zo}from"./FieldId.vuevuetypescriptsetuptruelang-DwatImZq.js";import{e as qo,f as Bo,s as Ke,r as M,u as No,I as Ho,g as Ko,ag as Pe,ah as Po,J as Qo,K as Oo,aL as Zo,aM as Qe,aN as jo,ai as Wo,aO as R,aH as me,L as Go,aP as Xo,aQ as Jo,M as Yo,N as xo,c as r,o as t,a as v,k as a,l as e,j as U,t as f,T as h,O as _,P as es,R as l,p as d,y as i,aR as J,aS as Y,ak as os,S as V,al as ss,U as x,V as ts,aT as ns,av as as,b1 as ls,E as is,aV as ds,a7 as cs,aW as rs,aj as us,aX as _s,Q as ps,ar as vs,b2 as Oe,aY as ks,at as ms,Z as gs,n as Ze,a9 as je,aZ as fs,$ as ys,F as hs,a0 as $s,A as Cs,a1 as bs,a2 as ws,b3 as We,a$ as Ge,a3 as Is,a4 as D}from"./index-CRAs9Aby.js";import{_ as Ss,a as Ds}from"./SearchInput-BZAwknOd.js";import{_ as Es,a as Ts}from"./upload-rounded-8g7nrfaj.js";import{_ as Vs}from"./MediaKeyboardShortcuts.vuevuetypescriptsetuptruelang-C9TuQ7S2.js";import{_ as As}from"./VCheckbox-CIULXI0B.js";import{a as Ms}from"./tags-D2ApdQ5I.js";import{u as Fs,a as Ls}from"./key-events-CqsPa-7g.js";import{u as Rs}from"./search-BzSrYmzJ.js";import"./VInputChip-D4Mcll6i.js";const Us={class:"top-app-bar"},zs={class:"title"},qs={key:0},Bs={key:1},Ns={class:"actions"},Hs=["onClick"],Ks={class:"button-group"},Ps=["onClick","onMouseover"],Qs=["src"],Os=["src","onError"],Zs={key:1,class:"actions"},js={class:"right"},Ws=["onClick","onMouseover"],Gs={class:"start"},Xs={class:"number"},Js={class:"image"},Ys=["src"],xs=["src","onError"],et={class:"title"},ot={class:"subtitle"},st=["onClick"],tt={class:"actions"},nt={class:"time"},at={key:2,class:"no-data-placeholder"},A=55,yt=qo({__name:"VideosView",setup(lt){var qe;const E=Bo(),{videoSortBy:z}=Ke(E),T=M([]),{t:Xe}=No(),{parseQ:Je}=Rs(),I=Ho({tagIds:[],bucketId:void 0}),ge=Ko(),{app:F,urlTokenKey:ee,uploads:oe}=Ke(ge),P=M(!1),se=M(!1),{input:Ye,upload:xe,uploadChanged:fe}=Pe(oe),{input:eo,upload:oo,uploadChanged:ye}=Pe(oe),{dropping:so,fileDragEnter:he,fileDragLeave:$e,dropFiles:to}=Po(oe),te=M(!1),u=Qo.VIDEO,Ce=Oo(),be=Ce.query,ne=M(parseInt(((qe=be.page)==null?void 0:qe.toString())??"1")),{tags:Q,buckets:O,fetch:no}=Zo(u),ao=Qe(()=>{const s={};return O.value.forEach(n=>{s[n.id]=n}),s}),b=M(""),{addToTags:lo}=Ms(u,Q),{deleteItems:ae,deleteItem:Z}=jo(),{view:io}=fs(u),{selectedIds:g,allChecked:we,realAllChecked:S,selectRealAll:co,allCheckedAlertVisible:ro,clearSelection:q,toggleAllChecked:uo,toggleSelect:B,total:w,checked:N,shiftEffectingIds:j,handleItemClick:Ie,handleMouseOver:Se,selectAll:_o,shouldSelect:De}=Fs(T),{downloadItems:Ee}=Wo(ee,u,q,()=>as("videos")),{downloadFile:W}=ms(ee),Te=s=>{const n=Ce.query.q;Cs(E,n?`/videos?page=${s}&q=${n}`:`/videos?page=${s}`)},{keyDown:Ve,keyUp:Ae}=Ls(w,A,ne,_o,q,Te,()=>{J(Y.MEDIA_TRASH,F.value.osVersion)?X(u,K()):ae(u,g.value,S.value,w.value,b.value)}),le=M([]),po=vs(),vo=Qe(()=>T.value.map(s=>({src:me(s.fileId),name:R(s.path),duration:s.duration,size:s.size,path:s.path,data:s,type:u}))),Me=s=>{le.value.push(s)},{loading:G,fetch:H}=Go({handle:async(s,n)=>{if(te.value=!1,n)is(Xe(n),"error");else if(s){const C=[];for(const $ of s.videos)C.push({...$,fileId:ds(ee.value,$.path,$.id)});T.value=C,w.value=s.videoCount}},document:ls,variables:()=>({offset:(ne.value-1)*A,limit:A,query:b.value,sortBy:z.value})}),{trashLoading:ie,trash:X}=Xo(),{restoreLoading:de,restore:ce}=Jo();function re(s){ge.lightbox={sources:vo.value,index:s,visible:!0}}const K=()=>{let s=b.value;return S.value||(s=`ids:${g.value.join(",")}`),s};function ko(s){z.value!==s&&(te.value=!0,z.value=s)}function mo(s){return s?`/videos?q=${s}`:"/videos"}function Fe(s){bs(ws,{type:u,tags:Q.value,item:{key:s.id,title:s.title,size:s.size},selected:Q.value.filter(n=>s.tags.some(C=>C.id===n.id))})}function ue(){const s=O.value.find(n=>n.id===I.bucketId);return s?Ge(s.topItems[0]):`${F.value.internalStoragePath}/Movies`}function go(){xe(ue())}function fo(){oo(ue())}function yo(s){to(s,ue(),n=>We(n.name))}const Le=s=>{s.type===u&&(q(),H())},Re=s=>{s.type===u&&H()},Ue=s=>{s.type===u&&(q(),H())},ze=s=>{s.status==="done"&&We(s.fileName)&&((!I.bucketId||O.value.some(C=>C.id===I.bucketId&&C.topItems.some($=>s.dir.startsWith(Ge($)))))&&setTimeout(()=>{H()},1e3),D.emit("media_items_actioned",{type:u,action:"upload",query:""}))};return Yo(()=>{var s;b.value=Is(((s=be.q)==null?void 0:s.toString())??""),Je(I,b.value),no(),H(),D.on("item_tags_updated",Re),D.on("items_tags_updated",Le),D.on("media_items_actioned",Ue),D.on("upload_task_done",ze),window.addEventListener("keydown",Ve),window.addEventListener("keyup",Ae)}),xo(()=>{D.off("item_tags_updated",Re),D.off("items_tags_updated",Le),D.off("media_items_actioned",Ue),D.off("upload_task_done",ze),window.removeEventListener("keydown",Ve),window.removeEventListener("keyup",Ae)}),(s,n)=>{const C=As,$=cs,c=ns,_e=rs,L=us,pe=_s,ve=ps,ho=Ss,$o=Vs,Co=Es,Be=os,bo=Ts,wo=Mo,Io=Fo,So=Ds,ke=Lo,Ne=Ro,Do=ks,He=gs,Eo=zo,To=Uo,Vo=Ao,p=es("tooltip");return t(),r(h,null,[v("div",Us,[a(C,{"touch-target":"wrapper",checked:e(we),indeterminate:!e(we)&&e(N),onChange:e(uo)},null,8,["checked","indeterminate","onChange"]),v("div",zs,[e(g).length?(t(),r("span",qs,f(s.$t("x_selected",{count:e(S)?e(w).toLocaleString():e(g).length.toLocaleString()})),1)):(t(),r("span",Bs,f(s.$t("page_title.videos"))+" ("+f(e(w).toLocaleString())+")",1)),e(N)?(t(),r(h,{key:2},[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{onClick:n[0]||(n[0]=i(o=>e(ae)(e(u),e(g),e(S),e(w),b.value),["stop"]))},{icon:d(()=>[a($)]),_:1})),[[p,s.$t("delete")]]),_((t(),l(c,{loading:e(de)(K()),onClick:n[1]||(n[1]=i(o=>e(ce)(e(u),K()),["stop"]))},{icon:d(()=>[a(_e)]),_:1},8,["loading"])),[[p,s.$t("restore")]]),_((t(),l(c,{onClick:n[2]||(n[2]=i(o=>e(Ee)(e(S),e(g),b.value),["stop"]))},{icon:d(()=>[a(L)]),_:1})),[[p,s.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,loading:e(ie)(K()),onClick:n[3]||(n[3]=i(o=>e(X)(e(u),K()),["stop"]))},{icon:d(()=>[a(pe)]),_:1},8,["loading"])),[[p,s.$t("move_to_trash")]]):_((t(),l(c,{key:1,onClick:n[4]||(n[4]=i(o=>e(ae)(e(u),e(g),e(S),e(w),b.value),["stop"]))},{icon:d(()=>[a($)]),_:1})),[[p,s.$t("delete")]]),_((t(),l(c,{onClick:n[5]||(n[5]=i(o=>e(Ee)(e(S),e(g),b.value),["stop"]))},{icon:d(()=>[a(L)]),_:1})),[[p,s.$t("download")]]),_((t(),l(c,{onClick:n[6]||(n[6]=i(o=>e(lo)(e(g),e(S),b.value),["stop"]))},{icon:d(()=>[a(ve)]),_:1})),[[p,s.$t("add_to_tags")]])],64))],64)):U("",!0)]),v("div",Ns,[a(ho,{filter:I,tags:e(Q),buckets:e(O),"get-url":mo},null,8,["filter","tags","buckets"]),a($o),I.trash?U("",!0):(t(),l(Be,{key:0,modelValue:P.value,"onUpdate:modelValue":n[9]||(n[9]=o=>P.value=o)},{trigger:d(()=>[_((t(),l(c,null,{icon:d(()=>[a(Co)]),_:1})),[[p,s.$t("upload")]])]),default:d(()=>[v("div",{class:"dropdown-item",onClick:n[7]||(n[7]=i(o=>{go(),P.value=!1},["stop"]))},f(s.$t("upload_files")),1),v("div",{class:"dropdown-item",onClick:n[8]||(n[8]=i(o=>{fo(),P.value=!1},["stop"]))},f(s.$t("upload_folder")),1)]),_:1},8,["modelValue"])),a(Be,{modelValue:se.value,"onUpdate:modelValue":n[10]||(n[10]=o=>se.value=o)},{trigger:d(()=>[_((t(),l(c,{loading:te.value},{icon:d(()=>[a(bo)]),_:1},8,["loading"])),[[p,s.$t("sort")]])]),default:d(()=>[(t(!0),r(h,null,x(e(po),o=>(t(),r("div",{key:o.value,class:V(["dropdown-item",{selected:o.value===e(z)}]),onClick:y=>{ko(o.value),se.value=!1}},f(s.$t(o.label)),11,Hs))),128))]),_:1},8,["modelValue"]),v("div",Ks,[v("button",{class:V({selected:!e(E).videosCardView}),onClick:n[11]||(n[11]=o=>e(E).videosCardView=!1)},[a(wo)],2),v("button",{class:V({selected:e(E).videosCardView}),onClick:n[12]||(n[12]=o=>e(E).videosCardView=!0)},[a(Io)],2)])])]),a(So,{limit:A,total:e(w),"all-checked-alert-visible":e(ro),"real-all-checked":e(S),"select-real-all":e(co),"clear-selection":e(q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),v("div",{class:"scroll-content",onDragover:n[16]||(n[16]=i((...o)=>e(he)&&e(he)(...o),["stop","prevent"]))},[_(v("div",{class:"drag-mask",onDrop:i(yo,["stop","prevent"]),onDragleave:n[13]||(n[13]=i((...o)=>e($e)&&e($e)(...o),["stop","prevent"]))},f(s.$t("release_to_send_files")),545),[[ss,e(so)]]),e(E).videosCardView?(t(),r("div",{key:1,class:V(["media-list",{"select-mode":e(N)}])},[(t(!0),r(h,null,x(T.value,(o,y)=>{var k;return t(),r("section",{key:o.id,class:V(["media-item selectable-card",{selected:e(g).includes(o.id),selecting:e(j).includes(o.id)}]),onClick:i(m=>e(Ie)(m,o,y,re),["stop"]),onMouseover:m=>e(Se)(m,y)},[v("div",Gs,[e(j).includes(o.id)?(t(),l(C,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(De),onClick:i(m=>e(B)(m,o,y),["stop"])},null,8,["checked","onClick"])):(t(),l(C,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(g).includes(o.id),onClick:i(m=>e(B)(m,o,y),["stop"])},null,8,["checked","onClick"])),v("span",Xs,[a(Eo,{id:y+1,raw:o},null,8,["id","raw"])])]),v("div",Js,[le.value.includes(o.id)?(t(),r("img",{key:0,src:`/ficons/${e(Oe)(o.path)}.svg`,class:"svg"},null,8,Ys)):(t(),r("img",{key:1,class:"image-thumb",src:e(me)(o.fileId,"&w=200&h=200"),onError:m=>Me(o.id)},null,40,xs))]),v("div",et,f(e(R)(o.path)),1),v("div",ot,[v("span",null,f(e(Ze)(o.size)),1),v("span",null,f(e(je)(o.duration)),1),v("a",{onClick:i(m=>e(io)(e(E),o.bucketId),["stop","prevent"])},f((k=ao.value[o.bucketId])==null?void 0:k.name),9,st),a(He,{tags:o.tags,type:e(u),"only-links":!0},null,8,["tags","type"])]),v("div",tt,[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{class:"sm",onClick:i(m=>e(Z)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",loading:e(de)(`ids:${o.id}`),onClick:i(m=>e(ce)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(_e)]),_:2},1032,["loading","onClick"])),[[p,s.$t("restore")]]),_((t(),l(c,{class:"sm",onClick:i(m=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,class:"sm",loading:e(ie)(`ids:${o.id}`),onClick:i(m=>e(X)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(pe)]),_:2},1032,["loading","onClick"])),[[p,s.$t("move_to_trash")]]):_((t(),l(c,{key:1,class:"sm",onClick:i(m=>e(Z)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",onClick:i(m=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]]),_((t(),l(c,{class:"sm",onClick:i(m=>Fe(o),["stop"])},{icon:d(()=>[a(ve)]),_:2},1032,["onClick"])),[[p,s.$t("add_to_tags")]])],64))]),v("div",nt,[_((t(),r("span",null,[hs(f(e($s)(o.createdAt)),1)])),[[p,e(ys)(o.createdAt)]])])],42,Ws)}),128)),e(G)&&T.value.length===0?(t(),l(To,{key:0,limit:A})):U("",!0)],2)):(t(),r("div",{key:0,class:V(["media-grid",{"select-mode":e(N)}])},[(t(!0),r(h,null,x(T.value,(o,y)=>(t(),r("section",{key:o.id,class:V(["media-item",{selected:e(g).includes(o.id),selecting:e(j).includes(o.id)}]),onClick:i(k=>e(Ie)(k,o,y,re),["stop"]),onMouseover:k=>e(Se)(k,y)},[le.value.includes(o.id)?(t(),r("img",{key:0,src:`/ficons/${e(Oe)(o.path)}.svg`,class:"image svg"},null,8,Qs)):(t(),r("img",{key:1,class:"image image-thumb",src:e(me)(o.fileId,"&w=200&h=200"),onError:k=>Me(o.id)},null,40,Os)),e(j).includes(o.id)?(t(),l(c,{key:2,class:"btn-checkbox",onClick:i(k=>e(B)(k,o,y),["stop"])},{icon:d(()=>[e(De)?(t(),l(ke,{key:0})):(t(),l(Ne,{key:1}))]),_:2},1032,["onClick"])):e(g).includes(o.id)?(t(),l(c,{key:3,class:"btn-checkbox",onClick:i(k=>e(B)(k,o,y),["stop"])},{icon:d(()=>[a(ke)]),_:2},1032,["onClick"])):(t(),r(h,{key:4},[a(c,{class:"btn-checkbox",onClick:i(k=>e(B)(k,o,y),["stop"])},{icon:d(()=>[e(g).includes(o.id)?(t(),l(ke,{key:0})):(t(),l(Ne,{key:1}))]),_:2},1032,["onClick"]),e(N)?_((t(),l(c,{key:0,class:"btn-zoom sm",onClick:i(k=>re(y),["stop"])},{icon:d(()=>[a(Do)]),_:2},1032,["onClick"])),[[p,s.$t("open")]]):(t(),r("div",Zs,[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{class:"sm",onClick:i(k=>e(Z)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",loading:e(de)(`ids:${o.id}`),onClick:i(k=>e(ce)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(_e)]),_:2},1032,["loading","onClick"])),[[p,s.$t("restore")]]),_((t(),l(c,{class:"sm",onClick:i(k=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,class:"sm",loading:e(ie)(`ids:${o.id}`),onClick:i(k=>e(X)(e(u),`ids:${o.id}`),["stop"])},{icon:d(()=>[a(pe)]),_:2},1032,["loading","onClick"])),[[p,s.$t("move_to_trash")]]):_((t(),l(c,{key:1,class:"sm",onClick:i(k=>e(Z)(e(u),o),["stop"])},{icon:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),l(c,{class:"sm",onClick:i(k=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[a(L)]),_:2},1032,["onClick"])),[[p,s.$t("download")]]),_((t(),l(c,{class:"sm",onClick:i(k=>Fe(o),["stop"])},{icon:d(()=>[a(ve)]),_:2},1032,["onClick"])),[[p,s.$t("add_to_tags")]])],64))])),v("div",{class:V(["info",{"has-tags":o.tags.length>0}])},[a(He,{tags:o.tags,type:e(u)},null,8,["tags","type"]),v("span",js,f(["SIZE_ASC","SIZE_DESC"].includes(e(z))?e(Ze)(o.size):e(je)(o.duration)),1)],2)],64))],42,Ps))),128)),e(G)&&T.value.length===0?(t(),r(h,{key:0},x(A,o=>v("section",{key:o,class:"skeleton-image media-item"})),64)):U("",!0)],2)),!e(G)&&T.value.length===0?(t(),r("div",at,f(s.$t(e(ts)(e(G),e(F).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):U("",!0),e(w)>A?(t(),l(Vo,{key:3,page:ne.value,go:Te,total:e(w),limit:A},null,8,["page","total"])):U("",!0),v("input",{ref_key:"fileInput",ref:Ye,style:{display:"none"},type:"file",accept:"video/*",multiple:"",onChange:n[14]||(n[14]=(...o)=>e(fe)&&e(fe)(...o))},null,544),v("input",{ref_key:"dirFileInput",ref:eo,style:{display:"none"},type:"file",accept:"video/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[15]||(n[15]=(...o)=>e(ye)&&e(ye)(...o))},null,544)],32)],64)}}});export{yt as default};
