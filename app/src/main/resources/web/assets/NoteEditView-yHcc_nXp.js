import{_ as Y}from"./MonacoEditor.vuevuetypescriptsetuptruelang-g6EZmGmL.js";import{_ as Z}from"./print-outline-rounded-DvcH-jiL.js";import{b8 as ee,b9 as z,ba as te,m as ne,c as h,o as p,a as c,e as ae,f as oe,u as se,r as y,s as ie,g as le,h as ue,J as re,i as de,bb as ce,ac as me,I as fe,a2 as q,ad as _e,p as S,M as ve,y as U,k as N,Y as A,O as pe,j as F,t as ge,l as O,aN as be,W as Te,Q as G,N as ye,w as he,X as ke,U as we,bc as Ne,D as P,bd as Me,be as $e,a4 as Ce,z as Le,$ as xe,a0 as Ee,bf as qe,F as Se}from"./index-H9YOjX-Y.js";import{u as Ie}from"./markdown-9NTK5H0b.js";var W=function(){return ee.Date.now()},Ve="Expected a function",De=Math.max,Re=Math.min;function Qe($,i,u){var m,a,o,l,s,r,_=0,C=!1,v=!1,g=!0;if(typeof $!="function")throw new TypeError(Ve);i=z(i)||0,te(u)&&(C=!!u.leading,v="maxWait"in u,o=v?De(z(u.maxWait)||0,i):o,g="trailing"in u?!!u.trailing:g);function k(n){var d=m,e=a;return m=a=void 0,_=n,l=$.apply(e,d),l}function L(n){return _=n,s=setTimeout(f,i),C?k(n):l}function I(n){var d=n-r,e=n-_,t=i-d;return v?Re(t,o-e):t}function b(n){var d=n-r,e=n-_;return r===void 0||d>=i||d<0||v&&e>=o}function f(){var n=W();if(b(n))return x(n);s=setTimeout(f,I(n))}function x(n){return s=void 0,g&&m?k(n):(m=a=void 0,l)}function V(){s!==void 0&&clearTimeout(s),_=0,m=r=a=s=void 0}function D(){return s===void 0?l:x(W())}function w(){var n=W(),d=b(n);if(m=arguments,a=this,r=n,d){if(s===void 0)return L(r);if(v)return clearTimeout(s),s=setTimeout(f,i),k(r)}return s===void 0&&(s=setTimeout(f,i)),l}return w.cancel=V,w.flush=D,w}const Ue={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function We($,i){return p(),h("svg",Ue,i[0]||(i[0]=[c("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1)]))}const Be=ne({name:"material-symbols-arrow-back-rounded",render:We}),He={class:"top-app-bar"},ze={class:"title"},Ae={class:"state-point"},Fe={class:"actions"},Oe={class:"panel-container"},Ge=["innerHTML"],M="NOTE",Pe=ae({__name:"NoteEditView",setup($){const i=oe(),{t:u}=se(),m=fe(),a=y(""),o=y(),l=y(""),s=y(""),r=y(!1),{app:_,urlTokenKey:C}=ie(le());function v(){const e=Ce.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),Le(i,t)}const{render:g}=Ie(_,C),k=Qe(()=>{r.value=!1,x({id:a.value,input:{content:l.value,title:qe(l.value,{length:250,omission:""})}})},500),L=()=>{he(l,async e=>{r.value=!0,s.value=await g(e),k()})},I=()=>{window.print()},b=y();ue({handle:(e,t)=>{t?P(u(t),"error"):e&&(b.value=e.tags)},document:Ne,variables:{type:M}});const{fetch:f}=re({handle:async(e,t)=>{t?P(u(t),"error"):(o.value=e.note,l.value=e.note.content,s.value=await g(l.value),L())},document:Me,variables:()=>({id:a.value}),options:{fetchPolicy:"no-cache"}}),{mutate:x,onDone:V}=de({document:$e});V(e=>{var t,T;o.value=e.data.saveNote,!a.value&&((t=o.value)!=null&&t.id)&&(a.value=(T=o.value)==null?void 0:T.id,ce(i,`/notes/${a.value}`))});function D(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${u("updated_at")}: ${ke(e)})`:""}function w(){var e,t;xe(Ee,{type:M,tags:b.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=b.value)==null?void 0:t.filter(T=>{var E;return(E=o.value)==null?void 0:E.tags.some(R=>R.id===T.id)})})}const n=e=>{e.type===M&&f()},d=e=>{e.type===M&&f()};return me(()=>{a.value=m.params.id,a.value==="create"&&(a.value=""),a.value?f():L(),q.on("item_tags_updated",d),q.on("items_tags_updated",n)}),_e(()=>{q.off("item_tags_updated",d),q.off("items_tags_updated",n)}),(e,t)=>{var B,H;const T=Be,E=we,R=Te,j=ye,X=Z,J=Y,Q=ve("tooltip");return p(),h(G,null,[c("div",He,[S((p(),h("button",{class:"btn-icon",onClick:U(v,["prevent"])},[t[1]||(t[1]=c("md-ripple",null,null,-1)),N(T)])),[[Q,e.$t("back")]]),c("div",ze,[A(ge(a.value?O(u)("edit"):O(u)("create"))+" ",1),S(c("span",Ae,"*",512),[[be,r.value]]),t[2]||(t[2]=A()),(B=o.value)!=null&&B.updatedAt?(p(),pe(E,{key:0,id:D(),class:"time",raw:o.value},null,8,["id","raw"])):F("",!0)]),c("div",Fe,[N(R,{tags:(H=o.value)==null?void 0:H.tags,type:M,"only-links":!0},null,8,["tags"]),a.value?(p(),h(G,{key:0},[S((p(),h("button",{class:"btn-icon",onClick:U(w,["prevent"])},[t[3]||(t[3]=c("md-ripple",null,null,-1)),N(j)])),[[Q,e.$t("add_to_tags")]]),S((p(),h("button",{class:"btn-icon",onClick:U(I,["prevent"])},[t[4]||(t[4]=c("md-ripple",null,null,-1)),N(X)])),[[Q,e.$t("print")]])],64)):F("",!0)])]),c("div",Oe,[N(J,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=K=>l.value=K),language:"html"},null,8,["modelValue"]),c("div",{class:"md-container",innerHTML:s.value},null,8,Ge)])],64)}}}),Ye=Se(Pe,[["__scopeId","data-v-eb5effca"]]);export{Ye as default};
