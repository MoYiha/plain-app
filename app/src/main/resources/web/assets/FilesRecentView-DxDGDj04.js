import{d as ie,u as ce,r as h,f as de,s as re,i as ue,ao as _e,G as pe,H as ve,I as ke,c as l,o as a,a as o,h as m,L as he,n as g,k as s,t as d,J as me,x as _,j as v,ah as ge,N as G,O as fe,a1 as I,bh as ye,P as be,by as we,bH as Ee,A as Ce,bx as Ie,X as De,M as Te,R as Le,ay as Se,l as Ve,U as $e,V as Fe,W as xe,bA as Ae,ai as Ne,bD as Be,ak as Ue,bE as Me,bF as Re,bB as ze,a0 as f,bG as Ge}from"./index-Dohfv8Fq.js";import{_ as K}from"./default-BQXvEOng.js";import{u as Ke,c as Oe}from"./key-events-COB8z-tk.js";const He={class:"top-app-bar"},Pe=["checked","indeterminate"],Qe={key:0},Je={key:1},We={key:0,class:"scroller"},Xe={class:"start"},je={class:"number"},qe=["onClick","onMouseover"],Ye={class:"start"},Ze=["checked","onClick"],es=["checked","onClick"],ss={class:"number"},ts=["onClick"],os={key:0,class:"svg",src:K},ns=["src","onError"],as=["src","onError"],ls={key:3,class:"svg",src:K},is={class:"title"},cs={class:"subtitle"},ds={class:"actions"},rs=["onClick"],us={class:"btn-icon sm"},_s={class:"card card-info"},ps={class:"key-value vertical"},vs={class:"key"},ks={class:"value"},hs={key:2,class:"no-data-placeholder"},bs=ie({__name:"FilesRecentView",setup(ms){const{t:O}=ce(),H=h([]),D=de(),{app:P,urlTokenKey:y}=re(D),r=h([]),{selectedIds:p,allChecked:T,realAllChecked:Q,clearSelection:b,toggleAllChecked:L,toggleSelect:S,total:w,checked:V,shiftEffectingIds:$,handleItemClick:J,handleMouseOver:W,selectAll:X,shouldSelect:j}=Ke(r),{downloadFile:F,downloadFiles:q}=_e(y),{view:Y}=Re(H,(e,n)=>{D.lightbox={sources:e,index:n,visible:!0}}),{keyDown:x,keyUp:A}=Oe(X,b,()=>{}),N=h([]),B=h([]),Z=e=>{N.value.push(e)},ee=e=>{B.value.push(e)},{mutate:se,onDone:te}=ue({document:we});te(e=>{q(e.data.setTempValue.key),b()});const U=e=>{Be(e.name)?window.open(Ue(y.value,e.path),"_blank"):Me(e.name)?Y(r.value,e):F(e.path)},{loading:E,fetch:M}=pe({handle:async(e,n)=>{if(n)Ce(O(n),"error");else{const u=[];for(const C of e.recentFiles)u.push(Ie(C,y.value));r.value=u,w.value=u.length}},document:Ee}),oe=()=>{se({key:ze(),value:JSON.stringify(p.value.map(e=>({path:e})))})},R=e=>{e.status==="done"&&setTimeout(()=>{M()},1e3)},ne=e=>{e.forEach(n=>{Ge(r.value,u=>u.id===n.id)}),b()},z=e=>{ne([e.item])};return ve(()=>{M(),f.on("upload_task_done",R),f.on("file_deleted",z),window.addEventListener("keydown",x),window.addEventListener("keyup",A)}),ke(()=>{f.off("upload_task_done",R),f.off("file_deleted",z),window.removeEventListener("keydown",x),window.removeEventListener("keyup",A)}),(e,n)=>{const u=ge,C=Le,ae=Ae,le=Ne,k=me("tooltip");return a(),l(G,null,[o("div",He,[o("md-checkbox",{"touch-target":"wrapper",checked:s(T),indeterminate:!s(T)&&s(V),onChange:n[0]||(n[0]=(...c)=>s(L)&&s(L)(...c))},null,40,Pe),s(p).length?(a(),l("span",Qe,d(e.$t("x_selected",{count:s(Q)?s(w).toLocaleString():s(p).length.toLocaleString()})),1)):(a(),l("span",Je,d(e.$t("recent_files"))+" ("+d(s(w).toLocaleString())+")",1)),s(V)?g((a(),l("button",{key:2,class:"btn-icon",onClick:_(oe,["stop"])},[n[1]||(n[1]=o("md-ripple",null,null,-1)),v(u)])),[[k,e.$t("download")]]):m("",!0)]),s(E)&&r.value.length===0?(a(),l("div",We,[(a(),l(G,null,fe(20,c=>o("section",{key:c,class:"file-item selectable-card-skeleton"},[o("div",Xe,[n[2]||(n[2]=o("div",{class:"checkbox"},[o("div",{class:"skeleton-checkbox"})],-1)),o("span",je,d(c),1)]),n[3]||(n[3]=De('<div class="image"><div class="skeleton-image"></div></div><div class="title"><div class="skeleton-text skeleton-title"></div></div><div class="subtitle"><div class="skeleton-text skeleton-subtitle"></div></div><div class="actions"><div class="skeleton-text skeleton-actions"></div></div>',4))])),64))])):m("",!0),r.value.length>0?(a(),he(s(ye),{key:1,class:"scroller","data-key":"id","data-sources":r.value,"estimate-size":80},{item:I(({index:c,item:t})=>[(a(),l("section",{key:t.id,class:Te(["file-item selectable-card",{selected:s(p).includes(t.id),selecting:s($).includes(t.id)}]),onClick:_(i=>s(J)(i,t,c,()=>{U(t)}),["stop"]),onMouseover:i=>s(W)(i,c)},[o("div",Ye,[s($).includes(t.id)?(a(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:s(j),onClick:_(i=>s(S)(i,t,c),["stop"])},null,8,Ze)):(a(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:s(p).includes(t.id),onClick:_(i=>s(S)(i,t,c),["stop"])},null,8,es)),o("span",ss,[v(C,{id:c+1,raw:t},null,8,["id","raw"])])]),o("div",{class:"image",onClick:_(i=>U(t),["stop"])},[B.value.includes(t.id)?(a(),l("img",os)):!N.value.includes(t.id)&&t.fileId?(a(),l("img",{key:1,class:"image-thumb",src:s(Se)(t.fileId,"&w=50&h=50"),onError:i=>Z(t.id)},null,40,ns)):t.extension?(a(),l("img",{key:2,src:`/ficons/${t.extension}.svg`,class:"svg",onError:i=>ee(t.id)},null,40,as)):(a(),l("img",ls))],8,ts),o("div",is,d(t.name),1),o("div",cs,[o("span",null,d(s(Ve)(t.size)),1),g((a(),l("span",null,[Fe(d(s(xe)(t.updatedAt)),1)])),[[k,s($e)(t.updatedAt)]])]),o("div",ds,[g((a(),l("button",{class:"btn-icon sm",onClick:_(i=>s(F)(t.path),["stop"])},[n[4]||(n[4]=o("md-ripple",null,null,-1)),v(u)],8,rs)),[[k,e.$t("download")]]),v(le,null,{content:I(i=>[o("section",_s,[o("div",ps,[o("div",vs,d(e.$t("path")),1),o("div",ks,d(t.path),1)])])]),default:I(()=>[g((a(),l("button",us,[n[5]||(n[5]=o("md-ripple",null,null,-1)),v(ae)])),[[k,e.$t("info")]])]),_:2},1024)])],42,qe))]),_:1},8,["data-sources"])):m("",!0),!s(E)&&r.value.length===0?(a(),l("div",hs,d(e.$t(s(be)(s(E),s(P).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):m("",!0)],64)}}});export{bs as default};
