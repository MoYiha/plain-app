import{_ as fe}from"./VPagination.vuevuetypescriptsetuptruelang-BmXTgLz3.js";import{d as he,e as ye,s as be,f as Ce,r as b,u as we,D as Te,E as Se,F as $e,G as Le,i as Me,H as xe,I as De,c as l,o as n,a as o,j as r,k as e,n as C,h as w,t as c,J as Ae,x as _,K as Ie,L as qe,M as O,N as A,O as j,P as Ee,Q as Ve,A as Ue,B as Be,R as Ne,S as Re,T as He,U as Ke,V as Qe,W as ze,X as Ge,y as Pe,Y as Fe,Z as Oe,$ as je,a0 as T,C as Je}from"./index-Dohfv8Fq.js";import{_ as We}from"./call-outline-rounded-B_RMlFtN.js";import{_ as Xe,a as Ye}from"./SearchInput-NYtHFioA.js";import{u as Ze,a as es}from"./tags-TPcx2lPg.js";import{u as ss,a as ts}from"./key-events-COB8z-tk.js";import{u as as}from"./search-BGPnRmZx.js";import"./search-rounded-DoLKRhlL.js";import"./rss-feed-rounded-DCFCzJSD.js";import"./vee-validate-BgwL6Mce.js";const os={class:"top-app-bar"},ns=["checked","indeterminate"],ls={class:"title"},is={key:0},cs={key:1},ds={class:"actions"},rs={class:"scroll-content"},us=["onClick","onMouseover"],_s={class:"start"},ps=["checked","onClick"],ms=["checked","onClick"],vs={class:"number"},gs={class:"title"},ks=["innerHTML"],fs={class:"actions"},hs=["onClick"],ys={key:0,indeterminate:"",class:"spinner-sm"},bs=["onClick"],Cs={class:"info"},ws={class:"time"},Ts={class:"start"},Ss={class:"number"},$s={key:0,class:"no-data-placeholder"},p=50,Ls=he({__name:"MessagesView",setup(Ms){var F;const J=ye(),{app:W}=be(Ce()),m=b([]),{t:I}=we(),{parseQ:X}=as(),q=Te({tagIds:[]}),u=Se.SMS,E=$e(),V=E.query,S=b(parseInt(((F=V.page)==null?void 0:F.toString())??"1")),k=b(""),{tags:f,fetch:Y}=Ze(u),{addToTags:Z}=es(u,f),{selectedIds:v,allChecked:U,realAllChecked:$,selectRealAll:ee,allCheckedAlertVisible:se,clearSelection:L,toggleAllChecked:B,toggleSelect:N,total:d,checked:M,shiftEffectingIds:R,handleItemClick:te,handleMouseOver:ae,selectAll:oe,shouldSelect:ne}=ss(m),H=s=>{const a=E.query.q;Pe(J,a?`/messages?page=${s}&q=${a}`:`/messages?page=${s}`)},{keyDown:K,keyUp:Q}=ts(d,p,S,oe,L,H,()=>{}),{loading:x,fetch:D}=Le({handle:(s,a)=>{a?Ue(I(a),"error"):s&&(m.value=s.messages,d.value=s.messageCount)},document:Ve,variables:()=>({offset:(S.value-1)*p,limit:p,query:k.value})}),le=["1","2","3"].map(s=>({id:s,name:I("message_type."+s)}));function ie(s){Fe(Oe,{type:u,tags:f.value,item:{key:s.id,title:"",size:0},selected:f.value.filter(a=>s.tags.some(h=>h.id===a.id))})}const z=b(""),{mutate:ce,loading:de}=Me({document:Be});function re(s){z.value=s.id,ce({number:s.address})}function ue(s){return s?`/messages?q=${s}`:"/messages"}const G=s=>{s.type===u&&(L(),D())},P=s=>{s.type===u&&D()};return xe(()=>{var s;k.value=je(((s=V.q)==null?void 0:s.toString())??""),X(q,k.value),Y(),D(),T.on("item_tags_updated",P),T.on("items_tags_updated",G),window.addEventListener("keydown",K),window.addEventListener("keyup",Q)}),De(()=>{T.off("item_tags_updated",P),T.off("items_tags_updated",G),window.removeEventListener("keydown",K),window.removeEventListener("keyup",Q)}),(s,a)=>{const h=Ie,_e=Xe,pe=Ye,me=Ne,ve=We,ge=He,ke=fe,y=Ae("tooltip");return n(),l(A,null,[o("div",os,[o("md-checkbox",{"touch-target":"wrapper",checked:e(U),indeterminate:!e(U)&&e(M),onChange:a[0]||(a[0]=(...t)=>e(B)&&e(B)(...t))},null,40,ns),o("div",ls,[e(v).length?(n(),l("span",is,c(s.$t("x_selected",{count:e($)?e(d).toLocaleString():e(v).length.toLocaleString()})),1)):(n(),l("span",cs,c(s.$t("page_title.messages"))+" ("+c(e(d).toLocaleString())+")",1)),e(M)?C((n(),l("button",{key:2,class:"btn-icon",onClick:a[1]||(a[1]=_(t=>e(Z)(e(v),e($),k.value),["stop"]))},[a[2]||(a[2]=o("md-ripple",null,null,-1)),r(h)])),[[y,s.$t("add_to_tags")]]):w("",!0)]),o("div",ds,[r(_e,{filter:q,tags:e(f),types:e(le),"get-url":ue},null,8,["filter","tags","types"])])]),r(pe,{limit:p,total:e(d),"all-checked-alert-visible":e(se),"real-all-checked":e($),"select-real-all":e(ee),"clear-selection":e(L)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),o("div",rs,[o("div",{class:O(["sms-list",{"select-mode":e(M)}])},[(n(!0),l(A,null,j(m.value,(t,g)=>(n(),l("section",{key:t.id,class:O(["sms-item selectable-card",{selected:e(v).includes(t.id),selecting:e(R).includes(t.id)}]),onClick:_(i=>e(te)(i,t,g,()=>{}),["stop"]),onMouseover:i=>e(ae)(i,g)},[o("div",_s,[e(R).includes(t.id)?(n(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:e(ne),onClick:_(i=>e(N)(i,t,g),["stop"])},null,8,ps)):(n(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:e(v).includes(t.id),onClick:_(i=>e(N)(i,t,g),["stop"])},null,8,ms)),o("span",vs,[r(me,{id:g+1,raw:t},null,8,["id","raw"])])]),o("div",gs,c(t.address),1),o("div",{class:"subtitle",innerHTML:e(Re)(t.body)},null,8,ks),o("div",fs,[C((n(),l("button",{class:"btn-icon sm",onClick:_(i=>ie(t),["stop"])},[a[3]||(a[3]=o("md-ripple",null,null,-1)),r(h)],8,hs)),[[y,s.$t("add_to_tags")]]),e(de)&&z.value===t.id?(n(),l("md-circular-progress",ys)):C((n(),l("button",{key:1,class:"btn-icon sm",onClick:_(i=>re(t),["stop"])},[a[4]||(a[4]=o("md-ripple",null,null,-1)),r(ve)],8,bs)),[[y,s.$t("make_a_phone_call")]])]),o("div",Cs,[o("span",null,c(s.$t(`message_type.${t.type}`)),1),r(ge,{tags:t.tags,type:e(u),"only-links":!0},null,8,["tags","type"])]),o("div",ws,[C((n(),l("span",null,[Qe(c(e(ze)(t.date)),1)])),[[y,e(Ke)(t.date)]])])],42,us))),128)),e(x)&&m.value.length===0?(n(),l(A,{key:0},j(20,t=>o("section",{key:t,class:"sms-item selectable-card-skeleton"},[o("div",Ts,[a[5]||(a[5]=o("div",{class:"checkbox"},[o("div",{class:"skeleton-checkbox"})],-1)),o("span",Ss,c(t),1)]),a[6]||(a[6]=Ge('<div class="title" data-v-d5f0aaae><div class="skeleton-text skeleton-title" data-v-d5f0aaae></div></div><div class="subtitle" data-v-d5f0aaae><div class="skeleton-text skeleton-subtitle" data-v-d5f0aaae></div><div class="skeleton-text skeleton-subtitle" data-v-d5f0aaae></div></div><div class="actions" data-v-d5f0aaae><div class="skeleton-text skeleton-actions" data-v-d5f0aaae></div></div><div class="info" data-v-d5f0aaae><div class="skeleton-text skeleton-info" data-v-d5f0aaae></div></div><div class="time" data-v-d5f0aaae><div class="skeleton-text skeleton-time" data-v-d5f0aaae></div></div>',5))])),64)):w("",!0)],2),!e(x)&&m.value.length===0?(n(),l("div",$s,c(s.$t(e(Ee)(e(x),e(W).permissions,"READ_SMS"))),1)):w("",!0),e(d)>p?(n(),qe(ke,{key:1,page:S.value,go:H,total:e(d),limit:p},null,8,["page","total"])):w("",!0)])],64)}}}),Rs=Je(Ls,[["__scopeId","data-v-d5f0aaae"]]);export{Rs as default};
