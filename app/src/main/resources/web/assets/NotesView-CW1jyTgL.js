import{_ as He}from"./VPagination.vuevuetypescriptsetuptruelang-CHD_8v0v.js";import{e as ge,c as r,J as a,o as s,a as d,d as Fe,t as w,m as Ke,i as U,bo as Je,K as j,a5 as q,L as G,bp as We,f as Xe,r as O,u as Ye,M as Ze,N as et,bq as tt,O as st,P as ot,j as S,k as i,l as e,U as L,Q as y,R as nt,q as h,z as u,p as at,V as lt,T as pe,br as it,W as rt,ai as ct,ak as dt,bs as ut,F as _t,bt as pt,a8 as mt,aO as ht,aS as vt,S as gt,G as me,bu as kt,$ as ft,a0 as yt,a1 as $t,B as R,a2 as he,a3 as bt,ab as Tt,bn as wt,ac as qt,a6 as ve,a4 as Ct,bv as Nt,I as St}from"./index-DRp6xo3j.js";import{_ as Lt}from"./FieldId.vuevuetypescriptsetuptruelang-slfJ4h1L.js";import{_ as Dt,u as It,b as Vt,a as xt}from"./key-events-cECSsEaK.js";import{_ as Mt,a as Et,b as At}from"./SearchInput-BJwFSU_P.js";import{_ as Qt}from"./VCheckbox-COaKMA3E.js";import{u as zt,a as Bt}from"./tags-DBIbojtk.js";import{u as Pt}from"./search-VN1T4MU3.js";import"./search-rounded-DveNm3Pb.js";const Ot={key:0,class:"note-item selectable-card-skeleton"},Rt={class:"list-item-start"},Ut={class:"number"},jt=ge({__name:"NoteSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(D){return(c,_)=>{const p=Dt;return c.isPhone?(s(),a(p,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":3})):(s(),r("section",Ot,[d("div",Rt,[_[0]||(_[0]=d("div",{class:"skeleton-checkbox"},null,-1)),d("span",Ut,w(c.index),1)]),_[1]||(_[1]=Fe('<div class="title"><div class="skeleton-text lg" style="width:50%;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:40%;"></div><div class="skeleton-text" style="width:40%;margin-block-start:8px;"></div></div><div class="actions"><div class="skeleton-text" style="width:140px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',4))]))}}}),Gt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ht(D,c){return s(),r("svg",Gt,c[0]||(c[0]=[d("path",{fill:"currentColor",d:"M19 17.7v1.8q0 .2.15.35t.35.15t.35-.15t.15-.35v-3q0-.2-.15-.35T19.5 16h-3q-.2 0-.35.15t-.15.35t.15.35t.35.15h1.8l-2.45 2.45q-.15.15-.15.35t.15.35t.35.15t.35-.15zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v5q0 .425-.288.713T20 11t-.712-.288T19 10V5H5v14h5q.425 0 .713.288T11 20t-.288.713T10 21zm0-3v1V5v6.075V11zm2-2q0 .425.288.713T8 17h2.075q.425 0 .713-.288t.287-.712t-.287-.712t-.713-.288H8q-.425 0-.712.288T7 16m0-4q0 .425.288.713T8 13h5q.425 0 .713-.288T14 12t-.288-.712T13 11H8q-.425 0-.712.288T7 12m0-4q0 .425.288.713T8 9h8q.425 0 .713-.288T17 8t-.288-.712T16 7H8q-.425 0-.712.288T7 8m11 15q-2.075 0-3.537-1.463T13 18t1.463-3.537T18 13t3.538 1.463T23 18t-1.463 3.538T18 23"},null,-1)]))}const Ft=Ke({name:"material-symbols-export-notes-outline-rounded",render:Ht}),Kt=(D,c)=>{const{mutate:_,onDone:p}=U({document:Je}),$=j(new Map);return p(l=>{$.delete(l.data.trashNotes),D(),c(),q.emit("refetch_tags",G.NOTE),q.emit("notes_actioned",{action:"trash"})}),{trashLoading(l){return $.get(l)??!1},trash(l){$.set(l,!0),_({query:l})}}},Jt=(D,c)=>{const{mutate:_,onDone:p}=U({document:We}),$=j(new Map);return p(l=>{$.delete(l.data.restoreNotes),D(),c(),q.emit("refetch_tags",G.NOTE),q.emit("notes_actioned",{action:"restore"})}),{restoreLoading(l){return $.get(l)??!1},restore(l){$.set(l,!0),_({query:l})}}},Wt={class:"top-app-bar"},Xt={class:"title"},Yt={key:0},Zt={key:1},es={class:"actions"},ts={key:1,class:"scroller"},ss=["href"],os=["onClick","onMouseover"],ns={class:"list-item-start"},as={class:"number"},ls={class:"title"},is={class:"subtitle"},rs={class:"actions"},cs={class:"time"},ds={key:3,class:"no-data-placeholder"},M=50,us=ge({__name:"NotesView",setup(D){var re;const c=at("isPhone"),_=Xe(),p=O([]),{t:$}=Ye(),{parseQ:l,buildQ:ke}=Pt(),g=j({tagIds:[],trash:!1}),I=G.NOTE,H=Ze(),F=H.query,z=O(parseInt(((re=F.page)==null?void 0:re.toString())??"1")),C=O(""),{tags:E,fetch:fe}=zt(I),{selectedIds:T,allChecked:K,realAllChecked:V,selectRealAll:ye,allCheckedAlertVisible:$e,clearSelection:N,toggleAllChecked:be,toggleSelect:J,total:k,checked:B,shiftEffectingIds:W,handleItemClick:Te,handleMouseOver:we,selectAll:qe,shouldSelect:Ce}=It(p),{addToTags:Ne}=Bt(I,E),X=t=>{const n=H.query.q;R(_,n?`/notes?page=${t}&q=${n}`:`/notes?page=${t}`)},{keyDown:Y,keyUp:Z}=xt(k,M,z,qe,N,X,()=>{te(T.value,V.value,k.value,C.value)}),{loading:P,fetch:x}=et({handle:(t,n)=>{n?_t($(n),"error"):t&&(p.value=t.notes,k.value=t.noteCount)},document:ut,variables:()=>({offset:(z.value-1)*M,limit:M,query:C.value})});function Se(t){he(bt,{type:I,tags:E.value,item:{key:t.id,title:"",size:0},selected:E.value.filter(n=>t.tags.some(A=>A.id===n.id))})}function ee(t){return t?`/notes?q=${t}`:"/notes"}const{mutate:Le,onDone:De}=U({document:pt}),Ie=()=>{Le({query:Q()})},Q=()=>{let t=C.value;return V.value||(t=`ids:${T.value.join(",")}`),t};De(t=>{tt(t.data.exportNotes,"application/json","notes.json")});const{deleteItems:te}=Vt(Nt,()=>{N(),x()});function Ve(t){he(qt,{id:t.id,name:wt(t.title,{length:20}),gql:Tt`
      mutation DeleteNote($query: String!) {
        deleteNotes(query: $query)
      }
    `,variables:()=>({query:`ids:${t.id}`}),done:()=>{N(),k.value--},typeName:"Note"})}const{trashLoading:xe,trash:se}=Kt(N,x),{restoreLoading:oe,restore:ne}=Jt(N,x);function Me(t){R(_,ae(t))}function ae(t){const n=ve.currentRoute.value.query.q;return n?`/notes/${t.id}?q=${n}`:`/notes/${t.id}`}function Ee(){ve.push("/notes/create")}const le=t=>{t.type===I&&(N(),x())},ie=t=>{t.type===I&&x()};function Ae(t){Object.assign(g,t),R(_,ee(ke(g)))}return st(()=>{var t;C.value=Ct(((t=F.q)==null?void 0:t.toString())??""),l(g,C.value),g.trash===void 0&&(g.trash=!1),fe(),x(),q.on("item_tags_updated",ie),q.on("items_tags_updated",le),window.addEventListener("keydown",Y),window.addEventListener("keyup",Z)}),ot(()=>{q.off("item_tags_updated",ie),q.off("items_tags_updated",le),window.removeEventListener("keydown",Y),window.removeEventListener("keyup",Z)}),(t,n)=>{const A=Qt,ce=mt,b=ct,de=ht,ue=vt,_e=gt,Qe=Ft,ze=Mt,Be=dt,Pe=At,Oe=Et,Re=jt,Ue=Lt,je=ft,Ge=He,f=nt("tooltip");return s(),r(L,null,[d("div",Wt,[i(A,{"touch-target":"wrapper",checked:e(K),indeterminate:!e(K)&&e(B),onChange:e(be)},null,8,["checked","indeterminate","onChange"]),d("div",Xt,[e(T).length?(s(),r("span",Yt,w(t.$t("x_selected",{count:e(V)?e(k).toLocaleString():e(T).length.toLocaleString()})),1)):(s(),r("span",Zt,w(t.$t("page_title.notes"))+" ("+w(e(k).toLocaleString())+")",1)),e(B)?(s(),r(L,{key:2},[g.trash?(s(),r(L,{key:0},[y((s(),a(b,{onClick:n[0]||(n[0]=u(m=>e(te)(e(T),e(V),e(k),C.value),["stop"]))},{default:h(()=>[i(ce)]),_:1})),[[f,t.$t("delete")]]),y((s(),a(b,{loading:e(oe)(Q()),onClick:n[1]||(n[1]=u(m=>e(ne)(Q()),["stop"]))},{default:h(()=>[i(de)]),_:1},8,["loading"])),[[f,t.$t("restore")]])],64)):(s(),r(L,{key:1},[y((s(),a(b,{onClick:n[2]||(n[2]=u(m=>e(se)(Q()),["stop"]))},{default:h(()=>[i(ue)]),_:1})),[[f,t.$t("move_to_trash")]]),y((s(),a(b,{onClick:n[3]||(n[3]=u(m=>e(Ne)(e(T),e(V),C.value),["stop"]))},{default:h(()=>[i(_e)]),_:1})),[[f,t.$t("add_to_tags")]]),y((s(),a(b,{onClick:u(Ie,["stop"])},{default:h(()=>[i(Qe)]),_:1})),[[f,t.$t("export_notes")]])],64))],64)):S("",!0)]),d("div",es,[i(ze,{filter:g,tags:e(E),"get-url":ee,"show-trash":!0,"show-chips":!e(c),"is-phone":e(c)},null,8,["filter","tags","show-chips","is-phone"]),g.trash?S("",!0):(s(),a(Be,{key:0,class:"btn-sm",onClick:u(Ee,["prevent"])},{default:h(()=>[me(w(t.$t("create")),1)]),_:1}))])]),e(c)?(s(),a(Pe,{key:0,class:"mobile-search-filters",filter:g,tags:e(E),feeds:[],buckets:[],types:[],onFilterChange:Ae},null,8,["filter","tags"])):S("",!0),i(Oe,{limit:M,total:e(k),"all-checked-alert-visible":e($e),"real-all-checked":e(V),"select-real-all":e(ye),"clear-selection":e(N)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(P)&&p.value.length===0?(s(),r("div",ts,[(s(),r(L,null,lt(20,m=>i(Re,{key:m,index:m,"is-phone":e(c)},null,8,["index","is-phone"])),64))])):S("",!0),p.value.length?(s(),a(e(it),{key:2,class:pe(["scroller",{"select-mode":e(B)}]),"data-key":"id","data-sources":p.value,"estimate-size":100},{item:h(({index:m,item:o})=>[(s(),r("a",{key:o.id,class:"item-link",href:ae(o)},[d("article",{class:pe(["note-item selectable-card",{selected:e(T).includes(o.id)||o.id==t.$route.params.id,selecting:e(W).includes(o.id)}]),onClick:u(v=>e(Te)(v,o,m,()=>{Me(o)}),["stop","prevent"]),onMouseover:v=>e(we)(v,m)},[d("div",ns,[e(W).includes(o.id)?(s(),a(A,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(Ce),onClick:u(v=>e(J)(v,o,m),["stop"])},null,8,["checked","onClick"])):(s(),a(A,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(T).includes(o.id),onClick:u(v=>e(J)(v,o,m),["stop"])},null,8,["checked","onClick"])),d("span",as,[i(Ue,{id:m+1,raw:o},null,8,["id","raw"])])]),d("div",ls,w(e(kt)(o.title.split(`
`)[0].trimStart())||t.$t("meta_no_title")),1),d("div",is,[i(je,{tags:o.tags,type:e(I),"only-links":!0},null,8,["tags","type"])]),d("div",rs,[g.trash?(s(),r(L,{key:0},[y((s(),a(b,{class:"sm",onClick:u(v=>Ve(o),["stop","prevent"])},{default:h(()=>[i(ce)]),_:2},1032,["onClick"])),[[f,t.$t("delete")]]),y((s(),a(b,{class:"sm",loading:e(oe)(`ids:${o.id}`),onClick:u(v=>e(ne)(`ids:${o.id}`),["stop","prevent"])},{default:h(()=>[i(de)]),_:2},1032,["loading","onClick"])),[[f,t.$t("restore")]])],64)):(s(),r(L,{key:1},[y((s(),a(b,{class:"sm",loading:e(xe)(`ids:${o.id}`),onClick:u(v=>e(se)(`ids:${o.id}`),["stop","prevent"])},{default:h(()=>[i(ue)]),_:2},1032,["loading","onClick"])),[[f,t.$t("move_to_trash")]]),y((s(),a(b,{class:"sm",onClick:u(v=>Se(o),["stop","prevent"])},{default:h(()=>[i(_e)]),_:2},1032,["onClick"])),[[f,t.$t("add_to_tags")]])],64))]),d("div",cs,[y((s(),r("span",null,[me(w(e($t)(o.updatedAt)),1)])),[[f,e(yt)(o.updatedAt)]])])],42,os)],8,ss))]),footer:h(()=>[e(k)>M?(s(),a(Ge,{key:0,page:z.value,go:X,total:e(k),limit:M},null,8,["page","total"])):S("",!0)]),_:1},8,["data-sources","class"])):S("",!0),!e(P)&&p.value.length===0?(s(),r("div",ds,w(t.$t(e(rt)(e(P)))),1)):S("",!0)],64)}}}),$s=St(us,[["__scopeId","data-v-5e8e7d5c"]]);export{$s as default};
