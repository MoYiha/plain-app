import{_ as $e}from"./VPagination.vuevuetypescriptsetuptruelang-JQdiaM3z.js";import{_ as we}from"./call-outline-rounded-CjYYQeWh.js";import{e as Le,f as Te,s as Se,g as qe,r as T,u as De,G as Ie,H as Ae,I as xe,J as Ee,i as Me,K as Ve,L as Ne,c as o,o as n,a as l,k as r,l as t,j as S,t as d,Q as q,p as g,M as Ge,y as p,a6 as Qe,N as Ue,O as Be,P as W,R as J,S as Ke,a7 as Re,D as ze,E as He,U as Oe,a8 as Pe,W as je,X as Fe,Y as We,Z as Je,d as Xe,z as Ye,$ as X,a0 as Ze,a9 as et,aa as tt,a1 as st,a2 as _,ab as at,F as lt}from"./index-BjwOe50_.js";import{_ as nt,a as ot}from"./SearchInput-CiogdeIK.js";import{b as ct,u as it,a as dt}from"./key-events-C_0dFOja.js";import{u as rt}from"./search-Cp54c8dH.js";import{u as ut,a as pt}from"./tags-CUGCZoM5.js";import"./search-rounded-DTTX8wGU.js";const _t={class:"top-app-bar"},vt=["checked","indeterminate"],mt={class:"title"},kt={key:0},gt={key:1},ht={class:"actions"},yt={class:"scroll-content"},ft=["onClick","onMouseover"],bt={class:"start"},Ct=["checked","onClick"],$t=["checked","onClick"],wt={class:"number"},Lt={class:"title"},Tt={class:"subtitle"},St={class:"actions"},qt=["onClick"],Dt={key:0,indeterminate:"",class:"spinner-sm"},It=["onClick"],At=["onClick"],xt={class:"geo"},Et={class:"time"},Mt={class:"start"},Vt={class:"number"},Nt={key:0,class:"no-data-placeholder"},h=50,Gt=Le({__name:"CallsView",setup(Qt){var j;const Y=Te(),{app:Z}=Se(qe()),y=T([]),{t:D}=De(),{parseQ:ee}=rt(),E=Ie({tagIds:[]}),u=Ae.CALL,M=xe(),V=M.query,I=T(parseInt(((j=V.page)==null?void 0:j.toString())??"1")),m=T(""),{tags:C,fetch:te}=ut(u),{addToTags:se}=pt(u,C),{deleteItems:N}=ct(at,()=>{$(),w(),_.emit("refetch_tags",u),_.emit("calls_deleted")}),{selectedIds:v,allChecked:G,realAllChecked:f,selectRealAll:ae,allCheckedAlertVisible:le,clearSelection:$,toggleAllChecked:Q,toggleSelect:U,total:c,checked:A,shiftEffectingIds:B,handleItemClick:ne,handleMouseOver:oe,selectAll:ce,shouldSelect:ie}=it(y),K=e=>{const s=M.query.q;Ye(Y,s?`/calls?page=${e}&q=${s}`:`/calls?page=${e}`)},{keyDown:R,keyUp:z}=dt(c,h,I,ce,$,K,()=>{N(v.value,f.value,c.value,m.value)}),{loading:x,fetch:w}=Ee({handle:(e,s)=>{s?ze(D(s),"error"):e&&(y.value=e.calls,c.value=e.callCount)},document:Re,variables:()=>({offset:(I.value-1)*h,limit:h,query:m.value})}),de=["1","2","3"].map(e=>({id:e,name:D("call_type."+e)}));function re(e){X(Ze,{type:u,tags:C.value,item:{key:e.id,title:"",size:0},selected:C.value.filter(s=>e.tags.some(L=>L.id===s.id))})}function ue(e){return e?`/calls?q=${e}`:"/calls"}const H=e=>{e.type===u&&($(),w())},O=e=>{e.type===u&&w()};function pe(e){if(!e)return"";const s=[];return e.isp&&s.push(D("phone_isp_type."+e.isp)),e.city===e.province?s.push(e.city):s.push(`${e.province}${e.city}`),s.join(", ")}const P=T(""),{mutate:_e,loading:ve}=Me({document:He});function me(e){P.value=e.id,_e({number:e.number})}function ke(e){X(tt,{id:e.id,name:e.number,gql:et`
      mutation DeleteCall($query: String!) {
        deleteCalls(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),typeName:"Call",done:()=>{c.value--,e.tags.length&&_.emit("refetch_tags",u),_.emit("calls_deleted")}})}return Ve(()=>{var e;m.value=st(((e=V.q)==null?void 0:e.toString())??""),ee(E,m.value),te(),w(),_.on("item_tags_updated",O),_.on("items_tags_updated",H),window.addEventListener("keydown",R),window.addEventListener("keyup",z)}),Ne(()=>{_.off("item_tags_updated",O),_.off("items_tags_updated",H),window.removeEventListener("keydown",R),window.removeEventListener("keyup",z)}),(e,s)=>{const L=Qe,F=Ue,ge=nt,he=ot,ye=Oe,fe=je,be=we,Ce=$e,k=Ge("tooltip");return n(),o(q,null,[l("div",_t,[l("md-checkbox",{"touch-target":"wrapper",checked:t(G),indeterminate:!t(G)&&t(A),onChange:s[0]||(s[0]=(...a)=>t(Q)&&t(Q)(...a))},null,40,vt),l("div",mt,[t(v).length?(n(),o("span",kt,d(e.$t("x_selected",{count:t(f)?t(c).toLocaleString():t(v).length.toLocaleString()})),1)):(n(),o("span",gt,d(e.$t("page_title.calls"))+" ("+d(t(c).toLocaleString())+")",1)),t(A)?(n(),o(q,{key:2},[g((n(),o("button",{class:"btn-icon",onClick:s[1]||(s[1]=p(a=>t(N)(t(v),t(f),t(c),m.value),["stop"]))},[s[3]||(s[3]=l("md-ripple",null,null,-1)),r(L)])),[[k,e.$t("delete")]]),g((n(),o("button",{class:"btn-icon",onClick:s[2]||(s[2]=p(a=>t(se)(t(v),t(f),m.value),["stop"]))},[s[4]||(s[4]=l("md-ripple",null,null,-1)),r(F)])),[[k,e.$t("add_to_tags")]])],64)):S("",!0)]),l("div",ht,[r(ge,{filter:E,tags:t(C),types:t(de),"get-url":ue},null,8,["filter","tags","types"])])]),r(he,{limit:h,total:t(c),"all-checked-alert-visible":t(le),"real-all-checked":t(f),"select-real-all":t(ae),"clear-selection":t($)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),l("div",yt,[l("div",{class:W(["call-list",{"select-mode":t(A)}])},[(n(!0),o(q,null,J(y.value,(a,b)=>(n(),o("section",{key:a.id,class:W(["call-item selectable-card",{selected:t(v).includes(a.id),selecting:t(B).includes(a.id)}]),onClick:p(i=>t(ne)(i,a,b,()=>{}),["stop"]),onMouseover:i=>t(oe)(i,b)},[l("div",bt,[t(B).includes(a.id)?(n(),o("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:t(ie),onClick:p(i=>t(U)(i,a,b),["stop"])},null,8,Ct)):(n(),o("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:t(v).includes(a.id),onClick:p(i=>t(U)(i,a,b),["stop"])},null,8,$t)),l("span",wt,[r(ye,{id:b+1,raw:a},null,8,["id","raw"])])]),l("div",Lt,d(a.name?a.name+" "+a.number:a.number),1),l("div",Tt,[l("span",null,d(t(Pe)(a.duration)),1),l("span",null,d(e.$t("call_type."+a.type)),1),r(fe,{tags:a.tags,type:t(u),"only-links":!0},null,8,["tags","type"])]),l("div",St,[g((n(),o("button",{class:"btn-icon sm",onClick:p(i=>ke(a),["stop"])},[s[5]||(s[5]=l("md-ripple",null,null,-1)),r(L)],8,qt)),[[k,e.$t("delete")]]),t(ve)&&P.value===a.id?(n(),o("md-circular-progress",Dt)):g((n(),o("button",{key:1,class:"btn-icon sm",onClick:p(i=>me(a),["stop"])},[s[6]||(s[6]=l("md-ripple",null,null,-1)),r(be)],8,It)),[[k,e.$t("make_a_phone_call")]]),g((n(),o("button",{class:"btn-icon sm",onClick:p(i=>re(a),["stop"])},[s[7]||(s[7]=l("md-ripple",null,null,-1)),r(F)],8,At)),[[k,e.$t("add_to_tags")]])]),l("div",xt,d(pe(a.geo)),1),l("div",Et,[g((n(),o("span",null,[We(d(t(Je)(a.startedAt)),1)])),[[k,t(Fe)(a.startedAt)]])])],42,ft))),128)),t(x)&&y.value.length===0?(n(),o(q,{key:0},J(20,a=>l("section",{key:a,class:"call-item selectable-card-skeleton"},[l("div",Mt,[s[8]||(s[8]=l("div",{class:"checkbox"},[l("div",{class:"skeleton-checkbox"})],-1)),l("span",Vt,d(a),1)]),s[9]||(s[9]=Xe('<div class="title" data-v-b01ce200><div class="skeleton-text skeleton-title" data-v-b01ce200></div></div><div class="subtitle" data-v-b01ce200><div class="skeleton-text skeleton-subtitle" data-v-b01ce200></div></div><div class="actions" data-v-b01ce200><div class="skeleton-text skeleton-actions" data-v-b01ce200></div></div><div class="geo" data-v-b01ce200><div class="skeleton-text skeleton-geo" data-v-b01ce200></div></div><div class="time" data-v-b01ce200><div class="skeleton-text skeleton-time" data-v-b01ce200></div></div>',5))])),64)):S("",!0)],2),!t(x)&&y.value.length===0?(n(),o("div",Nt,d(e.$t(t(Ke)(t(x),t(Z).permissions,"WRITE_CALL_LOG"))),1)):S("",!0),t(c)>h?(n(),Be(Ce,{key:1,page:I.value,go:K,total:t(c),limit:h},null,8,["page","total"])):S("",!0)])],64)}}}),jt=lt(Gt,[["__scopeId","data-v-b01ce200"]]);export{jt as default};
