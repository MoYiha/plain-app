import{e as w,ay as G,r as q,az as E,cr as U,i as C,cs as H,ct as P,S as v,o as p,p as c,k as f,F as y,t as i,l as a,aB as T,at as R,j as Z,Z as J,z as K,a as m,P as O,T as $,c as W,V as X,bz as Y,U as x,by as ee,am as te,aD as ae,a5 as h,bU as se,H as oe,u as S,L as ne,bj as le,E as A,a2 as de}from"./index-CuU5w3Fk.js";const re={class:"button-group"},ue=w({__name:"AddToTagsModal",props:{type:{type:String,required:!0},tags:{type:Array,default:()=>[]},query:{type:String,required:!0}},setup(d){const{handleSubmit:_}=G(),s=q("add_to_tags"),t=d,{value:o,errorMessage:n}=E("selectedTags",U().test("required","valid.required",e=>e.length),{initialValue:[]}),{mutate:l,loading:g,onDone:D}=C({document:H}),{mutate:F,loading:b,onDone:L}=C({document:P}),k=()=>{h.emit("items_tags_updated",{type:t.type}),h.emit("refetch_tags",t.type),T()};L(k),D(k);function M(e){o.value.includes(e)?se(o.value,r=>r.id===e.id):o.value.push(e)}const V=_(()=>{s.value==="add_to_tags"?F({type:t.type,tagIds:o.value.map(e=>e.id),query:t.query}):l({type:t.type,tagIds:o.value.map(e=>e.id),query:t.query})});return(e,r)=>{const z=Y,B=ee,I=R,N=J,Q=K,j=ae;return p(),v(j,{onClose:a(T)},{headline:c(()=>[y(i(e.$t("tags")),1)]),content:c(()=>[m("div",re,[m("button",{class:$({selected:s.value==="add_to_tags"}),onClick:r[0]||(r[0]=u=>s.value="add_to_tags")},i(e.$t("add_to_tags")),3),m("button",{class:$({selected:s.value==="remove_from_tags"}),onClick:r[1]||(r[1]=u=>s.value="remove_from_tags")},i(e.$t("remove_from_tags")),3)]),f(B,null,{default:c(()=>[(p(!0),W(x,null,X(d.tags,u=>(p(),v(z,{key:u.id,label:u.name,selected:a(o).includes(u),onClick:ie=>M(u)},null,8,["label","selected","onClick"]))),128))]),_:1}),O(m("div",{class:"invalid-feedback"},i(a(n)?e.$t(a(n)):""),513),[[te,a(n)]])]),actions:c(()=>[f(I,{value:"cancel",onClick:a(T)},{default:c(()=>[y(i(e.$t("cancel")),1)]),_:1},8,["onClick"]),f(Q,{value:"save",disabled:a(b)||a(g),onClick:a(V)},{default:c(()=>[a(b)||a(g)?(p(),v(N,{key:0,indeterminate:""})):Z("",!0),y(" "+i(e.$t("save")),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["onClose"])}}}),ce=oe(ue,[["__scopeId","data-v-311a7874"]]),ge=(d,_)=>{const{t:s}=S();return{addToTags:(t,o,n)=>{let l=n;if(!o){if(t.length===0){A(s("select_first"),"error");return}l=`ids:${t.join(",")}`}de(ce,{type:d,tags:_.value,query:l})}}},pe=(d,_=()=>{})=>{const s=q([]),{t}=S(),{loading:o,fetch:n}=ne({handle:async(l,g)=>{g?A(t(g),"error"):l&&(s.value=l.tags,_())},document:le,variables:{type:d}});return{tags:s,loading:o,fetch:n}};export{ge as a,pe as u};
