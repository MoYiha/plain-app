import{_ as Me}from"./VPagination.vuevuetypescriptsetuptruelang-CHD_8v0v.js";import{_ as Ie,u as De,a as qe}from"./key-events-cECSsEaK.js";import{e as se,c as n,J as h,o as a,a as o,d as Ae,t as d,f as Ve,s as Ee,g as Pe,r as T,u as Be,K as Ue,L as Ne,M as Qe,N as Re,i as He,O as Ke,P as ze,j as $,k as c,l as e,Q as L,R as Fe,z as m,S as je,p as Ge,T as Y,U as P,V as Z,W as Oe,X as Je,F as We,H as Xe,Y as Ye,Z as Ze,$ as es,a0 as ss,G as ts,a1 as as,B as ee,a2 as os,a3 as ns,a4 as ls,a5 as x,I as is}from"./index-DRp6xo3j.js";import{_ as cs}from"./call-outline-rounded-CPF2tTKf.js";import{_ as ds}from"./FieldId.vuevuetypescriptsetuptruelang-slfJ4h1L.js";import{_ as rs,a as _s,b as ps}from"./SearchInput-BJwFSU_P.js";import{_ as us}from"./VCheckbox-COaKMA3E.js";import{u as ms,a as gs}from"./tags-DBIbojtk.js";import{u as hs}from"./search-VN1T4MU3.js";import"./search-rounded-DveNm3Pb.js";const vs={key:0,class:"sms-item selectable-card-skeleton"},ks={class:"list-item-start"},ys={class:"number"},fs=se({__name:"MessageSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(te){return(r,_)=>{const M=Ie;return r.isPhone?(a(),h(M,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":3})):(a(),n("section",vs,[o("div",ks,[_[0]||(_[0]=o("div",{class:"skeleton-checkbox"},null,-1)),o("span",ys,d(r.index),1)]),_[1]||(_[1]=Ae('<div class="title"><div class="skeleton-text lg" style="width:120px;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:80%;"></div><div class="skeleton-text" style="width:80%;margin-block-start:8px;"></div></div><div class="actions"><div class="skeleton-text" style="width:140px;"></div></div><div class="info"><div class="skeleton-text" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',5))]))}}}),bs={class:"top-app-bar"},ws={class:"title"},$s={key:0},Cs={key:1},Ss={class:"actions"},Ts={class:"scroll-content"},Ls=["onClick","onMouseover"],xs={class:"list-item-start"},Ms={class:"number"},Is={class:"title"},Ds=["innerHTML"],qs={class:"actions"},As=["onClick"],Vs=["onClick"],Es={class:"info"},Ps={class:"time"},Bs={key:0,class:"no-data-placeholder"},g=50,Us=se({__name:"MessagesView",setup(te){var W;const r=Ge("isPhone"),_=Ve(),{app:M}=Ee(Pe()),v=T([]),{t:B}=Be(),{parseQ:ae,buildQ:oe}=hs(),k=Ue({tagIds:[]}),u=Ne.SMS,U=Qe(),N=U.query,I=T(parseInt(((W=N.page)==null?void 0:W.toString())??"1")),C=T(""),{tags:y,fetch:ne}=ms(u),{addToTags:le}=gs(u,y),{selectedIds:f,allChecked:Q,realAllChecked:D,selectRealAll:ie,allCheckedAlertVisible:ce,clearSelection:q,toggleAllChecked:de,toggleSelect:R,total:p,checked:A,shiftEffectingIds:H,handleItemClick:re,handleMouseOver:_e,selectAll:pe,shouldSelect:ue}=De(v),K=s=>{const l=U.query.q;ee(_,l?`/messages?page=${s}&q=${l}`:`/messages?page=${s}`)},{keyDown:z,keyUp:F}=qe(p,g,I,pe,q,K,()=>{}),{loading:V,fetch:E}=Re({handle:(s,l)=>{l?We(B(l),"error"):s&&(v.value=s.messages,p.value=s.messageCount)},document:Je,variables:()=>({offset:(I.value-1)*g,limit:g,query:C.value})}),me=["1","2","3"].map(s=>({id:s,name:B("message_type."+s)}));function ge(s){os(ns,{type:u,tags:y.value,item:{key:s.id,title:"",size:0},selected:y.value.filter(l=>s.tags.some(b=>b.id===l.id))})}const j=T(""),{mutate:he,loading:ve}=He({document:Xe});function ke(s){j.value=s.id,he({number:s.address})}function G(s){return s?`/messages?q=${s}`:"/messages"}const O=s=>{s.type===u&&(q(),E())},J=s=>{s.type===u&&E()};function ye(s){Object.assign(k,s),ee(_,G(oe(k)))}return Ke(()=>{var s;C.value=ls(((s=N.q)==null?void 0:s.toString())??""),ae(k,C.value),ne(),E(),x.on("item_tags_updated",J),x.on("items_tags_updated",O),window.addEventListener("keydown",z),window.addEventListener("keyup",F)}),ze(()=>{x.off("item_tags_updated",J),x.off("items_tags_updated",O),window.removeEventListener("keydown",z),window.removeEventListener("keyup",F)}),(s,l)=>{const b=us,X=je,fe=rs,be=ps,we=_s,$e=ds,Ce=Ze,Se=cs,Te=es,Le=fs,xe=Me,S=Fe("tooltip");return a(),n(P,null,[o("div",bs,[c(b,{"touch-target":"wrapper",checked:e(Q),indeterminate:!e(Q)&&e(A),onChange:e(de)},null,8,["checked","indeterminate","onChange"]),o("div",ws,[e(f).length?(a(),n("span",$s,d(s.$t("x_selected",{count:e(D)?e(p).toLocaleString():e(f).length.toLocaleString()})),1)):(a(),n("span",Cs,d(s.$t("page_title.messages"))+" ("+d(e(p).toLocaleString())+")",1)),e(A)?L((a(),n("button",{key:2,class:"btn-icon",onClick:l[0]||(l[0]=m(t=>e(le)(e(f),e(D),C.value),["stop"]))},[c(X)])),[[S,s.$t("add_to_tags")]]):$("",!0)]),o("div",Ss,[c(fe,{filter:k,tags:e(y),types:e(me),"get-url":G,"show-chips":!e(r),"is-phone":e(r)},null,8,["filter","tags","types","show-chips","is-phone"])])]),e(r)?(a(),h(be,{key:0,class:"mobile-search-filters",filter:k,tags:e(y),feeds:[],buckets:[],types:[],onFilterChange:ye},null,8,["filter","tags"])):$("",!0),c(we,{limit:g,total:e(p),"all-checked-alert-visible":e(ce),"real-all-checked":e(D),"select-real-all":e(ie),"clear-selection":e(q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),o("div",Ts,[o("div",{class:Y(["sms-list",{"select-mode":e(A)}])},[(a(!0),n(P,null,Z(v.value,(t,w)=>(a(),n("section",{key:t.id,class:Y(["sms-item selectable-card",{selected:e(f).includes(t.id),selecting:e(H).includes(t.id)}]),onClick:m(i=>e(re)(i,t,w,()=>{}),["stop"]),onMouseover:i=>e(_e)(i,w)},[o("div",xs,[e(H).includes(t.id)?(a(),h(b,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(ue),onClick:m(i=>e(R)(i,t,w),["stop"])},null,8,["checked","onClick"])):(a(),h(b,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(f).includes(t.id),onClick:m(i=>e(R)(i,t,w),["stop"])},null,8,["checked","onClick"])),o("span",Ms,[c($e,{id:w+1,raw:t},null,8,["id","raw"])])]),o("div",Is,d(t.address),1),o("div",{class:"subtitle",innerHTML:e(Ye)(t.body)},null,8,Ds),o("div",qs,[L((a(),n("button",{class:"btn-icon sm",onClick:m(i=>ge(t),["stop"])},[c(X)],8,As)),[[S,s.$t("add_to_tags")]]),e(ve)&&j.value===t.id?(a(),h(Ce,{key:0,indeterminate:"",class:"sm"})):L((a(),n("button",{key:1,class:"btn-icon sm",onClick:m(i=>ke(t),["stop"])},[c(Se)],8,Vs)),[[S,s.$t("make_a_phone_call")]])]),o("div",Es,[o("span",null,d(s.$t(`message_type.${t.type}`)),1),c(Te,{tags:t.tags,type:e(u),"only-links":!0},null,8,["tags","type"])]),o("div",Ps,[L((a(),n("span",null,[ts(d(e(as)(t.date)),1)])),[[S,e(ss)(t.date)]])])],42,Ls))),128)),e(V)&&v.value.length===0?(a(),n(P,{key:0},Z(20,t=>c(Le,{key:t,index:t,"is-phone":e(r)},null,8,["index","is-phone"])),64)):$("",!0)],2),!e(V)&&v.value.length===0?(a(),n("div",Bs,d(s.$t(e(Oe)(e(V),e(M).permissions,"READ_SMS"))),1)):$("",!0),e(p)>g?(a(),h(xe,{key:1,page:I.value,go:K,total:e(p),limit:g},null,8,["page","total"])):$("",!0)])],64)}}}),Js=is(Us,[["__scopeId","data-v-2be0b974"]]);export{Js as default};
