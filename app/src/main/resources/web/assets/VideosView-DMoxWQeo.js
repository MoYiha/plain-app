import{_ as st}from"./VPagination.vuevuetypescriptsetuptruelang-C9URNuao.js";import{o,c as l,a as n,d as ot,u as nt,s as Ce,h as I,g as lt,I as at,i as ct,J as it,aC as $e,aD as dt,aF as _t,ag as ut,K as we,L as rt,M as pt,m as e,t as h,O as $,x as p,w as c,p as i,e as P,q as Te,v as g,N,P as Z,aE as mt,Q as vt,f as ht,C as Ie,aH as kt,aN as gt,aG as bt,al as yt,S as ft,ay as J,aJ as F,E as Se,a9 as Ee,U as Ct,V as $t,W as wt,X as Tt,ao as It,an as St,Y as Et,Z as qt,av as Vt,aK as Dt,$ as zt,a0 as f,ad as At,ap as Lt,a1 as Mt,aL as Bt,a3 as Nt,a2 as Ft}from"./index-BxNI00MG.js";import{_ as Kt,a as Rt,b as Ut,c as Ht}from"./grid-view-outline-rounded-C_6zsYJR.js";import{u as Qt,_ as Gt,a as Ot,b as Pt}from"./key-events-B5RXeznw.js";import{_ as Zt}from"./sort-rounded-BbQ1dmh_.js";import{_ as Jt}from"./upload-rounded-DLL-9Gf2.js";import{a as Wt}from"./tags-BUfgTqH4.js";import{u as Xt}from"./search-D1_YTViL.js";import"./rss-feed-rounded-Dj4EQ17i.js";import"./vee-validate.esm-9czZ1sUw.js";const Yt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},jt=n("path",{fill:"currentColor",d:"M17.525 10.625q.35-.225.35-.625t-.35-.625L12.65 6.25q-.375-.25-.763-.038t-.387.663v6.25q0 .45.388.663t.762-.038zM8 18q-.825 0-1.412-.587T6 16V4q0-.825.588-1.412T8 2h12q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm0-2h12V4H8zm-4 6q-.825 0-1.412-.587T2 20V7q0-.425.288-.712T3 6t.713.288T4 7v13h13q.425 0 .713.288T18 21t-.288.713T17 22zM8 4v12z"},null,-1),xt=[jt];function es(qe,W){return o(),l("svg",Yt,[...xt])}const ts={name:"material-symbols-video-library-outline-rounded",render:es},ss={class:"top-app-bar"},os=["checked","indeterminate"],ns={class:"title"},ls={key:0},as={key:1},cs=n("md-ripple",null,null,-1),is=n("md-ripple",null,null,-1),ds=n("md-ripple",null,null,-1),_s={class:"actions"},us=n("md-ripple",null,null,-1),rs={class:"btn-icon btn-sort"},ps=n("md-ripple",null,null,-1),ms={class:"menu-items"},vs=["onClick","selected"],hs={slot:"headline"},ks=n("md-ripple",null,null,-1),gs={class:"scroll-content"},bs=["onClick","onMouseover"],ys=["src","onError"],fs=["onClick"],Cs=n("md-ripple",null,null,-1),$s=["onClick"],ws=n("md-ripple",null,null,-1),Ts={class:"actions"},Is=["onClick"],Ss=n("md-ripple",null,null,-1),Es=["onClick"],qs=n("md-ripple",null,null,-1),Vs=["onClick"],Ds=n("md-ripple",null,null,-1),zs=["onClick"],As=n("md-ripple",null,null,-1),Ls=["onClick"],Ms=n("md-ripple",null,null,-1),Bs={class:"info"},Ns={class:"right"},Fs=["onClick","onMouseover"],Ks={class:"start"},Rs=["onClick","checked"],Us=["onClick","checked"],Hs={class:"number"},Qs=["src","onError"],Gs={class:"title"},Os={class:"subtitle"},Ps=["onClick"],Zs={class:"actions"},Js=["onClick"],Ws=n("md-ripple",null,null,-1),Xs=["onClick"],Ys=n("md-ripple",null,null,-1),js=["onClick"],xs=n("md-ripple",null,null,-1),eo={class:"time"},to={key:2,class:"no-data-placeholder"},S=55,po=ot({__name:"VideosView",setup(qe){var ge;const W=mt(),k=nt(),{videoSortBy:A}=Ce(k),E=I([]),{t:K}=lt(),{parseQ:Ve}=Xt(),X=at({tagIds:[]}),Y=ct(),{app:De,urlTokenKey:R}=Ce(Y),u=it.VIDEO,j=vt(),x=j.query,U=I(parseInt(((ge=x.page)==null?void 0:ge.toString())??"1")),q=I([]),H=I([]),ze=$e(()=>{const t={};return H.value.forEach(a=>{t[a.id]=a}),t}),C=I(""),{addToTags:Ae}=Wt(u,q),{deleteItems:ee,deleteItem:te}=dt(),{view:Le}=_t(u),{selectedIds:v,allChecked:se,realAllChecked:w,selectRealAll:Me,allCheckedAlertVisible:Be,clearSelection:V,toggleAllChecked:oe,toggleSelect:D,total:b,checked:z,shiftEffectingIds:L,handleItemClick:ne,handleMouseOver:le,selectAll:Ne,shouldSelect:ae}=Qt(E),{downloadItems:Fe}=ut(R,u,V,"videos.zip"),{downloadFile:ce}=It(R),ie=t=>{const a=j.query.q;ht(k,a?`/videos?page=${t}&q=${a}`:`/videos?page=${t}`)},{keyDown:de,keyUp:_e}=Pt(b,S,U,Ne,V,ie,()=>{ee(u,v.value,w.value,C.value)}),Q=I([]),Ke=St(),ue=$e(()=>E.value.map(t=>({src:J(t.fileId),name:F(t.path),duration:t.duration,size:t.size,path:t.path,data:t,type:u}))),re=t=>{Q.value.push(t)},{loading:Re,fetch:M}=we({handle:async(t,a)=>{if(a)Ie(K(a),"error");else if(t){const y=[];for(const T of t.videos)y.push({...T,fileId:kt(R.value,T.path)});E.value=y,b.value=t.videoCount}},document:gt,variables:()=>({offset:(U.value-1)*S,limit:S,query:C.value,sortBy:A.value}),appApi:!0});function B(t){Y.lightbox={sources:ue.value,index:t,visible:!0}}const{fetch:Ue}=we({handle:async(t,a)=>{a?Ie(K(a),"error"):t&&(q.value=t.tags,H.value=t.mediaBuckets)},document:bt,variables:{type:u},appApi:!0});function He(t,a){A.value=a,t.close()}function Qe(t){return t?`/videos?q=${t}`:"/videos"}function pe(t){Et(qt,{type:u,tags:q.value,item:{key:t.id,title:t.title,size:t.size},selected:q.value.filter(a=>t.tags.some(y=>y.id===a.id))})}function Ge(){k.videosCardView=!k.videosCardView}function Oe(){W.push("/files"),Vt(Dt,{message:K("upload_videos")})}const me=t=>{t.type===u&&(V(),M())},ve=t=>{t.type===u&&M()},he=t=>{t.type===u&&(V(),M())},ke=()=>{b.value--};return rt(()=>{var t;C.value=zt(((t=x.q)==null?void 0:t.toString())??""),Ve(X,C.value),Ue(),M(),f.on("item_tags_updated",ve),f.on("items_tags_updated",me),f.on("media_item_deleted",ke),f.on("media_items_deleted",he),window.addEventListener("keydown",de),window.addEventListener("keyup",_e)}),pt(()=>{f.off("item_tags_updated",ve),f.off("items_tags_updated",me),f.off("media_item_deleted",ke),f.off("media_items_deleted",he),window.removeEventListener("keydown",de),window.removeEventListener("keyup",_e)}),(t,a)=>{const y=At,T=Lt,G=Mt,Pe=Gt,Ze=Jt,Je=Zt,We=yt,Xe=Rt,Ye=Ut,je=Ot,be=ts,O=Kt,ye=Ht,xe=Bt,fe=Nt,et=Ft,tt=st,r=ft("tooltip");return o(),l($,null,[n("div",ss,[n("md-checkbox",{"touch-target":"wrapper",onChange:a[0]||(a[0]=(...s)=>e(oe)&&e(oe)(...s)),checked:e(se),indeterminate:!e(se)&&e(z)},null,40,os),n("div",ns,[e(v).length?(o(),l("span",ls,h(t.$t("x_selected",{count:e(w)?e(b).toLocaleString():e(v).length.toLocaleString()})),1)):(o(),l("span",as,h(t.$t("page_title.videos"))+" ("+h(e(b).toLocaleString())+")",1)),e(z)?(o(),l($,{key:2},[p((o(),l("button",{class:"btn-icon",onClick:a[1]||(a[1]=c(s=>e(ee)(e(u),e(v),e(w),C.value),["stop"]))},[cs,i(y)])),[[r,t.$t("delete")]]),p((o(),l("button",{class:"btn-icon",onClick:a[2]||(a[2]=c(s=>e(Fe)(e(w),e(v),C.value),["stop"]))},[is,i(T)])),[[r,t.$t("download")]]),p((o(),l("button",{class:"btn-icon",onClick:a[3]||(a[3]=c(s=>e(Ae)(e(v),e(w),C.value),["stop"]))},[ds,i(G)])),[[r,t.$t("add_to_tags")]])],64)):P("",!0)]),n("div",_s,[i(Pe,{filter:X,tags:q.value,buckets:H.value,"get-url":Qe},null,8,["filter","tags","buckets"]),p((o(),l("button",{class:"btn-icon",onClick:c(Oe,["prevent"])},[us,i(Ze)])),[[r,t.$t("upload")]]),i(We,null,{content:Te(s=>[n("div",ms,[(o(!0),l($,null,Z(e(Ke),d=>(o(),l("md-menu-item",{key:d.value,onClick:_=>He(s,d.value),selected:d.value===e(A)},[n("div",hs,h(t.$t(d.label)),1)],8,vs))),128))])]),default:Te(()=>[p((o(),l("button",rs,[ps,i(Je)])),[[r,t.$t("sort")]])]),_:1}),p((o(),l("button",{class:"btn-icon",onClick:c(Ge,["prevent"])},[ks,e(k).videosCardView?(o(),g(Xe,{key:0})):(o(),g(Ye,{key:1}))])),[[r,t.$t(e(k).videosCardView?"grid_view":"card_view")]])])]),i(je,{limit:S,total:e(b),"all-checked-alert-visible":e(Be),"real-all-checked":e(w),"select-real-all":e(Me),"clear-selection":e(V)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),n("div",gs,[e(k).videosCardView?(o(),l("div",{key:1,class:N(["media-list",{"select-mode":e(z)}])},[(o(!0),l($,null,Z(E.value,(s,d)=>{var _;return o(),l("section",{class:N(["media-item selectable-card",{selected:e(v).includes(s.id),selecting:e(L).includes(s.id)}]),key:s.id,onClick:c(m=>e(ne)(m,s,d,B),["stop"]),onMouseover:m=>e(le)(m,d)},[n("div",Ks,[e(L).includes(s.id)?(o(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:c(m=>e(D)(m,s,d),["stop"]),checked:e(ae)},null,8,Rs)):(o(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:c(m=>e(D)(m,s,d),["stop"]),checked:e(v).includes(s.id)},null,8,Us)),n("span",Hs,[i(et,{id:d+1,raw:s},null,8,["id","raw"])])]),Q.value.includes(s.id)?(o(),g(be,{key:0,class:"image",onClick:c(m=>B(d),["stop"])},null,8,["onClick"])):(o(),l("img",{key:1,class:"image",src:e(J)(s.fileId,"&w=200&h=200"),onError:m=>re(s.id)},null,40,Qs)),n("div",Gs,h(e(F)(s.path)),1),n("div",Os,[n("span",null,h(e(Se)(s.size)),1),n("span",null,h(e(Ee)(s.duration)),1),n("a",{onClick:c(m=>e(Le)(e(k),s.bucketId),["stop","prevent"])},h((_=ze.value[s.bucketId])==null?void 0:_.name),9,Ps),i(fe,{tags:s.tags,type:e(u),"only-links":!0},null,8,["tags","type"])]),n("div",Zs,[p((o(),l("button",{class:"btn-icon sm",onClick:c(m=>e(te)(e(u),s),["stop"])},[Ws,i(y)],8,Js)),[[r,t.$t("delete")]]),p((o(),l("button",{class:"btn-icon sm",onClick:c(m=>e(ce)(s.path,e(F)(s.path).replace(" ","-")),["stop"])},[Ys,i(T)],8,Xs)),[[r,t.$t("download")]]),p((o(),l("button",{class:"btn-icon sm",onClick:c(m=>pe(s),["stop"])},[xs,i(G)],8,js)),[[r,t.$t("add_to_tags")]])]),n("div",eo,[p((o(),l("span",null,[$t(h(e(wt)(s.createdAt)),1)])),[[r,e(Ct)(s.createdAt)]])])],42,Fs)}),128))],2)):(o(),l("div",{key:0,class:N(["media-grid",{"select-mode":e(z)}])},[(o(!0),l($,null,Z(E.value,(s,d)=>(o(),l("div",{class:N(["media-item",{selected:e(v).includes(s.id),selecting:e(L).includes(s.id)}]),key:s.id,onClick:c(_=>e(ne)(_,s,d,B),["stop"]),onMouseover:_=>e(le)(_,d)},[Q.value.includes(s.id)?(o(),g(be,{key:0,class:"image"})):(o(),l("img",{key:1,class:"image",src:e(J)(s.fileId,"&w=200&h=200"),onError:_=>re(s.id)},null,40,ys)),e(L).includes(s.id)?(o(),l("button",{key:2,class:"btn-icon btn-checkbox",onClick:c(_=>e(D)(_,s,d),["stop"])},[Cs,e(ae)?(o(),g(O,{key:0})):(o(),g(ye,{key:1}))],8,fs)):e(v).includes(s.id)?(o(),l("button",{key:3,class:"btn-icon btn-checkbox",onClick:c(_=>e(D)(_,s,d),["stop"])},[ws,i(O)],8,$s)):(o(),l($,{key:4},[n("div",Ts,[n("button",{class:"btn-icon sm btn-checkbox",onClick:c(_=>e(D)(_,s,d),["stop"])},[Ss,e(v).includes(s.id)?(o(),g(O,{key:0})):(o(),g(ye,{key:1}))],8,Is),e(z)?p((o(),l("button",{key:0,class:"btn-icon sm",onClick:c(_=>B(d),["stop"])},[qs,i(xe)],8,Es)),[[r,t.$t("open")]]):(o(),l($,{key:1},[p((o(),l("button",{class:"btn-icon sm",onClick:c(_=>e(te)(e(u),s),["stop"])},[Ds,i(y)],8,Vs)),[[r,t.$t("delete")]]),p((o(),l("button",{class:"btn-icon sm",onClick:c(_=>e(ce)(s.path,e(F)(s.path).replace(" ","-")),["stop"])},[As,i(T)],8,zs)),[[r,t.$t("download")]]),p((o(),l("button",{class:"btn-icon sm",onClick:c(_=>pe(s),["stop"])},[Ms,i(G)],8,Ls)),[[r,t.$t("add_to_tags")]])],64))]),n("div",Bs,[i(fe,{tags:s.tags,type:e(u)},null,8,["tags","type"]),n("span",Ns,h(["SIZE_ASC","SIZE_DESC"].includes(e(A))?e(Se)(s.size):e(Ee)(s.duration)),1)])],64))],42,bs))),128))],2)),!e(k).videosCardView&&ue.value.length===0?(o(),l("div",to,h(t.$t(e(Tt)(e(Re),e(De).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):P("",!0),e(b)>S?(o(),g(tt,{key:3,page:U.value,go:ie,total:e(b),limit:S},null,8,["page","total"])):P("",!0)])],64)}}});export{po as default};
