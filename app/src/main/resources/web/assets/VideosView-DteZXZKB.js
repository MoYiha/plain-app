import{_ as wo}from"./VPagination.vuevuetypescriptsetuptruelang-DUdPyPtr.js";import{_ as Io,a as Eo,b as So,c as Do,d as To}from"./grid-view-outline-rounded-0fx6hZgv.js";import{d as Ao,u as Fo,s as Be,h as U,g as Mo,I as Vo,i as Lo,ag as Ne,aD as zo,J as qo,aE as Ro,aF as He,aG as Uo,aI as Bo,ah as No,K as Ho,L as Ko,M as Qo,c as u,a as r,m as e,t as y,O as f,x as _,v as i,q as d,w as a,e as M,p as l,aH as Oo,N as B,P as Z,Q as Po,f as Go,C as Zo,aJ as Jo,aQ as Wo,am as Xo,S as jo,o as t,aL as ue,aR as Ke,aA as _e,aM as V,E as Qe,ab as Oe,U as Yo,V as xo,W as es,X as os,ap as ss,ao as ts,Z as ns,$ as as,a0 as ls,a1 as L,ae as is,aq as cs,a2 as ds,aN as rs,a4 as us,a3 as _s,aO as ps}from"./index-B-S542RM.js";import{_ as ks,a as ms,b as vs}from"./SearchInput-D0d2xIiv.js";import{_ as gs}from"./sort-rounded-BVzv_GA2.js";import{_ as hs}from"./upload-rounded-_5wwNL4r.js";import{_ as ys}from"./restore-from-trash-outline-rounded-Ck6P-VkW.js";import{_ as fs}from"./IconButton.vuevuetypescriptsetuptruelang-CxW8gnDA.js";import{a as $s}from"./tags-x91i2rzh.js";import{u as Cs,a as bs}from"./key-events-D1Kh05Em.js";import{u as ws}from"./search-k8SzNgo1.js";import{u as Is,a as Es}from"./media-trash-C0Lwc6-9.js";import{h as pe}from"./feature-Cs4tKJbl.js";import"./search-rounded-TCa6qTC1.js";import"./rss-feed-rounded-DzJ3TVan.js";import"./vee-validate.esm-D5u4WlYW.js";const Ss={class:"top-app-bar"},Ds=["checked","indeterminate"],Ts={class:"title"},As={key:0},Fs={key:1},Ms={class:"actions"},Vs=["onClick"],Ls={slot:"headline"},zs=["onClick"],qs={slot:"headline"},Rs={class:"menu-items"},Us=["onClick","selected"],Bs={slot:"headline"},Ns={class:"sm"},Hs=["selected"],Ks=["selected"],Qs=["onClick","onMouseover"],Os=["src"],Ps=["src","onError"],Gs={key:1,class:"actions"},Zs={class:"right"},Js=["onClick","onMouseover"],Ws={class:"start"},Xs=["onClick","checked"],js=["onClick","checked"],Ys={class:"number"},xs={class:"image"},et=["src"],ot=["src","onError"],st={class:"title"},tt={class:"subtitle"},nt=["onClick"],at={class:"actions"},lt={class:"time"},it={key:2,class:"no-data-placeholder"},S=55,It=Ao({__name:"VideosView",setup(ct){var ze;const I=Fo(),{videoSortBy:N}=Be(I),E=U([]),{t:Pe}=Mo(),{parseQ:Ge}=ws(),D=Vo({tagIds:[]}),ke=Lo(),{app:z,urlTokenKey:J,uploads:W}=Be(ke),{input:Ze,upload:Je,uploadChanged:me}=Ne(W),{input:We,upload:Xe,uploadChanged:ve}=Ne(W),{dropping:je,fileDragEnter:ge,fileDragLeave:he,dropFiles:Ye}=zo(W),X=U(!1),m=qo.VIDEO,ye=Po(),fe=ye.query,j=U(parseInt(((ze=fe.page)==null?void 0:ze.toString())??"1")),{tags:H,buckets:Y,fetch:xe}=Ro(m),eo=He(()=>{const s={};return Y.value.forEach(n=>{s[n.id]=n}),s}),C=U(""),{addToTags:oo}=$s(m,H),{deleteItems:x,deleteItem:K}=Uo(),{view:so}=Bo(m),{selectedIds:h,allChecked:$e,realAllChecked:w,selectRealAll:to,allCheckedAlertVisible:no,clearSelection:T,toggleAllChecked:Ce,toggleSelect:q,total:b,checked:R,shiftEffectingIds:Q,handleItemClick:be,handleMouseOver:we,selectAll:ao,shouldSelect:Ie}=Cs(E),{downloadItems:Ee}=No(J,m,T,"videos.zip"),{downloadFile:O}=ss(J),Se=s=>{const n=ye.query.q;Go(I,n?`/videos?page=${s}&q=${n}`:`/videos?page=${s}`)},{keyDown:De,keyUp:Te}=bs(b,S,j,ao,T,Se,()=>{x(m,h.value,w.value,b.value,C.value)}),ee=U([]),lo=ts(),io=He(()=>E.value.map(s=>({src:_e(s.fileId),name:V(s.path),duration:s.duration,size:s.size,path:s.path,data:s,type:m}))),Ae=s=>{ee.value.push(s)},{loading:P,fetch:A}=Ho({handle:async(s,n)=>{if(X.value=!1,n)Zo(Pe(n),"error");else if(s){const $=[];for(const c of s.videos)$.push({...c,fileId:Jo(J.value,c.path,c.id)});E.value=$,b.value=s.videoCount}},document:Wo,variables:()=>({offset:(j.value-1)*S,limit:S,query:C.value,sortBy:N.value}),appApi:!0}),{trashLoading:oe,trash:se}=Is(m,T,A),{restoreLoading:te,restore:ne}=Es(m,T,A);function ae(s){ke.lightbox={sources:io.value,index:s,visible:!0}}const G=()=>{let s=C.value;return w.value||(s=`ids:${h.value.join(",")}`),s};function co(s,n){X.value=!0,N.value=n,s.close()}function ro(s){return s?`/videos?q=${s}`:"/videos"}function Fe(s){ns(as,{type:m,tags:H.value,item:{key:s.id,title:s.title,size:s.size},selected:H.value.filter(n=>s.tags.some($=>$.id===n.id))})}function le(){const s=Y.value.find(n=>n.id===D.bucketId);return s?ps(s.topItems[0]):`${z.value.internalStoragePath}/Movies`}function uo(s){Je(le()),s.close()}function _o(s){Xe(le()),s.close()}function po(s){Ye(s,le(),"video")}const Me=s=>{s.type===m&&(T(),A())},Ve=s=>{s.type===m&&A()},Le=s=>{s.type===m&&(T(),A())};return Ko(()=>{var s;C.value=ls(((s=fe.q)==null?void 0:s.toString())??""),Ge(D,C.value),xe(),A(),L.on("item_tags_updated",Ve),L.on("items_tags_updated",Me),L.on("media_items_actioned",Le),window.addEventListener("keydown",De),window.addEventListener("keyup",Te)}),Qo(()=>{L.off("item_tags_updated",Ve),L.off("items_tags_updated",Me),L.off("media_items_actioned",Le),window.removeEventListener("keydown",De),window.removeEventListener("keyup",Te)}),(s,n)=>{const $=is,c=fs,ie=ys,F=cs,ce=vs,de=ds,ko=ks,mo=hs,qe=Xo,vo=gs,go=Io,ho=Eo,yo=ms,re=So,Re=Do,fo=rs,Ue=us,$o=_s,Co=To,bo=wo,p=jo("tooltip");return t(),u(f,null,[r("div",Ss,[r("md-checkbox",{"touch-target":"wrapper",onChange:n[0]||(n[0]=(...o)=>e(Ce)&&e(Ce)(...o)),checked:e($e),indeterminate:!e($e)&&e(R)},null,40,Ds),r("div",Ts,[e(h).length?(t(),u("span",As,y(s.$t("x_selected",{count:e(w)?e(b).toLocaleString():e(h).length.toLocaleString()})),1)):(t(),u("span",Fs,y(s.$t("page_title.videos"))+" ("+y(e(b).toLocaleString())+")",1)),e(R)?(t(),u(f,{key:2},[D.trash?(t(),u(f,{key:0},[_((t(),i(c,{onClick:n[1]||(n[1]=a(o=>e(x)(e(m),e(h),e(w),e(b),C.value),["stop"]))},{icon:d(()=>[l($)]),_:1})),[[p,s.$t("delete")]]),_((t(),i(c,{onClick:n[2]||(n[2]=a(o=>e(ne)(G()),["stop"])),loading:e(te)(G())},{icon:d(()=>[l(ie)]),_:1},8,["loading"])),[[p,s.$t("restore")]]),_((t(),i(c,{onClick:n[3]||(n[3]=a(o=>e(Ee)(e(w),e(h),C.value),["stop"]))},{icon:d(()=>[l(F)]),_:1})),[[p,s.$t("download")]])],64)):(t(),u(f,{key:1},[e(pe)(e(ue).MEDIA_TRASH,e(z).osVersion)?_((t(),i(c,{key:0,onClick:n[4]||(n[4]=a(o=>e(se)(G()),["stop"])),loading:e(oe)(G())},{icon:d(()=>[l(ce)]),_:1},8,["loading"])),[[p,s.$t("move_to_trash")]]):_((t(),i(c,{key:1,onClick:n[5]||(n[5]=a(o=>e(x)(e(m),e(h),e(w),e(b),C.value),["stop"]))},{icon:d(()=>[l($)]),_:1})),[[p,s.$t("delete")]]),_((t(),i(c,{onClick:n[6]||(n[6]=a(o=>e(Ee)(e(w),e(h),C.value),["stop"]))},{icon:d(()=>[l(F)]),_:1})),[[p,s.$t("download")]]),_((t(),i(c,{onClick:n[7]||(n[7]=a(o=>e(oo)(e(h),e(w),C.value),["stop"]))},{icon:d(()=>[l(de)]),_:1})),[[p,s.$t("add_to_tags")]])],64))],64)):M("",!0)]),r("div",Ms,[l(ko,{filter:D,tags:e(H),buckets:e(Y),"get-url":ro},null,8,["filter","tags","buckets"]),D.trash?M("",!0):(t(),i(qe,{key:0},{content:d(o=>[r("md-menu-item",{onClick:a(v=>uo(o),["stop"])},[r("div",Ls,y(s.$t("upload_files")),1)],8,Vs),r("md-menu-item",{onClick:a(v=>_o(o),["stop"])},[r("div",qs,y(s.$t("upload_folder")),1)],8,zs)]),default:d(()=>[_((t(),i(c,null,{icon:d(()=>[l(mo)]),_:1})),[[p,s.$t("upload")]])]),_:1})),l(qe,null,{content:d(o=>[r("div",Rs,[(t(!0),u(f,null,Z(e(lo),v=>(t(),u("md-menu-item",{key:v.value,onClick:k=>co(o,v.value),selected:v.value===e(N)},[r("div",Bs,y(s.$t(v.label)),1)],8,Us))),128))])]),default:d(()=>[_((t(),i(c,{loading:X.value},{icon:d(()=>[l(vo)]),_:1},8,["loading"])),[[p,s.$t("sort")]])]),_:1}),r("md-outlined-segmented-button-set",Ns,[r("md-outlined-segmented-button",{"data-value":"grid","no-checkmark":"",selected:!e(I).videosCardView,onClick:n[8]||(n[8]=o=>e(I).videosCardView=!1)},[l(go,{slot:"icon"})],8,Hs),r("md-outlined-segmented-button",{"data-value":"card","no-checkmark":"",selected:e(I).videosCardView,onClick:n[9]||(n[9]=o=>e(I).videosCardView=!0)},[l(ho,{slot:"icon"})],8,Ks)])])]),l(yo,{limit:S,total:e(b),"all-checked-alert-visible":e(no),"real-all-checked":e(w),"select-real-all":e(to),"clear-selection":e(T)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),r("div",{class:"scroll-content",onDragover:n[13]||(n[13]=a((...o)=>e(ge)&&e(ge)(...o),["stop","prevent"]))},[_(r("div",{class:"drag-mask",onDrop:a(po,["stop","prevent"]),onDragleave:n[10]||(n[10]=a((...o)=>e(he)&&e(he)(...o),["stop","prevent"]))},y(s.$t("release_to_send_files")),545),[[Oo,e(je)]]),e(I).videosCardView?(t(),u("div",{key:1,class:B(["media-list",{"select-mode":e(R)}])},[(t(!0),u(f,null,Z(E.value,(o,v)=>{var k;return t(),u("section",{class:B(["media-item selectable-card",{selected:e(h).includes(o.id),selecting:e(Q).includes(o.id)}]),key:o.id,onClick:a(g=>e(be)(g,o,v,ae),["stop"]),onMouseover:g=>e(we)(g,v)},[r("div",Ws,[e(Q).includes(o.id)?(t(),u("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:a(g=>e(q)(g,o,v),["stop"]),checked:e(Ie)},null,8,Xs)):(t(),u("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:a(g=>e(q)(g,o,v),["stop"]),checked:e(h).includes(o.id)},null,8,js)),r("span",Ys,[l($o,{id:v+1,raw:o},null,8,["id","raw"])])]),r("div",xs,[ee.value.includes(o.id)?(t(),u("img",{key:0,src:`/ficons/${e(Ke)(o.path)}.svg`,class:"svg"},null,8,et)):(t(),u("img",{key:1,class:"image-thumb",src:e(_e)(o.fileId,"&w=200&h=200"),onError:g=>Ae(o.id)},null,40,ot))]),r("div",st,y(e(V)(o.path)),1),r("div",tt,[r("span",null,y(e(Qe)(o.size)),1),r("span",null,y(e(Oe)(o.duration)),1),r("a",{onClick:a(g=>e(so)(e(I),o.bucketId),["stop","prevent"])},y((k=eo.value[o.bucketId])==null?void 0:k.name),9,nt),l(Ue,{tags:o.tags,type:e(m),"only-links":!0},null,8,["tags","type"])]),r("div",at,[D.trash?(t(),u(f,{key:0},[_((t(),i(c,{class:"sm",onClick:a(g=>e(K)(e(m),o),["stop"])},{icon:d(()=>[l($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),i(c,{class:"sm",onClick:a(g=>e(ne)(`ids:${o.id}`),["stop"]),loading:e(te)(`ids:${o.id}`)},{icon:d(()=>[l(ie)]),_:2},1032,["onClick","loading"])),[[p,s.$t("restore")]]),_((t(),i(c,{class:"sm",onClick:a(g=>e(O)(o.path,e(V)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(F)]),_:2},1032,["onClick"])),[[p,s.$t("download")]])],64)):(t(),u(f,{key:1},[e(pe)(e(ue).MEDIA_TRASH,e(z).osVersion)?_((t(),i(c,{key:0,class:"sm",onClick:a(g=>e(se)(`ids:${o.id}`),["stop"]),loading:e(oe)(`ids:${o.id}`)},{icon:d(()=>[l(ce)]),_:2},1032,["onClick","loading"])),[[p,s.$t("move_to_trash")]]):_((t(),i(c,{key:1,class:"sm",onClick:a(g=>e(K)(e(m),o),["stop"])},{icon:d(()=>[l($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),i(c,{class:"sm",onClick:a(g=>e(O)(o.path,e(V)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(F)]),_:2},1032,["onClick"])),[[p,s.$t("download")]]),_((t(),i(c,{class:"sm",onClick:a(g=>Fe(o),["stop"])},{icon:d(()=>[l(de)]),_:2},1032,["onClick"])),[[p,s.$t("add_to_tags")]])],64))]),r("div",lt,[_((t(),u("span",null,[xo(y(e(es)(o.createdAt)),1)])),[[p,e(Yo)(o.createdAt)]])])],42,Js)}),128)),e(P)&&E.value.length===0?(t(),i(Co,{key:0,limit:S})):M("",!0)],2)):(t(),u("div",{key:0,class:B(["media-grid",{"select-mode":e(R)}])},[(t(!0),u(f,null,Z(E.value,(o,v)=>(t(),u("section",{class:B(["media-item",{selected:e(h).includes(o.id),selecting:e(Q).includes(o.id)}]),key:o.id,onClick:a(k=>e(be)(k,o,v,ae),["stop"]),onMouseover:k=>e(we)(k,v)},[ee.value.includes(o.id)?(t(),u("img",{key:0,src:`/ficons/${e(Ke)(o.path)}.svg`,class:"image svg"},null,8,Os)):(t(),u("img",{key:1,class:"image image-thumb",src:e(_e)(o.fileId,"&w=200&h=200"),onError:k=>Ae(o.id)},null,40,Ps)),e(Q).includes(o.id)?(t(),i(c,{key:2,class:"btn-checkbox",onClick:a(k=>e(q)(k,o,v),["stop"])},{icon:d(()=>[e(Ie)?(t(),i(re,{key:0})):(t(),i(Re,{key:1}))]),_:2},1032,["onClick"])):e(h).includes(o.id)?(t(),i(c,{key:3,class:"btn-checkbox",onClick:a(k=>e(q)(k,o,v),["stop"])},{icon:d(()=>[l(re)]),_:2},1032,["onClick"])):(t(),u(f,{key:4},[l(c,{class:"btn-checkbox",onClick:a(k=>e(q)(k,o,v),["stop"])},{icon:d(()=>[e(h).includes(o.id)?(t(),i(re,{key:0})):(t(),i(Re,{key:1}))]),_:2},1032,["onClick"]),e(R)?_((t(),i(c,{key:0,class:"btn-zoom sm",onClick:a(k=>ae(v),["stop"])},{icon:d(()=>[l(fo)]),_:2},1032,["onClick"])),[[p,s.$t("open")]]):(t(),u("div",Gs,[D.trash?(t(),u(f,{key:0},[_((t(),i(c,{class:"sm",onClick:a(k=>e(K)(e(m),o),["stop"])},{icon:d(()=>[l($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),i(c,{class:"sm",onClick:a(k=>e(ne)(`ids:${o.id}`),["stop"]),loading:e(te)(`ids:${o.id}`)},{icon:d(()=>[l(ie)]),_:2},1032,["onClick","loading"])),[[p,s.$t("restore")]]),_((t(),i(c,{class:"sm",onClick:a(k=>e(O)(o.path,e(V)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(F)]),_:2},1032,["onClick"])),[[p,s.$t("download")]])],64)):(t(),u(f,{key:1},[e(pe)(e(ue).MEDIA_TRASH,e(z).osVersion)?_((t(),i(c,{key:0,class:"sm",onClick:a(k=>e(se)(`ids:${o.id}`),["stop"]),loading:e(oe)(`ids:${o.id}`)},{icon:d(()=>[l(ce)]),_:2},1032,["onClick","loading"])),[[p,s.$t("move_to_trash")]]):_((t(),i(c,{key:1,class:"sm",onClick:a(k=>e(K)(e(m),o),["stop"])},{icon:d(()=>[l($)]),_:2},1032,["onClick"])),[[p,s.$t("delete")]]),_((t(),i(c,{class:"sm",onClick:a(k=>e(O)(o.path,e(V)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(F)]),_:2},1032,["onClick"])),[[p,s.$t("download")]]),_((t(),i(c,{class:"sm",onClick:a(k=>Fe(o),["stop"])},{icon:d(()=>[l(de)]),_:2},1032,["onClick"])),[[p,s.$t("add_to_tags")]])],64))])),r("div",{class:B(["info",{"has-tags":o.tags.length>0}])},[l(Ue,{tags:o.tags,type:e(m)},null,8,["tags","type"]),r("span",Zs,y(["SIZE_ASC","SIZE_DESC"].includes(e(N))?e(Qe)(o.size):e(Oe)(o.duration)),1)],2)],64))],42,Qs))),128)),e(P)&&E.value.length===0?(t(),u(f,{key:0},Z(S,o=>r("section",{class:"skeleton-image media-item",key:o})),64)):M("",!0)],2)),!e(P)&&E.value.length===0?(t(),u("div",it,y(s.$t(e(os)(e(P),e(z).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):M("",!0),e(b)>S?(t(),i(bo,{key:3,page:j.value,go:Se,total:e(b),limit:S},null,8,["page","total"])):M("",!0),r("input",{ref_key:"fileInput",ref:Ze,style:{display:"none"},type:"file",accept:"video/*",multiple:"",onChange:n[11]||(n[11]=(...o)=>e(me)&&e(me)(...o))},null,544),r("input",{ref_key:"dirFileInput",ref:We,style:{display:"none"},type:"file",accept:"video/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[12]||(n[12]=(...o)=>e(ve)&&e(ve)(...o))},null,544)],32)],64)}}});export{It as default};
