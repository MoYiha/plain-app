import{_ as Je}from"./VPagination.vuevuetypescriptsetuptruelang-CUh5gD9j.js";import{a4 as H,e as We,r as b,s as ue,g as Ye,ag as Xe,ah as Ze,f as ea,u as aa,I as ta,K as sa,ai as na,J as oa,i as re,L as _e,M as la,N as ia,c as l,o,a as n,k as p,l as a,O as v,j as q,t as i,P as ca,y as u,aj as da,p as z,ak as pa,R as L,al as ua,S as R,T as U,U as j,V as ra,am as _a,an as va,E,ao as ka,ap as ma,aq as ga,ar as fa,Y as ha,n as ya,F as M,as as ba,a7 as wa,at as $a,au as ve,$ as ke,d as Ca,A as Sa,av as Da,a3 as Aa,H as Ia}from"./index-Dd8UjYtJ.js";import{_ as La}from"./FieldId.vuevuetypescriptsetuptruelang-BnKTOzAN.js";import{_ as Ua,a as Pa}from"./SearchInput-CX6-UxKh.js";import{_ as Na,a as Va}from"./upload-rounded-CVLjHjg8.js";import{_ as Fa}from"./VCheckbox-lCJ3fupj.js";import{u as qa,a as Ea}from"./key-events-U1fzVka7.js";import{u as Ma}from"./search-CEqTgbsb.js";import"./VInputChip-xYeMr_VW.js";const w=C=>{H.emit("tap_phone",C)};function Ta(C,d){const S=C.findIndex(D=>D.id===d);S!==-1&&C.splice(S,1)}const Ba={class:"top-app-bar"},Ka={class:"title"},xa={key:0},Qa={key:1},Ga={class:"actions"},za=["disabled"],Ra={class:"menu-items"},ja=["onClick"],Ha=["onClick","onMouseover"],Oa={class:"start"},Ja={class:"number"},Wa=["src"],Ya={class:"title"},Xa={class:"subtitle"},Za={class:"actions"},et=["onClick"],at=["onClick"],tt={class:"time"},st={class:"start"},nt={class:"number"},ot={key:0,class:"no-data-placeholder"},$=50,lt=We({__name:"AppsView",setup(C){var de;const d=b([]),{app:S,urlTokenKey:D,uploads:O}=ue(Ye()),{input:me,upload:ge,uploadChanged:J}=Xe(O),{dropping:fe,fileDragEnter:W,fileDragLeave:Y,dropFiles:he}=Ze(O),X=ea(),k=b([]),{t:g}=aa(),{appSortBy:P}=ue(X),{parseQ:ye}=Ma(),Z=ta({tagIds:[]}),be=fa(),N=b(!1),ee=sa(),ae=ee.query,T=b(parseInt(((de=ae.page)==null?void 0:de.toString())??"1")),V=b(""),{selectedIds:A,allChecked:te,realAllChecked:B,selectRealAll:we,allCheckedAlertVisible:$e,clearSelection:K,toggleAllChecked:Ce,toggleSelect:se,total:f,checked:x,shiftEffectingIds:ne,handleItemClick:Se,handleMouseOver:De,selectAll:Ae,shouldSelect:Ie}=qa(k),{downloadItems:Le}=na(D,oa.PACKAGE,K,()=>Da("apps")),{downloadFile:Ue}=$a(D),Q=e=>{const s=ee.query.q;Sa(X,s?`/apps?page=${e}&q=${s}`:`/apps?page=${e}`)},{keyDown:oe,keyUp:le}=Ea(f,$,T,Ae,K,Q,()=>{}),Pe=()=>{ge(S.value.downloadsDir)},{mutate:Ne}=re({document:_a}),Ve=["user","system"].map(e=>({id:e,name:g("app_type."+e)})),Fe=e=>{e.isUninstalling=!1},{loading:G,fetch:ie}=_e({handle:(e,s)=>{N.value=!1,s?E(g(s),"error"):e&&(k.value=e.packages.map(c=>({...c,isUninstalling:!1,icon:ka(D.value,"pkgicon://"+c.id)})),f.value=e.packageCount)},document:va,variables:()=>({offset:(T.value-1)*$,limit:$,query:V.value,sortBy:P.value})});function qe(e){return e?`/apps?q=${e}`:"/apps"}const F=b(!1);function Ee(e){if(P.value===e){F.value=!1;return}N.value=!0,P.value=e,Q(1),F.value=!1}const{mutate:Me}=re({document:ma});function Te(e){e.isUninstalling=!0,w(g("confirm_uninstallation_on_phone")),Me({id:e.id})}const{loading:Be,fetch:Ke}=_e({handle:e=>{if(e)for(const s of e.packageStatuses){const c=d.value.find(_=>_.id===s.id);if(c){const _=c.isNew&&s.exist,I=!c.isNew&&s.exist&&c.updatedAt<s.updatedAt;(_||I)&&(d.value=d.value.filter(h=>h.id!==s.id),w(""),_?E(g("app_installation_completed"),"success"):E(g("app_upgrade_completed"),"success"),ie())}else s.exist||(Ta(k.value,s.id),w(""))}},document:ga,variables:()=>({ids:[...k.value.filter(e=>e.isUninstalling).map(e=>e.id),...d.value.map(e=>e.id)]})}),ce=e=>{e.status==="done"&&Ne({path:e.dir+"/"+e.fileName}).then(s=>{if(w(g("confirm_installation_on_phone")),s&&s.data&&s.data.installPackage){const{packageName:c,updatedAt:_,isNew:I}=s.data.installPackage;c&&(d.value.push({id:c,updatedAt:_,isNew:I}),setTimeout(()=>{d.value.some(h=>h.id===c)&&(d.value=d.value.filter(h=>h.id!==c),w(""))},12e4))}}).catch(s=>{w(""),E(g("app_installation_failed")+": "+s.message,"error")})};function xe(e){he(e,S.value.downloadsDir,s=>s.name.endsWith(".apk"))}return la(()=>{var e;setInterval(()=>{(k.value.some(s=>s.isUninstalling)||d.value.length>0)&&!Be.value&&Ke()},1e3),V.value=Aa(((e=ae.q)==null?void 0:e.toString())??""),ye(Z,V.value),ie(),H.on("upload_task_done",ce),window.addEventListener("keydown",oe),window.addEventListener("keyup",le)}),ia(()=>{H.off("upload_task_done",ce),window.removeEventListener("keydown",oe),window.removeEventListener("keyup",le)}),(e,s)=>{const c=Fa,_=da,I=Ua,h=Na,pe=ha,Qe=Va,Ge=pa,ze=Pa,Re=La,je=ba,He=wa,Oe=Je,m=ca("tooltip");return o(),l(U,null,[n("div",Ba,[p(c,{"touch-target":"wrapper",checked:a(te),indeterminate:!a(te)&&a(x),onChange:a(Ce)},null,8,["checked","indeterminate","onChange"]),n("div",Ka,[a(A).length?(o(),l("span",xa,i(e.$t("x_selected",{count:a(B)?a(f).toLocaleString():a(A).length.toLocaleString()})),1)):(o(),l("span",Qa,i(e.$t("page_title.apps"))+" ("+i(a(f).toLocaleString())+")",1)),a(x)?v((o(),l("button",{key:2,class:"btn-icon",onClick:s[0]||(s[0]=u(t=>a(Le)(a(B),a(A),V.value),["stop"]))},[p(_)])),[[m,e.$t("download")]]):q("",!0)]),n("div",Ga,[p(I,{filter:Z,types:a(Ve),"get-url":qe},null,8,["filter","types"]),v((o(),l("button",{class:"btn-icon",onClick:u(Pe,["stop"])},[p(h)])),[[m,e.$t("install_app")]]),p(Ge,{modelValue:F.value,"onUpdate:modelValue":s[1]||(s[1]=t=>F.value=t)},{trigger:z(()=>[v((o(),l("button",{class:"btn-icon btn-sort",disabled:N.value},[N.value?(o(),L(pe,{key:0,indeterminate:""})):(o(),L(Qe,{key:1}))],8,za)),[[m,e.$t("sort")]])]),default:z(()=>[n("div",Ra,[(o(!0),l(U,null,j(a(be),t=>(o(),l("div",{key:t.value,class:R(["dropdown-item",{selected:t.value===a(P)}]),onClick:y=>Ee(t.value)},i(e.$t(t.label)),11,ja))),128))])]),_:1},8,["modelValue"])])]),p(ze,{limit:$,total:a(f),"all-checked-alert-visible":a($e),"real-all-checked":a(B),"select-real-all":a(we),"clear-selection":a(K)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),n("div",{class:"scroll-content",onDragover:s[4]||(s[4]=u((...t)=>a(W)&&a(W)(...t),["stop","prevent"]))},[v(n("div",{class:"drag-mask",onDrop:u(xe,["stop","prevent"]),onDragleave:s[2]||(s[2]=u((...t)=>a(Y)&&a(Y)(...t),["stop","prevent"]))},i(e.$t("release_to_send_files")),545),[[ua,a(fe)]]),n("div",{class:R(["app-list",{"select-mode":a(x)}])},[(o(!0),l(U,null,j(k.value,(t,y)=>(o(),l("section",{key:t.id,class:R(["app-item selectable-card",{selected:a(A).includes(t.id),selecting:a(ne).includes(t.id)}]),onClick:u(r=>a(Se)(r,t,y,()=>{}),["stop"]),onMouseover:r=>a(De)(r,y)},[n("div",Oa,[a(ne).includes(t.id)?(o(),L(c,{key:0,class:"checkbox","touch-target":"wrapper",checked:a(Ie),onClick:u(r=>a(se)(r,t,y),["stop"])},null,8,["checked","onClick"])):(o(),L(c,{key:1,class:"checkbox","touch-target":"wrapper",checked:a(A).includes(t.id),onClick:u(r=>a(se)(r,t,y),["stop"])},null,8,["checked","onClick"])),n("span",Ja,[p(Re,{id:y+1,raw:t},null,8,["id","raw"])])]),n("img",{class:"image",width:"50",height:"50",src:t.icon},null,8,Wa),n("div",Ya,i(t.name)+" ("+i(t.version)+")",1),n("div",Xa,[n("span",null,i(t.id),1),n("span",null,i(a(ya)(t.size)),1),n("span",null,i(e.$t("app_type."+t.type)),1)]),n("div",Za,[t.isUninstalling?(o(),l(U,{key:0},[v(p(pe,{indeterminate:"",class:"sm"},null,512),[[m,e.$t("uninstalling")]]),s[5]||(s[5]=M(" Â ")),p(je,{class:"btn-sm",onClick:u(r=>Fe(t),["stop"])},{default:z(()=>[M(i(e.$t("cancel")),1)]),_:2},1032,["onClick"])],64)):v((o(),l("button",{key:1,class:"btn-icon sm",onClick:u(r=>Te(t),["stop"])},[p(He)],8,et)),[[m,e.$t("uninstall")]]),v((o(),l("button",{class:"btn-icon sm",onClick:u(r=>a(Ue)(t.path,`${t.name.replace(" ","")}-${t.id}.apk`),["stop"])},[p(_)],8,at)),[[m,e.$t("download")]])]),n("div",tt,[v((o(),l("span",null,[M(i(e.$t("installed_at"))+": "+i(a(ke)(t.installedAt)),1)])),[[m,a(ve)(t.installedAt)]]),v((o(),l("span",null,[M(i(e.$t("updated_at"))+": "+i(a(ke)(t.updatedAt)),1)])),[[m,a(ve)(t.updatedAt)]])])],42,Ha))),128)),a(G)&&k.value.length===0?(o(),l(U,{key:0},j(20,t=>n("section",{key:t,class:"app-item selectable-card-skeleton"},[n("div",st,[s[6]||(s[6]=n("div",{class:"checkbox"},[n("div",{class:"skeleton-checkbox"})],-1)),n("span",nt,i(t),1)]),s[7]||(s[7]=Ca('<div class="image" data-v-3a46a6e1><div class="skeleton-image" data-v-3a46a6e1></div></div><div class="title" data-v-3a46a6e1><div class="skeleton-text skeleton-title" data-v-3a46a6e1></div></div><div class="subtitle" data-v-3a46a6e1><div class="skeleton-text skeleton-subtitle" data-v-3a46a6e1></div></div><div class="actions" data-v-3a46a6e1><div class="skeleton-text skeleton-actions" data-v-3a46a6e1></div></div><div class="time" data-v-3a46a6e1><div class="skeleton-text skeleton-time" data-v-3a46a6e1></div><div class="skeleton-text skeleton-time" data-v-3a46a6e1></div></div>',5))])),64)):q("",!0)],2),!a(G)&&k.value.length===0?(o(),l("div",ot,i(e.$t(a(ra)(a(G)))),1)):q("",!0),a(f)>$?(o(),L(Oe,{key:1,page:T.value,go:Q,total:a(f),limit:$},null,8,["page","total"])):q("",!0),n("input",{ref_key:"fileInput",ref:me,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:s[3]||(s[3]=(...t)=>a(J)&&a(J)(...t))},null,544)],32)],64)}}}),mt=Ia(lt,[["__scopeId","data-v-3a46a6e1"]]);export{mt as default};
