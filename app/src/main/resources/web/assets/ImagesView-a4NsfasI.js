import{_ as Ts}from"./VPagination.vuevuetypescriptsetuptruelang-CEZVU5HQ.js";import{_ as Ds,a as Ss,b as Vs,c as As,d as Es}from"./grid-view-outline-rounded-DJvQQpw8.js";import{_ as Ms}from"./FieldId.vuevuetypescriptsetuptruelang-BAr-ccW2.js";import{e as Fs,f as Rs,s as Ne,r as R,u as Ls,I as Us,g as zs,ah as He,ai as qs,J as Bs,K as Ns,aM as Hs,aN as Pe,aO as Ps,aj as Ks,aP as L,aI as ge,L as Qs,aQ as Os,aR as Ws,M as js,N as Gs,c as m,o as t,a as p,k as n,l as e,O as Xs,j as U,t as y,U as h,P as u,Q as Js,S as l,p as d,y as i,aS as Y,aT as Z,al as Ys,T as A,am as Zs,V as x,W as xs,aU as eo,aw as so,aV as oo,E as to,aW as ao,a8 as no,aX as lo,ak as io,aY as co,R as ro,as as uo,aZ as _o,au as po,$ as mo,n as Ke,a_ as go,a0 as ko,F as vo,a1 as fo,A as yo,a2 as ho,a3 as $o,a$ as Qe,b0 as Oe,a4 as Co,a5 as D}from"./index-CuU5w3Fk.js";import{_ as bo,a as wo}from"./SearchInput-Do4mYLNe.js";import{_ as Io,a as To}from"./upload-rounded-Bty2yz0H.js";import{_ as Do}from"./MediaKeyboardShortcuts.vuevuetypescriptsetuptruelang-DEaP1BqB.js";import{u as So}from"./search-cTEMyIe9.js";import{a as Vo}from"./tags-C_c-1fHE.js";import{u as Ao,a as Eo}from"./key-events-CMYOn2tc.js";import"./VInputChip-Cze1-7DF.js";const Mo={class:"top-app-bar"},Fo={class:"title"},Ro={key:0},Lo={key:1},Uo={class:"actions"},zo=["onClick"],qo={class:"button-group"},Bo=["onClick","onMouseover"],No=["src"],Ho={key:1,class:"actions"},Po={class:"right"},Ko=["onClick","onMouseover"],Qo={class:"start"},Oo={class:"number"},Wo=["src"],jo={class:"title"},Go={class:"subtitle"},Xo=["onClick"],Jo={class:"actions"},Yo={class:"time"},Zo={key:2,class:"no-data-placeholder"},E=55,ut=Fs({__name:"ImagesView",setup(xo){var Ue;const S=Rs(),{imageSortBy:P}=Ne(S),V=R([]),{t:We}=Ls(),{parseQ:je}=So(),I=Us({tagIds:[],bucketId:void 0}),ke=zs(),{app:M,urlTokenKey:ee,uploads:se}=Ne(ke),K=R(!1),oe=R(!1),{input:Ge,upload:Xe,uploadChanged:ve}=He(se),{input:Je,upload:Ye,uploadChanged:fe}=He(se),{dropping:Ze,fileDragEnter:ye,fileDragLeave:he,dropFiles:xe}=qs(se),te=R(!1),r=Bs.IMAGE,$e=Ns(),Ce=$e.query,ae=R(parseInt(((Ue=Ce.page)==null?void 0:Ue.toString())??"1")),{tags:Q,buckets:O,fetch:es}=Hs(r),ss=Pe(()=>{const o={};return O.value.forEach(a=>{o[a.id]=a}),o}),b=R(""),{addToTags:os}=Vo(r,Q),{deleteItems:ne,deleteItem:W}=Ps(),{view:ts}=go(r),{selectedIds:v,allChecked:be,realAllChecked:T,selectRealAll:as,allCheckedAlertVisible:ns,clearSelection:z,toggleAllChecked:ls,toggleSelect:q,total:w,checked:B,shiftEffectingIds:j,handleItemClick:we,handleMouseOver:Ie,selectAll:is,shouldSelect:Te}=Ao(V),{downloadItems:De}=Ks(ee,r,z,()=>so("images")),{downloadFile:G}=po(ee),Se=o=>{const a=$e.query.q;yo(S,a?`/images?page=${o}&q=${a}`:`/images?page=${o}`)},{keyDown:Ve,keyUp:Ae}=Eo(w,E,ae,is,z,Se,()=>{Y(Z.MEDIA_TRASH,M.value.osVersion)?J(r,N()):ne(r,v.value,T.value,w.value,b.value)}),ds=uo(),cs=Pe(()=>V.value.map(o=>({src:ge(o.fileId),name:L(o.path),duration:0,size:o.size,path:o.path,type:r,data:o})));function le(o){ke.lightbox={sources:cs.value,index:o,visible:!0}}const N=()=>{let o=b.value;return T.value||(o=`ids:${v.value.join(",")}`),o};function Ee(o){ho($o,{type:r,tags:Q.value,item:{key:o.id,title:o.title,size:o.size},selected:Q.value.filter(a=>o.tags.some(C=>C.id===a.id))})}function rs(o){P.value!==o&&(te.value=!0,P.value=o)}const{loading:X,fetch:H}=Qs({handle:async(o,a)=>{if(te.value=!1,a)to(We(a),"error");else if(o){const C=[];for(const $ of o.images)C.push({...$,fileId:ao(ee.value,$.path,$.id)});V.value=C,w.value=o.imageCount}},document:oo,variables:()=>({offset:(ae.value-1)*E,limit:E,query:b.value,sortBy:P.value})}),{trashLoading:ie,trash:J}=Os(),{restoreLoading:de,restore:ce}=Ws();function us(o){return o?`/images?q=${o}`:"/images"}function re(){const o=O.value.find(a=>a.id===I.bucketId);return o?Oe(o.topItems[0]):`${M.value.internalStoragePath}/Pictures`}function _s(){Xe(re())}function ps(){Ye(re())}function ms(o){xe(o,re(),a=>Qe(a.name))}const Me=o=>{o.type===r&&(z(),H())},Fe=o=>{o.type===r&&H()},Re=o=>{o.type===r&&(z(),H())},Le=o=>{o.status==="done"&&Qe(o.fileName)&&((!I.bucketId||O.value.some(C=>C.id===I.bucketId&&C.topItems.some($=>o.dir.startsWith(Oe($)))))&&setTimeout(()=>{H()},1e3),D.emit("media_items_actioned",{type:r,action:"upload",query:""}))};return js(()=>{var o;b.value=Co(((o=Ce.q)==null?void 0:o.toString())??""),je(I,b.value),es(),H(),D.on("item_tags_updated",Fe),D.on("items_tags_updated",Me),D.on("media_items_actioned",Re),D.on("upload_task_done",Le),window.addEventListener("keydown",Ve),window.addEventListener("keyup",Ae)}),Gs(()=>{D.off("item_tags_updated",Fe),D.off("items_tags_updated",Me),D.off("media_items_actioned",Re),D.off("upload_task_done",Le),window.removeEventListener("keydown",Ve),window.removeEventListener("keyup",Ae)}),(o,a)=>{const C=Xs,$=no,c=eo,ue=lo,F=io,_e=co,pe=ro,gs=bo,ks=Do,vs=Io,ze=Ys,fs=To,ys=Ds,hs=Ss,$s=wo,me=Vs,qe=As,Cs=_o,Be=mo,bs=Ms,ws=Es,Is=Ts,_=Js("tooltip");return t(),m(h,null,[p("div",Mo,[n(C,{"touch-target":"wrapper",checked:e(be),indeterminate:!e(be)&&e(B),onChange:e(ls)},null,8,["checked","indeterminate","onChange"]),p("div",Fo,[e(v).length?(t(),m("span",Ro,y(o.$t("x_selected",{count:e(T)?e(w).toLocaleString():e(v).length.toLocaleString()})),1)):(t(),m("span",Lo,y(o.$t("page_title.images"))+" ("+y(e(w).toLocaleString())+")",1)),e(B)?(t(),m(h,{key:2},[I.trash?(t(),m(h,{key:0},[u((t(),l(c,{onClick:a[0]||(a[0]=i(s=>e(ne)(e(r),e(v),e(T),e(w),b.value),["stop"]))},{default:d(()=>[n($)]),_:1})),[[_,o.$t("delete")]]),u((t(),l(c,{loading:e(de)(N()),onClick:a[1]||(a[1]=i(s=>e(ce)(e(r),N()),["stop"]))},{default:d(()=>[n(ue)]),_:1},8,["loading"])),[[_,o.$t("restore")]]),u((t(),l(c,{onClick:a[2]||(a[2]=i(s=>e(De)(e(T),e(v),b.value),["stop"]))},{default:d(()=>[n(F)]),_:1})),[[_,o.$t("download")]])],64)):(t(),m(h,{key:1},[e(Y)(e(Z).MEDIA_TRASH,e(M).osVersion)?u((t(),l(c,{key:0,loading:e(ie)(N()),onClick:a[3]||(a[3]=i(s=>e(J)(e(r),N()),["stop"]))},{default:d(()=>[n(_e)]),_:1},8,["loading"])),[[_,o.$t("move_to_trash")]]):u((t(),l(c,{key:1,onClick:a[4]||(a[4]=i(s=>e(ne)(e(r),e(v),e(T),e(w),b.value),["stop"]))},{default:d(()=>[n($)]),_:1})),[[_,o.$t("delete")]]),u((t(),l(c,{onClick:a[5]||(a[5]=i(s=>e(De)(e(T),e(v),b.value),["stop"]))},{default:d(()=>[n(F)]),_:1})),[[_,o.$t("download")]]),u((t(),l(c,{onClick:a[6]||(a[6]=i(s=>e(os)(e(v),e(T),b.value),["stop"]))},{default:d(()=>[n(pe)]),_:1})),[[_,o.$t("add_to_tags")]])],64))],64)):U("",!0)]),p("div",Uo,[n(gs,{filter:I,tags:e(Q),buckets:e(O),"get-url":us},null,8,["filter","tags","buckets"]),n(ks),I.trash?U("",!0):(t(),l(ze,{key:0,modelValue:K.value,"onUpdate:modelValue":a[9]||(a[9]=s=>K.value=s)},{trigger:d(()=>[u((t(),l(c,null,{default:d(()=>[n(vs)]),_:1})),[[_,o.$t("upload")]])]),default:d(()=>[p("div",{class:"dropdown-item",onClick:a[7]||(a[7]=i(s=>{_s(),K.value=!1},["stop"]))},y(o.$t("upload_files")),1),p("div",{class:"dropdown-item",onClick:a[8]||(a[8]=i(s=>{ps(),K.value=!1},["stop"]))},y(o.$t("upload_folder")),1)]),_:1},8,["modelValue"])),n(ze,{modelValue:oe.value,"onUpdate:modelValue":a[10]||(a[10]=s=>oe.value=s)},{trigger:d(()=>[u((t(),l(c,{loading:te.value},{default:d(()=>[n(fs)]),_:1},8,["loading"])),[[_,o.$t("sort")]])]),default:d(()=>[(t(!0),m(h,null,x(e(ds),s=>(t(),m("div",{key:s.value,class:A(["dropdown-item",{selected:s.value===e(P)}]),onClick:f=>{rs(s.value),oe.value=!1}},y(o.$t(s.label)),11,zo))),128))]),_:1},8,["modelValue"]),p("div",qo,[p("button",{class:A({selected:!e(S).imagesCardView}),onClick:a[11]||(a[11]=s=>e(S).imagesCardView=!1)},[n(ys)],2),p("button",{class:A({selected:e(S).imagesCardView}),onClick:a[12]||(a[12]=s=>e(S).imagesCardView=!0)},[n(hs)],2)])])]),n($s,{limit:E,total:e(w),"all-checked-alert-visible":e(ns),"real-all-checked":e(T),"select-real-all":e(as),"clear-selection":e(z)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),p("div",{class:"scroll-content",onDragover:a[16]||(a[16]=i((...s)=>e(ye)&&e(ye)(...s),["stop","prevent"]))},[u(p("div",{class:"drag-mask",onDrop:i(ms,["stop","prevent"]),onDragleave:a[13]||(a[13]=i((...s)=>e(he)&&e(he)(...s),["stop","prevent"]))},y(o.$t("release_to_send_files")),545),[[Zs,e(Ze)]]),e(S).imagesCardView?(t(),m("div",{key:1,class:A(["media-list",{"select-mode":e(B)}])},[(t(!0),m(h,null,x(V.value,(s,f)=>{var g;return t(),m("section",{key:s.id,class:A(["media-item selectable-card",{selected:e(v).includes(s.id),selecting:e(j).includes(s.id)}]),onClick:i(k=>e(we)(k,s,f,le),["stop"]),onMouseover:k=>e(Ie)(k,f)},[p("div",Qo,[e(j).includes(s.id)?(t(),l(C,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(Te),onClick:i(k=>e(q)(k,s,f),["stop"])},null,8,["checked","onClick"])):(t(),l(C,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(v).includes(s.id),onClick:i(k=>e(q)(k,s,f),["stop"])},null,8,["checked","onClick"])),p("span",Oo,[n(bs,{id:f+1,raw:s},null,8,["id","raw"])])]),p("img",{class:"image",src:e(ge)(s.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,Wo),p("div",jo,y(e(L)(s.path)),1),p("div",Go,[p("span",null,y(e(Ke)(s.size)),1),p("a",{onClick:i(k=>e(ts)(e(S),s.bucketId),["stop","prevent"])},y((g=ss.value[s.bucketId])==null?void 0:g.name),9,Xo),n(Be,{tags:s.tags,type:e(r),"only-links":!0},null,8,["tags","type"])]),p("div",Jo,[I.trash?(t(),m(h,{key:0},[u((t(),l(c,{class:"sm",onClick:i(k=>e(W)(e(r),s),["stop"])},{default:d(()=>[n($)]),_:2},1032,["onClick"])),[[_,o.$t("delete")]]),u((t(),l(c,{class:"sm",loading:e(de)(`ids:${s.id}`),onClick:i(k=>e(ce)(e(r),`ids:${s.id}`),["stop"])},{default:d(()=>[n(ue)]),_:2},1032,["loading","onClick"])),[[_,o.$t("restore")]]),u((t(),l(c,{class:"sm",onClick:i(k=>e(G)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{default:d(()=>[n(F)]),_:2},1032,["onClick"])),[[_,o.$t("download")]])],64)):(t(),m(h,{key:1},[e(Y)(e(Z).MEDIA_TRASH,e(M).osVersion)?u((t(),l(c,{key:0,class:"sm",loading:e(ie)(`ids:${s.id}`),onClick:i(k=>e(J)(e(r),`ids:${s.id}`),["stop"])},{default:d(()=>[n(_e)]),_:2},1032,["loading","onClick"])),[[_,o.$t("move_to_trash")]]):u((t(),l(c,{key:1,class:"sm",onClick:i(k=>e(W)(e(r),s),["stop"])},{default:d(()=>[n($)]),_:2},1032,["onClick"])),[[_,o.$t("delete")]]),u((t(),l(c,{class:"sm",onClick:i(k=>e(G)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{default:d(()=>[n(F)]),_:2},1032,["onClick"])),[[_,o.$t("download")]]),u((t(),l(c,{class:"sm",onClick:i(k=>Ee(s),["stop"])},{default:d(()=>[n(pe)]),_:2},1032,["onClick"])),[[_,o.$t("add_to_tags")]])],64))]),p("div",Yo,[u((t(),m("span",null,[vo(y(e(fo)(s.createdAt)),1)])),[[_,e(ko)(s.createdAt)]])])],42,Ko)}),128)),e(X)&&V.value.length===0?(t(),l(ws,{key:0,limit:E})):U("",!0)],2)):(t(),m("div",{key:0,class:A(["media-grid",{"select-mode":e(B)}])},[(t(!0),m(h,null,x(V.value,(s,f)=>(t(),m("section",{key:s.id,class:A(["media-item",{selected:e(v).includes(s.id),selecting:e(j).includes(s.id)}]),onClick:i(g=>e(we)(g,s,f,le),["stop"]),onMouseover:g=>e(Ie)(g,f)},[p("img",{class:"image-thumb image",src:e(ge)(s.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,No),e(j).includes(s.id)?(t(),l(c,{key:0,class:"btn-checkbox",onClick:i(g=>e(q)(g,s,f),["stop"])},{default:d(()=>[e(Te)?(t(),l(me,{key:0})):(t(),l(qe,{key:1}))]),_:2},1032,["onClick"])):e(v).includes(s.id)?(t(),l(c,{key:1,class:"btn-checkbox",onClick:i(g=>e(q)(g,s,f),["stop"])},{default:d(()=>[n(me)]),_:2},1032,["onClick"])):(t(),m(h,{key:2},[n(c,{class:"btn-checkbox",onClick:i(g=>e(q)(g,s,f),["stop"])},{default:d(()=>[e(v).includes(s.id)?(t(),l(me,{key:0})):(t(),l(qe,{key:1}))]),_:2},1032,["onClick"]),e(B)?u((t(),l(c,{key:0,class:"btn-zoom sm",onClick:i(g=>le(f),["stop"])},{default:d(()=>[n(Cs)]),_:2},1032,["onClick"])),[[_,o.$t("open")]]):(t(),m("div",Ho,[I.trash?(t(),m(h,{key:0},[u((t(),l(c,{class:"sm",onClick:i(g=>e(W)(e(r),s),["stop"])},{default:d(()=>[n($)]),_:2},1032,["onClick"])),[[_,o.$t("delete")]]),u((t(),l(c,{class:"sm",loading:e(de)(`ids:${s.id}`),onClick:i(g=>e(ce)(e(r),`ids:${s.id}`),["stop"])},{default:d(()=>[n(ue)]),_:2},1032,["loading","onClick"])),[[_,o.$t("restore")]]),u((t(),l(c,{class:"sm",onClick:i(g=>e(G)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{default:d(()=>[n(F)]),_:2},1032,["onClick"])),[[_,o.$t("download")]])],64)):(t(),m(h,{key:1},[e(Y)(e(Z).MEDIA_TRASH,e(M).osVersion)?u((t(),l(c,{key:0,class:"sm",loading:e(ie)(`ids:${s.id}`),onClick:i(g=>e(J)(e(r),`ids:${s.id}`),["stop"])},{default:d(()=>[n(_e)]),_:2},1032,["loading","onClick"])),[[_,o.$t("move_to_trash")]]):u((t(),l(c,{key:1,class:"sm",onClick:i(g=>e(W)(e(r),s),["stop"])},{default:d(()=>[n($)]),_:2},1032,["onClick"])),[[_,o.$t("delete")]]),u((t(),l(c,{class:"sm",onClick:i(g=>e(G)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{default:d(()=>[n(F)]),_:2},1032,["onClick"])),[[_,o.$t("download")]]),u((t(),l(c,{class:"sm",onClick:i(g=>Ee(s),["stop"])},{default:d(()=>[n(pe)]),_:2},1032,["onClick"])),[[_,o.$t("add_to_tags")]])],64))])),p("div",{class:A(["info",{"has-tags":s.tags.length>0}])},[n(Be,{tags:s.tags,type:e(r)},null,8,["tags","type"]),p("span",Po,y(e(Ke)(s.size)),1)],2)],64))],42,Bo))),128)),e(X)&&V.value.length===0?(t(),m(h,{key:0},x(E,s=>p("section",{key:s,class:"skeleton-image media-item"})),64)):U("",!0)],2)),!e(X)&&V.value.length===0?(t(),m("div",Zo,y(o.$t(e(xs)(e(X),e(M).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):U("",!0),e(w)>E?(t(),l(Is,{key:3,page:ae.value,go:Se,total:e(w),limit:E},null,8,["page","total"])):U("",!0),p("input",{ref_key:"fileInput",ref:Ge,style:{display:"none"},type:"file",accept:"image/*",multiple:"",onChange:a[14]||(a[14]=(...s)=>e(ve)&&e(ve)(...s))},null,544),p("input",{ref_key:"dirFileInput",ref:Je,style:{display:"none"},type:"file",accept:"image/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:a[15]||(a[15]=(...s)=>e(fe)&&e(fe)(...s))},null,544)],32)],64)}}});export{ut as default};
