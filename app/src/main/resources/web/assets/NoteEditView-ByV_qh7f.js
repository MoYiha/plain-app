import{_ as Y}from"./MonacoEditor.vuevuetypescriptsetuptruelang-BtShko3w.js";import{_ as Z}from"./print-outline-rounded-rFOQwzQu.js";import{bf as ee,bg as W,bh as te,m as ne,c as y,o as v,a as p,e as ae,f as oe,u as se,r as T,s as ie,g as re,h as ue,L as le,i as ce,bi as de,ae as me,K as _e,a5 as S,af as fe,P as q,Q as ve,y as Q,k as L,F,S as pe,j as P,t as ge,l as j,am as he,$ as be,U as z,R as Te,w as ye,a0 as ke,bj as we,E as G,bk as Le,bl as $e,a6 as Ce,A as Ee,a2 as Me,a3 as Ne,bm as xe,H as Se}from"./index-CuU5w3Fk.js";import{_ as qe}from"./FieldId.vuevuetypescriptsetuptruelang-BAr-ccW2.js";import{u as Re}from"./markdown-GsmR3cqR.js";var U=function(){return ee.Date.now()},Ve="Expected a function",Ie=Math.max,De=Math.min;function He(C,i,u){var d,a,o,r,s,l,_=0,E=!1,f=!1,g=!0;if(typeof C!="function")throw new TypeError(Ve);i=W(i)||0,te(u)&&(E=!!u.leading,f="maxWait"in u,o=f?Ie(W(u.maxWait)||0,i):o,g="trailing"in u?!!u.trailing:g);function k(n){var c=d,e=a;return d=a=void 0,_=n,r=C.apply(e,c),r}function M(n){return _=n,s=setTimeout(m,i),E?k(n):r}function R(n){var c=n-l,e=n-_,t=i-c;return f?De(t,o-e):t}function h(n){var c=n-l,e=n-_;return l===void 0||c>=i||c<0||f&&e>=o}function m(){var n=U();if(h(n))return N(n);s=setTimeout(m,R(n))}function N(n){return s=void 0,g&&d?k(n):(d=a=void 0,r)}function V(){s!==void 0&&clearTimeout(s),_=0,d=l=a=s=void 0}function I(){return s===void 0?r:N(U())}function w(){var n=U(),c=h(n);if(d=arguments,a=this,l=n,c){if(s===void 0)return M(l);if(f)return clearTimeout(s),s=setTimeout(m,i),k(l)}return s===void 0&&(s=setTimeout(m,i)),r}return w.cancel=V,w.flush=I,w}const Qe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ue(C,i){return v(),y("svg",Qe,i[0]||(i[0]=[p("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1)]))}const Ae=ne({name:"material-symbols-arrow-back-rounded",render:Ue}),Be={class:"top-app-bar"},We={class:"title"},Fe={class:"state-point"},Pe={class:"actions"},je={class:"panel-container"},ze=["innerHTML"],$="NOTE",Ge=ae({__name:"NoteEditView",setup(C){const i=oe(),{t:u}=se(),d=_e(),a=T(""),o=T(),r=T(""),s=T(""),l=T(!1),{app:_,urlTokenKey:E}=ie(re());function f(){const e=Ce.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),Ee(i,t)}const{render:g}=Re(_,E),k=He(()=>{l.value=!1,N({id:a.value,input:{content:r.value,title:xe(r.value,{length:250,omission:""})}})},500),M=()=>{ye(r,async e=>{l.value=!0,s.value=await g(e),k()})},R=()=>{window.print()},h=T();ue({handle:(e,t)=>{t?G(u(t),"error"):e&&(h.value=e.tags)},document:we,variables:{type:$}});const{fetch:m}=le({handle:async(e,t)=>{t?G(u(t),"error"):(o.value=e.note,r.value=e.note.content,s.value=await g(r.value),M())},document:Le,variables:()=>({id:a.value}),options:{fetchPolicy:"no-cache"}}),{mutate:N,onDone:V}=ce({document:$e});V(e=>{var t,b;o.value=e.data.saveNote,!a.value&&((t=o.value)!=null&&t.id)&&(a.value=(b=o.value)==null?void 0:b.id,de(i,`/notes/${a.value}`))});function I(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${u("updated_at")}: ${ke(e)})`:""}function w(){var e,t;Me(Ne,{type:$,tags:h.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=h.value)==null?void 0:t.filter(b=>{var x;return(x=o.value)==null?void 0:x.tags.some(D=>D.id===b.id)})})}const n=e=>{e.type===$&&m()},c=e=>{e.type===$&&m()};return me(()=>{a.value=d.params.id,a.value==="create"&&(a.value=""),a.value?m():M(),S.on("item_tags_updated",c),S.on("items_tags_updated",n)}),fe(()=>{S.off("item_tags_updated",c),S.off("items_tags_updated",n)}),(e,t)=>{var A,B;const b=Ae,x=qe,D=be,O=Te,K=Z,X=Y,H=ve("tooltip");return v(),y(z,null,[p("div",Be,[q((v(),y("button",{class:"btn-icon",onClick:Q(f,["prevent"])},[L(b)])),[[H,e.$t("back")]]),p("div",We,[F(ge(a.value?j(u)("edit"):j(u)("create"))+" ",1),q(p("span",Fe,"*",512),[[he,l.value]]),t[1]||(t[1]=F()),(A=o.value)!=null&&A.updatedAt?(v(),pe(x,{key:0,id:I(),class:"time",raw:o.value},null,8,["id","raw"])):P("",!0)]),p("div",Pe,[L(D,{tags:(B=o.value)==null?void 0:B.tags,type:$,"only-links":!0},null,8,["tags"]),a.value?(v(),y(z,{key:0},[q((v(),y("button",{class:"btn-icon",onClick:Q(w,["prevent"])},[L(O)])),[[H,e.$t("add_to_tags")]]),q((v(),y("button",{class:"btn-icon",onClick:Q(R,["prevent"])},[L(K)])),[[H,e.$t("print")]])],64)):P("",!0)])]),p("div",je,[L(X,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=J=>r.value=J),language:"html"},null,8,["modelValue"]),p("div",{class:"md-container",innerHTML:s.value},null,8,ze)])],64)}}}),Ze=Se(Ge,[["__scopeId","data-v-fac1e980"]]);export{Ze as default};
