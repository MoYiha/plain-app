import{e as X,aw as Y,r as _,u as ee,ax as se,ay as ne,cw as oe,cx as te,cy as re,cz as ie,cA as ae,cB as le,cC as ce,a5 as ue,cD as N,c as D,o as E,a as v,j as $,k as T,cE as de,t as h,O as P,al as R,y as me,R as F,cF as we,q as fe,l as u,v as ve,p as M,bZ as pe,as as be,T as ge,cG as he,x as _e,z as Ve,F as O,H as ye}from"./index-Bm4LvS3o.js";function W(n){let o=n;if(typeof o>"u"){if(typeof navigator>"u"||!navigator)return"";o=navigator.userAgent||""}return o.toLowerCase()}function L(n,o){try{return new RegExp(n,"g").exec(o)}catch{return null}}function H(){if(typeof navigator>"u"||!navigator||!navigator.userAgentData)return!1;const o=navigator.userAgentData.brands;return!!(o&&o.length)}function ke(n,o){const t=L(`(${n})((?:\\/|\\s|:)([0-9|\\.|_]+))`,o);return t?t[3]:""}function I(n){return n.replace(/_/g,".")}function y(n,o){let t=null,e="-1";return n.some(r=>{const l=L(`(${r.test})((?:\\/|\\s|:)([0-9|\\.|_]+))?`,o);return!l||r.brand?!1:(t=r,e=l[3]||"-1",r.versionAlias?e=r.versionAlias:r.versionTest&&(e=ke(r.versionTest.toLowerCase(),o)||e),e=I(e),!0)}),{preset:t,version:e}}function V(n,o){const t={brand:"",version:"-1"};return n.some(e=>{const r=U(o,e);return r?(t.brand=e.id,t.version=e.versionAlias||r.version,t.version!=="-1"):!1}),t}function U(n,o){return n.find(t=>L(`${o.test}`,t.brand.toLowerCase()))}const C=[{test:"phantomjs",id:"phantomjs"},{test:"whale",id:"whale"},{test:"edgios|edge|edg",id:"edge"},{test:"msie|trident|windows phone",id:"ie",versionTest:"iemobile|msie|rv"},{test:"miuibrowser",id:"miui browser"},{test:"samsungbrowser",id:"samsung internet"},{test:"samsung",id:"samsung internet",versionTest:"version"},{test:"chrome|crios",id:"chrome"},{test:"firefox|fxios",id:"firefox"},{test:"android",id:"android browser",versionTest:"version"},{test:"safari|iphone|ipad|ipod",id:"safari",versionTest:"version"}],K=[{test:"(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",id:"chrome",versionTest:"chrome"},{test:"chromium",id:"chrome"},{test:"whale",id:"chrome",versionAlias:"-1",brand:!0}],j=[{test:"applewebkit",id:"webkit",versionTest:"applewebkit|safari"}],q=[{test:"(?=(iphone|ipad))(?!(.*version))",id:"webview"},{test:"(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",id:"webview"},{test:"webview",id:"webview"}],z=[{test:"windows phone",id:"windows phone"},{test:"windows 2000",id:"window",versionAlias:"5.0"},{test:"windows nt",id:"window"},{test:"win32|windows",id:"window"},{test:"iphone|ipad|ipod",id:"ios",versionTest:"iphone os|cpu os"},{test:"macos|macintel|mac os x",id:"mac"},{test:"android|linux armv81",id:"android"},{test:"tizen",id:"tizen"},{test:"webos|web0s",id:"webos"}];function G(n){return!!y(q,n).preset}function Se(n){const o=W(n),t=!!/mobi/g.exec(o),e={name:"unknown",version:"-1",majorVersion:-1,webview:G(o),chromium:!1,chromiumVersion:"-1",webkit:!1,webkitVersion:"-1"},r={name:"unknown",version:"-1",majorVersion:-1},{preset:l,version:w}=y(C,o),{preset:s,version:c}=y(z,o),p=y(K,o);if(e.chromium=!!p.preset,e.chromiumVersion=p.version,!e.chromium){const m=y(j,o);e.webkit=!!m.preset,e.webkitVersion=m.version}return s&&(r.name=s.id,r.version=c,r.majorVersion=parseInt(c,10)),l&&(e.name=l.id,e.version=w,e.webview&&r.name==="ios"&&e.name!=="safari"&&(e.webview=!1)),e.majorVersion=parseInt(e.version,10),{browser:e,os:r,isMobile:t,isHints:!1}}function J(n){const o=navigator.userAgentData,t=[...o.brands],e=n&&n.fullVersionList,r=o.mobile||!1,l=t[0],w=(n&&n.platform||o.platform||navigator.platform).toLowerCase(),s={name:l.brand,version:l.version,majorVersion:-1,webkit:!1,webkitVersion:"-1",chromium:!1,chromiumVersion:"-1",webview:!!V(q,t).brand||G(W())},c={name:"unknown",version:"-1",majorVersion:-1};s.webkit=!s.chromium&&j.some(i=>U(t,i));const p=V(K,t);if(s.chromium=!!p.brand,s.chromiumVersion=p.version,!s.chromium){const i=V(j,t);s.webkit=!!i.brand,s.webkitVersion=i.version}const m=z.find(i=>new RegExp(`${i.test}`,"g").exec(w));if(c.name=m?m.id:"",n&&(c.version=n.platformVersion),e&&e.length){const i=V(C,e);s.name=i.brand||s.name,s.version=i.version||s.version}else{const i=V(C,t);s.name=i.brand||s.name,s.version=i.brand&&n?n.uaFullVersion:i.version}return s.webkit&&(c.name=r?"ios":"mac"),c.name==="ios"&&s.webview&&(s.version="-1"),c.version=I(c.version),s.version=I(s.version),c.majorVersion=parseInt(c.version,10),s.majorVersion=parseInt(s.version,10),{browser:s,os:c,isMobile:r,isHints:!0}}async function Ae(){if(H()){const n=await navigator.userAgentData.getHighEntropyValues(["architecture","model","platform","platformVersion","uaFullVersion","fullVersionList"]);return J(n)}return Ee()}function Ee(n){return H()?J():Se(n)}const Te={class:"header"},Be={class:"login-block"},xe={class:"alert alert-danger show",role:"alert"},$e={class:"body"},Pe={class:"tap-phone"},Re={class:"tap-phone-text"},Ie={key:0,class:"tips"},Ce=X({__name:"LoginView",setup(n){const{handleSubmit:o,isSubmitting:t}=Y(),e=_(!1),r=_(!0),l=_(!1),w=_("");let s;const c=window.location.protocol==="http:"?!1:!window.navigator.userAgentData,{t:p}=ee(),{value:m,errorMessage:i}=se("password",ne().required()),B=_(!1);async function Z(){const d=await fetch(`${N()}/init`,{method:"POST",headers:he()});if(d.status===403){e.value=!0,r.value=!0,w.value="web_access_disabled";return}r.value=!1;const f=await d.text();f?(m.value=f,B.value=!1):B.value=!0}Z();const x=o(async()=>{const d=localStorage.getItem("client_id");s=new WebSocket(`${oe()}?cid=${d}&auth=1`);const f=m.value??"",k=te(f),S=re(k);w.value="",e.value=!1,s.onopen=async()=>{t.value=!0;const a=await Ae(),b=ie(S,JSON.stringify({password:k,browserName:a.browser.name,browserVersion:a.browser.version,osName:a.os.name,osVersion:a.os.version,isMobile:a.isMobile}));s.send(ae(b))},s.onmessage=async a=>{var g;const b=le(S,ce(await a.data.arrayBuffer())),A=JSON.parse(b);A.status==="PENDING"?l.value=!0:(localStorage.setItem("auth_token",A.token),s.close(),window.location.href=((g=ue.currentRoute.value.query.redirect)==null?void 0:g.toString())??"/")},s.onclose=async a=>{if(!(a.reason==="abort"||a.reason==="OK")){if(t.value=!1,e.value=!0,l.value=!1,!a.reason&&(await fetch(`${N()}/health_check`)).status===200){w.value="failed_connect_ws";return}w.value=`login.${a.reason?a.reason:"failed"}`}},window.setTimeout(function(){s.readyState!==1&&s.close(3001,"timeout")},2e3)});function Q(){l.value=!1,e.value=!1,t.value=!1,s.close(3001,"abort")}return(d,f)=>{const k=de,S=we,a=_e,b=Ve,A=be;return E(),D(ge,null,[v("header",Te,[T(k,{"logged-in":!1})]),v("h1",null,h(d.$t("app_name")),1),v("div",Be,[P(v("form",{onSubmit:f[1]||(f[1]=me((...g)=>u(x)&&u(x)(...g),["prevent"]))},[P(v("div",xe,[T(S),v("div",$e,h(w.value?d.$t(w.value):""),1)],512),[[R,e.value]]),B.value?(E(),F(a,{key:0,modelValue:u(m),"onUpdate:modelValue":f[0]||(f[0]=g=>ve(m)?m.value=g:null),label:u(p)("password"),type:"password",class:"form-control",error:u(i),autocomplete:"current-password","error-text":u(i)?d.$t(u(i)):"",onKeydown:fe(u(x),["enter"])},null,8,["modelValue","label","error","error-text","onKeydown"])):$("",!0),r.value?$("",!0):(E(),F(b,{key:1,disabled:u(t),loading:u(t)},{default:M(()=>[O(h(d.$t(u(t)?"logging_in":"log_in")),1)]),_:1},8,["disabled","loading"]))],544),[[R,!l.value]]),P(v("div",null,[v("div",Pe,[T(u(pe))]),v("div",Re,h(d.$t("login.to_continue")),1),T(A,{onClick:Q},{default:M(()=>[O(h(d.$t("cancel")),1)]),_:1})],512),[[R,l.value]])]),u(c)?(E(),D("div",Ie,h(d.$t("browser_warning")),1)):$("",!0)],64)}}}),Le=ye(Ce,[["__scopeId","data-v-5bd94d1c"]]);export{Le as default};
