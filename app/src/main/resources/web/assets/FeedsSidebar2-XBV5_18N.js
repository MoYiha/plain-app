import{_ as Ke}from"./more-vert-BMfIzoNk.js";import{u as _e,r as b,L as pe,cl as Pe,E as M,e as We,f as je,s as xe,g as Oe,I as Ye,J as Ze,K as Je,aM as ne,a5 as le,i as ie,M as Xe,N as es,c as l,o,a,k as d,j as q,R as D,l as e,t as p,T as ce,O as I,P as ss,y as v,a7 as ts,Q as os,U as as,p as de,bp as ns,V as ls,ck as is,bZ as cs,cm as ds,cn as rs,co as us,Y as _s,d as ps,S as vs,$ as ms,F as fs,a0 as gs,Z as hs,aH as ks,A as re,a3 as ys,a4 as m,cp as bs,H as ws}from"./index-Eg2Dz6vI.js";import{_ as $s}from"./FieldId.vuevuetypescriptsetuptruelang-lzcc_jvg.js";import{_ as Cs,a as Ts}from"./SearchInput-DFrEaFdp.js";import{_ as Ss,a as Ls}from"./add-notes-outline-rounded-C2nV8WlM.js";import{_ as Es}from"./VCheckbox-BuMj4nO3.js";import{u as Fs}from"./feeds-X-F1NM8L.js";import{u as qs,b as Ds,a as Is}from"./key-events-BNPqExTk.js";import{a as Ms}from"./tags-BO_i69Sy.js";import{u as Ns}from"./search-BrbvAB1e.js";import"./VInputChip-BoCl3y34.js";const As=(Q,u,w)=>{const{t:$}=_e(),f=b(1),N=100,c=b(!1),{loading:C,fetch:R}=pe({handle:(g,T)=>{if(T)M($(T),"error");else if(g){g.items.length<N&&(c.value=!0);const S=g.items;f.value===1?Q.value=S:Q.value=Q.value.concat(S),w.value=g.total}},document:Pe,variables:()=>({offset:(f.value-1)*N,limit:N,query:u.value})});return{page:f,noMore:c,loading:C,fetch:R,loadMore:()=>{c.value||C.value||f.value++}}},Qs={class:"top-app-bar"},Rs={class:"title"},Us={key:0},Vs={key:1},zs={class:"actions"},Bs=["disabled"],Gs={key:0,class:"scroller"},Hs={class:"subtitle"},Ks={class:"number"},Ps=["href"],Ws=["onClick","onMouseover"],js={class:"title"},xs={class:"text"},Os={class:"subtitle"},Ys={class:"number"},Zs={class:"info"},Js=["onClick"],Xs={class:"time"},et={class:"btn-icon sm",style:{display:"none"}},st=["src"],tt={key:2,class:"no-data-placeholder"},ue=100,ot=We({__name:"FeedsSidebar2",setup(Q){var oe;const u=je(),{feedsSyncing:w}=xe(Oe()),{t:$}=_e(),f=Ye({tagIds:[]}),{parseQ:N}=Ns(),c=Ze.FEED_ENTRY,C=Je(),R=C.query,g=b(parseInt(((oe=R.page)==null?void 0:oe.toString())??"1")),T=b([]),S=b([]),B=ne(()=>{const s={};return S.value.forEach(t=>{s[t.id]=t}),s}),h=b([]),k=b(""),{selectedIds:r,allChecked:G,realAllChecked:L,selectRealAll:ve,allCheckedAlertVisible:me,clearSelection:U,toggleAllChecked:fe,toggleSelect:H,total:y,checked:K,shiftEffectingIds:P,handleItemClick:ge,handleMouseOver:he,selectAll:ke,shouldSelect:ye}=qs(h),be=s=>{g.value=s;const t=C.query.q;re(u,t?`/feeds?page=${s}&q=${t}`:`/feeds?page=${s}`)},{keyDown:W,keyUp:j}=Is(y,ue,g,ke,U,be,()=>{Y(r.value,L.value,y.value,k.value)}),{page:x,loading:V,loadMore:we,fetch:$e,noMore:O}=As(h,k,y),{addToTags:Ce}=Ms(c,T),A=()=>{x.value=1,$e()},{deleteItems:Y}=Ds(bs,()=>{U(),A(),h.value.some(s=>s.tags.length)&&m.emit("refetch_tags",c),m.emit("feed_entries_deleted")}),Te=ne(()=>le.currentRoute.value.path!=="/feeds"),{resizeWidth:Z}=is(300,()=>u.sidebar2Width,s=>{u.sidebar2Width=s}),{mutate:J,loading:Se,onDone:Le}=ie({document:ds});function Ee(){if(L)J({query:k.value});else{if(r.value.length===0){M($("select_first"),"error");return}J({query:`ids:${r.value.join(",")}`})}}Le(()=>{M($("saved"))});function Fe(s){return s?`/feeds?q=${s}`:"/feeds"}const{fetch:qe}=pe({handle:async(s,t)=>{t?M($(t),"error"):s&&(T.value=s.tags,S.value=s.feeds)},document:rs,variables:{type:c}});function X(s){const t=le.currentRoute.value.query.q;return t?`/feeds/${s.feedId}/entries/${s.id}?q=${t}`:`/feeds/${s.feedId}/entries/${s.id}`}function De(s){re(u,X(s))}const{viewFeed:Ie}=Fs(u),{mutate:Me}=ie({document:us});function Ne(){w.value=!0,Me({id:""})}const ee=s=>{w.value=!1,A(),s.error?M(s.error,"error"):M($("feeds_synced"))},se=s=>{s.type===c&&(U(),A())},te=s=>{s.type===c&&A()};return Xe(()=>{var t,E;const s=(t=document.getElementsByClassName("scroller"))==null?void 0:t[0];s&&(s.scrollTop=0),k.value=ys(((E=R.q)==null?void 0:E.toString())??""),N(f,k.value),qe(),A(),m.on("item_tags_updated",te),m.on("items_tags_updated",se),m.on("feeds_fetched",ee),window.addEventListener("keydown",W),window.addEventListener("keyup",j)}),es(()=>{x.value=1,O.value=!1,m.off("item_tags_updated",te),m.off("items_tags_updated",se),m.off("feeds_fetched",ee),window.removeEventListener("keydown",W),window.removeEventListener("keyup",j)}),(s,t)=>{const E=Es,Ae=ts,Qe=os,z=_s,Re=Ss,Ue=Cs,Ve=Ls,ze=Ts,Be=$s,Ge=hs,He=Ke,F=ss("tooltip");return o(),l("aside",{class:"sidebar2",style:cs({width:e(C).params.id?e(u).sidebar2Width+"px":"auto"})},[a("div",Qs,[d(E,{"touch-target":"wrapper",checked:e(G),indeterminate:!e(G)&&e(K),onChange:e(fe)},null,8,["checked","indeterminate","onChange"]),a("div",Rs,[e(r).length?(o(),l("span",Us,p(s.$t("x_selected",{count:e(L)?e(y).toLocaleString():e(r).length.toLocaleString()})),1)):(o(),l("span",Vs,p(s.$t("page_title.feeds"))+" ("+p(e(y).toLocaleString())+")",1)),e(K)?(o(),l(ce,{key:2},[I((o(),l("button",{class:"btn-icon",onClick:t[0]||(t[0]=v(i=>e(Y)(e(r),e(L),e(y),k.value),["stop"]))},[d(Ae)])),[[F,s.$t("delete")]]),I((o(),l("button",{class:"btn-icon",onClick:t[1]||(t[1]=v(i=>e(Ce)(e(r),e(L),k.value),["stop"]))},[d(Qe)])),[[F,s.$t("add_to_tags")]]),e(Se)?(o(),D(z,{key:0,indeterminate:"",class:"sm"})):I((o(),l("button",{key:1,class:"btn-icon sm",onClick:v(Ee,["prevent"])},[d(Re)])),[[F,s.$t("save_to_notes")]])],64)):q("",!0)]),a("div",zs,[d(Ue,{filter:f,tags:T.value,feeds:S.value,"show-chips":!Te.value,"get-url":Fe,"show-today":!0},null,8,["filter","tags","feeds","show-chips"]),e(w)?(o(),D(z,{key:0,indeterminate:"",class:"sm"})):I((o(),l("button",{key:1,class:"btn-icon",disabled:e(w),onClick:v(Ne,["prevent"])},[d(Ve)],8,Bs)),[[F,s.$t("sync_feeds")]])])]),d(ze,{limit:ue,total:e(y),"all-checked-alert-visible":e(me),"real-all-checked":e(L),"select-real-all":e(ve),"clear-selection":e(U)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(V)&&h.value.length===0?(o(),l("div",Gs,[(o(),l(ce,null,as(20,i=>a("section",{key:i,class:"feed-item selectable-card-skeleton"},[t[4]||(t[4]=ps('<div class="title" data-v-115aa717><div class="checkbox" data-v-115aa717><div class="skeleton-checkbox" data-v-115aa717></div></div><div class="text" data-v-115aa717><div class="skeleton-text skeleton-title" data-v-115aa717></div></div></div>',1)),a("div",Hs,[a("span",Ks,p(i),1),t[3]||(t[3]=a("div",{class:"info"},[a("div",{class:"skeleton-text skeleton-info"})],-1))]),t[5]||(t[5]=a("div",{class:"image"},[a("div",{class:"skeleton-image"})],-1))])),64))])):q("",!0),h.value.length>0?(o(),D(e(ns),{key:1,class:"scroller","data-key":"id","data-sources":h.value,"estimate-size":100,onTobottom:e(we)},{item:de(({index:i,item:n})=>{var ae;return[a("a",{class:"item-link",href:X(n)},[a("article",{class:vs(["feed-item selectable-card",{selected:e(r).includes(n.id)||n.id==s.$route.params.id,selecting:e(P).includes(n.id)}]),onClick:v(_=>e(ge)(_,n,i,()=>{De(n)}),["stop","prevent"]),onMouseover:_=>e(he)(_,i)},[a("div",js,[e(P).includes(n.id)?(o(),D(E,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(ye),onClick:v(_=>e(H)(_,n,i),["stop"])},null,8,["checked","onClick"])):(o(),D(E,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(r).includes(n.id),onClick:v(_=>e(H)(_,n,i),["stop"])},null,8,["checked","onClick"])),a("div",xs,p(n.title||s.$t("no_content")),1)]),a("div",Os,[a("span",Ys,[d(Be,{id:i+1,raw:n},null,8,["id","raw"])]),a("div",Zs,[a("a",{onClick:v(_=>e(Ie)(B.value[n.feedId]),["stop","prevent"])},p((ae=B.value[n.feedId])==null?void 0:ae.name),9,Js),t[6]||(t[6]=a("span",null,"Â·",-1)),I((o(),l("span",Xs,[fs(p(e(gs)(n.publishedAt)),1)])),[[F,e(ms)(n.publishedAt)]]),d(Ge,{tags:n.tags,type:e(c),"only-links":!0},null,8,["tags","type"])])]),I((o(),l("button",et,[d(He)])),[[F,s.$t("actions")]]),n.image?(o(),l("img",{key:0,class:"image",src:e(ks)(n.image,"&w=200&h=200")},null,8,st)):q("",!0)],42,Ws)],8,Ps)]}),footer:de(()=>[e(O)?q("",!0):(o(),D(z,{key:0,indeterminate:"",class:"sm"}))]),_:1},8,["data-sources","onTobottom"])):q("",!0),!e(V)&&h.value.length===0?(o(),l("div",tt,p(s.$t(e(ls)(e(V)))),1)):q("",!0),a("div",{class:"sidebar-drag-indicator",onMousedown:t[2]||(t[2]=(...i)=>e(Z)&&e(Z)(...i))},null,32)],4)}}}),mt=ws(ot,[["__scopeId","data-v-115aa717"]]);export{mt as default};
