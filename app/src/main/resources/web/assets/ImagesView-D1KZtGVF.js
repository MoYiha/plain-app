import{_ as To}from"./VPagination.vuevuetypescriptsetuptruelang-DZpCvrfT.js";import{_ as Do,a as So,b as Vo,c as Ao,d as Eo}from"./grid-view-outline-rounded-CitVomxq.js";import{_ as Mo}from"./FieldId.vuevuetypescriptsetuptruelang-lzcc_jvg.js";import{e as Fo,f as Lo,s as Ne,r as L,u as Ro,I as Uo,g as zo,ag as He,ah as qo,J as Bo,K as No,aL as Ho,aM as Pe,aN as Po,ai as Ko,aO as R,aH as ge,L as Qo,aP as Oo,aQ as jo,M as Go,N as Wo,c as m,o as t,a as p,k as a,l as e,j as U,t as y,T as h,O as u,P as Xo,R as l,p as c,y as i,aR as J,aS as Y,ak as Zo,S as A,al as Jo,U as x,V as Yo,aT as xo,av as es,aU as os,E as ss,aV as ts,a7 as ns,aW as as,aj as ls,aX as is,Q as cs,ar as ds,aY as rs,at as us,Z as _s,n as Ke,aZ as ps,$ as ms,F as gs,a0 as ks,A as vs,a1 as fs,a2 as ys,a_ as Qe,a3 as hs,a4 as D,a$ as $s}from"./index-Eg2Dz6vI.js";import{_ as Cs,a as bs}from"./SearchInput-DFrEaFdp.js";import{_ as ws,a as Is}from"./upload-rounded-DxjQpv8E.js";import{_ as Ts}from"./MediaKeyboardShortcuts.vuevuetypescriptsetuptruelang-y9_9FBhl.js";import{_ as Ds}from"./VCheckbox-BuMj4nO3.js";import{u as Ss}from"./search-BrbvAB1e.js";import{a as Vs}from"./tags-BO_i69Sy.js";import{u as As,a as Es}from"./key-events-BNPqExTk.js";import"./VInputChip-BoCl3y34.js";const Ms={class:"top-app-bar"},Fs={class:"title"},Ls={key:0},Rs={key:1},Us={class:"actions"},zs=["onClick"],qs={class:"button-group"},Bs=["onClick","onMouseover"],Ns=["src"],Hs={key:1,class:"actions"},Ps={class:"right"},Ks=["onClick","onMouseover"],Qs={class:"start"},Os={class:"number"},js=["src"],Gs={class:"title"},Ws={class:"subtitle"},Xs=["onClick"],Zs={class:"actions"},Js={class:"time"},Ys={key:2,class:"no-data-placeholder"},E=55,_t=Fo({__name:"ImagesView",setup(xs){var Ue;const S=Lo(),{imageSortBy:P}=Ne(S),V=L([]),{t:Oe}=Ro(),{parseQ:je}=Ss(),I=Uo({tagIds:[],bucketId:void 0}),ke=zo(),{app:M,urlTokenKey:ee,uploads:oe}=Ne(ke),K=L(!1),se=L(!1),{input:Ge,upload:We,uploadChanged:ve}=He(oe),{input:Xe,upload:Ze,uploadChanged:fe}=He(oe),{dropping:Je,fileDragEnter:ye,fileDragLeave:he,dropFiles:Ye}=qo(oe),te=L(!1),r=Bo.IMAGE,$e=No(),Ce=$e.query,ne=L(parseInt(((Ue=Ce.page)==null?void 0:Ue.toString())??"1")),{tags:Q,buckets:O,fetch:xe}=Ho(r),eo=Pe(()=>{const s={};return O.value.forEach(n=>{s[n.id]=n}),s}),b=L(""),{addToTags:oo}=Vs(r,Q),{deleteItems:ae,deleteItem:j}=Po(),{view:so}=ps(r),{selectedIds:v,allChecked:be,realAllChecked:T,selectRealAll:to,allCheckedAlertVisible:no,clearSelection:z,toggleAllChecked:ao,toggleSelect:q,total:w,checked:B,shiftEffectingIds:G,handleItemClick:we,handleMouseOver:Ie,selectAll:lo,shouldSelect:Te}=As(V),{downloadItems:De}=Ko(ee,r,z,()=>es("images")),{downloadFile:W}=us(ee),Se=s=>{const n=$e.query.q;vs(S,n?`/images?page=${s}&q=${n}`:`/images?page=${s}`)},{keyDown:Ve,keyUp:Ae}=Es(w,E,ne,lo,z,Se,()=>{J(Y.MEDIA_TRASH,M.value.osVersion)?Z(r,N()):ae(r,v.value,T.value,w.value,b.value)}),io=ds(),co=Pe(()=>V.value.map(s=>({src:ge(s.fileId),name:R(s.path),duration:0,size:s.size,path:s.path,type:r,data:s})));function le(s){ke.lightbox={sources:co.value,index:s,visible:!0}}const N=()=>{let s=b.value;return T.value||(s=`ids:${v.value.join(",")}`),s};function Ee(s){fs(ys,{type:r,tags:Q.value,item:{key:s.id,title:s.title,size:s.size},selected:Q.value.filter(n=>s.tags.some(C=>C.id===n.id))})}function ro(s){P.value!==s&&(te.value=!0,P.value=s)}const{loading:X,fetch:H}=Qo({handle:async(s,n)=>{if(te.value=!1,n)ss(Oe(n),"error");else if(s){const C=[];for(const $ of s.images)C.push({...$,fileId:ts(ee.value,$.path,$.id)});V.value=C,w.value=s.imageCount}},document:os,variables:()=>({offset:(ne.value-1)*E,limit:E,query:b.value,sortBy:P.value})}),{trashLoading:ie,trash:Z}=Oo(),{restoreLoading:ce,restore:de}=jo();function uo(s){return s?`/images?q=${s}`:"/images"}function re(){const s=O.value.find(n=>n.id===I.bucketId);return s?Qe(s.topItems[0]):`${M.value.internalStoragePath}/Pictures`}function _o(){We(re())}function po(){Ze(re())}function mo(s){Ye(s,re(),"image")}const Me=s=>{s.type===r&&(z(),H())},Fe=s=>{s.type===r&&H()},Le=s=>{s.type===r&&(z(),H())},Re=s=>{s.status==="done"&&$s(s.fileName)&&((!I.bucketId||O.value.some(C=>C.id===I.bucketId&&C.topItems.some($=>s.dir.startsWith(Qe($)))))&&setTimeout(()=>{H()},1e3),D.emit("media_items_actioned",{type:r,action:"upload",query:""}))};return Go(()=>{var s;b.value=hs(((s=Ce.q)==null?void 0:s.toString())??""),je(I,b.value),xe(),H(),D.on("item_tags_updated",Fe),D.on("items_tags_updated",Me),D.on("media_items_actioned",Le),D.on("upload_task_done",Re),window.addEventListener("keydown",Ve),window.addEventListener("keyup",Ae)}),Wo(()=>{D.off("item_tags_updated",Fe),D.off("items_tags_updated",Me),D.off("media_items_actioned",Le),D.off("upload_task_done",Re),window.removeEventListener("keydown",Ve),window.removeEventListener("keyup",Ae)}),(s,n)=>{const C=Ds,$=ns,d=xo,ue=as,F=ls,_e=is,pe=cs,go=Cs,ko=Ts,vo=ws,ze=Zo,fo=Is,yo=Do,ho=So,$o=bs,me=Vo,qe=Ao,Co=rs,Be=_s,bo=Mo,wo=Eo,Io=To,_=Xo("tooltip");return t(),m(h,null,[p("div",Ms,[a(C,{"touch-target":"wrapper",checked:e(be),indeterminate:!e(be)&&e(B),onChange:e(ao)},null,8,["checked","indeterminate","onChange"]),p("div",Fs,[e(v).length?(t(),m("span",Ls,y(s.$t("x_selected",{count:e(T)?e(w).toLocaleString():e(v).length.toLocaleString()})),1)):(t(),m("span",Rs,y(s.$t("page_title.images"))+" ("+y(e(w).toLocaleString())+")",1)),e(B)?(t(),m(h,{key:2},[I.trash?(t(),m(h,{key:0},[u((t(),l(d,{onClick:n[0]||(n[0]=i(o=>e(ae)(e(r),e(v),e(T),e(w),b.value),["stop"]))},{icon:c(()=>[a($)]),_:1})),[[_,s.$t("delete")]]),u((t(),l(d,{loading:e(ce)(N()),onClick:n[1]||(n[1]=i(o=>e(de)(e(r),N()),["stop"]))},{icon:c(()=>[a(ue)]),_:1},8,["loading"])),[[_,s.$t("restore")]]),u((t(),l(d,{onClick:n[2]||(n[2]=i(o=>e(De)(e(T),e(v),b.value),["stop"]))},{icon:c(()=>[a(F)]),_:1})),[[_,s.$t("download")]])],64)):(t(),m(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(M).osVersion)?u((t(),l(d,{key:0,loading:e(ie)(N()),onClick:n[3]||(n[3]=i(o=>e(Z)(e(r),N()),["stop"]))},{icon:c(()=>[a(_e)]),_:1},8,["loading"])),[[_,s.$t("move_to_trash")]]):u((t(),l(d,{key:1,onClick:n[4]||(n[4]=i(o=>e(ae)(e(r),e(v),e(T),e(w),b.value),["stop"]))},{icon:c(()=>[a($)]),_:1})),[[_,s.$t("delete")]]),u((t(),l(d,{onClick:n[5]||(n[5]=i(o=>e(De)(e(T),e(v),b.value),["stop"]))},{icon:c(()=>[a(F)]),_:1})),[[_,s.$t("download")]]),u((t(),l(d,{onClick:n[6]||(n[6]=i(o=>e(oo)(e(v),e(T),b.value),["stop"]))},{icon:c(()=>[a(pe)]),_:1})),[[_,s.$t("add_to_tags")]])],64))],64)):U("",!0)]),p("div",Us,[a(go,{filter:I,tags:e(Q),buckets:e(O),"get-url":uo},null,8,["filter","tags","buckets"]),a(ko),I.trash?U("",!0):(t(),l(ze,{key:0,modelValue:K.value,"onUpdate:modelValue":n[9]||(n[9]=o=>K.value=o)},{trigger:c(()=>[u((t(),l(d,null,{icon:c(()=>[a(vo)]),_:1})),[[_,s.$t("upload")]])]),default:c(()=>[p("div",{class:"dropdown-item",onClick:n[7]||(n[7]=i(o=>{_o(),K.value=!1},["stop"]))},y(s.$t("upload_files")),1),p("div",{class:"dropdown-item",onClick:n[8]||(n[8]=i(o=>{po(),K.value=!1},["stop"]))},y(s.$t("upload_folder")),1)]),_:1},8,["modelValue"])),a(ze,{modelValue:se.value,"onUpdate:modelValue":n[10]||(n[10]=o=>se.value=o)},{trigger:c(()=>[u((t(),l(d,{loading:te.value},{icon:c(()=>[a(fo)]),_:1},8,["loading"])),[[_,s.$t("sort")]])]),default:c(()=>[(t(!0),m(h,null,x(e(io),o=>(t(),m("div",{key:o.value,class:A(["dropdown-item",{selected:o.value===e(P)}]),onClick:f=>{ro(o.value),se.value=!1}},y(s.$t(o.label)),11,zs))),128))]),_:1},8,["modelValue"]),p("div",qs,[p("button",{class:A({selected:!e(S).imagesCardView}),onClick:n[11]||(n[11]=o=>e(S).imagesCardView=!1)},[a(yo)],2),p("button",{class:A({selected:e(S).imagesCardView}),onClick:n[12]||(n[12]=o=>e(S).imagesCardView=!0)},[a(ho)],2)])])]),a($o,{limit:E,total:e(w),"all-checked-alert-visible":e(no),"real-all-checked":e(T),"select-real-all":e(to),"clear-selection":e(z)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),p("div",{class:"scroll-content",onDragover:n[16]||(n[16]=i((...o)=>e(ye)&&e(ye)(...o),["stop","prevent"]))},[u(p("div",{class:"drag-mask",onDrop:i(mo,["stop","prevent"]),onDragleave:n[13]||(n[13]=i((...o)=>e(he)&&e(he)(...o),["stop","prevent"]))},y(s.$t("release_to_send_files")),545),[[Jo,e(Je)]]),e(S).imagesCardView?(t(),m("div",{key:1,class:A(["media-list",{"select-mode":e(B)}])},[(t(!0),m(h,null,x(V.value,(o,f)=>{var g;return t(),m("section",{key:o.id,class:A(["media-item selectable-card",{selected:e(v).includes(o.id),selecting:e(G).includes(o.id)}]),onClick:i(k=>e(we)(k,o,f,le),["stop"]),onMouseover:k=>e(Ie)(k,f)},[p("div",Qs,[e(G).includes(o.id)?(t(),l(C,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(Te),onClick:i(k=>e(q)(k,o,f),["stop"])},null,8,["checked","onClick"])):(t(),l(C,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(v).includes(o.id),onClick:i(k=>e(q)(k,o,f),["stop"])},null,8,["checked","onClick"])),p("span",Os,[a(bo,{id:f+1,raw:o},null,8,["id","raw"])])]),p("img",{class:"image",src:e(ge)(o.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,js),p("div",Gs,y(e(R)(o.path)),1),p("div",Ws,[p("span",null,y(e(Ke)(o.size)),1),p("a",{onClick:i(k=>e(so)(e(S),o.bucketId),["stop","prevent"])},y((g=eo.value[o.bucketId])==null?void 0:g.name),9,Xs),a(Be,{tags:o.tags,type:e(r),"only-links":!0},null,8,["tags","type"])]),p("div",Zs,[I.trash?(t(),m(h,{key:0},[u((t(),l(d,{class:"sm",onClick:i(k=>e(j)(e(r),o),["stop"])},{icon:c(()=>[a($)]),_:2},1032,["onClick"])),[[_,s.$t("delete")]]),u((t(),l(d,{class:"sm",loading:e(ce)(`ids:${o.id}`),onClick:i(k=>e(de)(e(r),`ids:${o.id}`),["stop"])},{icon:c(()=>[a(ue)]),_:2},1032,["loading","onClick"])),[[_,s.$t("restore")]]),u((t(),l(d,{class:"sm",onClick:i(k=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[a(F)]),_:2},1032,["onClick"])),[[_,s.$t("download")]])],64)):(t(),m(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(M).osVersion)?u((t(),l(d,{key:0,class:"sm",loading:e(ie)(`ids:${o.id}`),onClick:i(k=>e(Z)(e(r),`ids:${o.id}`),["stop"])},{icon:c(()=>[a(_e)]),_:2},1032,["loading","onClick"])),[[_,s.$t("move_to_trash")]]):u((t(),l(d,{key:1,class:"sm",onClick:i(k=>e(j)(e(r),o),["stop"])},{icon:c(()=>[a($)]),_:2},1032,["onClick"])),[[_,s.$t("delete")]]),u((t(),l(d,{class:"sm",onClick:i(k=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[a(F)]),_:2},1032,["onClick"])),[[_,s.$t("download")]]),u((t(),l(d,{class:"sm",onClick:i(k=>Ee(o),["stop"])},{icon:c(()=>[a(pe)]),_:2},1032,["onClick"])),[[_,s.$t("add_to_tags")]])],64))]),p("div",Js,[u((t(),m("span",null,[gs(y(e(ks)(o.createdAt)),1)])),[[_,e(ms)(o.createdAt)]])])],42,Ks)}),128)),e(X)&&V.value.length===0?(t(),l(wo,{key:0,limit:E})):U("",!0)],2)):(t(),m("div",{key:0,class:A(["media-grid",{"select-mode":e(B)}])},[(t(!0),m(h,null,x(V.value,(o,f)=>(t(),m("section",{key:o.id,class:A(["media-item",{selected:e(v).includes(o.id),selecting:e(G).includes(o.id)}]),onClick:i(g=>e(we)(g,o,f,le),["stop"]),onMouseover:g=>e(Ie)(g,f)},[p("img",{class:"image-thumb image",src:e(ge)(o.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,Ns),e(G).includes(o.id)?(t(),l(d,{key:0,class:"btn-checkbox",onClick:i(g=>e(q)(g,o,f),["stop"])},{icon:c(()=>[e(Te)?(t(),l(me,{key:0})):(t(),l(qe,{key:1}))]),_:2},1032,["onClick"])):e(v).includes(o.id)?(t(),l(d,{key:1,class:"btn-checkbox",onClick:i(g=>e(q)(g,o,f),["stop"])},{icon:c(()=>[a(me)]),_:2},1032,["onClick"])):(t(),m(h,{key:2},[a(d,{class:"btn-checkbox",onClick:i(g=>e(q)(g,o,f),["stop"])},{icon:c(()=>[e(v).includes(o.id)?(t(),l(me,{key:0})):(t(),l(qe,{key:1}))]),_:2},1032,["onClick"]),e(B)?u((t(),l(d,{key:0,class:"btn-zoom sm",onClick:i(g=>le(f),["stop"])},{icon:c(()=>[a(Co)]),_:2},1032,["onClick"])),[[_,s.$t("open")]]):(t(),m("div",Hs,[I.trash?(t(),m(h,{key:0},[u((t(),l(d,{class:"sm",onClick:i(g=>e(j)(e(r),o),["stop"])},{icon:c(()=>[a($)]),_:2},1032,["onClick"])),[[_,s.$t("delete")]]),u((t(),l(d,{class:"sm",loading:e(ce)(`ids:${o.id}`),onClick:i(g=>e(de)(e(r),`ids:${o.id}`),["stop"])},{icon:c(()=>[a(ue)]),_:2},1032,["loading","onClick"])),[[_,s.$t("restore")]]),u((t(),l(d,{class:"sm",onClick:i(g=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[a(F)]),_:2},1032,["onClick"])),[[_,s.$t("download")]])],64)):(t(),m(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(M).osVersion)?u((t(),l(d,{key:0,class:"sm",loading:e(ie)(`ids:${o.id}`),onClick:i(g=>e(Z)(e(r),`ids:${o.id}`),["stop"])},{icon:c(()=>[a(_e)]),_:2},1032,["loading","onClick"])),[[_,s.$t("move_to_trash")]]):u((t(),l(d,{key:1,class:"sm",onClick:i(g=>e(j)(e(r),o),["stop"])},{icon:c(()=>[a($)]),_:2},1032,["onClick"])),[[_,s.$t("delete")]]),u((t(),l(d,{class:"sm",onClick:i(g=>e(W)(o.path,e(R)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[a(F)]),_:2},1032,["onClick"])),[[_,s.$t("download")]]),u((t(),l(d,{class:"sm",onClick:i(g=>Ee(o),["stop"])},{icon:c(()=>[a(pe)]),_:2},1032,["onClick"])),[[_,s.$t("add_to_tags")]])],64))])),p("div",{class:A(["info",{"has-tags":o.tags.length>0}])},[a(Be,{tags:o.tags,type:e(r)},null,8,["tags","type"]),p("span",Ps,y(e(Ke)(o.size)),1)],2)],64))],42,Bs))),128)),e(X)&&V.value.length===0?(t(),m(h,{key:0},x(E,o=>p("section",{key:o,class:"skeleton-image media-item"})),64)):U("",!0)],2)),!e(X)&&V.value.length===0?(t(),m("div",Ys,y(s.$t(e(Yo)(e(X),e(M).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):U("",!0),e(w)>E?(t(),l(Io,{key:3,page:ne.value,go:Se,total:e(w),limit:E},null,8,["page","total"])):U("",!0),p("input",{ref_key:"fileInput",ref:Ge,style:{display:"none"},type:"file",accept:"image/*",multiple:"",onChange:n[14]||(n[14]=(...o)=>e(ve)&&e(ve)(...o))},null,544),p("input",{ref_key:"dirFileInput",ref:Xe,style:{display:"none"},type:"file",accept:"image/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[15]||(n[15]=(...o)=>e(fe)&&e(fe)(...o))},null,544)],32)],64)}}});export{_t as default};
