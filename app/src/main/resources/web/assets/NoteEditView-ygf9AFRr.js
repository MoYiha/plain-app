import{_ as Y}from"./MonacoEditor.vuevuetypescriptsetuptruelang-DBrYkOvn.js";import{u as Z,_ as ee}from"./markdown-DlbQHIWS.js";import{b6 as te,b7 as z,b8 as ne,m as ae,c as h,o as p,a as c,e as oe,f as se,u as ie,r as y,s as le,g as ue,h as re,J as de,i as ce,b9 as me,ac as _e,I as fe,a2 as q,ad as ve,p as S,M as pe,y as U,k as L,Y as A,O as ge,j as F,t as be,l as O,aL as Te,W as ye,Q as G,N as he,w as ke,X as we,U as Le,ba as Me,D as P,bb as Ne,bc as $e,a4 as Ce,z as xe,$ as Ee,a0 as qe,bd as Se,F as Ie}from"./index-BEu6YjWH.js";var W=function(){return te.Date.now()},Ve="Expected a function",De=Math.max,Re=Math.min;function Qe(N,i,u){var m,a,o,l,s,r,f=0,$=!1,v=!1,g=!0;if(typeof N!="function")throw new TypeError(Ve);i=z(i)||0,ne(u)&&($=!!u.leading,v="maxWait"in u,o=v?De(z(u.maxWait)||0,i):o,g="trailing"in u?!!u.trailing:g);function k(n){var d=m,e=a;return m=a=void 0,f=n,l=N.apply(e,d),l}function C(n){return f=n,s=setTimeout(_,i),$?k(n):l}function I(n){var d=n-r,e=n-f,t=i-d;return v?Re(t,o-e):t}function b(n){var d=n-r,e=n-f;return r===void 0||d>=i||d<0||v&&e>=o}function _(){var n=W();if(b(n))return x(n);s=setTimeout(_,I(n))}function x(n){return s=void 0,g&&m?k(n):(m=a=void 0,l)}function V(){s!==void 0&&clearTimeout(s),f=0,m=r=a=s=void 0}function D(){return s===void 0?l:x(W())}function w(){var n=W(),d=b(n);if(m=arguments,a=this,r=n,d){if(s===void 0)return C(r);if(v)return clearTimeout(s),s=setTimeout(_,i),k(r)}return s===void 0&&(s=setTimeout(_,i)),l}return w.cancel=V,w.flush=D,w}const Ue={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function We(N,i){return p(),h("svg",Ue,i[0]||(i[0]=[c("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1)]))}const Be=ae({name:"material-symbols-arrow-back-rounded",render:We}),He={class:"top-app-bar"},ze={class:"title"},Ae={class:"state-point"},Fe={class:"actions"},Oe={class:"panel-container"},Ge=["innerHTML"],M="NOTE",Pe=oe({__name:"NoteEditView",setup(N){const i=se(),{t:u}=ie(),m=fe(),a=y(""),o=y(),l=y(""),s=y(""),r=y(!1),{app:f,urlTokenKey:$}=le(ue());function v(){const e=Ce.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),xe(i,t)}const{render:g}=Z(f,$),k=Qe(()=>{r.value=!1,x({id:a.value,input:{content:l.value,title:Se(l.value,{length:250,omission:""})}})},500),C=()=>{ke(l,async e=>{r.value=!0,s.value=await g(e),k()})},I=()=>{window.print()},b=y();re({handle:(e,t)=>{t?P(u(t),"error"):e&&(b.value=e.tags)},document:Me,variables:{type:M}});const{fetch:_}=de({handle:async(e,t)=>{t?P(u(t),"error"):(o.value=e.note,l.value=e.note.content,s.value=await g(l.value),C())},document:Ne,variables:()=>({id:a.value}),options:{fetchPolicy:"no-cache"}}),{mutate:x,onDone:V}=ce({document:$e});V(e=>{var t,T;o.value=e.data.saveNote,!a.value&&((t=o.value)!=null&&t.id)&&(a.value=(T=o.value)==null?void 0:T.id,me(i,`/notes/${a.value}`))});function D(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${u("updated_at")}: ${we(e)})`:""}function w(){var e,t;Ee(qe,{type:M,tags:b.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=b.value)==null?void 0:t.filter(T=>{var E;return(E=o.value)==null?void 0:E.tags.some(R=>R.id===T.id)})})}const n=e=>{e.type===M&&_()},d=e=>{e.type===M&&_()};return _e(()=>{a.value=m.params.id,a.value==="create"&&(a.value=""),a.value?_():C(),q.on("item_tags_updated",d),q.on("items_tags_updated",n)}),ve(()=>{q.off("item_tags_updated",d),q.off("items_tags_updated",n)}),(e,t)=>{var B,H;const T=Be,E=Le,R=ye,j=he,X=ee,J=Y,Q=pe("tooltip");return p(),h(G,null,[c("div",He,[S((p(),h("button",{class:"btn-icon",onClick:U(v,["prevent"])},[t[1]||(t[1]=c("md-ripple",null,null,-1)),L(T)])),[[Q,e.$t("back")]]),c("div",ze,[A(be(a.value?O(u)("edit"):O(u)("create"))+" ",1),S(c("span",Ae,"*",512),[[Te,r.value]]),t[2]||(t[2]=A()),(B=o.value)!=null&&B.updatedAt?(p(),ge(E,{key:0,id:D(),class:"time",raw:o.value},null,8,["id","raw"])):F("",!0)]),c("div",Fe,[L(R,{tags:(H=o.value)==null?void 0:H.tags,type:M,"only-links":!0},null,8,["tags"]),a.value?(p(),h(G,{key:0},[S((p(),h("button",{class:"btn-icon",onClick:U(w,["prevent"])},[t[3]||(t[3]=c("md-ripple",null,null,-1)),L(j)])),[[Q,e.$t("add_to_tags")]]),S((p(),h("button",{class:"btn-icon",onClick:U(I,["prevent"])},[t[4]||(t[4]=c("md-ripple",null,null,-1)),L(X)])),[[Q,e.$t("print")]])],64)):F("",!0)])]),c("div",Oe,[L(J,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=K=>l.value=K),language:"html"},null,8,["modelValue"]),c("div",{class:"md-container",innerHTML:s.value},null,8,Ge)])],64)}}}),Ke=Ie(Pe,[["__scopeId","data-v-eb5effca"]]);export{Ke as default};
