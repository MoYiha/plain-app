import{_ as Nt}from"./VPagination.vuevuetypescriptsetuptruelang-CMel8YZq.js";import{m as Ze,c as g,o as a,a as l,i as _e,b5 as zt,b6 as Ht,s as me,g as Je,u as Ye,a4 as C,aM as xe,E as ve,r as L,b7 as Qt,e as Kt,f as Gt,I as Ot,ag as Oe,ah as jt,J as Wt,K as Xt,aL as Zt,aN as Jt,ai as Yt,L as xt,aP as eo,aQ as to,M as oo,N as so,k as n,l as e,j as J,t as h,T as V,O as r,P as ao,R as d,p as c,y as i,aR as de,aS as ce,ak as no,al as lo,S as re,U as ue,V as io,aT as co,av as ro,b8 as uo,a7 as po,aW as _o,aj as mo,aX as vo,Q as go,ar as ko,b2 as yo,aH as fo,n as ho,a9 as $o,aZ as bo,Z as Co,at as To,aO as je,b9 as Io,Y as wo,$ as Eo,F as Ao,a0 as Do,d as qo,A as So,ba as We,a1 as Fo,a2 as Po,a$ as Xe,a3 as Vo,H as Lo}from"./index-CRAs9Aby.js";import{_ as Mo}from"./FieldId.vuevuetypescriptsetuptruelang-DwatImZq.js";import{_ as Ro,a as Bo}from"./SearchInput-BZAwknOd.js";import{_ as Uo,a as No}from"./upload-rounded-8g7nrfaj.js";import{_ as zo}from"./MediaKeyboardShortcuts.vuevuetypescriptsetuptruelang-C9TuQ7S2.js";import{_ as Ho}from"./VCheckbox-CIULXI0B.js";import{u as Qo}from"./search-BzSrYmzJ.js";import{u as Ko,a as Go}from"./key-events-CqsPa-7g.js";import{a as Oo}from"./tags-D2ApdQ5I.js";import"./VInputChip-D4Mcll6i.js";const jo={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Wo(w,f){return a(),g("svg",jo,f[0]||(f[0]=[l("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V9q0-.425-.288-.712T10 8t-.712.288T9 9v6q0 .425.288.713T10 16m4 0q.425 0 .713-.288T15 15V9q0-.425-.288-.712T14 8t-.712.288T13 9v6q0 .425.288.713T14 16m-2 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const Xo=Ze({name:"material-symbols-pause-circle-outline-rounded",render:Wo}),Zo={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Jo(w,f){return a(),g("svg",Zo,f[0]||(f[0]=[l("path",{fill:"currentColor",d:"M3 16v-2h7v2zm0-4v-2h11v2zm0-4V6h11v2zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4z"},null,-1)]))}const Yo=Ze({name:"material-symbols-playlist-add",render:Jo});function pe(w,f,E=500){const v=w.cloneNode(!0),$=w.getBoundingClientRect(),M=f.getBoundingClientRect();v.style.position="absolute",v.style.top=$.top+"px",v.style.left=$.left+"px",v.style.opacity=1,document.body.appendChild(v);let b=0;function A(B){b||(b=B);const U=B-b,F=Math.min(U/E,1);v.style.top=$.top+(M.top-$.top)*F+"px",v.style.left=$.left+(M.left-$.left)*F+"px",F<1?requestAnimationFrame(A):document.body.removeChild(v)}requestAnimationFrame(A)}const xo=(w,f)=>{const{mutate:E,loading:v,onDone:$}=_e({document:zt}),{mutate:M,loading:b,onDone:A}=_e({document:Ht}),{app:B}=me(Je()),{t:U}=Ye();$(()=>{C.emit("refetch_app"),f()}),A(()=>{C.emit("refetch_app")});const F=xe(()=>{var k;return((k=B.value)==null?void 0:k.audios)??[]}),W=k=>F.value.some(y=>y.path===k.path);return{loading:v,removeLoading:b,isInPlaylist:W,addItemsToPlaylist:(k,y,P,N)=>{let z=N;if(!P){if(y.length===0){ve(U("select_first"),"error");return}z=`ids:${y.join(",")}`}const H=k.target,R=document.getElementById("quick-audio");pe(H,R),E({query:z})},removeItemsFromPlaylist:(k,y,P,N)=>{if(P)w.value.filter(R=>W(R)).forEach(R=>{M({path:R.path})});else{if(y.length===0){ve(U("select_first"),"error");return}w.value.filter(Q=>y.includes(Q.id)&&W(Q)).forEach(Q=>{M({path:Q.path})})}const z=k.target,H=document.getElementById("quick-audio");pe(z,H)},addToPlaylist:(k,y)=>{const P=k.target,N=document.getElementById("quick-audio");pe(P,N),E({query:`ids:${y.id}`})},removeFromPlaylist:(k,y)=>{M({path:y.path})}}},es=()=>{const w=L(""),{mutate:f,loading:E,onDone:v}=_e({document:Qt});return v(()=>{C.emit("play_audio")}),{loading:E,playPath:w,play:$=>{w.value=$.path,f({path:$.path})},pause:()=>{C.emit("pause_audio")}}},ts={class:"top-app-bar"},os={class:"title"},ss={key:0},as={key:1},ns={class:"actions"},ls=["onClick"],is=["onClick","onMouseover"],ds={class:"start"},cs={class:"number"},rs={class:"image"},us=["src"],ps=["src","onError"],_s={class:"title"},ms={class:"subtitle"},vs={class:"duration"},gs=["onClick"],ks={class:"actions"},ys={class:"artist"},fs={class:"time"},hs={class:"start"},$s={class:"number"},bs={key:0,class:"no-data-placeholder"},j=50,Cs=Kt({__name:"AudiosView",setup(w){var Be;const f=Gt(),{audioSortBy:E}=me(f),v=L([]),{t:$}=Ye(),{parseQ:M}=Qo(),b=Ot({tagIds:[],bucketId:void 0}),{app:A,urlTokenKey:B,audioPlaying:U,uploads:F}=me(Je()),W=t=>{var s;return U.value&&((s=A.value)==null?void 0:s.audioCurrent)===t.path},k=L([]),y=L(!1),P=L(!1),{input:N,upload:z,uploadChanged:H}=Oe(F),{input:R,upload:Q,uploadChanged:ge}=Oe(F),{dropping:et,fileDragEnter:ke,fileDragLeave:ye,dropFiles:tt}=jt(F),te=L(!1),m=Wt.AUDIO,fe=Xt(),he=fe.query,oe=L(parseInt(((Be=he.page)==null?void 0:Be.toString())??"1")),{tags:Y,buckets:x,fetch:ot}=Zt(m),st=xe(()=>{const t={};return x.value.forEach(s=>{t[s.id]=s}),t}),D=L(""),{addToTags:at}=Oo(m,Y),{deleteItems:se,deleteItem:$e}=Jt(),{view:nt}=bo(m),{selectedIds:T,allChecked:be,realAllChecked:q,selectRealAll:lt,allCheckedAlertVisible:it,clearSelection:K,toggleAllChecked:dt,toggleSelect:Ce,total:S,checked:ae,shiftEffectingIds:Te,handleItemClick:ct,handleMouseOver:rt,selectAll:ut,shouldSelect:pt}=Ko(v),{downloadItems:Ie}=Yt(B,m,K,()=>ro("audios")),{downloadFile:we}=To(B),Ee=t=>{const s=fe.query.q;So(f,s?`/audios?page=${t}&q=${s}`:`/audios?page=${t}`)},{keyDown:Ae,keyUp:De}=Go(S,j,oe,ut,K,Ee,()=>{de(ce.MEDIA_TRASH,A.value.osVersion)?le(m,Z()):se(m,T.value,q.value,S.value,D.value)}),{addItemsToPlaylist:_t,addToPlaylist:mt,removeFromPlaylist:vt,isInPlaylist:gt}=xo(v,K),kt=ko(),qe=L([]),{play:yt,playPath:ft,loading:ht,pause:$t}=es(),bt=t=>{qe.value.push(t)},{loading:ne,fetch:X}=xt({handle:(t,s)=>{te.value=!1,s?ve($(s),"error"):t&&(v.value=t.items,S.value=t.total)},document:uo,variables:()=>({offset:(oe.value-1)*j,limit:j,query:D.value,sortBy:E.value})}),{trashLoading:Se,trash:le}=eo(),{restoreLoading:Fe,restore:Pe}=to();function Ct(t){return t?`/audios?q=${t}`:"/audios"}function Tt(t){E.value!==t&&(te.value=!0,E.value=t)}function ie(){const t=x.value.find(s=>s.id===b.bucketId);return t?Xe(t.topItems[0]):`${A.value.internalStoragePath}/Music`}function It(){z(ie())}function wt(){Q(ie())}function Et(t){tt(t,ie(),s=>We(s.name))}const Z=()=>{let t=D.value;return q.value||(t=`ids:${T.value.join(",")}`),t},Ve=t=>{t.type===m&&(K(),X())},Le=t=>{t.type===m&&X()},Me=t=>{t.type===m&&(K(),X())},Re=t=>{t.status==="done"&&We(t.fileName)&&((!b.bucketId||x.value.some(I=>I.id===b.bucketId&&I.topItems.some(G=>t.dir.startsWith(Xe(G)))))&&setTimeout(()=>{X()},1e3),C.emit("media_items_actioned",{type:m,action:"upload",query:""}))};function At(t){const s=t.tags.map(I=>I.id);Fo(Po,{type:m,tags:Y.value,item:{key:t.id,title:t.title,size:t.size},selected:Y.value.filter(I=>s.includes(I.id))})}function Dt(t,s){k.value.push(s.id),setTimeout(()=>{vt(t,s),setTimeout(()=>{k.value=k.value.filter(I=>I!==s.id)},300)},150)}return oo(()=>{var t;D.value=Vo(((t=he.q)==null?void 0:t.toString())??""),M(b,D.value),ot(),X(),C.on("item_tags_updated",Le),C.on("items_tags_updated",Ve),C.on("media_items_actioned",Me),C.on("upload_task_done",Re),window.addEventListener("keydown",Ae),window.addEventListener("keyup",De)}),so(()=>{C.off("item_tags_updated",Le),C.off("items_tags_updated",Ve),C.off("media_items_actioned",Me),C.off("upload_task_done",Re),window.removeEventListener("keydown",Ae),window.removeEventListener("keyup",De)}),(t,s)=>{const I=Ho,G=po,u=co,Ue=_o,ee=mo,Ne=vo,ze=Yo,He=go,qt=Ro,St=zo,Ft=Uo,Qe=no,Pt=No,Vt=Bo,Lt=Mo,Mt=Co,Ke=Io,Rt=wo,Bt=Xo,Ut=Nt,p=ao("tooltip");return a(),g(V,null,[l("div",ts,[n(I,{"touch-target":"wrapper",checked:e(be),indeterminate:!e(be)&&e(ae),onChange:e(dt)},null,8,["checked","indeterminate","onChange"]),l("div",os,[e(T).length?(a(),g("span",ss,h(t.$t("x_selected",{count:e(q)?e(S).toLocaleString():e(T).length.toLocaleString()})),1)):(a(),g("span",as,h(t.$t("page_title.audios"))+" ("+h(e(S).toLocaleString())+")",1)),e(ae)?(a(),g(V,{key:2},[b.trash?(a(),g(V,{key:0},[r((a(),d(u,{onClick:s[0]||(s[0]=i(o=>e(se)(e(m),e(T),e(q),e(S),D.value),["stop"]))},{icon:c(()=>[n(G)]),_:1})),[[p,t.$t("delete")]]),r((a(),d(u,{loading:e(Fe)(Z()),onClick:s[1]||(s[1]=i(o=>e(Pe)(e(m),Z()),["stop"]))},{icon:c(()=>[n(Ue)]),_:1},8,["loading"])),[[p,t.$t("restore")]]),r((a(),d(u,{onClick:s[2]||(s[2]=i(o=>e(Ie)(e(q),e(T),D.value),["stop"]))},{icon:c(()=>[n(ee)]),_:1})),[[p,t.$t("download")]])],64)):(a(),g(V,{key:1},[e(de)(e(ce).MEDIA_TRASH,e(A).osVersion)?r((a(),d(u,{key:0,loading:e(Se)(Z()),onClick:s[3]||(s[3]=i(o=>e(le)(e(m),Z()),["stop"]))},{icon:c(()=>[n(Ne)]),_:1},8,["loading"])),[[p,t.$t("move_to_trash")]]):r((a(),d(u,{key:1,onClick:s[4]||(s[4]=i(o=>e(se)(e(m),e(T),e(q),e(S),D.value),["stop"]))},{icon:c(()=>[n(G)]),_:1})),[[p,t.$t("delete")]]),r((a(),d(u,{onClick:s[5]||(s[5]=i(o=>e(Ie)(e(q),e(T),D.value),["stop"]))},{icon:c(()=>[n(ee)]),_:1})),[[p,t.$t("download")]]),r((a(),d(u,{onClick:s[6]||(s[6]=i(o=>e(_t)(o,e(T),e(q),D.value),["stop"]))},{icon:c(()=>[n(ze)]),_:1})),[[p,t.$t("add_to_playlist")]]),r((a(),d(u,{onClick:s[7]||(s[7]=i(o=>e(at)(e(T),e(q),D.value),["stop"]))},{icon:c(()=>[n(He)]),_:1})),[[p,t.$t("add_to_tags")]])],64))],64)):J("",!0)]),l("div",ns,[n(qt,{filter:b,tags:e(Y),buckets:e(x),"get-url":Ct},null,8,["filter","tags","buckets"]),n(St),n(Qe,{modelValue:y.value,"onUpdate:modelValue":s[10]||(s[10]=o=>y.value=o)},{trigger:c(()=>[r((a(),d(u,null,{icon:c(()=>[n(Ft)]),_:1})),[[p,t.$t("upload")]])]),default:c(()=>[l("div",{class:"dropdown-item",onClick:s[8]||(s[8]=i(o=>{It(),y.value=!1},["stop"]))},h(t.$t("upload_files")),1),l("div",{class:"dropdown-item",onClick:s[9]||(s[9]=i(o=>{wt(),y.value=!1},["stop"]))},h(t.$t("upload_folder")),1)]),_:1},8,["modelValue"]),n(Qe,{modelValue:P.value,"onUpdate:modelValue":s[11]||(s[11]=o=>P.value=o)},{trigger:c(()=>[r((a(),d(u,{loading:te.value},{icon:c(()=>[n(Pt)]),_:1},8,["loading"])),[[p,t.$t("sort")]])]),default:c(()=>[(a(!0),g(V,null,ue(e(kt),o=>(a(),g("div",{key:o.value,class:re(["dropdown-item",{selected:o.value===e(E)}]),onClick:O=>{Tt(o.value),P.value=!1}},h(t.$t(o.label)),11,ls))),128))]),_:1},8,["modelValue"])])]),n(Vt,{limit:j,total:e(S),"all-checked-alert-visible":e(it),"real-all-checked":e(q),"select-real-all":e(lt),"clear-selection":e(K)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),l("div",{class:"scroll-content",onDragover:s[16]||(s[16]=i((...o)=>e(ke)&&e(ke)(...o),["stop","prevent"]))},[r(l("div",{class:"drag-mask",onDrop:i(Et,["stop","prevent"]),onDragleave:s[12]||(s[12]=i((...o)=>e(ye)&&e(ye)(...o),["stop","prevent"]))},h(t.$t("release_to_send_files")),545),[[lo,e(et)]]),l("div",{class:re(["audio-list",{"select-mode":e(ae)}])},[(a(!0),g(V,null,ue(v.value,(o,O)=>{var Ge;return a(),g("section",{key:o.id,class:re(["media-item selectable-card",{selected:e(T).includes(o.id),selecting:e(Te).includes(o.id)}]),onClick:i(_=>e(ct)(_,o,O,()=>{e(yt)(o)}),["stop"]),onMouseover:_=>e(rt)(_,O)},[l("div",ds,[e(Te).includes(o.id)?(a(),d(I,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(pt),onClick:i(_=>e(Ce)(_,o,O),["stop"])},null,8,["checked","onClick"])):(a(),d(I,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(T).includes(o.id),onClick:i(_=>e(Ce)(_,o,O),["stop"])},null,8,["checked","onClick"])),l("span",cs,[n(Lt,{id:O+1,raw:o},null,8,["id","raw"])])]),l("div",rs,[qe.value.includes(o.id)?(a(),g("img",{key:0,src:`/ficons/${e(yo)(o.path)}.svg`,class:"svg"},null,8,us)):(a(),g("img",{key:1,class:"image-thumb",src:e(fo)(o.albumFileId,"&w=200&h=200"),onError:_=>bt(o.id)},null,40,ps))]),l("div",_s,h(o.title),1),l("div",ms,[l("span",null,h(e(ho)(o.size)),1),l("span",vs,h(e($o)(o.duration)),1),l("a",{onClick:i(_=>e(nt)(e(f),o.bucketId),["stop","prevent"])},h((Ge=st.value[o.bucketId])==null?void 0:Ge.name),9,gs),n(Mt,{tags:o.tags,type:e(m),"only-links":!0},null,8,["tags","type"])]),l("div",ks,[b.trash?(a(),g(V,{key:0},[r((a(),d(u,{class:"sm",onClick:i(_=>e($e)(e(m),o),["stop"])},{icon:c(()=>[n(G)]),_:2},1032,["onClick"])),[[p,t.$t("delete")]]),r((a(),d(u,{class:"sm",loading:e(Fe)(`ids:${o.id}`),onClick:i(_=>e(Pe)(e(m),`ids:${o.id}`),["stop"])},{icon:c(()=>[n(Ue)]),_:2},1032,["loading","onClick"])),[[p,t.$t("restore")]]),r((a(),d(u,{class:"sm",onClick:i(_=>e(we)(o.path,e(je)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[n(ee)]),_:2},1032,["onClick"])),[[p,t.$t("download")]])],64)):(a(),g(V,{key:1},[e(de)(e(ce).MEDIA_TRASH,e(A).osVersion)?r((a(),d(u,{key:0,class:"sm",loading:e(Se)(`ids:${o.id}`),onClick:i(_=>e(le)(e(m),`ids:${o.id}`),["stop"])},{icon:c(()=>[n(Ne)]),_:2},1032,["loading","onClick"])),[[p,t.$t("move_to_trash")]]):r((a(),d(u,{key:1,class:"sm",onClick:i(_=>e($e)(e(m),o),["stop"])},{icon:c(()=>[n(G)]),_:2},1032,["onClick"])),[[p,t.$t("delete")]]),r((a(),d(u,{class:"sm",onClick:i(_=>e(we)(o.path,e(je)(o.path).replace(" ","-")),["stop"])},{icon:c(()=>[n(ee)]),_:2},1032,["onClick"])),[[p,t.$t("download")]]),e(gt)(o)&&!k.value.includes(o.id)?r((a(),d(u,{key:2,class:"sm",onClick:i(_=>Dt(_,o),["stop","prevent"])},{icon:c(()=>[n(Ke,{class:"playlist-remove-icon"})]),_:2},1032,["onClick"])),[[p,t.$t("remove_from_playlist")]]):k.value.includes(o.id)?(a(),d(u,{key:3,class:"sm",disabled:!0},{icon:c(()=>[n(Ke,{class:"playlist-remove-icon rotating"})]),_:1})):r((a(),d(u,{key:4,class:"sm",onClick:i(_=>e(mt)(_,o),["stop","prevent"])},{icon:c(()=>[n(ze)]),_:2},1032,["onClick"])),[[p,t.$t("add_to_playlist")]]),r((a(),d(u,{class:"sm",onClick:i(_=>At(o),["stop"])},{icon:c(()=>[n(He)]),_:2},1032,["onClick"])),[[p,t.$t("add_to_tags")]])],64)),e(ht)&&o.path===e(ft)?(a(),d(Rt,{key:2,indeterminate:"",class:"sm"})):W(o)?r((a(),d(u,{key:3,class:"sm",onClick:s[13]||(s[13]=i(_=>e($t)(),["stop"]))},{icon:c(()=>[n(Bt)]),_:1})),[[p,t.$t("pause")]]):J("",!0)]),l("div",ys,h(o.artist),1),l("div",fs,[r((a(),g("span",null,[Ao(h(e(Do)(o.createdAt)),1)])),[[p,e(Eo)(o.createdAt)]])])],42,is)}),128)),e(ne)&&v.value.length===0?(a(),g(V,{key:0},ue(20,o=>l("section",{key:o,class:"media-item selectable-card-skeleton"},[l("div",hs,[s[17]||(s[17]=l("div",{class:"checkbox"},[l("div",{class:"skeleton-checkbox"})],-1)),l("span",$s,h(o),1)]),s[18]||(s[18]=qo('<div class="image" data-v-ccdb0179><div class="skeleton-image" data-v-ccdb0179></div></div><div class="title" data-v-ccdb0179><div class="skeleton-text skeleton-title" data-v-ccdb0179></div></div><div class="subtitle" data-v-ccdb0179><div class="skeleton-text skeleton-subtitle" data-v-ccdb0179></div></div><div class="actions" data-v-ccdb0179><div class="skeleton-text skeleton-actions" data-v-ccdb0179></div></div><div class="artist" data-v-ccdb0179><div class="skeleton-text skeleton-artist" data-v-ccdb0179></div></div><div class="time" data-v-ccdb0179><div class="skeleton-text skeleton-time" data-v-ccdb0179></div></div>',6))])),64)):J("",!0)],2),!e(ne)&&v.value.length===0?(a(),g("div",bs,h(t.$t(e(io)(e(ne),e(A).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):J("",!0),e(S)>j?(a(),d(Ut,{key:1,page:oe.value,go:Ee,total:e(S),limit:j},null,8,["page","total"])):J("",!0),l("input",{ref_key:"fileInput",ref:N,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",onChange:s[14]||(s[14]=(...o)=>e(H)&&e(H)(...o))},null,544),l("input",{ref_key:"dirFileInput",ref:R,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:s[15]||(s[15]=(...o)=>e(ge)&&e(ge)(...o))},null,544)],32)],64)}}}),Ls=Lo(Cs,[["__scopeId","data-v-ccdb0179"]]);export{Ls as default};
