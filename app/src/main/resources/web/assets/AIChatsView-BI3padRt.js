import{_ as ve}from"./VPagination.vuevuetypescriptsetuptruelang-C9URNuao.js";import{d as fe,h as I,g as ke,I as ye,u as be,i as $e,s as Ce,J as we,K as Ae,L as Te,M as qe,c as l,a,t as c,m as t,p as i,O as D,x as g,w as u,e as f,P as Ie,v as De,Q as Se,f as Le,C as Me,bg as Ve,S as Ee,o as n,N as Ne,a$ as Ue,am as O,V as X,U as Y,X as Be,bb as Ke,$ as Qe,a0 as k,bh as Z,Y as j,ab as Pe,ac as Re,Z as ze,ad as He,a1 as Fe,a2 as Ge,a3 as Je}from"./index-BxNI00MG.js";import{c as Oe,u as Xe,_ as Ye,a as Ze,b as je}from"./key-events-B5RXeznw.js";import{u as We,a as xe}from"./tags-BUfgTqH4.js";import{u as et}from"./search-D1_YTViL.js";import"./rss-feed-rounded-Dj4EQ17i.js";import"./vee-validate.esm-9czZ1sUw.js";const tt={class:"top-app-bar"},at={class:"title"},st={class:"actions"},ot=a("md-ripple",null,null,-1),nt=a("md-ripple",null,null,-1),lt={class:"table-responsive"},ct={class:"table"},it=["checked","indeterminate"],dt={key:0},rt=a("th",null,null,-1),ut=["onClick"],_t=["onChange","checked"],pt={key:0},ht=["onClick"],gt={class:"nowrap"},mt={class:"action-btns"},vt=["onClick"],ft=a("md-ripple",null,null,-1),kt=["onClick"],yt=a("md-ripple",null,null,-1),bt={class:"nowrap"},$t={class:"nowrap"},Ct={key:0},wt=["colspan"],At={class:"no-data-placeholder"},m=50,Et=fe({__name:"AIChatsView",setup(Tt){var H;const y=I([]),{t:W}=ke(),{parseQ:x}=et(),S=ye({tagIds:[]}),ee=be(),te=$e(),{app:w}=Ce(te),d=we.AI_CHAT,L=Se(),M=L.query,A=I(parseInt(((H=M.page)==null?void 0:H.toString())??"1")),_=I(""),{tags:b,fetch:ae}=We(d),{addToTags:se}=xe(d,b),{deleteItems:V}=Oe(Ke,()=>{C()}),{selectedIds:v,allChecked:E,realAllChecked:$,selectRealAll:oe,allCheckedAlertVisible:ne,clearSelection:T,toggleAllChecked:N,toggleRow:U,total:r,checked:B,selectAll:le}=Xe(y),K=e=>{const o=L.query.q;Le(ee,o?`/aichats?page=${e}&q=${o}`:`/aichats?page=${e}`)},{keyDown:Q,keyUp:P}=je(r,m,A,le,T,K,()=>{V($.value,v.value,_.value)}),{loading:ce,fetch:C}=Ae({handle:(e,o)=>{o?Me(W(o),"error"):e&&(y.value=e.aiChats,r.value=e.aiChatCount)},document:Ve,variables:()=>({offset:(A.value-1)*m,limit:m,query:_.value}),appApi:!0});function ie(e){return e?`/aichats?q=${e}`:"/aichats"}const R=e=>{e.type===d&&(T(),C())},z=e=>{e.type===d&&C()};Te(()=>{var e;_.value=Qe(((e=M.q)==null?void 0:e.toString())??""),x(S,_.value),ae(),C(),k.on("item_tags_updated",z),k.on("items_tags_updated",R),window.addEventListener("keydown",Q),window.addEventListener("keyup",P)}),qe(()=>{k.off("item_tags_updated",z),k.off("items_tags_updated",R),window.removeEventListener("keydown",Q),window.removeEventListener("keyup",P)});function de(e){Z(`/aichats/${e.id}`)}function re(){Z("/aichats/create")}function ue(e){j(Re,{id:e.id,name:e.id,gql:Pe`
      mutation DeleteAIChat($query: String!) {
        deleteAIChats(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),appApi:!0,typeName:"AIChat",done:()=>{r.value--,e.tags.length&&k.emit("refetch_tags",d)}})}function _e(e){j(ze,{type:d,tags:b.value,item:{key:e.id,title:"",size:0},selected:b.value.filter(o=>e.tags.some(q=>q.id===o.id))})}return(e,o)=>{const q=Ye,F=He,G=Fe,pe=Ze,he=Ge,ge=Je,me=ve,p=Ee("tooltip");return n(),l(D,null,[a("div",tt,[a("div",at,c(e.$t("page_title.aichats"))+" ("+c(t(r).toLocaleString())+")",1),a("div",st,[i(q,{filter:S,tags:t(b),"get-url":ie},null,8,["filter","tags"]),t(B)?(n(),l(D,{key:0},[g((n(),l("button",{class:"btn-icon",onClick:o[0]||(o[0]=u(s=>t(V)(t($),t(v),_.value),["stop"]))},[ot,i(F)])),[[p,e.$t("delete")]]),g((n(),l("button",{class:"btn-icon",onClick:o[1]||(o[1]=u(s=>t(se)(t(v),t($),_.value),["stop"]))},[nt,i(G)])),[[p,e.$t("add_to_tags")]])],64)):f("",!0),a("md-outlined-button",{class:"btn-sm",onClick:u(re,["prevent"])},c(e.$t("new_chat")),1)])]),i(pe,{limit:m,total:t(r),"all-checked-alert-visible":t(ne),"real-all-checked":t($),"select-real-all":t(oe),"clear-selection":t(T)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",lt,[a("table",ct,[a("thead",null,[a("tr",null,[a("th",null,[a("md-checkbox",{"touch-target":"wrapper",onChange:o[2]||(o[2]=(...s)=>t(N)&&t(N)(...s)),checked:t(E),indeterminate:!t(E)&&t(B)},null,40,it)]),t(w).developerMode?(n(),l("th",dt,"ID")):f("",!0),a("th",null,c(e.$t("content")),1),rt,a("th",null,c(e.$t("tags")),1),a("th",null,c(e.$t("updated_at")),1),a("th",null,c(e.$t("created_at")),1)])]),a("tbody",null,[(n(!0),l(D,null,Ie(y.value,(s,J)=>(n(),l("tr",{key:s.id,class:Ne({selected:t(v).includes(s.id)}),onClick:u(h=>t(U)(h,s,J),["stop"])},[a("td",null,[a("md-checkbox",{"touch-target":"wrapper",onChange:h=>t(U)(h,s,J),checked:t(v).includes(s.id)},null,40,_t)]),t(w).developerMode?(n(),l("td",pt,[i(he,{id:s.id,raw:s},null,8,["id","raw"])])):f("",!0),a("td",null,[a("a",{href:"#",onClick:u(h=>de(s),["prevent"])},c(t(Ue)(s.content,{length:200,omission:""})),9,ht)]),a("td",gt,[a("div",mt,[g((n(),l("button",{class:"btn-icon sm",onClick:u(h=>ue(s),["stop"])},[ft,i(F)],8,vt)),[[p,e.$t("delete")]]),g((n(),l("button",{class:"btn-icon sm",onClick:u(h=>_e(s),["stop"])},[yt,i(G)],8,kt)),[[p,e.$t("add_to_tags")]])])]),a("td",null,[i(ge,{tags:s.tags,type:t(d)},null,8,["tags","type"])]),a("td",bt,[g((n(),l("time",null,[X(c(t(Y)(s.updatedAt)),1)])),[[p,t(O)(s.updatedAt)]])]),a("td",$t,[g((n(),l("time",null,[X(c(t(Y)(s.updatedAt)),1)])),[[p,t(O)(s.createdAt)]])])],10,ut))),128))]),y.value.length?f("",!0):(n(),l("tfoot",Ct,[a("tr",null,[a("td",{colspan:t(w).developerMode?7:6},[a("div",At,c(e.$t(t(Be)(t(ce)))),1)],8,wt)])]))])]),t(r)>m?(n(),De(me,{key:0,page:A.value,go:K,total:t(r),limit:m},null,8,["page","total"])):f("",!0)],64)}}});export{Et as default};
