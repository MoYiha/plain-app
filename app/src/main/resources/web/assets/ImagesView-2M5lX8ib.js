import{_ as Ze}from"./VPagination.vuevuetypescriptsetuptruelang-C9URNuao.js";import{d as je,u as xe,s as ke,h as V,g as es,I as ss,i as ts,J as os,aC as ve,aD as ns,ag as ls,K as be,L as as,M as cs,c as l,a as n,m as e,t as g,O as C,x as p,w as c,p as i,e as O,q as ye,v as w,N as B,P,aE as is,Q as ds,aF as _s,f as us,C as fe,aG as rs,aH as ps,aI as ms,al as hs,S as gs,o,ay as J,aJ as q,E as Ce,U as ks,V as vs,W as bs,X as ys,ao as fs,an as Cs,Y as ws,Z as $s,av as Is,aK as Ts,$ as Ss,a0 as y,ad as As,ap as Ds,a1 as Es,aL as Ls,a3 as Vs,a2 as Ms}from"./index-BxNI00MG.js";import{_ as zs,a as Bs,b as qs,c as Fs}from"./grid-view-outline-rounded-C_6zsYJR.js";import{u as Ks,_ as Ns,a as Rs,b as Us}from"./key-events-B5RXeznw.js";import{_ as Gs}from"./sort-rounded-BbQ1dmh_.js";import{_ as Hs}from"./upload-rounded-DLL-9Gf2.js";import{u as Qs}from"./search-D1_YTViL.js";import{a as Os}from"./tags-BUfgTqH4.js";import"./rss-feed-rounded-Dj4EQ17i.js";import"./vee-validate.esm-9czZ1sUw.js";const Ps={class:"top-app-bar"},Js=["checked","indeterminate"],Ws={class:"title"},Xs={key:0},Ys={key:1},Zs=n("md-ripple",null,null,-1),js=n("md-ripple",null,null,-1),xs=n("md-ripple",null,null,-1),et={class:"actions"},st=n("md-ripple",null,null,-1),tt={class:"btn-icon btn-sort"},ot=n("md-ripple",null,null,-1),nt={class:"menu-items"},lt=["onClick","selected"],at={slot:"headline"},ct=n("md-ripple",null,null,-1),it={class:"scroll-content"},dt=["onClick","onMouseover"],_t=["src"],ut=["onClick"],rt=n("md-ripple",null,null,-1),pt=["onClick"],mt=n("md-ripple",null,null,-1),ht={class:"actions"},gt=["onClick"],kt=n("md-ripple",null,null,-1),vt=["onClick"],bt=n("md-ripple",null,null,-1),yt=["onClick"],ft=n("md-ripple",null,null,-1),Ct=["onClick"],wt=n("md-ripple",null,null,-1),$t=["onClick"],It=n("md-ripple",null,null,-1),Tt={class:"info"},St={class:"right"},At=["onClick","onMouseover"],Dt={class:"start"},Et=["onClick","checked"],Lt=["onClick","checked"],Vt={class:"number"},Mt=["src"],zt={class:"title"},Bt={class:"subtitle"},qt=["onClick"],Ft={class:"actions"},Kt=["onClick"],Nt=n("md-ripple",null,null,-1),Rt=["onClick"],Ut=n("md-ripple",null,null,-1),Gt=["onClick"],Ht=n("md-ripple",null,null,-1),Qt={class:"time"},Ot={key:2,class:"no-data-placeholder"},S=55,oo=je({__name:"ImagesView",setup(Pt){var me;const we=is(),k=xe(),{imageSortBy:F}=ke(k),$=V([]),{t:K}=es(),{parseQ:$e}=Qs(),W=ss({tagIds:[]}),X=ts(),{app:Ie,urlTokenKey:N}=ke(X),u=os.IMAGE,Y=ds(),Z=Y.query,R=V(parseInt(((me=Z.page)==null?void 0:me.toString())??"1")),A=V([]),U=V([]),Te=ve(()=>{const s={};return U.value.forEach(a=>{s[a.id]=a}),s}),f=V(""),{addToTags:Se}=Os(u,A),{deleteItems:j,deleteItem:x}=ns(),{view:Ae}=_s(u),{selectedIds:m,allChecked:ee,realAllChecked:I,selectRealAll:De,allCheckedAlertVisible:Ee,clearSelection:D,toggleAllChecked:se,toggleSelect:E,total:v,checked:L,shiftEffectingIds:M,handleItemClick:te,handleMouseOver:oe,selectAll:Le,shouldSelect:ne}=Ks($),{downloadItems:Ve}=ls(N,u,D,"images.zip"),{downloadFile:le}=fs(N),ae=s=>{const a=Y.query.q;us(k,a?`/images?page=${s}&q=${a}`:`/images?page=${s}`)},{keyDown:ce,keyUp:ie}=Us(v,S,R,Le,D,ae,()=>{j(u,m.value,I.value,f.value)}),Me=Cs(),ze=ve(()=>$.value.map(s=>({src:J(s.fileId),name:q(s.path),duration:0,size:s.size,path:s.path,type:u,data:s})));function G(s){X.lightbox={sources:ze.value,index:s,visible:!0}}const{fetch:Be}=be({handle:async(s,a)=>{a?fe(K(a),"error"):s&&(A.value=s.tags,U.value=s.mediaBuckets)},document:rs,variables:{type:u},appApi:!0});function de(s){ws($s,{type:u,tags:A.value,item:{key:s.id,title:s.title,size:s.size},selected:A.value.filter(a=>s.tags.some(b=>b.id===a.id))})}function qe(s,a){F.value=a,s.close()}const{loading:Fe,fetch:z}=be({handle:async(s,a)=>{if(a)fe(K(a),"error");else if(s){const b=[];for(const T of s.images)b.push({...T,fileId:ps(N.value,T.path)});$.value=b,v.value=s.imageCount}},document:ms,variables:()=>({offset:(R.value-1)*S,limit:S,query:f.value,sortBy:F.value}),appApi:!0});function Ke(s){return s?`/images?q=${s}`:"/images"}function Ne(){k.imagesCardView=!k.imagesCardView}function Re(){we.push("/files"),Is(Ts,{message:K("upload_images")})}const _e=s=>{s.type===u&&(D(),z())},ue=s=>{s.type===u&&z()},re=s=>{s.type===u&&(D(),z())},pe=()=>{v.value--};return as(()=>{var s;f.value=Ss(((s=Z.q)==null?void 0:s.toString())??""),$e(W,f.value),Be(),z(),y.on("item_tags_updated",ue),y.on("items_tags_updated",_e),y.on("media_item_deleted",pe),y.on("media_items_deleted",re),window.addEventListener("keydown",ce),window.addEventListener("keyup",ie)}),cs(()=>{y.off("item_tags_updated",ue),y.off("items_tags_updated",_e),y.off("media_item_deleted",pe),y.off("media_items_deleted",re),window.removeEventListener("keydown",ce),window.removeEventListener("keyup",ie)}),(s,a)=>{const b=As,T=Ds,H=Es,Ue=Ns,Ge=Hs,He=Gs,Qe=hs,Oe=Bs,Pe=qs,Je=Rs,Q=zs,he=Fs,We=Ls,ge=Vs,Xe=Ms,Ye=Ze,r=gs("tooltip");return o(),l(C,null,[n("div",Ps,[n("md-checkbox",{"touch-target":"wrapper",onChange:a[0]||(a[0]=(...t)=>e(se)&&e(se)(...t)),checked:e(ee),indeterminate:!e(ee)&&e(L)},null,40,Js),n("div",Ws,[e(m).length?(o(),l("span",Xs,g(s.$t("x_selected",{count:e(I)?e(v).toLocaleString():e(m).length.toLocaleString()})),1)):(o(),l("span",Ys,g(s.$t("page_title.images"))+" ("+g(e(v).toLocaleString())+")",1)),e(L)?(o(),l(C,{key:2},[p((o(),l("button",{class:"btn-icon",onClick:a[1]||(a[1]=c(t=>e(j)(e(u),e(m),e(I),f.value),["stop"]))},[Zs,i(b)])),[[r,s.$t("delete")]]),p((o(),l("button",{class:"btn-icon",onClick:a[2]||(a[2]=c(t=>e(Ve)(e(I),e(m),f.value),["stop"]))},[js,i(T)])),[[r,s.$t("download")]]),p((o(),l("button",{class:"btn-icon",onClick:a[3]||(a[3]=c(t=>e(Se)(e(m),e(I),f.value),["stop"]))},[xs,i(H)])),[[r,s.$t("add_to_tags")]])],64)):O("",!0)]),n("div",et,[i(Ue,{filter:W,tags:A.value,buckets:U.value,"get-url":Ke},null,8,["filter","tags","buckets"]),p((o(),l("button",{class:"btn-icon",onClick:c(Re,["prevent"])},[st,i(Ge)])),[[r,s.$t("upload")]]),i(Qe,null,{content:ye(t=>[n("div",nt,[(o(!0),l(C,null,P(e(Me),d=>(o(),l("md-menu-item",{onClick:_=>qe(t,d.value),key:d.value,selected:d.value===e(F)},[n("div",at,g(s.$t(d.label)),1)],8,lt))),128))])]),default:ye(()=>[p((o(),l("button",tt,[ot,i(He)])),[[r,s.$t("sort")]])]),_:1}),p((o(),l("button",{class:"btn-icon",onClick:c(Ne,["stop"])},[ct,e(k).imagesCardView?(o(),w(Oe,{key:0})):(o(),w(Pe,{key:1}))])),[[r,s.$t(e(k).imagesCardView?"grid_view":"card_view")]])])]),i(Je,{limit:S,total:e(v),"all-checked-alert-visible":e(Ee),"real-all-checked":e(I),"select-real-all":e(De),"clear-selection":e(D)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),n("div",it,[e(k).imagesCardView?(o(),l("div",{key:1,class:B(["media-list",{"select-mode":e(L)}])},[(o(!0),l(C,null,P($.value,(t,d)=>{var _;return o(),l("section",{class:B(["media-item selectable-card",{selected:e(m).includes(t.id),selecting:e(M).includes(t.id)}]),key:t.id,onClick:c(h=>e(te)(h,t,d,G),["stop"]),onMouseover:h=>e(oe)(h,d)},[n("div",Dt,[e(M).includes(t.id)?(o(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:c(h=>e(E)(h,t,d),["stop"]),checked:e(ne)},null,8,Et)):(o(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:c(h=>e(E)(h,t,d),["stop"]),checked:e(m).includes(t.id)},null,8,Lt)),n("span",Vt,[i(Xe,{id:d+1,raw:t},null,8,["id","raw"])])]),n("img",{class:"image",src:e(J)(t.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,Mt),n("div",zt,g(e(q)(t.path)),1),n("div",Bt,[n("span",null,g(e(Ce)(t.size)),1),n("a",{onClick:c(h=>e(Ae)(e(k),t.bucketId),["stop","prevent"])},g((_=Te.value[t.bucketId])==null?void 0:_.name),9,qt),i(ge,{tags:t.tags,type:e(u),"only-links":!0},null,8,["tags","type"])]),n("div",Ft,[p((o(),l("button",{class:"btn-icon sm",onClick:c(h=>e(x)(e(u),t),["stop"])},[Nt,i(b)],8,Kt)),[[r,s.$t("delete")]]),p((o(),l("button",{class:"btn-icon sm",onClick:c(h=>e(le)(t.path,e(q)(t.path).replace(" ","-")),["stop"])},[Ut,i(T)],8,Rt)),[[r,s.$t("download")]]),p((o(),l("button",{class:"btn-icon sm",onClick:c(h=>de(t),["stop"])},[Ht,i(H)],8,Gt)),[[r,s.$t("add_to_tags")]])]),n("div",Qt,[p((o(),l("span",null,[vs(g(e(bs)(t.createdAt)),1)])),[[r,e(ks)(t.createdAt)]])])],42,At)}),128))],2)):(o(),l("div",{key:0,class:B(["media-grid",{"select-mode":e(L)}])},[(o(!0),l(C,null,P($.value,(t,d)=>(o(),l("section",{class:B(["media-item",{selected:e(m).includes(t.id),selecting:e(M).includes(t.id)}]),key:t.id,onClick:c(_=>e(te)(_,t,d,G),["stop"]),onMouseover:_=>e(oe)(_,d)},[n("img",{class:"image",src:e(J)(t.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,_t),e(M).includes(t.id)?(o(),l("button",{key:0,class:"btn-icon btn-checkbox",onClick:c(_=>e(E)(_,t,d),["stop"])},[rt,e(ne)?(o(),w(Q,{key:0})):(o(),w(he,{key:1}))],8,ut)):e(m).includes(t.id)?(o(),l("button",{key:1,class:"btn-icon btn-checkbox",onClick:c(_=>e(E)(_,t,d),["stop"])},[mt,i(Q)],8,pt)):(o(),l(C,{key:2},[n("div",ht,[n("button",{class:"btn-icon sm btn-checkbox",onClick:c(_=>e(E)(_,t,d),["stop"])},[kt,e(m).includes(t.id)?(o(),w(Q,{key:0})):(o(),w(he,{key:1}))],8,gt),e(L)?p((o(),l("button",{key:0,class:"btn-icon sm",onClick:c(_=>G(d),["stop"])},[bt,i(We)],8,vt)),[[r,s.$t("open")]]):(o(),l(C,{key:1},[p((o(),l("button",{class:"btn-icon sm",onClick:c(_=>e(x)(e(u),t),["stop"])},[ft,i(b)],8,yt)),[[r,s.$t("delete")]]),p((o(),l("button",{class:"btn-icon sm",onClick:c(_=>e(le)(t.path,e(q)(t.path).replace(" ","-")),["stop"])},[wt,i(T)],8,Ct)),[[r,s.$t("download")]]),p((o(),l("button",{class:"btn-icon sm",onClick:c(_=>de(t),["stop"])},[It,i(H)],8,$t)),[[r,s.$t("add_to_tags")]])],64))]),n("div",Tt,[i(ge,{tags:t.tags,type:e(u)},null,8,["tags","type"]),n("span",St,g(e(Ce)(t.size)),1)])],64))],42,dt))),128))],2)),!e(k).imagesCardView&&$.value.length===0?(o(),l("div",Ot,g(s.$t(e(ys)(e(Fe),e(Ie).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):O("",!0),e(v)>S?(o(),w(Ye,{key:3,page:R.value,go:ae,total:e(v),limit:S},null,8,["page","total"])):O("",!0)])],64)}}});export{oo as default};
