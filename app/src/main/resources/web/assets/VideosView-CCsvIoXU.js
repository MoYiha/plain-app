import{_ as Vs}from"./VPagination.vuevuetypescriptsetuptruelang-CEZVU5HQ.js";import{_ as As,a as Ms,b as Fs,c as Rs,d as Ls}from"./grid-view-outline-rounded-DJvQQpw8.js";import{_ as Us}from"./FieldId.vuevuetypescriptsetuptruelang-BAr-ccW2.js";import{e as zs,f as qs,s as Ke,r as M,u as Bs,I as Ns,g as Hs,ah as Pe,ai as Ks,J as Ps,K as Qs,aM as Os,aN as Qe,aO as Ws,aj as js,aP as L,aI as me,L as Zs,aQ as Gs,aR as Xs,M as Js,N as Ys,c as r,o as t,a as v,k as a,l as e,O as xs,j as U,t as f,U as h,P as _,Q as eo,S as l,p as d,y as i,aS as J,aT as Y,al as so,T as V,am as oo,V as x,W as to,aU as no,aw as ao,b2 as lo,E as io,aW as co,a8 as ro,aX as uo,ak as _o,aY as po,R as vo,as as ko,b3 as Oe,aZ as mo,au as go,$ as fo,n as We,aa as je,a_ as yo,a0 as ho,F as $o,a1 as Co,A as bo,a2 as wo,a3 as Io,b4 as Ze,b0 as Ge,a4 as So,a5 as D}from"./index-CuU5w3Fk.js";import{_ as Do,a as Eo}from"./SearchInput-Do4mYLNe.js";import{_ as To,a as Vo}from"./upload-rounded-Bty2yz0H.js";import{_ as Ao}from"./MediaKeyboardShortcuts.vuevuetypescriptsetuptruelang-DEaP1BqB.js";import{a as Mo}from"./tags-C_c-1fHE.js";import{u as Fo,a as Ro}from"./key-events-CMYOn2tc.js";import{u as Lo}from"./search-cTEMyIe9.js";import"./VInputChip-Cze1-7DF.js";const Uo={class:"top-app-bar"},zo={class:"title"},qo={key:0},Bo={key:1},No={class:"actions"},Ho=["onClick"],Ko={class:"button-group"},Po=["onClick","onMouseover"],Qo=["src"],Oo=["src","onError"],Wo={key:1,class:"actions"},jo={class:"right"},Zo=["onClick","onMouseover"],Go={class:"start"},Xo={class:"number"},Jo={class:"image"},Yo=["src"],xo=["src","onError"],et={class:"title"},st={class:"subtitle"},ot=["onClick"],tt={class:"actions"},nt={class:"time"},at={key:2,class:"no-data-placeholder"},A=55,ft=zs({__name:"VideosView",setup(lt){var qe;const E=qs(),{videoSortBy:z}=Ke(E),T=M([]),{t:Xe}=Bs(),{parseQ:Je}=Lo(),I=Ns({tagIds:[],bucketId:void 0}),ge=Hs(),{app:F,urlTokenKey:ee,uploads:se}=Ke(ge),P=M(!1),oe=M(!1),{input:Ye,upload:xe,uploadChanged:fe}=Pe(se),{input:es,upload:ss,uploadChanged:ye}=Pe(se),{dropping:os,fileDragEnter:he,fileDragLeave:$e,dropFiles:ts}=Ks(se),te=M(!1),u=Ps.VIDEO,Ce=Qs(),be=Ce.query,ne=M(parseInt(((qe=be.page)==null?void 0:qe.toString())??"1")),{tags:Q,buckets:O,fetch:ns}=Os(u),as=Qe(()=>{const o={};return O.value.forEach(n=>{o[n.id]=n}),o}),b=M(""),{addToTags:ls}=Mo(u,Q),{deleteItems:ae,deleteItem:W}=Ws(),{view:is}=yo(u),{selectedIds:g,allChecked:we,realAllChecked:S,selectRealAll:ds,allCheckedAlertVisible:cs,clearSelection:q,toggleAllChecked:rs,toggleSelect:B,total:w,checked:N,shiftEffectingIds:j,handleItemClick:Ie,handleMouseOver:Se,selectAll:us,shouldSelect:De}=Fo(T),{downloadItems:Ee}=js(ee,u,q,()=>ao("videos")),{downloadFile:Z}=go(ee),Te=o=>{const n=Ce.query.q;bo(E,n?`/videos?page=${o}&q=${n}`:`/videos?page=${o}`)},{keyDown:Ve,keyUp:Ae}=Ro(w,A,ne,us,q,Te,()=>{J(Y.MEDIA_TRASH,F.value.osVersion)?X(u,K()):ae(u,g.value,S.value,w.value,b.value)}),le=M([]),_s=ko(),ps=Qe(()=>T.value.map(o=>({src:me(o.fileId),name:L(o.path),duration:o.duration,size:o.size,path:o.path,data:o,type:u}))),Me=o=>{le.value.push(o)},{loading:G,fetch:H}=Zs({handle:async(o,n)=>{if(te.value=!1,n)io(Xe(n),"error");else if(o){const C=[];for(const $ of o.videos)C.push({...$,fileId:co(ee.value,$.path,$.id)});T.value=C,w.value=o.videoCount}},document:lo,variables:()=>({offset:(ne.value-1)*A,limit:A,query:b.value,sortBy:z.value})}),{trashLoading:ie,trash:X}=Gs(),{restoreLoading:de,restore:ce}=Xs();function re(o){ge.lightbox={sources:ps.value,index:o,visible:!0}}const K=()=>{let o=b.value;return S.value||(o=`ids:${g.value.join(",")}`),o};function vs(o){z.value!==o&&(te.value=!0,z.value=o)}function ks(o){return o?`/videos?q=${o}`:"/videos"}function Fe(o){wo(Io,{type:u,tags:Q.value,item:{key:o.id,title:o.title,size:o.size},selected:Q.value.filter(n=>o.tags.some(C=>C.id===n.id))})}function ue(){const o=O.value.find(n=>n.id===I.bucketId);return o?Ge(o.topItems[0]):`${F.value.internalStoragePath}/Movies`}function ms(){xe(ue())}function gs(){ss(ue())}function fs(o){ts(o,ue(),n=>Ze(n.name))}const Re=o=>{o.type===u&&(q(),H())},Le=o=>{o.type===u&&H()},Ue=o=>{o.type===u&&(q(),H())},ze=o=>{o.status==="done"&&Ze(o.fileName)&&((!I.bucketId||O.value.some(C=>C.id===I.bucketId&&C.topItems.some($=>o.dir.startsWith(Ge($)))))&&setTimeout(()=>{H()},1e3),D.emit("media_items_actioned",{type:u,action:"upload",query:""}))};return Js(()=>{var o;b.value=So(((o=be.q)==null?void 0:o.toString())??""),Je(I,b.value),ns(),H(),D.on("item_tags_updated",Le),D.on("items_tags_updated",Re),D.on("media_items_actioned",Ue),D.on("upload_task_done",ze),window.addEventListener("keydown",Ve),window.addEventListener("keyup",Ae)}),Ys(()=>{D.off("item_tags_updated",Le),D.off("items_tags_updated",Re),D.off("media_items_actioned",Ue),D.off("upload_task_done",ze),window.removeEventListener("keydown",Ve),window.removeEventListener("keyup",Ae)}),(o,n)=>{const C=xs,$=ro,c=no,_e=uo,R=_o,pe=po,ve=vo,ys=Do,hs=Ao,$s=To,Be=so,Cs=Vo,bs=As,ws=Ms,Is=Eo,ke=Fs,Ne=Rs,Ss=mo,He=fo,Ds=Us,Es=Ls,Ts=Vs,p=eo("tooltip");return t(),r(h,null,[v("div",Uo,[a(C,{"touch-target":"wrapper",checked:e(we),indeterminate:!e(we)&&e(N),onChange:e(rs)},null,8,["checked","indeterminate","onChange"]),v("div",zo,[e(g).length?(t(),r("span",qo,f(o.$t("x_selected",{count:e(S)?e(w).toLocaleString():e(g).length.toLocaleString()})),1)):(t(),r("span",Bo,f(o.$t("page_title.videos"))+" ("+f(e(w).toLocaleString())+")",1)),e(N)?(t(),r(h,{key:2},[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{onClick:n[0]||(n[0]=i(s=>e(ae)(e(u),e(g),e(S),e(w),b.value),["stop"]))},{default:d(()=>[a($)]),_:1})),[[p,o.$t("delete")]]),_((t(),l(c,{loading:e(de)(K()),onClick:n[1]||(n[1]=i(s=>e(ce)(e(u),K()),["stop"]))},{default:d(()=>[a(_e)]),_:1},8,["loading"])),[[p,o.$t("restore")]]),_((t(),l(c,{onClick:n[2]||(n[2]=i(s=>e(Ee)(e(S),e(g),b.value),["stop"]))},{default:d(()=>[a(R)]),_:1})),[[p,o.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,loading:e(ie)(K()),onClick:n[3]||(n[3]=i(s=>e(X)(e(u),K()),["stop"]))},{default:d(()=>[a(pe)]),_:1},8,["loading"])),[[p,o.$t("move_to_trash")]]):_((t(),l(c,{key:1,onClick:n[4]||(n[4]=i(s=>e(ae)(e(u),e(g),e(S),e(w),b.value),["stop"]))},{default:d(()=>[a($)]),_:1})),[[p,o.$t("delete")]]),_((t(),l(c,{onClick:n[5]||(n[5]=i(s=>e(Ee)(e(S),e(g),b.value),["stop"]))},{default:d(()=>[a(R)]),_:1})),[[p,o.$t("download")]]),_((t(),l(c,{onClick:n[6]||(n[6]=i(s=>e(ls)(e(g),e(S),b.value),["stop"]))},{default:d(()=>[a(ve)]),_:1})),[[p,o.$t("add_to_tags")]])],64))],64)):U("",!0)]),v("div",No,[a(ys,{filter:I,tags:e(Q),buckets:e(O),"get-url":ks},null,8,["filter","tags","buckets"]),a(hs),I.trash?U("",!0):(t(),l(Be,{key:0,modelValue:P.value,"onUpdate:modelValue":n[9]||(n[9]=s=>P.value=s)},{trigger:d(()=>[_((t(),l(c,null,{default:d(()=>[a($s)]),_:1})),[[p,o.$t("upload")]])]),default:d(()=>[v("div",{class:"dropdown-item",onClick:n[7]||(n[7]=i(s=>{ms(),P.value=!1},["stop"]))},f(o.$t("upload_files")),1),v("div",{class:"dropdown-item",onClick:n[8]||(n[8]=i(s=>{gs(),P.value=!1},["stop"]))},f(o.$t("upload_folder")),1)]),_:1},8,["modelValue"])),a(Be,{modelValue:oe.value,"onUpdate:modelValue":n[10]||(n[10]=s=>oe.value=s)},{trigger:d(()=>[_((t(),l(c,{loading:te.value},{default:d(()=>[a(Cs)]),_:1},8,["loading"])),[[p,o.$t("sort")]])]),default:d(()=>[(t(!0),r(h,null,x(e(_s),s=>(t(),r("div",{key:s.value,class:V(["dropdown-item",{selected:s.value===e(z)}]),onClick:y=>{vs(s.value),oe.value=!1}},f(o.$t(s.label)),11,Ho))),128))]),_:1},8,["modelValue"]),v("div",Ko,[v("button",{class:V({selected:!e(E).videosCardView}),onClick:n[11]||(n[11]=s=>e(E).videosCardView=!1)},[a(bs)],2),v("button",{class:V({selected:e(E).videosCardView}),onClick:n[12]||(n[12]=s=>e(E).videosCardView=!0)},[a(ws)],2)])])]),a(Is,{limit:A,total:e(w),"all-checked-alert-visible":e(cs),"real-all-checked":e(S),"select-real-all":e(ds),"clear-selection":e(q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),v("div",{class:"scroll-content",onDragover:n[16]||(n[16]=i((...s)=>e(he)&&e(he)(...s),["stop","prevent"]))},[_(v("div",{class:"drag-mask",onDrop:i(fs,["stop","prevent"]),onDragleave:n[13]||(n[13]=i((...s)=>e($e)&&e($e)(...s),["stop","prevent"]))},f(o.$t("release_to_send_files")),545),[[oo,e(os)]]),e(E).videosCardView?(t(),r("div",{key:1,class:V(["media-list",{"select-mode":e(N)}])},[(t(!0),r(h,null,x(T.value,(s,y)=>{var k;return t(),r("section",{key:s.id,class:V(["media-item selectable-card",{selected:e(g).includes(s.id),selecting:e(j).includes(s.id)}]),onClick:i(m=>e(Ie)(m,s,y,re),["stop"]),onMouseover:m=>e(Se)(m,y)},[v("div",Go,[e(j).includes(s.id)?(t(),l(C,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(De),onClick:i(m=>e(B)(m,s,y),["stop"])},null,8,["checked","onClick"])):(t(),l(C,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(g).includes(s.id),onClick:i(m=>e(B)(m,s,y),["stop"])},null,8,["checked","onClick"])),v("span",Xo,[a(Ds,{id:y+1,raw:s},null,8,["id","raw"])])]),v("div",Jo,[le.value.includes(s.id)?(t(),r("img",{key:0,src:`/ficons/${e(Oe)(s.path)}.svg`,class:"svg"},null,8,Yo)):(t(),r("img",{key:1,class:"image-thumb",src:e(me)(s.fileId,"&w=200&h=200"),onError:m=>Me(s.id)},null,40,xo))]),v("div",et,f(e(L)(s.path)),1),v("div",st,[v("span",null,f(e(We)(s.size)),1),v("span",null,f(e(je)(s.duration)),1),v("a",{onClick:i(m=>e(is)(e(E),s.bucketId),["stop","prevent"])},f((k=as.value[s.bucketId])==null?void 0:k.name),9,ot),a(He,{tags:s.tags,type:e(u),"only-links":!0},null,8,["tags","type"])]),v("div",tt,[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{class:"sm",onClick:i(m=>e(W)(e(u),s),["stop"])},{default:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),_((t(),l(c,{class:"sm",loading:e(de)(`ids:${s.id}`),onClick:i(m=>e(ce)(e(u),`ids:${s.id}`),["stop"])},{default:d(()=>[a(_e)]),_:2},1032,["loading","onClick"])),[[p,o.$t("restore")]]),_((t(),l(c,{class:"sm",onClick:i(m=>e(Z)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{default:d(()=>[a(R)]),_:2},1032,["onClick"])),[[p,o.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,class:"sm",loading:e(ie)(`ids:${s.id}`),onClick:i(m=>e(X)(e(u),`ids:${s.id}`),["stop"])},{default:d(()=>[a(pe)]),_:2},1032,["loading","onClick"])),[[p,o.$t("move_to_trash")]]):_((t(),l(c,{key:1,class:"sm",onClick:i(m=>e(W)(e(u),s),["stop"])},{default:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),_((t(),l(c,{class:"sm",onClick:i(m=>e(Z)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{default:d(()=>[a(R)]),_:2},1032,["onClick"])),[[p,o.$t("download")]]),_((t(),l(c,{class:"sm",onClick:i(m=>Fe(s),["stop"])},{default:d(()=>[a(ve)]),_:2},1032,["onClick"])),[[p,o.$t("add_to_tags")]])],64))]),v("div",nt,[_((t(),r("span",null,[$o(f(e(Co)(s.createdAt)),1)])),[[p,e(ho)(s.createdAt)]])])],42,Zo)}),128)),e(G)&&T.value.length===0?(t(),l(Es,{key:0,limit:A})):U("",!0)],2)):(t(),r("div",{key:0,class:V(["media-grid",{"select-mode":e(N)}])},[(t(!0),r(h,null,x(T.value,(s,y)=>(t(),r("section",{key:s.id,class:V(["media-item",{selected:e(g).includes(s.id),selecting:e(j).includes(s.id)}]),onClick:i(k=>e(Ie)(k,s,y,re),["stop"]),onMouseover:k=>e(Se)(k,y)},[le.value.includes(s.id)?(t(),r("img",{key:0,src:`/ficons/${e(Oe)(s.path)}.svg`,class:"image svg"},null,8,Qo)):(t(),r("img",{key:1,class:"image image-thumb",src:e(me)(s.fileId,"&w=200&h=200"),onError:k=>Me(s.id)},null,40,Oo)),e(j).includes(s.id)?(t(),l(c,{key:2,class:"btn-checkbox",onClick:i(k=>e(B)(k,s,y),["stop"])},{default:d(()=>[e(De)?(t(),l(ke,{key:0})):(t(),l(Ne,{key:1}))]),_:2},1032,["onClick"])):e(g).includes(s.id)?(t(),l(c,{key:3,class:"btn-checkbox",onClick:i(k=>e(B)(k,s,y),["stop"])},{default:d(()=>[a(ke)]),_:2},1032,["onClick"])):(t(),r(h,{key:4},[a(c,{class:"btn-checkbox",onClick:i(k=>e(B)(k,s,y),["stop"])},{default:d(()=>[e(g).includes(s.id)?(t(),l(ke,{key:0})):(t(),l(Ne,{key:1}))]),_:2},1032,["onClick"]),e(N)?_((t(),l(c,{key:0,class:"btn-zoom sm",onClick:i(k=>re(y),["stop"])},{default:d(()=>[a(Ss)]),_:2},1032,["onClick"])),[[p,o.$t("open")]]):(t(),r("div",Wo,[I.trash?(t(),r(h,{key:0},[_((t(),l(c,{class:"sm",onClick:i(k=>e(W)(e(u),s),["stop"])},{default:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),_((t(),l(c,{class:"sm",loading:e(de)(`ids:${s.id}`),onClick:i(k=>e(ce)(e(u),`ids:${s.id}`),["stop"])},{default:d(()=>[a(_e)]),_:2},1032,["loading","onClick"])),[[p,o.$t("restore")]]),_((t(),l(c,{class:"sm",onClick:i(k=>e(Z)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{default:d(()=>[a(R)]),_:2},1032,["onClick"])),[[p,o.$t("download")]])],64)):(t(),r(h,{key:1},[e(J)(e(Y).MEDIA_TRASH,e(F).osVersion)?_((t(),l(c,{key:0,class:"sm",loading:e(ie)(`ids:${s.id}`),onClick:i(k=>e(X)(e(u),`ids:${s.id}`),["stop"])},{default:d(()=>[a(pe)]),_:2},1032,["loading","onClick"])),[[p,o.$t("move_to_trash")]]):_((t(),l(c,{key:1,class:"sm",onClick:i(k=>e(W)(e(u),s),["stop"])},{default:d(()=>[a($)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),_((t(),l(c,{class:"sm",onClick:i(k=>e(Z)(s.path,e(L)(s.path).replace(" ","-")),["stop"])},{default:d(()=>[a(R)]),_:2},1032,["onClick"])),[[p,o.$t("download")]]),_((t(),l(c,{class:"sm",onClick:i(k=>Fe(s),["stop"])},{default:d(()=>[a(ve)]),_:2},1032,["onClick"])),[[p,o.$t("add_to_tags")]])],64))])),v("div",{class:V(["info",{"has-tags":s.tags.length>0}])},[a(He,{tags:s.tags,type:e(u)},null,8,["tags","type"]),v("span",jo,f(["SIZE_ASC","SIZE_DESC"].includes(e(z))?e(We)(s.size):e(je)(s.duration)),1)],2)],64))],42,Po))),128)),e(G)&&T.value.length===0?(t(),r(h,{key:0},x(A,s=>v("section",{key:s,class:"skeleton-image media-item"})),64)):U("",!0)],2)),!e(G)&&T.value.length===0?(t(),r("div",at,f(o.$t(e(to)(e(G),e(F).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):U("",!0),e(w)>A?(t(),l(Ts,{key:3,page:ne.value,go:Te,total:e(w),limit:A},null,8,["page","total"])):U("",!0),v("input",{ref_key:"fileInput",ref:Ye,style:{display:"none"},type:"file",accept:"video/*",multiple:"",onChange:n[14]||(n[14]=(...s)=>e(fe)&&e(fe)(...s))},null,544),v("input",{ref_key:"dirFileInput",ref:es,style:{display:"none"},type:"file",accept:"video/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[15]||(n[15]=(...s)=>e(ye)&&e(ye)(...s))},null,544)],32)],64)}}});export{ft as default};
