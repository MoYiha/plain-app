import{_ as Be}from"./more-vert-XVOmELru.js";import{u as ue,r as b,G as _e,c8 as Ge,A as D,d as xe,e as Ke,s as We,f as He,D as Pe,E as je,F as Oe,aE as ne,a2 as ae,i as le,H as Je,I as Xe,c as l,o as n,a as o,j as r,h as F,L as Ye,k as e,t as p,N as ie,n as q,J as Ze,x as f,a6 as es,K as ss,O as ts,a1 as de,bh as os,P as ns,c7 as as,bM as ls,c9 as is,ca as ds,cb as cs,X as rs,M as us,R as _s,U as ps,V as fs,W as ms,T as vs,ay as gs,y as ce,$ as hs,a0 as m,cc as ks,C as ys}from"./index-Dohfv8Fq.js";import{_ as bs,a as ws}from"./SearchInput-NYtHFioA.js";import{_ as $s,a as Cs}from"./add-notes-outline-rounded-BZvnlf5C.js";import{u as Ts}from"./feeds-C8QCcad_.js";import{u as Ss,b as Ls,a as Es}from"./key-events-COB8z-tk.js";import{a as Fs}from"./tags-TPcx2lPg.js";import{u as qs}from"./search-BGPnRmZx.js";import"./search-rounded-DoLKRhlL.js";import"./rss-feed-rounded-DCFCzJSD.js";import"./vee-validate-BgwL6Mce.js";const Ds=(N,u,w)=>{const{t:$}=ue(),v=b(1),I=100,d=b(!1),{loading:C,fetch:A}=_e({handle:(g,T)=>{if(T)D($(T),"error");else if(g){g.items.length<I&&(d.value=!0);const S=g.items;v.value===1?N.value=S:N.value=N.value.concat(S),w.value=g.total}},document:Ge,variables:()=>({offset:(v.value-1)*I,limit:I,query:u.value})});return{page:v,noMore:d,loading:C,fetch:A,loadMore:()=>{d.value||C.value||v.value++}}},Is={class:"top-app-bar"},Ms=["checked","indeterminate"],Ns={class:"title"},As={key:0},Rs={key:1},Us={key:0,indeterminate:"",class:"spinner-sm"},Vs={class:"actions"},Qs={key:0,indeterminate:"",class:"spinner-sm"},zs=["disabled"],Bs={key:0,class:"scroller"},Gs={class:"subtitle"},xs={class:"number"},Ks=["href"],Ws=["onClick","onMouseover"],Hs={class:"title"},Ps=["checked","onClick"],js=["checked","onClick"],Os={class:"text"},Js={class:"subtitle"},Xs={class:"number"},Ys={class:"info"},Zs=["onClick"],et={class:"time"},st={class:"btn-icon sm",style:{display:"none"}},tt=["src"],ot={key:0,indeterminate:"",class:"spinner-sm"},nt={key:2,class:"no-data-placeholder"},re=100,at=xe({__name:"FeedsSidebar2",setup(N){var te;const u=Ke(),{feedsSyncing:w}=We(He()),{t:$}=ue(),v=Pe({tagIds:[]}),{parseQ:I}=qs(),d=je.FEED_ENTRY,C=Oe(),A=C.query,g=b(parseInt(((te=A.page)==null?void 0:te.toString())??"1")),T=b([]),S=b([]),Q=ne(()=>{const s={};return S.value.forEach(t=>{s[t.id]=t}),s}),h=b([]),k=b(""),{selectedIds:c,allChecked:z,realAllChecked:L,selectRealAll:pe,allCheckedAlertVisible:fe,clearSelection:R,toggleAllChecked:B,toggleSelect:G,total:y,checked:x,shiftEffectingIds:K,handleItemClick:me,handleMouseOver:ve,selectAll:ge,shouldSelect:he}=Ss(h),ke=s=>{g.value=s;const t=C.query.q;ce(u,t?`/feeds?page=${s}&q=${t}`:`/feeds?page=${s}`)},{keyDown:W,keyUp:H}=Es(y,re,g,ge,R,ke,()=>{O(c.value,L.value,y.value,k.value)}),{page:P,loading:V,loadMore:ye,fetch:be,noMore:j}=Ds(h,k,y),{addToTags:we}=Fs(d,T),M=()=>{P.value=1,be()},{deleteItems:O}=Ls(ks,()=>{R(),M(),h.value.some(s=>s.tags.length)&&m.emit("refetch_tags",d),m.emit("feed_entries_deleted")}),$e=ne(()=>ae.currentRoute.value.path!=="/feeds"),{resizeWidth:J}=as(300,()=>u.sidebar2Width,s=>{u.sidebar2Width=s}),{mutate:X,loading:Ce,onDone:Te}=le({document:is});function Se(){if(L)X({query:k.value});else{if(c.value.length===0){D($("select_first"),"error");return}X({query:`ids:${c.value.join(",")}`})}}Te(()=>{D($("saved"))});function Le(s){return s?`/feeds?q=${s}`:"/feeds"}const{fetch:Ee}=_e({handle:async(s,t)=>{t?D($(t),"error"):s&&(T.value=s.tags,S.value=s.feeds)},document:ds,variables:{type:d}});function Y(s){const t=ae.currentRoute.value.query.q;return t?`/feeds/${s.feedId}/entries/${s.id}?q=${t}`:`/feeds/${s.feedId}/entries/${s.id}`}function Fe(s){ce(u,Y(s))}const{viewFeed:qe}=Ts(u),{mutate:De}=le({document:cs});function Ie(){w.value=!0,De({id:""})}const Z=s=>{w.value=!1,M(),s.error?D(s.error,"error"):D($("feeds_synced"))},ee=s=>{s.type===d&&(R(),M())},se=s=>{s.type===d&&M()};return Je(()=>{var t,U;const s=(t=document.getElementsByClassName("scroller"))==null?void 0:t[0];s&&(s.scrollTop=0),k.value=hs(((U=A.q)==null?void 0:U.toString())??""),I(v,k.value),Ee(),M(),m.on("item_tags_updated",se),m.on("items_tags_updated",ee),m.on("feeds_fetched",Z),window.addEventListener("keydown",W),window.addEventListener("keyup",H)}),Xe(()=>{P.value=1,j.value=!1,m.off("item_tags_updated",se),m.off("items_tags_updated",ee),m.off("feeds_fetched",Z),window.removeEventListener("keydown",W),window.removeEventListener("keyup",H)}),(s,t)=>{const U=es,Me=ss,Ne=$s,Ae=bs,Re=Cs,Ue=ws,Ve=_s,Qe=vs,ze=Be,E=Ze("tooltip");return n(),l("aside",{class:"sidebar2",style:ls({width:e(C).params.id?e(u).sidebar2Width+"px":"auto"})},[o("div",Is,[o("md-checkbox",{"touch-target":"wrapper",checked:e(z),indeterminate:!e(z)&&e(x),onChange:t[0]||(t[0]=(...i)=>e(B)&&e(B)(...i))},null,40,Ms),o("div",Ns,[e(c).length?(n(),l("span",As,p(s.$t("x_selected",{count:e(L)?e(y).toLocaleString():e(c).length.toLocaleString()})),1)):(n(),l("span",Rs,p(s.$t("page_title.feeds"))+" ("+p(e(y).toLocaleString())+")",1)),e(x)?(n(),l(ie,{key:2},[q((n(),l("button",{class:"btn-icon",onClick:t[1]||(t[1]=f(i=>e(O)(e(c),e(L),e(y),k.value),["stop"]))},[t[4]||(t[4]=o("md-ripple",null,null,-1)),r(U)])),[[E,s.$t("delete")]]),q((n(),l("button",{class:"btn-icon",onClick:t[2]||(t[2]=f(i=>e(we)(e(c),e(L),k.value),["stop"]))},[t[5]||(t[5]=o("md-ripple",null,null,-1)),r(Me)])),[[E,s.$t("add_to_tags")]]),e(Ce)?(n(),l("md-circular-progress",Us)):q((n(),l("button",{key:1,class:"btn-icon sm",onClick:f(Se,["prevent"])},[t[6]||(t[6]=o("md-ripple",null,null,-1)),r(Ne)])),[[E,s.$t("save_to_notes")]])],64)):F("",!0)]),o("div",Vs,[r(Ae,{filter:v,tags:T.value,feeds:S.value,"show-chips":!$e.value,"get-url":Le,"show-today":!0},null,8,["filter","tags","feeds","show-chips"]),e(w)?(n(),l("md-circular-progress",Qs)):q((n(),l("button",{key:1,class:"btn-icon",disabled:e(w),onClick:f(Ie,["prevent"])},[t[7]||(t[7]=o("md-ripple",null,null,-1)),r(Re)],8,zs)),[[E,s.$t("sync_feeds")]])])]),r(Ue,{limit:re,total:e(y),"all-checked-alert-visible":e(fe),"real-all-checked":e(L),"select-real-all":e(pe),"clear-selection":e(R)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(V)&&h.value.length===0?(n(),l("div",Bs,[(n(),l(ie,null,ts(20,i=>o("section",{key:i,class:"feed-item selectable-card-skeleton"},[t[9]||(t[9]=rs('<div class="title" data-v-9fe1976f><div class="checkbox" data-v-9fe1976f><div class="skeleton-checkbox" data-v-9fe1976f></div></div><div class="text" data-v-9fe1976f><div class="skeleton-text skeleton-title" data-v-9fe1976f></div></div></div>',1)),o("div",Gs,[o("span",xs,p(i),1),t[8]||(t[8]=o("div",{class:"info"},[o("div",{class:"skeleton-text skeleton-info"})],-1))]),t[10]||(t[10]=o("div",{class:"image"},[o("div",{class:"skeleton-image"})],-1))])),64))])):F("",!0),h.value.length>0?(n(),Ye(e(os),{key:1,class:"scroller","data-key":"id","data-sources":h.value,"estimate-size":100,onTobottom:e(ye)},{item:de(({index:i,item:a})=>{var oe;return[o("a",{class:"item-link",href:Y(a)},[o("article",{class:us(["feed-item selectable-card",{selected:e(c).includes(a.id)||a.id==s.$route.params.id,selecting:e(K).includes(a.id)}]),onClick:f(_=>e(me)(_,a,i,()=>{Fe(a)}),["stop","prevent"]),onMouseover:_=>e(ve)(_,i)},[o("div",Hs,[e(K).includes(a.id)?(n(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",checked:e(he),onClick:f(_=>e(G)(_,a,i),["stop"])},null,8,Ps)):(n(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",checked:e(c).includes(a.id),onClick:f(_=>e(G)(_,a,i),["stop"])},null,8,js)),o("div",Os,p(a.title||s.$t("no_content")),1)]),o("div",Js,[o("span",Xs,[r(Ve,{id:i+1,raw:a},null,8,["id","raw"])]),o("div",Ys,[o("a",{onClick:f(_=>e(qe)(Q.value[a.feedId]),["stop","prevent"])},p((oe=Q.value[a.feedId])==null?void 0:oe.name),9,Zs),t[11]||(t[11]=o("span",null,"Â·",-1)),q((n(),l("span",et,[fs(p(e(ms)(a.publishedAt)),1)])),[[E,e(ps)(a.publishedAt)]]),r(Qe,{tags:a.tags,type:e(d),"only-links":!0},null,8,["tags","type"])])]),q((n(),l("button",st,[t[12]||(t[12]=o("md-ripple",null,null,-1)),r(ze)])),[[E,s.$t("actions")]]),a.image?(n(),l("img",{key:0,class:"image",src:e(gs)(a.image,"&w=200&h=200")},null,8,tt)):F("",!0)],42,Ws)],8,Ks)]}),footer:de(()=>[e(j)?F("",!0):(n(),l("md-circular-progress",ot))]),_:1},8,["data-sources","onTobottom"])):F("",!0),!e(V)&&h.value.length===0?(n(),l("div",nt,p(s.$t(e(ns)(e(V)))),1)):F("",!0),o("div",{class:"sidebar-drag-indicator",onMousedown:t[3]||(t[3]=(...i)=>e(J)&&e(J)(...i))},null,32)],4)}}}),gt=ys(at,[["__scopeId","data-v-9fe1976f"]]);export{gt as default};
