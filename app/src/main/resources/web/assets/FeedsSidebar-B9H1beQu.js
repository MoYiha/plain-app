import{_ as Le}from"./LeftSidebar.vuevuetypescriptsetuptruelang-Bwcxwg_R.js";import{a as Te,_ as xe,b as Se}from"./TagFilter.vuevuetypescriptsetuptruelang-nDSyeZ_O.js";import{e as z,aA as oe,r,i as N,ce as qe,aB as ae,aC as se,ae as le,aE as ce,aD as Q,J as A,o as _,q as u,k as p,G as g,t as s,ak as de,j as R,l as n,Z as ue,A as ie,a as c,v as re,x as _e,y as pe,aF as fe,cf as Ie,u as De,f as Qe,s as Re,g as Ae,K as Be,N as Ge,w as Ne,h as Ke,bq as Ue,F as W,a5 as B,af as je,a6 as X,a4 as ze,cg as Oe,ch as Pe,ci as He,cj as Je,c as $,z as G,T as U,V as ee,Q as te,R as Ye,ck as Ze,U as ne,a2 as j,ac as We,cl as Xe,B as et}from"./index-DRp6xo3j.js";import{_ as me}from"./VCheckbox-COaKMA3E.js";import{u as tt}from"./feeds-92enUHJ0.js";import{u as nt}from"./search-VN1T4MU3.js";const ot={class:"form-row"},at={class:"form-row"},st={class:"form-check-label"},lt=z({__name:"AddFeedModal",props:{done:{type:Function,required:!0}},setup(q){const{handleSubmit:F}=oe(),k=r(),d=r(!1);function I(e){d.value=e.target.checked}const m=q,{mutate:M,loading:E,onDone:y}=N({document:qe}),{value:l,resetField:f,errorMessage:v}=ae("inputValue",se().required());f();function h(){Q()}le(async()=>{await ce(),requestAnimationFrame(()=>{setTimeout(()=>{var e;try{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),(e=k.value)==null||e.focus()}catch(i){console.debug("Focus blocked:",i)}},100)})});const b=F(()=>{M({url:l.value??"",fetchContent:d.value})});return y(()=>{var e;(e=m.done)==null||e.call(this),Q()}),(e,i)=>{const w=pe,L=me,T=de,D=ue,x=ie,S=fe;return _(),A(S,{onClose:h},{headline:u(()=>[g(s(e.$t("add_subscription")),1)]),content:u(()=>[c("div",ot,[p(w,{ref_key:"inputRef",ref:k,modelValue:n(l),"onUpdate:modelValue":i[0]||(i[0]=V=>_e(l)?l.value=V:null),label:e.$t("rss_url"),error:!!n(v),"error-text":n(v)?e.$t(n(v)):"",onKeyup:re(n(b),["enter"])},null,8,["modelValue","label","error","error-text","onKeyup"])]),c("div",at,[c("label",st,[p(L,{"touch-target":"wrapper",checked:d.value,onChange:I},null,8,["checked"]),g(" "+s(e.$t("fetch_content_automatically")),1)])])]),actions:u(()=>[p(T,{value:"cancel",onClick:h},{default:u(()=>[g(s(e.$t("cancel")),1)]),_:1}),p(x,{value:"save",disabled:n(E),onClick:n(b)},{default:u(()=>[n(E)?(_(),A(D,{key:0,indeterminate:""})):R("",!0),g(" "+s(e.$t("save")),1)]),_:1},8,["disabled","onClick"])]),_:1})}}}),ct={class:"form-label"},dt={class:"form-row"},ut={class:"form-row"},it={class:"form-check-label"},rt=z({__name:"FeedModal",props:{data:{type:Object,required:!0}},setup(q){var h,b;const{handleSubmit:F}=oe(),k=r(),d=r(!1);function I(e){d.value=e.target.checked}const m=q,{mutate:M,loading:E,onDone:y}=N({document:Ie}),{value:l,errorMessage:f}=ae("inputValue",se().required());l.value=((h=m.data)==null?void 0:h.name)??"",d.value=((b=m.data)==null?void 0:b.fetchContent)??!1,(async()=>(await ce(),requestAnimationFrame(()=>{setTimeout(()=>{var e;try{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),(e=k.value)==null||e.focus()}catch(i){console.debug("Focus blocked:",i)}},100)})))();const v=F(()=>{var e;M({id:(e=m.data)==null?void 0:e.id,name:l.value,fetchContent:d.value})});return y(()=>{Q()}),(e,i)=>{const w=pe,L=me,T=de,D=ue,x=ie,S=fe;return _(),A(S,{onClose:n(Q)},{headline:u(()=>[g(s(e.$t("update_subscription")),1)]),content:u(()=>{var V;return[c("div",ct,s((V=q.data)==null?void 0:V.url),1),c("div",dt,[p(w,{ref_key:"inputRef",ref:k,modelValue:n(l),"onUpdate:modelValue":i[0]||(i[0]=K=>_e(l)?l.value=K:null),class:"form-control",label:e.$t("name"),error:!!n(f),"error-text":n(f)?e.$t(n(f)):"",onKeyup:re(n(v),["enter"])},null,8,["modelValue","label","error","error-text","onKeyup"])]),c("div",ut,[c("label",it,[p(L,{"touch-target":"wrapper",checked:d.value,onChange:I},null,8,["checked"]),g(" "+s(e.$t("fetch_content_automatically")),1)])])]}),actions:u(()=>[p(T,{value:"cancel",onClick:n(Q)},{default:u(()=>[g(s(e.$t("cancel")),1)]),_:1},8,["onClick"]),p(x,{value:"save",disabled:n(E),onClick:n(v)},{default:u(()=>[n(E)?(_(),A(D,{key:0,indeterminate:""})):R("",!0),g(" "+s(e.$t("save")),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["onClose"])}}}),_t={class:"nav"},pt={class:"title"},ft={key:0,class:"count"},mt={class:"title"},vt={key:0,class:"count"},ht=["onClick"],gt={class:"title"},kt=["id","onClick"],yt={key:0,class:"count"},bt=["onClick"],Mt=z({__name:"FeedsSidebar",setup(q){const{t:F}=De(),k=Qe(),{counter:d}=Re(Ae()),{parseQ:I}=nt(),m=Be({tagIds:[]}),M=r([]),E=[{text:"add_subscription",click:ve},{text:"import_opml_file",click:be},{text:"export_opml_file",click:Ce}],y=r(!1),l=r(""),f=r(""),v=r(!1),h=r(),b=r(new Map),e=r(!1),i=r(),{fetch:w}=Ge({handle:t=>{t&&(d.value.feedEntries=t.total,d.value.feedEntriesToday=t.today,t.feedsCount.forEach(o=>{b.value.set(o.id,o.count)}))},document:Oe,variables:()=>({})});function L(t){return b.value.get(t)??-1}function T(){var C;const t=X.currentRoute.value,o=ze(((C=t.query.q)==null?void 0:C.toString())??"");I(m,o),l.value=m.tagIds.length===1?m.tagIds[0]:"",f.value=m.feedId??"",v.value=m.today??!1,v.value?(l.value="",f.value=""):l.value&&f.value&&(l.value=""),w()}T(),Ne(()=>X.currentRoute.value,()=>{T()});const{viewFeed:D,viewAll:x,viewToday:S}=tt(k),{refetch:V}=Ke({handle:(t,o)=>{o?W(F(o),"error"):t&&(M.value=t.feeds)},document:Pe});function K(t){const o=t.target.files;if(!o)return;const C=new FileReader;C.addEventListener("load",()=>{ke({content:C.result})},!1),C.readAsText(o[0])}function ve(){j(lt,{done:()=>{V()}})}const{mutate:he,onDone:ge}=N({document:He});ge(t=>{Ue(t.data.exportFeeds,"application/xml","feeds.xml")});const{mutate:ke,onDone:ye}=N({document:Je});ye(()=>{W(F("imported")),V()});function be(){h.value.value="",h.value.click()}function Ce(){he()}function $e(t){i.value=t;const o=document.getElementById("feed-"+t.id);document.dispatchEvent(new CustomEvent("dropdown-toggle",{detail:{exclude:o}})),e.value=!0}function Fe(t){j(rt,{data:t})}function Ee(t){j(We,{id:t.id,name:t.name,gql:Xe,typeName:"Feed",done:()=>{et(k,"/feeds")}})}const O=()=>{w()},P=()=>{w()};return le(()=>{B.on("feed_entries_deleted",O),B.on("feeds_fetched",P)}),je(()=>{B.off("feed_entries_deleted",O),B.off("feeds_fetched",P)}),(t,o)=>{const C=Se,we=Ze,H=Te,Ve=xe,Me=Le,J=Ye("tooltip");return _(),A(Me,null,{title:u(()=>[g(s(t.$t("page_title.feeds")),1)]),actions:u(()=>[te((_(),$("button",{id:"add-feed-ref",class:"btn-icon",onClick:o[0]||(o[0]=()=>y.value=!0)},[p(C)])),[[J,n(F)("add_subscription")]])]),body:u(()=>{var Y;return[c("ul",_t,[c("li",{class:U({active:!v.value&&!l.value&&!f.value}),onClick:o[1]||(o[1]=G((...a)=>n(x)&&n(x)(...a),["prevent"]))},[c("span",pt,s(t.$t("all")),1),n(d).feedEntries>=0?(_(),$("span",ft,s(n(d).feedEntries.toLocaleString()),1)):R("",!0)],2),c("li",{class:U({active:v.value}),onClick:o[2]||(o[2]=G((...a)=>n(S)&&n(S)(...a),["prevent"]))},[c("span",mt,s(t.$t("today")),1),n(d).feedEntriesToday>=0?(_(),$("span",vt,s(n(d).feedEntriesToday.toLocaleString()),1)):R("",!0)],2),(_(!0),$(ne,null,ee(M.value,a=>(_(),$("li",{key:a.id,class:U({active:f.value&&a.id===f.value}),onClick:G(Z=>n(D)(a),["stop","prevent"])},[c("span",gt,s(a.name),1),te((_(),$("button",{id:"feed-"+a.id,class:"btn-icon sm",onClick:G(Z=>$e(a),["prevent","stop"])},[p(we)],8,kt)),[[J,t.$t("actions")]]),L(a.id)>=0?(_(),$("span",yt,s(L(a.id).toLocaleString()),1)):R("",!0)],10,ht))),128))]),p(H,{modelValue:y.value,"onUpdate:modelValue":o[3]||(o[3]=a=>y.value=a),anchor:"add-feed-ref"},{default:u(()=>[(_(),$(ne,null,ee(E,a=>c("div",{key:a.text,class:"dropdown-item",onClick:Z=>{a.click(),y.value=!1}},s(t.$t(a.text)),9,bt)),64))]),_:1},8,["modelValue"]),p(H,{modelValue:e.value,"onUpdate:modelValue":o[6]||(o[6]=a=>e.value=a),anchor:"feed-"+((Y=i.value)==null?void 0:Y.id)},{default:u(()=>[c("div",{class:"dropdown-item",onClick:o[4]||(o[4]=a=>{Fe(i.value),e.value=!1})},s(t.$t("edit")),1),c("div",{class:"dropdown-item",onClick:o[5]||(o[5]=a=>{Ee(i.value),e.value=!1})},s(t.$t("delete")),1)]),_:1},8,["modelValue","anchor"]),p(Ve,{type:"FEED_ENTRY",selected:l.value},null,8,["selected"]),c("input",{ref_key:"fileInput",ref:h,style:{display:"none"},accept:".xml",type:"file",onChange:K},null,544)]}),_:1})}}});export{Mt as default};
